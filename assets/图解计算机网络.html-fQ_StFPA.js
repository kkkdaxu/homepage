import{_ as p}from"./plugin-vue_export-helper-DlAUqK2U.js";import{r,o as i,c as g,a as o,b as t,d as e,e as n}from"./app-DxhWEvMr.js";const a="/homepage/assets/åº”ç”¨å±‚-17113568856832-DLu56jHA.png",l="/homepage/assets/TCPæ®µ-17113568856821-CcSZgBBr.png",c="/homepage/assets/ç½‘ç»œå±‚-17113568856833-BdsDnNH5.png",d="/homepage/assets/12-17113568856834-U6a9WeMF.jpg",m="/homepage/assets/16-17113568856835-C-B-5tgT.jpg",T="/homepage/assets/å­ç½‘æ©ç è®¡ç®—å™¨-17113568856836-CQxjsmso.png",h="/homepage/assets/17-17113568856837-CZW5hMJZ.jpg",u="/homepage/assets/ç½‘ç»œæ¥å£å±‚-17113568856838-BhTkNj9M.png",_="/homepage/assets/tcpipå‚è€ƒæ¨¡å‹.drawio-17113568856839-DO_2IWRR.png",P="/homepage/assets/å°è£…-17095571212752-Cea2uy32.png",C="/homepage/assets/2-Bu98tyy8.jpg",b="/homepage/assets/3-Butmlozp.jpg",k="/homepage/assets/4-DcEsvKTB.jpg",f="/homepage/assets/5-C4V50KJO.jpg",S="/homepage/assets/6-DOFr9pIO.jpg",A="/homepage/assets/7-b7PJDG7w.jpg",I="/homepage/assets/8-BPU93unx.jpg",x="/homepage/assets/TCPä¸‰æ¬¡æ¡æ‰‹.drawio-CRyunhoY.png",N="/homepage/assets/10-1uUawnNq.jpg",q="/homepage/assets/11-C3FbMqeU.jpg",y="/homepage/assets/12-170945132350423-TP4lFMOP.jpg",H="/homepage/assets/13-DOKqDVrx.jpg",v="/homepage/assets/14-BpsqDyse.jpg",z="/homepage/assets/15-BdobvrRH.jpg",E="/homepage/assets/16-170945132350111-t60v6E8A.jpg",w="/homepage/assets/17-170945132350212-G7x2toB9.jpg",K="/homepage/assets/18-CyBAb_HX.jpg",D="/homepage/assets/19-fzN2OA9y.jpg",M="/homepage/assets/20-p5D_Rx7C.jpg",L="/homepage/assets/21-DBVyO0LX.jpg",R="/homepage/assets/æ•°æ®åŒ….drawio-CrY54gjy.png",Y="/homepage/assets/23-CpB5qdL3.jpg",U="/homepage/assets/24-DnzcLlXO.jpg",F="/homepage/assets/25-BwtjuyeF.jpg",j="/homepage/assets/OSIä¸TCP-D-5hOZv5.png",W="/homepage/assets/å°è£…-17095571212752-Cea2uy32.png",B="/homepage/assets/åè®®æ ˆ-CD0LU5Yn.png",O="/homepage/assets/æ”¶å‘æµç¨‹-BarE7JVy.png",Q="/homepage/assets/sk_buff-BFUKSYSX.jpg",G="/homepage/assets/6b9bfd38d2684b3f9843ebabf8771212-DU1cLQ9H.png",V="/homepage/assets/3-HTTPä¸‰éƒ¨åˆ†-CFsF1dTG.png",X="/homepage/assets/4-ç§Ÿæˆ¿å’Œä¸‰æ–¹åè®®-BuoQlUkP.png",Z="/homepage/assets/5-è¯·æ±‚åº”ç­”-CDB7NIwd.png",J="/homepage/assets/6-äº”å¤§ç±»HTTPçŠ¶æ€ç -BxrAaLaK.png",$="/homepage/assets/7-HOSTå­—æ®µ-DgkCXV0f.png",oo="/homepage/assets/8-content-lengthå­—æ®µ-DgrzACjF.png",to="/homepage/assets/9-connectionå­—æ®µ-Ccy1-2pG.png",so="/homepage/assets/d2b20d1cc03936332adb2a68512eb167-20230309231005893-MFG0u7Nw.png",eo="/homepage/assets/10-content-typeå­—æ®µ-B4rnl9ij.png",no="/homepage/assets/11-content-encodingå­—æ®µ-BT2P8DaD.png",po="/homepage/assets/12-Getè¯·æ±‚-bRPz_XPb.png",ro="/homepage/assets/13-Postè¯·æ±‚-Ds3IERib.png",io="/homepage/assets/1cb6bc37597e4af8adfef412bfc57a42-DQYPPHqG.png",go="/homepage/assets/ç¼“å­˜etag-DGdgWhhQ.png",ao="/homepage/assets/httpç¼“å­˜-rIqTMxiK.png",lo="/homepage/assets/14-cookieæŠ€æœ¯-CQfep88D.png",co="/homepage/assets/15-ä½ å·æ²¡äº†-C9DHbzVb.png",mo="/homepage/assets/16-çŸ­è¿æ¥ä¸é•¿è¿æ¥-_DRt0KVW.png",To="/homepage/assets/17-ç®¡é“ç½‘ç»œä¼ è¾“-BABM1lk1.png",ho="/homepage/assets/18-é˜Ÿå¤´é˜»å¡-C2mq0NcG.png",uo="/homepage/assets/19-HTTPSä¸HTTP-CTNkSeFC.png",_o="/homepage/assets/20-æ··åˆåŠ å¯†-CJT5FiPL.png",Po="/homepage/assets/æ‘˜è¦ç®—æ³•-CD4SI6gK.png",Co="/homepage/assets/æ•°å­—ç­¾å-BKfyHxKo.png",bo="/homepage/assets/22-æ•°å­—è¯ä¹¦å·¥ä½œæµç¨‹-kD0-plNr.png",ko="/homepage/assets/23-HTTPSå·¥ä½œæµç¨‹-CvCYHWL8.png",fo="/homepage/assets/è¯ä¹¦çš„æ ¡éªŒ-B7a5xM3d.png",So="/homepage/assets/baiduè¯ä¹¦-NJXYNUBT.png",Ao="/homepage/assets/ç”¨æˆ·ä¿¡ä»»-CekP1oBS.png",Io="/homepage/assets/ç³»ç»Ÿæ ¹è¯ä¹¦-GqjZ0Sbn.png",xo="/homepage/assets/è¯ä¹¦é“¾-C9JTGrBz.png",No="/homepage/assets/è®°å½•åè®®-DFoR1z_Z.png",qo="/homepage/assets/æé—®-BAt7UvrY.jpeg",yo="/homepage/assets/httpsä¸­é—´äºº.drawio-BBzTSI_2.png",Ho="/homepage/assets/è¯ä¹¦å®‰å…¨æç¤º-1Z0bMdHx.png",vo="/homepage/assets/åŒå‘è®¤è¯-DBRlUufk.png",zo="/homepage/assets/25-HTTP2-ByNjcjcF.png",Eo="/homepage/assets/äºŒè¿›åˆ¶å¸§-1Yhntvpf.png",wo="/homepage/assets/http1-B4BqLHm6.png",Ko="/homepage/assets/h2c-BCv3osew.png",Do="/homepage/assets/index-D-7UKpJJ.png",Mo="/homepage/assets/stream-C4rK7a5f.png",Lo="/homepage/assets/http2å¤šè·¯å¤ç”¨-DBgwKbLS.jpeg",Ro="/homepage/assets/83445581dafe409d8cfd2c573b2781ac-CVsBh48A.png",Yo="/homepage/assets/push-0hFHl-fX.png",Uo="/homepage/assets/http2é˜»å¡-CRa4yVj4.jpeg",Fo="/homepage/assets/tcpé˜Ÿå¤´é˜»å¡-Bx_MJvde.gif",jo="/homepage/assets/27-HTTP3-DvjAhILZ.png",Wo="/homepage/assets/quicæ— é˜»å¡-D-X1NreL.jpeg",Bo="/homepage/assets/28-HTTP3äº¤äº’æ¬¡æ•°-Bul4Zgz0.png",Oo="/homepage/assets/4cad213f5125432693e0e2a512c2d1a1-20230309231022316-D6d4CZMi.png",Qo="/homepage/assets/format_png-20230309231026577-BaUMJkmw.png",Go="/homepage/assets/29-TLS1.2-å››æ¬¡æ¡æ‰‹-HV9coBF3.png",Vo="/homepage/assets/30-TLS1.3-agT9DN-m.png",Xo="/homepage/assets/1310bf5ed78e4c8186481c47719e0793-CKHTImPe.png",Zo="/homepage/assets/format_png-20230309230534096-B-piNIrR.png",Jo="/homepage/assets/format_png-20230309230419839-DiuwOSZI.png",$o="/homepage/assets/format_png-20230309230424714-4vqxzDb6.png",ot="/homepage/assets/format_png-20230309230428466-CycQYXq5.png",tt="/homepage/assets/format_png-20230309230433082-BsYWN1An.png",st="/homepage/assets/format_png-20230309230436594-BDOl8oDm.png",et="/homepage/assets/format_png-20230309230439961-DbRiNROJ.png",nt="/homepage/assets/format_png-20230309230445811-CHPcV_ZT.png",pt="/homepage/assets/tcpå’Œudpæ¨¡å—-D2V6V3iS.jpeg",rt="/homepage/assets/TCPä¸‰æ¬¡æ¡æ‰‹.drawio-170955959882217-CLItAnlf.png",it="/homepage/assets/format_png-20230309230500953-DYn7_b81.png",gt="/homepage/assets/format_png-20230309230504118-D24HZBS5.png",at="/homepage/assets/format_png-20230309230508297-DcpteqgS.png",lt="/homepage/assets/format_png-20230309230520683-XEYsRJZX.png",ct="/homepage/assets/format_png-20230309230525514-DGmlWi3J.png",dt="/homepage/assets/fe898053d2e93abac950b1637645943f-HrqHAqt2.png",mt="/homepage/assets/ç›¸åŒack-MPojSf4l.png",Tt="/homepage/assets/format_png-20230309230639121-CL_zzmQZ.png",ht="/homepage/assets/format_png-20230309230636571-DGpMj7fd.png",ut="/homepage/assets/isnç›¸åŒ-0ncoXbtI.png",_t="/homepage/assets/isnä¸ç›¸åŒ-CSegrSKq.png",Pt="/homepage/assets/format_png-20230309230633447-CAVeKzsU.png",Ct="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAjQAAABHCAMAAAAnfC13AAAAIGNIUk0AAHomAACAhAAA+gAAAIDoAAB1MAAA6mAAADqYAAAXcJy6UTwAAAGwUExURf////+6t/8rH/8fEP8eEf8eEP8pG/+Ujv8fEv+HgP8nGs3zzeeCadLfvNq+ntDmwbGVTRInLhInaJXzzc3znFknLhJznM3ztXlPLjmVtZVzLhJPg7HUgzknLs3UgzknTXnUzbHzzRInTc21aFm1zTlPTRJPTXmVaDlPg3lzLrGVg1knTXnUnBJzaFknaFlPg1m1nFlzLpVzTVm1tbHztXm1gzknaFmVg5WVTbHznFlPaFlPTVlzg3lPaJXUg5W1aHmVTRJzg7G1aNPZtc/syP4hEtyxlPwqHP0oGeWOdOxzXPNRP/8fEeiCaO5oU/RPPP0nGOT/x/KIZ+fqtuvHmebxvMWcSxInZqb/x+T/mGInLhJ4mOT/sIVSLj6csKZ4LhJSgMXegD4nLuTegD4nS4XexxInS2K+x+S+ZsX/xz5SSz5SgIV4LsWcgIWcZhJSS2InS2InZhJ4ZmJSgIXemGK+mGJ4LqZ4Sz4nZmKcgGK+sMX/sIW+gKacSz6cmMX/mGJSZmJSS2J4gIVSZqbegKa+ZoWcSxJ4gMW+ZufjsOX4wv8hEvV4WfhUPfZsUPlROk33bE0AAAABYktHRACIBR1IAAAAB3RJTUUH6AMDCAQS+hADhQAAAAFvck5UAc+id5oAAAyzSURBVHja7Vz5YxtHFU6xBQFzaGP5kBwrcuRSSkoLBVJa7qvchzgUy7Il17IipZSS0kJTznLf8C8z7828mTdvd7Vaa+11nPl+8GqlmTffe/PtmxnpJVeuBAQEBAQEBJw/HnvH0nJlISy9811lOxFwrnjs6mKKQSy/u2w3As4T7ylAM5XK1bLduFBYuexQM/7e9y1m4v3KRtluXCRcftEsVSofWNTGcmW5bDcuEi6/aIrIEiHTeCDRVKPo2mp6s9paFK2XzfV0CKIpHFY0WhIbm1EU1Tc28a6xdX1bvWjeaOEdF41uN8NuI4q2dtzdOo2xsZmsTTBY1y9utrhI9b2wt9LmN7PHhwlvR7sr+Id4x/hbXmY84qPtkGisH7I/8VXPnn7f+iPiZcyvNLfhvrZmePFmQATtbO3gvRrf8o/zLQO+aIxalEu7KJbmjcdbSaKhdulzBg67Npmiqa1RhKsfVMNtbO7SW3gv7WWKhrXXolmH+aenIc6/ffMJw0uPR3yMHSka2d/yNc8e80eM1/zQk/AJCuDDqyAajDWzs9JQTOwzXMe+xD+BbxnwRWMdUMGCCDVvPFFPEg13NAm1Wy1wrLXiWa+mpyZrvHbrqVstx8HcS3tZouHtUTQfeXq19syTdeIt+deeXm3rSTDjGz5kh0RDfiT6D3xJNA1fVK59tQ7UQQxof22XXiJQNNCYiWalurVD/ON8S4EvmtqamQz1pIBWmjeeemYnQTS2nV0GGhFfP8AjlVptZJXfSjGNOm2dNjY/uhYxDWCwTLRrnmj0vbTnRKPHl/Z4e5jw6npjt11v1Im34+91seMTH7JjRWP8SOjvicb5I+KlPtBxbZn3d6vcUpJoIGkR/zjfUiD2NGqp1S+q1z5WxxXq2VbSnobawZsmK0FEYWlX2FVz2tz+uItce+sTm1s76HRbi0bNcMO1r9365DZOevP2KokGM7y5l/asaMz40h5vr0XTXn+2pcYn3uZK7e0kmPGID9kh0Vg/4v3N8qSfHeuPjJeyD0KgGa+tPXebz71enkB8YNZtnYh/jO+FEA2stshJ7z2UXtrrSaIx7XCCce/TQtG4Of3UzdYGF83zL3y61bDO4kdsiWluQ6CuYUCNaJAA3Ut71JfGl/Z4ey2a2guf2UEfjX/2artoXno84kN2nGicH6K/3axBVqH+Ml4YZlhubFv/zEobX5Zp9Arl+Ht8L4poVoyzqBGYj89+LlE02A7OAJF6pJrwvPBMg4/bmhPNtc/Xq7tx0bhMg5tPyBAkmgY8qHQv7ZFAaHxpj7eHCW/otXGd+YdX+eTSeJaPsWNF4/yQ/Rs2sShL1F/GCxWgPqftWeLyxKYDsxIkcsP/omYa2kCSaFaqz6WIRrWjtVlmGn36cpm3efsLu+0vbqZmGoyvinQDYwIzVaWDNt5fF/asaMz48czl2hvROB9pxvjG2vCi8Z43fMgOiYb5IfpX2a7/2ir5E4vXtnlI1thG2DuVxkUD73n8Gd+SkCCaht7Zkmiaj6eIhh1rIQht74sZ/4jc3IZAYlwTRYOCa7Alh80B3qccud0RWtgTR24TdN2gQfshbzNrJ0GPb/iIIzfzw+/P+Da3654/nFOVQlt1R25+Ok8SDdjy+Au+JUAeue0hyIqGEq9/5DbtaBFWb2x9ifkE74vTFmxWsTlbTlhE7eELlwe+wYRJFPZghwB2aPyYPdaei+b6tqXrfVlIvOx4xMfYIdGQH7K/5dsg1v6XkdRe84D5rkbsy72640GioS/36qhCKRrOt3TRzEIjq0V1ayfLRhkIPyMUjkdANEsFiKYAG5cIBf5geVFFU6l8eUETXznjTGNWN3GIv7i4/KURX61UFiwRxv4Jll/82qLFxwpLX/9G2RHKjcsvmm8WUu75rbjhF79diOXK8nfKDlFeXH7RrHy3gFTzvQS73y9GM5XK1bIjlBdXOgGnhJruH/xwYSs/UmbK9iQvgmhOjaVK5ccFmFmuLJftSV4E0ZwaBaWIhzjTdKPozt7i5nr7UdQv26dzQhBNV0/1wWEURYODQ7wbHr10rF6MTsbxfgeHd/Hd0bFqr7Qy6XSm0QR79b1mYG/G+MMoOrqXYJfuZN+DQ65tPRZw99/3CQzwmYhdoS/dE6Yemdl81Wyjy/CH/Iz5a3kZx8w9e7hQNLZfelxtOMEA8j66h/eKj+WRFadUfixOfcNPE/EnJEk0Ri2K8gTFMjp5eZwsmtFPXoGxkehP98A57CNEQ/bS5wAc78ftpolmevfVXKLp7Q+Ye+6KH028+7lEw/miaPqgI3rK4v46vt2fQRjN/cHhxFID0bh+6XHV9tXrobJgn/EB9iUeWXFK5UdkTFww7l2MhebtwxeNJaiCAyONTl4dJIumO4D40qSqgez8ctFwh5PQu4+BHEu7Lki+aHqv7U15MDTrbnoqGwqxMJHowOQTjccXRPPz1/Z6r78yID+lv45v7/4bqq/Hf6jHAtG4fulx1ZwnehAmGphc4pEVp1R+Qz8uOsPBJ5q3gC+a3r4JmlIeaGV08sbr95JEo9jrz8fkXJfCzUVj7dm0Poz4egS8VGKcSLs6PcNTPZD50Q/G0T2lmOGAtmQHh7/Yj1hzDHKKaHCcVNFovtKex1fNdrc/nEwHwwH56fyVfIf9ng5+omhsvxlxTRMNJAnikRWnNH42TjYud8c6+Vje6aKBudIvund+OUADb46TRDN6sAeEiVlv/60HNhbeamPswZsme4EHsGQqTNQcjY5/xRlru7Q+q9cHh6obtZfBmB79Wn2MwTLOqxkeOvu9+785xknvGq3SFUQBvbqRv6ci0Ri+0p7HF0Uz7b85VuOTn+Ya46v8kqLhy5Prnx5XKxqII+5p3BaFeGTGKYWfjRPFRU0Afup4zxCNba33CEov036SaLp68p1z7uw19B9etIcD4x5pTGulcea3d8dc5sYuGTk4/F1sFfaD8fu3/zAeWufRFFtiRscQYLNAiGxA67v39Jm+xFfa8/iiaHpv//Eexs7EzV49vpgRfNHYTZg5Pel+M+KqO5H4baYxq6zlkRmnJH48ThgXlWmm0YDznimajumM0wZx+9Of46LR2eDOHi3vacsT2YPFBrbjI3hueKaJMI1MpF2aFwjSpNNJzzR3/jLoTuKicZlm3LH2qWfalYmG+Ep7Hl8120O9NlJy3qOr5AtmhWiGtOrZI3f3zt6suOp4+MstZiV4xgyPOeKUyE/GSe9plHAc7wzRaMYkmk73rbhodFDVpOyzDVs/RTTKHiUrmWn0Kc1lYLJLuz91nYoTnxeM0YO/TqZ/O0zNNOg8ec0mlQvE3nPRGL7xzMX4atG42BHTaXwPNtSVD2DI8O/aRlY0EKcZcU0TDbzn8Zgdp0R+XpxgDT7RmZbxzhCN3qBZ0YxePkEZio2VbtJ1R0NyNCYadkyFNlPOQRy5nV36kmDAwpsQjGN4KrBBomj0UkfZY9DhV+JL91w07ggt7Ikjt5ks3WBI+yEvxm4PwzMNc8qKRvWbFdc00cDwHo/ZcUrmx+IE4/X2+/po73iniwaVbkJAotGJ1DvjGGXDeN2IfQk1kKKx9mgxVm8c/d07U3vfIPt29elJPab+l1vsOAP7Edis0vuxSaZT29AkY3PF9uzehdDYN3xj9jhfJpqXjq173nPJ+ULw6Z4tD+bIrfvNiqsvmsjFR6leiiYtTun86LQYuf0A7avmWp6S0Y1/MZiMYaalrG9dHxJUlor5GaEYM+eJeUWDJ9+58OiIplL5x+JW/vkw//Y0+wfL6Zw/Q87zg+VlEc2/Fi/uqmgT80TVrWflI5RGnBr/Lqpy7z9le5IXQTSnx3+LSTX/K9uP3AiiCciNIJqA3AiiCciNIJqA3JjzyP0o1f4GZEF+uVdU7a8svzyj2l9Z2+pqeP0B89T+BmRBiqag2l9Ro3pmtb+itpX9oOjXtuap/Q3IghRNQbW/okb1zGp/ZW2rreEVta15an8DshD7JyyF1P52xE/zZ1X7K2tbXQ2vqG3NU/sbkAVZI1xM7W9HiuaMan9lbaut4ZW1rXlqfwOyIERTUO1vR4rmjGp/ZW0r1fDGalvz1P4GZEH+Y7lian87QgRnVfsra1uphjdW25qn9jcgCwmVewXU/nZi5YZnU/sbq201Nbyx2tY8tb8BWfBFU1jtb3xj2zmT2l9R2+pxSsg0c9X+BmTBF01Rtb+yRvXMan9lbSur4fVFk6P2NyALc9cIPzplnAFZCKIJyI0Cf7AMonlUEEojAnIjiCYgN4JoAnIjiCYgN4JoAnIjiCYgN4JoAnIjWTRpVQL4m17v/rirfxAc0NX+/7YA82uRrBEu4v+2DrgQ+D/PZJyvsmgaRAAAACV0RVh0ZGF0ZTpjcmVhdGUAMjAyNC0wMy0wM1QwODowNDoxOCswMDowMHYO+kcAAAAldEVYdGRhdGU6bW9kaWZ5ADIwMjQtMDMtMDNUMDg6MDQ6MTgrMDA6MDAHU0L7AAAAKHRFWHRkYXRlOnRpbWVzdGFtcAAyMDI0LTAzLTAzVDA4OjA0OjE4KzAwOjAwUEZjJAAAAABJRU5ErkJggg==",bt="/homepage/assets/ç¬¬1æ¬¡æ¡æ‰‹ä¸¢å¤±-heHS087V.png",kt="/homepage/assets/ç¬¬2æ¬¡æ¡æ‰‹ä¸¢å¤±-Bxt87DUW.png",ft="/homepage/assets/ç¬¬ä¸‰æ¬¡æ¡æ‰‹ä¸¢å¤±.drawio-CFwrEL0p.png",St="/homepage/assets/format_png-20230309230625853-DpKdoC7W.png",At="/homepage/assets/format_png-20230309230622886-Dcuc5648.png",It="/homepage/assets/format_png-20230309230618804-CgQYCDVn.png",xt="/homepage/assets/format_png-20230309230614791-BhZFFJ_m.png",Nt="/homepage/assets/ç¬¬ä¸€æ¬¡æŒ¥æ‰‹ä¸¢å¤±-CvRwh75N.png",qt="/homepage/assets/ç¬¬äºŒæ¬¡æŒ¥æ‰‹ä¸¢å¤±-B7rNe42D.png",yt="/homepage/assets/fin_wait_2.drawio-D_HPPTFl.png",Ht="/homepage/assets/fin_wait_2æ­»ç­‰.drawio-DcJEiuhQ.png",vt="/homepage/assets/ç¬¬ä¸‰æ¬¡æŒ¥æ‰‹ä¸¢å¤±.drawio-B17oPQ8p.png",zt="/homepage/assets/ç¬¬å››æ¬¡æŒ¥æ‰‹ä¸¢å¤±drawio.drawio--0wxIkVM.png",Et="/homepage/assets/c9ea9b844e87bcd4acd3e320403ecab3-SUHIFoqx.png",wt="/homepage/assets/6385cc99500b01ba2ef288c27523c1e7-20230309230608128-dic6PrDD.png",Kt="/homepage/assets/3a81c23ce57c27cf63fc2b77e34de0ab-20230309230604522-BAXdpHJS.png",Dt="/homepage/assets/TIME-WAITè¿æ¥æ­£å¸¸å…³é—­.drawio-CmOiJlNx.png",Mt="/homepage/assets/d6f6757c02e3afbf113d1048c937f8ee-COVTKqUc.png",Lt="/homepage/assets/d2b20d1cc03936332adb2a68512eb167-Da3YJX-1.png",Rt="/homepage/assets/2d872f947dedd24800a1867dc4f8b9ce-2wJHed3m.png",Yt="/homepage/assets/format_png-20230309230552557-CwwatnRi.png",Ut="/homepage/assets/2d872f947dedd24800a1867dc4f8b9ce-2wJHed3m.png",Ft="/homepage/assets/3-170963811449717-Bf9cjK2O.jpg",jt="/homepage/assets/4-170963838776619-gxMU_3Zf.jpg",Wt="/homepage/assets/5-170963838776721-BBXQiBPK.jpg",Bt="/homepage/assets/6-170963838776723-BpHTu7Yz.jpg",Ot="/homepage/assets/7-170963838776725-Bz9a6oY6.jpg",Qt="/homepage/assets/8-170963838776727-BjRam_7y.jpg",Gt="/homepage/assets/9-X2C8qmoD.jpg",Vt="/homepage/assets/10-170963838776730-DhactuyB.jpg",Xt="/homepage/assets/11-170963838776732-CUZIZkLr.jpg",Zt="/homepage/assets/12-170963838776734-DQBM6mpD.jpg",Jt="/homepage/assets/13-170963838776736-ldgq6ueZ.jpg",$t="/homepage/assets/14-170963974212238-DGmZysHo.jpg",os="/homepage/assets/15-170963974212240-D7Don-3r.jpg",ts="/homepage/assets/16-170963974212342-B1ORsjb1.jpg",ss="/homepage/assets/17-170963974212344-CZtINOS7.jpg",es="/homepage/assets/18-170963974212346-D0PfJRUS.jpg",ns="/homepage/assets/19-170963974212348-D9As4Hon.jpg",ps="/homepage/assets/20-170963974212350-DBy5AryR.jpg",rs="/homepage/assets/21-KJqSob4_.png",is="/homepage/assets/22-CYcg6Ksu.jpg",gs="/homepage/assets/23-170964114088954-BqzQIMC1.jpg",as="/homepage/assets/24-170964114088956-CgivIPsW.jpg",ls="/homepage/assets/25-170964114088958-WnXTRo32.jpg",cs="/homepage/assets/26-Bt4R86I8.png",ds="/homepage/assets/27-D5bjyisR.jpg",ms="/homepage/assets/28-C3KFgDjJ.jpg",Ts="/homepage/assets/cwnd-ClV39ogn.png",hs="/homepage/assets/29-D0RMDiOE.jpg",us="/homepage/assets/æ‹¥å¡å‘ç”Ÿ-å¿«é€Ÿé‡ä¼ .drawio-5jb_En66.png",_s="/homepage/assets/2-17097799895331-BjtXVrZR.jpg",Ps="/homepage/assets/3-17097799895343-BqbgZrKA.jpg",Cs="/homepage/assets/4-17097799895345-DlLWjDEm.jpg",bs="/homepage/assets/5-17097799895347-DnLDp1gJ.jpg",ks="/homepage/assets/6-17097799895349-BsQZFIA2.jpg",fs="/homepage/assets/7-170977998953411-lE_QzJwj.jpg",Ss="/homepage/assets/8-170977998953413-5_KQtZCk.jpg",As="/homepage/assets/9-170977998953415-D88MA4L5.jpg",Is="/homepage/assets/10-170977998953417-BNjkHTLa.jpg",xs="/homepage/assets/11-170977998953419-r66tBKQj.jpg",Ns="/homepage/assets/12-170977998953421-_2x5lyY5.jpg",qs="/homepage/assets/13-170977998953423-CMvQ3aeK.jpg",ys="/homepage/assets/14-170977998953425-C8m_P2pX.jpg",Hs="/homepage/assets/15-170977998953427-hTUjKech.jpg",vs="/homepage/assets/16-170977998953429-DgKEVVmP.jpg",zs="/homepage/assets/17-170977998953431-DTJw7VP8.jpg",Es="/homepage/assets/18-170977998953433-D6faI1MV.jpg",ws="/homepage/assets/19-170977998953435-C1Gn2Ah0.jpg",Ks="/homepage/assets/21-170977998953437-flpf7v7T.jpg",Ds="/homepage/assets/22-170977998953439-CIz-LM6D.jpg",Ms="/homepage/assets/23-170977998953441-Db0bf2zS.jpg",Ls="/homepage/assets/24-170977998953443-4wplYIBT.jpg",Rs="/homepage/assets/25-170977998953445-BzMT1G3N.jpg",Ys="/homepage/assets/26-DyCbU5DA.jpg",Us="/homepage/assets/27-170977998953448-DnguarwD.jpg",Fs="/homepage/assets/28-170977998953450-6mh0inBZ.jpg",js="/homepage/assets/29-170977998953452-Ce_sa1Us.jpg",Ws="/homepage/assets/30-6vf9ldIy.jpg",Bs="/homepage/assets/31-Dv-GU65j.jpg",Os="/homepage/assets/32-BRh0I1xn.jpg",Qs="/homepage/assets/33-BNKckZ3n.jpg",Gs="/homepage/assets/34-BuVuNvc1.jpg",Vs="/homepage/assets/35-CFaxtQUx.jpg",Xs="/homepage/assets/36-yt1bNpX8.jpg",Zs="/homepage/assets/37-OAJjsRNv.jpg",Js="/homepage/assets/38-BzwLMtSX.jpg",$s="/homepage/assets/37-OAJjsRNv.jpg",oe="/homepage/assets/40-MWVzA3P_.jpg",te="/homepage/assets/41-B4H9QpdV.jpg",se="/homepage/assets/42-CRDDWQ9K.jpg",ee="/homepage/assets/43-CbpersIU.jpg",ne="/homepage/assets/44-CXfsw5ts.jpg",pe="/homepage/assets/45-DDNf2d5w.jpg",re="/homepage/assets/46-BYZJ1qAY.jpg",ie="/homepage/assets/47-C39Jf8F1.jpg",ge="/homepage/assets/48-Qve1Xl_1.jpg",ae="/homepage/assets/49-DfWd5EMA.jpg",le="/homepage/assets/50-B30F5ZpJ.jpg",ce="/homepage/assets/51-DmUQWrX_.jpg",de="/homepage/assets/52-Cum6BTue.jpg",me="/homepage/assets/53-BukIR7Gy.jpg",Te="/homepage/assets/54-CTEDfrMZ.jpg",he="/homepage/assets/55-p5RL4Rbp.jpg",ue="/homepage/assets/56-qn78qrCX.jpg",_e="/homepage/assets/57-Cp7m_5zp.jpg",Pe="/homepage/assets/58-vl-Sc7BN.jpg",Ce="/homepage/assets/59-p3BUfTlg.jpg",be="/homepage/assets/60-CkPbPeZp.jpg",ke="/homepage/assets/61-DeSHn5zI.jpg",fe="/homepage/assets/2-17109795367651-DReQmyty.jpg",Se="/homepage/assets/3-17109817255723-Blw_X6sW.jpg",Ae="/homepage/assets/4-17109817255725-DFjz71Ii.jpg",Ie="/homepage/assets/5-17109817255727-BS1iy1Ud.jpg",xe="/homepage/assets/6-17109817255729-uj01Do6i.jpg",Ne="/homepage/assets/7-171098172557211-B73-bHat.jpg",qe="/homepage/assets/8-171098172557213-QfKRzJnx.jpg",ye="/homepage/assets/9-171098172557215-lKwLT6rn.jpg",He="/homepage/assets/10-171098172557217-lBgjIjd8.jpg",ve="/homepage/assets/11-171098172557219-Fw2t7gEI.jpg",ze="/homepage/assets/12-171098172557221-D3fNhsni.jpg",Ee="/homepage/assets/13-171098172557223-D3SUVxbk.jpg",we="/homepage/assets/14-171098172557225-Dtkhx2uq.jpg",Ke="/homepage/assets/15-171098172557227-DfYfhBUm.jpg",De="/homepage/assets/16-171098172557229-BQPnFHAJ.jpg",Me="/homepage/assets/17-171098172557231-BQV_RU5_.jpg",Le="/homepage/assets/18-171098172557233-CQeFXkFB.jpg",Re="/homepage/assets/19-171098172557235-C2cAxMW2.jpg",Ye="/homepage/assets/20-171098172557237-bTk3XdMF.jpg",Ue="/homepage/assets/21-171098172557239-CxS-WbAC.jpg",Fe="/homepage/assets/22-171098172557241-7sybm2Yu.jpg",je="/homepage/assets/23-171098172557243-CUlIz2CX.jpg",We="/homepage/assets/24-171098172557245-D7tkJloQ.jpg",Be="/homepage/assets/25-171098172557247-BOdBlDSe.jpg",Oe="/homepage/assets/26-171098172557349-BYOF9YK7.jpg",Qe="/homepage/assets/27-171098172557351-B3EAqAuk.jpg",Ge="/homepage/assets/28-171098172557353-BeeALY_X.jpg",Ve="/homepage/assets/29-171098172557355-C8MJ6ueq.jpg",Xe="/homepage/assets/30-171098172557357-Dx6sN712.jpg",Ze="/homepage/assets/31-171098172557359-B8GHyHvl.jpg",Je="/homepage/assets/32-171098172557361-pG8MOb9k.jpg",$e="/homepage/assets/33-171098172557363-DK8XW2pW.jpg",on="/homepage/assets/34-171098172557365-BJtxoTSc.jpg",tn="/homepage/assets/35-171098172557367-Cd7vgzIB.jpg",sn="/homepage/assets/36-171098172557369-CGEqvvtH.jpg",en="/homepage/assets/37-171098172557371-B7sQomRh.jpg",nn="/homepage/assets/38-171098172557373-20bXPNB5.jpg",pn="/homepage/assets/39-171098172557375-DltTFW1S.jpg",rn="/homepage/assets/40-171098172557377-DKy0FopZ.jpg",gn="/homepage/assets/41-171098172557379-V5LZIEF1.jpg",an="/homepage/assets/42-171098172557381-TKDIADCM.jpg",ln="/homepage/assets/40-171098172557377-DKy0FopZ.jpg",cn="/homepage/assets/44-171098172557385-C0vxGwlZ.jpg",dn="/homepage/assets/2-171098423065187-CKfGnuQg.jpg",mn="/homepage/assets/3-171098423065188-ardH6i98.jpg",Tn="/homepage/assets/4-171098423065189-2iiiica-.jpg",hn="/homepage/assets/5-171098423065190-DSGhx8kF.jpg",un="/homepage/assets/6-171098423065191-O_45bzkH.jpg",_n="/homepage/assets/7-171098423065192-DwLHIuUx.jpg",Pn="/homepage/assets/8-171098423065193-BjSNDro9.jpg",Cn="/homepage/assets/9-171098423065194-CBFmR3TD.jpg",bn="/homepage/assets/10-171098423065295-B8bq7jhd.jpg",kn="/homepage/assets/11-171098423065296-Csb1GwnL.jpg",fn="/homepage/assets/12-171098423065297-DbxWkH_E.jpg",Sn="/homepage/assets/13-171098423065298-B0xUQsWA.jpg",An="/homepage/assets/14-171098423065299-CbhngM1g.jpg",In="/homepage/assets/15-1710984230652100-D0zcGzf3.jpg",xn="/homepage/assets/16-1710984230652101-CEdK9-gI.jpg",Nn="/homepage/assets/17-1710984230652102-CTh5Qj_Z.jpg",qn="/homepage/assets/18-1710984230652103-DaqgNKU3.jpg",yn="/homepage/assets/19-1710984230652104-av9lJq-A.jpg",Hn="/homepage/assets/20-1710984230652105-DGiIC24a.jpg",vn="/homepage/assets/21-1710984230652106-Btc5spvV.jpg",zn="/homepage/assets/22-1710984230652107-CQBVcE-h.jpg",En="/homepage/assets/TCP optionå­—æ®µ - TFO-Cf26ivUP.png",wn="/homepage/assets/23-1710984230652108-bL1r5HjU.jpg",Kn="/homepage/assets/24-1710984230652109-DWlBOUIN.jpg",Dn="/homepage/assets/25-1710984230652110-NnhDB0bA.jpg",Mn="/homepage/assets/26-1710984230652111-CQKmHaOJ.jpg",Ln="/homepage/assets/27-1710984230652112-BmHxRn4-.jpg",Rn="/homepage/assets/28-1710984230653113-5ZsP3Ir9.jpg",Yn="/homepage/assets/29-1710984230653114-6-CUtq3e.jpg",Un="/homepage/assets/30-1710984230653115-CpHA-aj6.jpg",Fn="/homepage/assets/6385cc99500b01ba2ef288c27523c1e7-wzSeRQQL.png",jn="/homepage/assets/3a81c23ce57c27cf63fc2b77e34de0ab-BA2ENeZd.png",Wn="/homepage/assets/TIME-WAITè¿æ¥æ­£å¸¸å…³é—­.drawio-1710984230691160-B5OFCGBq.png",Bn="/homepage/assets/33-1710984230653116-BRx9p8LC.jpg",On="/homepage/assets/34-1710984230653117-CwLNG101.jpg",Qn="/homepage/assets/35-1710984230654118-D_Jku2Fc.jpg",Gn="/homepage/assets/36-1710984230654119-9xkNHdf6.jpg",Vn="/homepage/assets/37-1710984230654120-D9n7m35c.jpg",Xn="/homepage/assets/38-1710984230654121-By2NIK4l.jpg",Zn="/homepage/assets/39-1710984230654122-CbAOFKsx.jpg",Jn="/homepage/assets/40-1710984230654123-CL2KBL39.jpg",$n="/homepage/assets/41-1710984230654124-B9EY2oxB.jpg",op="/homepage/assets/42-1710984230654125-DlrKbMbb.jpg",tp="/homepage/assets/43-1710984230654126-9WH650R_.jpg",sp="/homepage/assets/44-1710984230654127-B7hU1EVJ.jpg",ep="/homepage/assets/45-1710984230691176-CHmV29F-.jpg",np="/homepage/assets/46-1710984230691178-xlTVYuJL.jpg",pp="/homepage/assets/47-1710984230691180-BG9gXX0x.jpg",rp="/homepage/assets/48-1710984230691182-CQnEKA2i.jpg",ip="/homepage/assets/49-1710984230691184-CVvKVzJe.jpg",gp="/homepage/assets/a9116c5b375d356048df033dcb53582e-C7pkzIv6.png",ap="/homepage/assets/02dce678f870c8c70482b6e37dbb5574-CU5mMGvy.png",lp="/homepage/assets/f58b70cde860188b8f95a433e2f5293b-Dg_Z8in1.png",cp="/homepage/assets/68080e783d7acc842fa254e4f9ec5630-D5SfRZ4j.png",dp="/homepage/assets/a49a6bb8cd38ae1738d9c00aec68b444-BTpx5eh0.png",mp="/homepage/assets/45-DDNf2d5w.jpg",Tp="/homepage/assets/Apo6LQIBU7zIAAAAAAAAAAAAAARQnAQ-BQsvfxic.png",hp="/homepage/assets/tcpé˜Ÿå¤´é˜»å¡-Bx_MJvde.gif",up="/homepage/assets/http2é˜»å¡-CRa4yVj4.jpeg",_p="/homepage/assets/format_png-B2aihT5K.png",Pp="/homepage/assets/1uk5OZPL7gtUwqRLwaoGyFw-DIfmj9Eh.png",Cp="/homepage/assets/605d1026df934f20a5ee12f3c55aa6a7-BJfQAjzO.png",bp="/homepage/assets/ab3283383013b707d1420b6b4cb8517c-tmWjSpjk.png",kp="/homepage/assets/http3-over-quic-protocol-works-z52551Ww.png",fp="/homepage/assets/bcf3ccb6a15c4cdebe1cd0527fdd9a5e-BFwH3gW-.png",Sp="/homepage/assets/635813465fbb449882da2e2bee39f24e-C4jUOIYo.png",Ap="/homepage/assets/tcpé‡ä¼ æ­§ä¹‰-C0bJEqdv.jpeg",Ip="/homepage/assets/ca91985c9a94487a8a29db1249109717-CuITqkEZ.png",xp="/homepage/assets/6a94d41ef3d14cb6b7846e73da6c3104-D6PmZ6-G.png",Np="/homepage/assets/536298d2c54a43b699026bffe0f85010-B43jEfP1.png",qp="/homepage/assets/Packetä¸¢å¤±-BSx2IBB2.jpeg",yp="/homepage/assets/20-170963974212350-DBy5AryR.jpg",Hp="/homepage/assets/stream2-BQLa2J1b.png",vp="/homepage/assets/http2é˜»å¡-CRa4yVj4.jpeg",zp="/homepage/assets/quicæ— é˜»å¡-D-X1NreL.jpeg",Ep="/homepage/assets/f1070a6eccd24559904815297b07f789-C4ahLL83.png",wp="/homepage/assets/77e9a7cf70da4a1b981f61e78db2ad56-DgI46FJj.png",Kp="/homepage/assets/bbde0c66088f439b919a6d18b389aadb-Dk4G_0Ad.png",Dp="/homepage/assets/ä¹±åºç¡®è®¤1-HVYsLedm.png",Mp="/homepage/assets/ä¹±åºç¡®è®¤2-CHURnVZv.png",Lp="/homepage/assets/ä¹±åºç¡®è®¤3-XZJyLPof.png",Rp="/homepage/assets/ä¹±åºç¡®è®¤4-D9X8Yg2Q.png",Yp="/homepage/assets/ä¹±åºç¡®è®¤5-pnaz7b1u.png",Up="/homepage/assets/839501cffa7146cbb8d992264594e61d-B8pbFUrV.png",Fp="/homepage/assets/4cad213f5125432693e0e2a512c2d1a1-CG0Uv1iS.png",jp="/homepage/assets/format_png-20230309230003865-TJbk2CCe.png",Wp={},Bp=n('<h1 id="è®¡ç®—æœºç½‘ç»œ" tabindex="-1"><a class="header-anchor" href="#è®¡ç®—æœºç½‘ç»œ"><span>è®¡ç®—æœºç½‘ç»œ</span></a></h1><h1 id="å›¾è§£ç½‘ç»œ" tabindex="-1"><a class="header-anchor" href="#å›¾è§£ç½‘ç»œ"><span>å›¾è§£ç½‘ç»œ</span></a></h1><h1 id="" tabindex="-1"><a class="header-anchor" href="#"><span>-----------------</span></a></h1><p>ç®€å•ä»‹ç»ä¸‹ã€Šå›¾è§£ç½‘ç»œã€‹ï¼Œæ•´ä¸ªå†…å®¹å…±æœ‰ <strong><code>20W</code> å­— + <code>500</code> å¼ å›¾</strong>ï¼Œæ¯ä¸€ç¯‡éƒ½è‡ªå·±æ‰‹ç»˜äº†å¾ˆå¤šå›¾ï¼Œç›®çš„ä¹Ÿå¾ˆç®€å•ï¼Œæƒ³é€šè¿‡ã€Œè¯´äººè¯+å›¾è§£ã€çš„æ–¹å¼ï¼Œå‡»ç ´å¤§å®¶å¯¹äºã€Œå…«è‚¡æ–‡ã€çš„ææƒ§</p><h1 id="ä¸€ã€ç®€ä»‹" tabindex="-1"><a class="header-anchor" href="#ä¸€ã€ç®€ä»‹"><span>ä¸€ã€ç®€ä»‹</span></a></h1><h2 id="_1-1-é€‚åˆä»€ä¹ˆç¾¤ä½“" tabindex="-1"><a class="header-anchor" href="#_1-1-é€‚åˆä»€ä¹ˆç¾¤ä½“"><span>1.1 é€‚åˆä»€ä¹ˆç¾¤ä½“ï¼Ÿ</span></a></h2><p>ã€Šå›¾è§£ç½‘ç»œã€‹å†™çš„ç½‘ç»œçŸ¥è¯†ä¸»è¦æ˜¯<strong>é¢å‘ç¨‹åºå‘˜</strong>çš„ï¼Œå› ä¸ºå°æ—æœ¬èº«ä¹Ÿæ˜¯ä¸ªç¨‹åºå‘˜ï¼Œæ‰€ä»¥æ¶‰åŠåˆ°çš„çŸ¥è¯†ä¸»è¦æ˜¯å…³äºç¨‹åºå‘˜æ—¥å¸¸å·¥ä½œæˆ–è€…é¢è¯•çš„ç½‘ç»œçŸ¥è¯†ã€‚</p><p>éå¸¸é€‚åˆæœ‰ä¸€ç‚¹ç½‘ç»œåŸºç¡€ï¼Œä½†æ˜¯åˆä¸æ€ä¹ˆæ‰å®ï¼Œæˆ–è€…çŸ¥è¯†ç‚¹ä¸²ä¸èµ·æ¥çš„åŒå­¦ï¼Œè¯´ç™½<strong>è¿™æœ¬å›¾è§£ç½‘ç»œå°±æ˜¯ä¸ºäº†æ‹¯æ•‘åŠæ¡¶æ°´çš„åŒå­¦è€Œå‡ºæ¥çš„</strong>ã€‚</p><p>å› ä¸ºå°æ—å†™çš„å›¾è§£ç½‘ç»œå°±å››ä¸ªå­—ï¼Œ<strong>é€šä¿—æ˜“æ‡‚</strong>ï¼</p><p>ç›¸ä¿¡ä½ åœ¨çœ‹è¿™æœ¬å›¾è§£ç½‘ç»œçš„æ—¶å€™ï¼Œä½ å¿ƒé‡Œçš„æ„Ÿå—ä¼šæ˜¯ï¼š</p><ul><li>ã€Œå§æ§½ï¼ŒåŸæ¥æ˜¯è¿™æ ·ï¼Œå¤§å­¦è€å¸ˆæ•™çŸ¥è¯†åŸæ¥æ˜¯è¿™ä¹ˆç†è§£ã€</li><li>ã€Œå§æ§½ï¼Œæˆ‘çš„ç½‘ç»œçŸ¥è¯†ä¸²èµ·æ¥äº†ã€</li><li>ã€Œå§æ§½ï¼Œæˆ‘æ„Ÿè§‰é¢è¯•ç¨³äº†ã€</li><li>ã€Œå§æ§½ï¼Œç›¸è§æ¨æ™šã€</li></ul><p>å½“ç„¶ï¼Œä¹Ÿé€‚åˆé¢è¯•çªå‡»ç½‘ç»œçŸ¥è¯†æ—¶æ‹¿æ¥çœ‹ã€‚å›¾è§£ç½‘ç»œé‡Œçš„å†…å®¹åŸºæœ¬æ˜¯é¢è¯•å¸¸è§çš„åè®®ï¼Œæ¯”å¦‚ HTTPã€HTTPSã€TCPã€UDPã€IP ç­‰ç­‰ï¼Œä¹Ÿæœ‰å¾ˆå¤šé¢è¯•å¸¸é—®çš„é—®é¢˜ï¼Œæ¯”å¦‚ï¼š</p><ul><li>TCP ä¸ºä»€ä¹ˆä¸‰æ¬¡æ¡æ‰‹ï¼Ÿå››æ¬¡æŒ¥æ‰‹ï¼Ÿ</li><li>TCP ä¸ºä»€ä¹ˆè¦æœ‰ TIME_WAIT çŠ¶æ€ï¼Ÿ</li><li>TCP ä¸ºä»€ä¹ˆæ˜¯å¯é ä¼ è¾“åè®®ï¼Œè€Œ UDP ä¸æ˜¯ï¼Ÿ</li><li>é”®å…¥ç½‘å€åˆ°ç½‘é¡µæ˜¾ç¤ºï¼ŒæœŸé—´å‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ</li><li>HTTPS æ¡æ‰‹è¿‡ç¨‹æ˜¯æ€æ ·çš„ï¼Ÿ</li><li>â€¦.</li></ul><p>ä¸æ•¢è¯´ 100 % æ¶µç›–äº†é¢è¯•çš„ç½‘ç»œé—®é¢˜ï¼Œä½†æ˜¯è‡³å°‘ 90% æ˜¯æœ‰çš„ï¼Œè€Œä¸”å†…å®¹çš„æ·±åº¦åº”å¯¹å¤§å‚ä¹Ÿæ˜¯ç»°ç»°æœ‰ä½™ï¼Œæœ‰éå¸¸å¤šçš„è¯»è€…è·‘æ¥æ„Ÿæ¿€å°æ—çš„å›¾è§£ç½‘ç»œï¼Œå¸®åŠ©ä»–ä»¬æ‹¿åˆ°äº†å›½å†…å¾ˆå¤šä¸€çº¿å¤§å‚çš„ offerã€‚</p><h2 id="_1-2-è¦æ€ä¹ˆé˜…è¯»" tabindex="-1"><a class="header-anchor" href="#_1-2-è¦æ€ä¹ˆé˜…è¯»"><span>1.2 è¦æ€ä¹ˆé˜…è¯»ï¼Ÿ</span></a></h2><p>å¾ˆè¯šæ³çš„å‘Šè¯‰ä½ ï¼Œã€Šå›¾è§£ç½‘ç»œã€‹ä¸æ˜¯æ•™ç§‘ä¹¦ï¼Œè€Œæ˜¯æˆ‘å†™çš„<strong>å›¾è§£ç½‘ç»œæ–‡ç« çš„æ•´åˆ</strong>ï¼Œæ‰€ä»¥è‚¯å®šæ˜¯æ²¡æœ‰æ•™ç§‘ä¹¦é‚£ä¹ˆç»†è‡´å’Œå…¨é¢ï¼Œå½“ç„¶ä¹Ÿå°±ä¸ä¼šæœ‰å¾ˆå¤šåºŸè¯ï¼Œéƒ½æ˜¯<strong>ç›´å‡»é‡ç‚¹ï¼Œä¸ç»•å¼¯ï¼Œè€Œä¸”æœ‰çš„çŸ¥è¯†ç‚¹ä¹¦ä¸Šçœ‹ä¸åˆ°ã€‚</strong></p><p>é˜…è¯»çš„é¡ºåºå¯ä»¥ä¸ç”¨ä»å¤´è¯»åˆ°å°¾ï¼Œä½ å¯ä»¥æ ¹æ®ä½ æƒ³è¦äº†è§£çš„çŸ¥è¯†ç‚¹ï¼Œé€šè¿‡æœ¬ç«™çš„æœç´¢åŠŸèƒ½ï¼Œå»çœ‹å“ªä¸ªç« èŠ‚çš„å†…å®¹å°±å¥½ï¼Œå¯ä»¥éšæ„é˜…è¯»ä»»ä½•ç« èŠ‚ã€‚</p><p>ã€Šå›¾è§£ç½‘ç»œã€‹ç›®å½•ç»“æ„å¦‚ä¸‹ï¼ˆåˆ«çœ‹ç¯‡ç« ä¸å¤šï¼Œæ¯ä¸€ç« éƒ½æ˜¯å¾ˆé•¿å¾ˆé•¿çš„æ–‡ç« å“¦ ğŸ˜†ï¼‰ï¼š</p>',18),Op={href:"https://xiaolincoding.com/network/1_base/tcp_ip_model.html",target:"_blank",rel:"noopener noreferrer"},Qp={href:"https://xiaolincoding.com/network/1_base/what_happen_url.html",target:"_blank",rel:"noopener noreferrer"},Gp={href:"https://xiaolincoding.com/network/1_base/how_os_deal_network_package.html",target:"_blank",rel:"noopener noreferrer"},Vp={href:"https://xiaolincoding.com/network/2_http/http_interview.html",target:"_blank",rel:"noopener noreferrer"},Xp={href:"https://xiaolincoding.com/network/2_http/http_optimize.html",target:"_blank",rel:"noopener noreferrer"},Zp={href:"https://xiaolincoding.com/network/2_http/https_rsa.html",target:"_blank",rel:"noopener noreferrer"},Jp={href:"https://xiaolincoding.com/network/2_http/https_ecdhe.html",target:"_blank",rel:"noopener noreferrer"},$p={href:"https://xiaolincoding.com/network/2_http/https_optimize.html",target:"_blank",rel:"noopener noreferrer"},or={href:"https://xiaolincoding.com/network/2_http/http2.html",target:"_blank",rel:"noopener noreferrer"},tr={href:"https://xiaolincoding.com/network/2_http/http3.html",target:"_blank",rel:"noopener noreferrer"},sr={href:"https://xiaolincoding.com/network/2_http/http_rpc.html",target:"_blank",rel:"noopener noreferrer"},er={href:"https://xiaolincoding.com/network/2_http/http_websocket",target:"_blank",rel:"noopener noreferrer"},nr={href:"https://xiaolincoding.com/network/3_tcp/tcp_interview.html",target:"_blank",rel:"noopener noreferrer"},pr={href:"https://xiaolincoding.com/network/3_tcp/tcp_feature.html",target:"_blank",rel:"noopener noreferrer"},rr={href:"https://xiaolincoding.com/network/3_tcp/tcp_tcpdump.html",target:"_blank",rel:"noopener noreferrer"},ir={href:"https://xiaolincoding.com/network/3_tcp/tcp_queue.html",target:"_blank",rel:"noopener noreferrer"},gr={href:"https://xiaolincoding.com/network/3_tcp/tcp_optimize.html",target:"_blank",rel:"noopener noreferrer"},ar={href:"https://xiaolincoding.com/network/3_tcp/tcp_stream.html",target:"_blank",rel:"noopener noreferrer"},lr={href:"https://xiaolincoding.com/network/3_tcp/isn_deff.html",target:"_blank",rel:"noopener noreferrer"},cr={href:"https://xiaolincoding.com/network/3_tcp/syn_drop.html",target:"_blank",rel:"noopener noreferrer"},dr={href:"https://xiaolincoding.com/network/3_tcp/out_of_order_fin.html",target:"_blank",rel:"noopener noreferrer"},mr={href:"https://xiaolincoding.com/network/3_tcp/time_wait_recv_syn.html",target:"_blank",rel:"noopener noreferrer"},Tr={href:"https://xiaolincoding.com/network/3_tcp/tcp_down_and_crash.html",target:"_blank",rel:"noopener noreferrer"},hr={href:"https://xiaolincoding.com/network/3_tcp/tcp_unplug_the_network_cable.html",target:"_blank",rel:"noopener noreferrer"},ur={href:"https://xiaolincoding.com/network/3_tcp/tcp_tw_reuse_close.html",target:"_blank",rel:"noopener noreferrer"},_r={href:"https://xiaolincoding.com/network/3_tcp/tcp_tls.html",target:"_blank",rel:"noopener noreferrer"},Pr={href:"https://xiaolincoding.com/network/3_tcp/tcp_http_keepalive.html",target:"_blank",rel:"noopener noreferrer"},Cr={href:"https://xiaolincoding.com/network/3_tcp/tcp_problem.html",target:"_blank",rel:"noopener noreferrer"},br={href:"https://xiaolincoding.com/network/3_tcp/quic.html",target:"_blank",rel:"noopener noreferrer"},kr={href:"https://xiaolincoding.com/network/3_tcp/port.html",target:"_blank",rel:"noopener noreferrer"},fr={href:"https://xiaolincoding.com/network/3_tcp/tcp_no_listen.html",target:"_blank",rel:"noopener noreferrer"},Sr={href:"https://xiaolincoding.com/network/3_tcp/tcp_no_accpet.html",target:"_blank",rel:"noopener noreferrer"},Ar={href:"https://xiaolincoding.com/network/3_tcp/tcp_drop.html",target:"_blank",rel:"noopener noreferrer"},Ir={href:"https://xiaolincoding.com/network/3_tcp/tcp_three_fin.html",target:"_blank",rel:"noopener noreferrer"},xr={href:"https://xiaolincoding.com/network/3_tcp/tcp_seq_ack.html",target:"_blank",rel:"noopener noreferrer"},Nr={href:"https://xiaolincoding.com/network/4_ip/ip_base.html",target:"_blank",rel:"noopener noreferrer"},qr={href:"https://xiaolincoding.com/network/4_ip/ping.html",target:"_blank",rel:"noopener noreferrer"},yr={href:"https://xiaolincoding.com/network/4_ip/ping_lo.html",target:"_blank",rel:"noopener noreferrer"},Hr={href:"https://xiaolincoding.com/network/5_learn/learn_network.html",target:"_blank",rel:"noopener noreferrer"},vr={href:"https://xiaolincoding.com/network/5_learn/draw.html",target:"_blank",rel:"noopener noreferrer"},zr=n('<h1 id="äºŒã€ç½‘ç»œåŸºç¡€ç¯‡" tabindex="-1"><a class="header-anchor" href="#äºŒã€ç½‘ç»œåŸºç¡€ç¯‡"><span>äºŒã€ç½‘ç»œåŸºç¡€ç¯‡</span></a></h1><h2 id="_2-1-tcp-ip-ç½‘ç»œæ¨¡å‹æœ‰å“ªå‡ å±‚" tabindex="-1"><a class="header-anchor" href="#_2-1-tcp-ip-ç½‘ç»œæ¨¡å‹æœ‰å“ªå‡ å±‚"><span>2.1 TCP/IP ç½‘ç»œæ¨¡å‹æœ‰å“ªå‡ å±‚ï¼Ÿ</span></a></h2><p>é—®å¤§å®¶ï¼Œä¸ºä»€ä¹ˆè¦æœ‰ TCP/IP ç½‘ç»œæ¨¡å‹ï¼Ÿ</p><p>å¯¹äºåŒä¸€å°è®¾å¤‡ä¸Šçš„è¿›ç¨‹é—´é€šä¿¡ï¼Œæœ‰å¾ˆå¤šç§æ–¹å¼ï¼Œæ¯”å¦‚æœ‰ç®¡é“ã€æ¶ˆæ¯é˜Ÿåˆ—ã€å…±äº«å†…å­˜ã€ä¿¡å·ç­‰æ–¹å¼ï¼Œè€Œå¯¹äºä¸åŒè®¾å¤‡ä¸Šçš„è¿›ç¨‹é—´é€šä¿¡ï¼Œå°±éœ€è¦ç½‘ç»œé€šä¿¡ï¼Œè€Œè®¾å¤‡æ˜¯å¤šæ ·æ€§çš„ï¼Œæ‰€ä»¥è¦å…¼å®¹å¤šç§å¤šæ ·çš„è®¾å¤‡ï¼Œå°±<strong>åå•†</strong>å‡ºäº†ä¸€å¥—<strong>é€šç”¨çš„ç½‘ç»œåè®®</strong>ã€‚</p><p>è¿™ä¸ªç½‘ç»œåè®®æ˜¯<strong>åˆ†å±‚</strong>çš„ï¼Œæ¯ä¸€å±‚éƒ½æœ‰å„è‡ªçš„ä½œç”¨å’ŒèŒè´£ï¼Œæ¥ä¸‹æ¥å°±æ ¹æ®**ã€Œ TCP/IP ç½‘ç»œæ¨¡å‹ã€**åˆ†åˆ«å¯¹æ¯ä¸€å±‚è¿›è¡Œä»‹ç»ã€‚</p><ul><li><strong>åº”ç”¨å±‚</strong></li></ul><p>æœ€ä¸Šå±‚çš„ï¼Œä¹Ÿæ˜¯æˆ‘ä»¬èƒ½ç›´æ¥æ¥è§¦åˆ°çš„å°±æ˜¯<strong>åº”ç”¨å±‚</strong>ï¼ˆ<em>Application Layer</em>ï¼‰ï¼Œæˆ‘ä»¬<strong>ç”µè„‘æˆ–æ‰‹æœºä½¿ç”¨çš„åº”ç”¨è½¯ä»¶éƒ½æ˜¯åœ¨åº”ç”¨å±‚å®ç°</strong>ã€‚é‚£ä¹ˆï¼Œå½“ä¸¤ä¸ªä¸åŒè®¾å¤‡çš„åº”ç”¨éœ€è¦é€šä¿¡çš„æ—¶å€™ï¼Œåº”ç”¨å°±æŠŠåº”ç”¨æ•°æ®ä¼ ç»™ä¸‹ä¸€å±‚ï¼Œä¹Ÿå°±æ˜¯ä¼ è¾“å±‚ã€‚</p><p>æ‰€ä»¥ï¼Œåº”ç”¨å±‚åªéœ€è¦ä¸“æ³¨äºä¸ºç”¨æˆ·æä¾›åº”ç”¨åŠŸèƒ½ï¼Œæ¯”å¦‚ HTTPã€FTPã€Telnetã€DNSã€SMTPç­‰ã€‚</p><p>åº”ç”¨å±‚æ˜¯ä¸ç”¨å»å…³å¿ƒæ•°æ®æ˜¯å¦‚ä½•ä¼ è¾“çš„ï¼Œå°±ç±»ä¼¼äºï¼Œæˆ‘ä»¬å¯„å¿«é€’çš„æ—¶å€™ï¼Œåªéœ€è¦æŠŠåŒ…è£¹äº¤ç»™å¿«é€’å‘˜ï¼Œç”±ä»–è´Ÿè´£è¿è¾“å¿«é€’ï¼Œæˆ‘ä»¬ä¸éœ€è¦å…³å¿ƒå¿«é€’æ˜¯å¦‚ä½•è¢«è¿è¾“çš„ã€‚</p><p>è€Œä¸”<strong>åº”ç”¨å±‚</strong>æ˜¯å·¥ä½œåœ¨æ“ä½œç³»ç»Ÿä¸­çš„<strong>ç”¨æˆ·æ€</strong>ï¼Œ<strong>ä¼ è¾“å±‚åŠä»¥ä¸‹åˆ™å·¥ä½œåœ¨å†…æ ¸æ€ã€‚</strong></p><ul><li><strong>ä¼ è¾“å±‚</strong></li></ul><p>åº”ç”¨å±‚çš„æ•°æ®åŒ…ä¼šä¼ ç»™ä¼ è¾“å±‚ï¼Œ<strong>ä¼ è¾“å±‚</strong>ï¼ˆ<em>Transport Layer</em>ï¼‰æ˜¯ä¸ºåº”ç”¨å±‚æä¾›ç½‘ç»œæ”¯æŒçš„ã€‚</p><img src="'+a+'" alt="img" style="zoom:67%;"><p>åœ¨ä¼ è¾“å±‚ä¼šæœ‰ä¸¤ä¸ª<strong>ä¼ è¾“åè®®</strong>ï¼Œåˆ†åˆ«æ˜¯ TCP å’Œ UDPã€‚</p><p><strong>TCP</strong> çš„å…¨ç§°å«<strong>ä¼ è¾“æ§åˆ¶åè®®</strong>ï¼ˆ<em>Transmission Control Protocol</em>ï¼‰ï¼Œå¤§éƒ¨åˆ†åº”ç”¨ä½¿ç”¨çš„æ­£æ˜¯ TCP ä¼ è¾“å±‚åè®®ï¼Œæ¯”å¦‚ HTTP åº”ç”¨å±‚åè®®ã€‚TCP ç›¸æ¯” UDP å¤šäº†å¾ˆå¤šç‰¹æ€§ï¼Œæ¯”å¦‚æµé‡æ§åˆ¶ã€è¶…æ—¶é‡ä¼ ã€æ‹¥å¡æ§åˆ¶ç­‰ï¼Œè¿™äº›éƒ½æ˜¯ä¸ºäº†ä¿è¯æ•°æ®åŒ…èƒ½å¯é åœ°ä¼ è¾“ç»™å¯¹æ–¹ã€‚</p><p><strong>UDP</strong> ç›¸å¯¹æ¥è¯´å°±å¾ˆç®€å•ï¼Œç®€å•åˆ°<strong>åªè´Ÿè´£å‘é€æ•°æ®åŒ…ï¼Œä¸ä¿è¯æ•°æ®åŒ…æ˜¯å¦èƒ½æŠµè¾¾å¯¹æ–¹</strong>ï¼Œä½†å®ƒå®æ—¶æ€§ç›¸å¯¹æ›´å¥½ï¼Œä¼ è¾“æ•ˆç‡ä¹Ÿé«˜ã€‚å½“ç„¶ï¼ŒUDP ä¹Ÿå¯ä»¥å®ç°å¯é ä¼ è¾“ï¼ŒæŠŠ TCP çš„ç‰¹æ€§åœ¨åº”ç”¨å±‚ä¸Šå®ç°å°±å¯ä»¥ï¼Œä¸è¿‡è¦å®ç°ä¸€ä¸ªå•†ç”¨çš„<strong>å¯é  UDP ä¼ è¾“åè®®</strong>ï¼Œä¹Ÿä¸æ˜¯ä¸€ä»¶ç®€å•çš„äº‹æƒ…ã€‚</p><p>åº”ç”¨éœ€è¦ä¼ è¾“çš„æ•°æ®å¯èƒ½ä¼šéå¸¸å¤§ï¼Œå¦‚æœç›´æ¥ä¼ è¾“å°±ä¸å¥½æ§åˆ¶ï¼Œå› æ­¤å½“ä¼ è¾“å±‚çš„æ•°æ®åŒ…å¤§å°è¶…è¿‡ <strong>MSSï¼ˆTCP æœ€å¤§æŠ¥æ–‡æ®µé•¿åº¦ï¼‰</strong> ï¼Œå°±è¦å°†æ•°æ®åŒ…<strong>åˆ†å—</strong>ï¼Œè¿™æ ·å³ä½¿ä¸­é€”æœ‰ä¸€ä¸ªåˆ†å—ä¸¢å¤±æˆ–æŸåäº†ï¼Œåªéœ€è¦é‡æ–°å‘é€è¿™ä¸€ä¸ªåˆ†å—ï¼Œè€Œä¸ç”¨é‡æ–°å‘é€æ•´ä¸ªæ•°æ®åŒ…ã€‚åœ¨ TCP åè®®ä¸­ï¼Œæˆ‘ä»¬æŠŠæ¯ä¸ªåˆ†å—ç§°ä¸ºä¸€ä¸ª <strong>TCP æ®µ</strong>ï¼ˆ<em>TCP Segment</em>ï¼‰ã€‚</p><img src="'+l+'" alt="img" style="zoom:67%;"><p>å½“è®¾å¤‡ä½œä¸ºæ¥æ”¶æ–¹æ—¶ï¼Œä¼ è¾“å±‚åˆ™è¦è´Ÿè´£æŠŠæ•°æ®åŒ…ä¼ ç»™åº”ç”¨ï¼Œä½†æ˜¯ä¸€å°è®¾å¤‡ä¸Šå¯èƒ½ä¼š<strong>æœ‰å¾ˆå¤šåº”ç”¨åœ¨æ¥æ”¶æˆ–è€…ä¼ è¾“æ•°æ®</strong>ï¼Œå› æ­¤éœ€è¦ç”¨ä¸€ä¸ªç¼–å·å°†<strong>åº”ç”¨åŒºåˆ†</strong>å¼€æ¥ï¼Œè¿™ä¸ªç¼–å·å°±æ˜¯<strong>ç«¯å£</strong>ã€‚</p><p>æ¯”å¦‚ 80 ç«¯å£é€šå¸¸æ˜¯ Web æœåŠ¡å™¨ç”¨çš„ï¼Œ22 ç«¯å£é€šå¸¸æ˜¯è¿œç¨‹ç™»å½•æœåŠ¡å™¨ç”¨çš„ã€‚è€Œå¯¹äºæµè§ˆå™¨ï¼ˆå®¢æˆ·ç«¯ï¼‰ä¸­çš„æ¯ä¸ªæ ‡ç­¾æ éƒ½æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„è¿›ç¨‹ï¼Œæ“ä½œç³»ç»Ÿä¼šä¸ºè¿™äº›è¿›ç¨‹åˆ†é…ä¸´æ—¶çš„ç«¯å£å·ã€‚</p><p>ç”±äºä¼ è¾“å±‚çš„æŠ¥æ–‡ä¸­ä¼šæºå¸¦ç«¯å£å·ï¼Œå› æ­¤æ¥æ”¶æ–¹å¯ä»¥è¯†åˆ«å‡ºè¯¥æŠ¥æ–‡æ˜¯å‘é€ç»™å“ªä¸ªåº”ç”¨ã€‚</p><ul><li><strong>ç½‘ç»œå±‚</strong></li></ul><p>ä¼ è¾“å±‚å¯èƒ½å¤§å®¶åˆšæ¥è§¦çš„æ—¶å€™ï¼Œä¼šè®¤ä¸ºå®ƒè´Ÿè´£å°†æ•°æ®ä»ä¸€ä¸ªè®¾å¤‡ä¼ è¾“åˆ°å¦ä¸€ä¸ªè®¾å¤‡ï¼Œäº‹å®ä¸Šå®ƒå¹¶ä¸è´Ÿè´£ã€‚</p><p>å®é™…åœºæ™¯ä¸­çš„ç½‘ç»œç¯èŠ‚æ˜¯é”™ç»¼å¤æ‚çš„ï¼Œä¸­é—´æœ‰å„ç§å„æ ·çš„çº¿è·¯å’Œåˆ†å‰è·¯å£ï¼Œå¦‚æœä¸€ä¸ªè®¾å¤‡çš„æ•°æ®è¦ä¼ è¾“ç»™å¦ä¸€ä¸ªè®¾å¤‡ï¼Œå°±éœ€è¦åœ¨å„ç§å„æ ·çš„è·¯å¾„å’ŒèŠ‚ç‚¹è¿›è¡Œé€‰æ‹©ï¼Œè€Œ<strong>ä¼ è¾“å±‚</strong>çš„è®¾è®¡ç†å¿µæ˜¯<strong>ç®€å•ã€é«˜æ•ˆã€ä¸“æ³¨</strong>ï¼Œå¦‚æœä¼ è¾“å±‚è¿˜è´Ÿè´£è¿™ä¸€å—åŠŸèƒ½å°±æœ‰ç‚¹è¿èƒŒè®¾è®¡åŸåˆ™äº†ã€‚</p><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬ä¸å¸Œæœ›ä¼ è¾“å±‚åè®®å¤„ç†å¤ªå¤šçš„äº‹æƒ…ï¼Œåªéœ€è¦æœåŠ¡å¥½åº”ç”¨å³å¯ï¼Œè®©å…¶ä½œä¸ºåº”ç”¨é—´æ•°æ®ä¼ è¾“çš„åª’ä»‹ï¼Œå¸®åŠ©å®ç°åº”ç”¨åˆ°åº”ç”¨çš„é€šä¿¡ï¼Œè€Œå®é™…çš„ä¼ è¾“åŠŸèƒ½å°±äº¤ç»™ä¸‹ä¸€å±‚ï¼Œä¹Ÿå°±æ˜¯<strong>ç½‘ç»œå±‚</strong>ï¼ˆ<em>Internet Layer</em>ï¼‰ã€‚</p><img src="'+c+'" alt="img" style="zoom:67%;"><p>ç½‘ç»œå±‚æœ€å¸¸ä½¿ç”¨çš„æ˜¯ IP åè®®ï¼ˆ<em>Internet Protocol</em>ï¼‰ï¼ŒIP åè®®ä¼šå°†ä¼ è¾“å±‚çš„æŠ¥æ–‡ä½œä¸ºæ•°æ®éƒ¨åˆ†ï¼Œå†åŠ ä¸Š IP åŒ…å¤´ç»„è£…æˆ IP æŠ¥æ–‡ï¼Œå¦‚æœ IP æŠ¥æ–‡å¤§å°è¶…è¿‡ MTUï¼ˆä»¥å¤ªç½‘ä¸­ä¸€èˆ¬ä¸º 1500 å­—èŠ‚ï¼‰å°±ä¼š<strong>å†æ¬¡è¿›è¡Œåˆ†ç‰‡</strong>ï¼Œå¾—åˆ°ä¸€ä¸ªå³å°†å‘é€åˆ°ç½‘ç»œçš„ IP æŠ¥æ–‡ã€‚</p><img src="'+d+'" alt="img" style="zoom:67%;"><p>ç½‘ç»œå±‚è´Ÿè´£å°†æ•°æ®ä»ä¸€ä¸ªè®¾å¤‡ä¼ è¾“åˆ°å¦ä¸€ä¸ªè®¾å¤‡ï¼Œä¸–ç•Œä¸Šé‚£ä¹ˆå¤šè®¾å¤‡ï¼Œåˆè¯¥å¦‚ä½•æ‰¾åˆ°å¯¹æ–¹å‘¢ï¼Ÿå› æ­¤ï¼Œ<strong>ç½‘ç»œå±‚</strong>éœ€è¦æœ‰<strong>åŒºåˆ†è®¾å¤‡çš„ç¼–å·</strong>ã€‚</p><p>æˆ‘ä»¬ä¸€èˆ¬ç”¨ IP åœ°å€ç»™è®¾å¤‡è¿›è¡Œç¼–å·ï¼Œå¯¹äº IPv4 åè®®ï¼Œ IP åœ°å€å…± 32 ä½ï¼Œåˆ†æˆäº†å››æ®µï¼ˆæ¯”å¦‚ï¼Œ192.168.100.1ï¼‰ï¼Œæ¯æ®µæ˜¯ 8 ä½ã€‚åªæœ‰ä¸€ä¸ªå•çº¯çš„ IP åœ°å€è™½ç„¶åšåˆ°äº†åŒºåˆ†è®¾å¤‡ï¼Œä½†æ˜¯å¯»å€èµ·æ¥å°±ç‰¹åˆ«éº»çƒ¦ï¼Œå…¨ä¸–ç•Œé‚£ä¹ˆå¤šå°è®¾å¤‡ï¼Œéš¾é“ä¸€ä¸ªä¸€ä¸ªå»åŒ¹é…ï¼Ÿè¿™æ˜¾ç„¶ä¸ç§‘å­¦ã€‚</p><p>å› æ­¤ï¼Œéœ€è¦å°† IP åœ°å€åˆ†æˆä¸¤ç§æ„ä¹‰ï¼š</p><ul><li>ä¸€ä¸ªæ˜¯<strong>ç½‘ç»œå·</strong>ï¼Œè´Ÿè´£æ ‡è¯†è¯¥ IP åœ°å€æ˜¯å±äºå“ªä¸ªã€Œå­ç½‘ã€çš„ï¼›</li><li>ä¸€ä¸ªæ˜¯<strong>ä¸»æœºå·</strong>ï¼Œè´Ÿè´£æ ‡è¯†åŒä¸€ã€Œå­ç½‘ã€ä¸‹çš„ä¸åŒä¸»æœºï¼›</li></ul><p>æ€ä¹ˆåˆ†çš„å‘¢ï¼Ÿè¿™éœ€è¦é…åˆ<strong>å­ç½‘æ©ç </strong>æ‰èƒ½ç®—å‡º IP åœ°å€ çš„ç½‘ç»œå·å’Œä¸»æœºå·ã€‚</p><p>ä¸¾ä¸ªä¾‹å­ï¼Œæ¯”å¦‚ 10.100.122.0/24ï¼Œåé¢çš„<code>/24</code>è¡¨ç¤ºå°±æ˜¯ <code>255.255.255.0</code> å­ç½‘æ©ç ï¼Œ255.255.255.0 äºŒè¿›åˆ¶æ˜¯ã€Œ11111111-11111111-11111111-00000000ã€ï¼Œå¤§å®¶æ•°æ•°ä¸€å…±å¤šå°‘ä¸ª1ï¼Ÿä¸ç”¨æ•°äº†ï¼Œæ˜¯ 24 ä¸ª1ï¼Œä¸ºäº†ç®€åŒ–å­ç½‘æ©ç çš„è¡¨ç¤ºï¼Œç”¨/24ä»£æ›¿255.255.255.0ã€‚</p><p>çŸ¥é“äº†å­ç½‘æ©ç ï¼Œè¯¥æ€ä¹ˆè®¡ç®—å‡ºç½‘ç»œåœ°å€å’Œä¸»æœºåœ°å€å‘¢ï¼Ÿ</p><p>å°† 10.100.122.2 å’Œ 255.255.255.0 è¿›è¡Œ<strong>æŒ‰ä½ä¸è¿ç®—</strong>ï¼Œå°±å¯ä»¥å¾—åˆ°ç½‘ç»œå·ï¼Œå¦‚ä¸‹å›¾ï¼š</p><img src="'+m+'" alt="img" style="zoom:67%;"><p>å°† 255.255.255.0 å–ååä¸IPåœ°å€è¿›è¡Œè¿›è¡Œ<strong>æŒ‰ä½ä¸è¿ç®—</strong>ï¼Œå°±å¯ä»¥å¾—åˆ°ä¸»æœºå·ã€‚</p><p>å¤§å®¶å¯ä»¥å»æœç´¢ä¸‹å­ç½‘æ©ç è®¡ç®—å™¨ï¼Œè‡ªå·±æ”¹å˜ä¸‹ã€Œæ©ç ä½ã€çš„æ•°å€¼ï¼Œå°±èƒ½ä½“ä¼šåˆ°å­ç½‘æ©ç çš„ä½œç”¨äº†ã€‚</p><img src="'+T+'" alt="å­ç½‘æ©ç è®¡ç®—å™¨" style="zoom:67%;"><p>é‚£ä¹ˆåœ¨å¯»å€çš„è¿‡ç¨‹ä¸­ï¼Œå…ˆåŒ¹é…åˆ°ç›¸åŒçš„ç½‘ç»œå·ï¼ˆè¡¨ç¤ºè¦æ‰¾åˆ°åŒä¸€ä¸ªå­ç½‘ï¼‰ï¼Œæ‰ä¼šå»æ‰¾å¯¹åº”çš„ä¸»æœºã€‚</p><p>é™¤äº†å¯»å€èƒ½åŠ›ï¼Œ IP åè®®è¿˜æœ‰å¦ä¸€ä¸ªé‡è¦çš„èƒ½åŠ›å°±æ˜¯<strong>è·¯ç”±</strong>ã€‚å®é™…åœºæ™¯ä¸­ï¼Œä¸¤å°è®¾å¤‡å¹¶ä¸æ˜¯ç”¨ä¸€æ¡ç½‘çº¿è¿æ¥èµ·æ¥çš„ï¼Œè€Œæ˜¯é€šè¿‡å¾ˆå¤šç½‘å…³ã€è·¯ç”±å™¨ã€äº¤æ¢æœºç­‰ä¼—å¤šç½‘ç»œè®¾å¤‡è¿æ¥èµ·æ¥çš„ï¼Œé‚£ä¹ˆå°±ä¼šå½¢æˆå¾ˆå¤šæ¡ç½‘ç»œçš„è·¯å¾„ï¼Œå› æ­¤å½“æ•°æ®åŒ…åˆ°è¾¾ä¸€ä¸ªç½‘ç»œèŠ‚ç‚¹ï¼Œå°±éœ€è¦é€šè¿‡è·¯ç”±ç®—æ³•å†³å®šä¸‹ä¸€æ­¥èµ°å“ªæ¡è·¯å¾„ã€‚</p><p>è·¯ç”±å™¨å¯»å€å·¥ä½œä¸­ï¼Œå°±æ˜¯è¦æ‰¾åˆ°ç›®æ ‡åœ°å€çš„å­ç½‘ï¼Œæ‰¾åˆ°åè¿›è€ŒæŠŠæ•°æ®åŒ…è½¬å‘ç»™å¯¹åº”çš„ç½‘ç»œå†…ã€‚</p><img src="'+h+'" alt="IPåœ°å€çš„ç½‘ç»œå·" style="zoom:67%;"><p>æ‰€ä»¥ï¼Œ<strong>IP åè®®çš„å¯»å€ä½œç”¨æ˜¯å‘Šè¯‰æˆ‘ä»¬å»å¾€ä¸‹ä¸€ä¸ªç›®çš„åœ°è¯¥æœå“ªä¸ªæ–¹å‘èµ°ï¼Œè·¯ç”±åˆ™æ˜¯æ ¹æ®ã€Œä¸‹ä¸€ä¸ªç›®çš„åœ°ã€é€‰æ‹©è·¯å¾„ã€‚å¯»å€æ›´åƒåœ¨å¯¼èˆªï¼Œè·¯ç”±æ›´åƒåœ¨æ“ä½œæ–¹å‘ç›˜</strong>ã€‚</p><ul><li><strong>ç½‘ç»œæ¥å£å±‚</strong></li></ul><p>ç”Ÿæˆäº† IP å¤´éƒ¨ä¹‹åï¼Œæ¥ä¸‹æ¥è¦äº¤ç»™<strong>ç½‘ç»œæ¥å£å±‚</strong>ï¼ˆ<em>Link Layer</em>ï¼‰åœ¨ IP å¤´éƒ¨çš„å‰é¢åŠ ä¸Š MAC å¤´éƒ¨ï¼Œå¹¶å°è£…æˆæ•°æ®å¸§ï¼ˆData frameï¼‰å‘é€åˆ°ç½‘ç»œä¸Šã€‚</p><img src="'+u+'" alt="img" style="zoom:67%;"><p>IP å¤´éƒ¨ä¸­çš„æ¥æ”¶æ–¹ IP åœ°å€è¡¨ç¤ºç½‘ç»œåŒ…çš„ç›®çš„åœ°ï¼Œé€šè¿‡è¿™ä¸ªåœ°å€æˆ‘ä»¬å°±å¯ä»¥åˆ¤æ–­è¦å°†åŒ…å‘åˆ°å“ªé‡Œï¼Œä½†åœ¨ä»¥å¤ªç½‘çš„ä¸–ç•Œä¸­ï¼Œè¿™ä¸ªæ€è·¯æ˜¯è¡Œä¸é€šçš„ã€‚</p><p>ä»€ä¹ˆæ˜¯ä»¥å¤ªç½‘å‘¢ï¼Ÿç”µè„‘ä¸Šçš„ä»¥å¤ªç½‘æ¥å£ï¼ŒWi-Fiæ¥å£ï¼Œä»¥å¤ªç½‘äº¤æ¢æœºã€è·¯ç”±å™¨ä¸Šçš„åƒå…†ï¼Œä¸‡å…†ä»¥å¤ªç½‘å£ï¼Œè¿˜æœ‰ç½‘çº¿ï¼Œå®ƒä»¬éƒ½æ˜¯ä»¥å¤ªç½‘çš„ç»„æˆéƒ¨åˆ†ã€‚ä»¥å¤ªç½‘å°±æ˜¯ä¸€ç§åœ¨ã€Œå±€åŸŸç½‘ã€å†…ï¼ŒæŠŠé™„è¿‘çš„è®¾å¤‡è¿æ¥èµ·æ¥ï¼Œä½¿å®ƒä»¬ä¹‹é—´å¯ä»¥è¿›è¡Œé€šè®¯çš„æŠ€æœ¯ã€‚</p><p>ä»¥å¤ªç½‘åœ¨åˆ¤æ–­ç½‘ç»œåŒ…ç›®çš„åœ°æ—¶å’Œ IP çš„æ–¹å¼ä¸åŒï¼Œå› æ­¤å¿…é¡»é‡‡ç”¨ç›¸åŒ¹é…çš„æ–¹å¼æ‰èƒ½åœ¨ä»¥å¤ªç½‘ä¸­å°†åŒ…å‘å¾€ç›®çš„åœ°ï¼Œè€Œ MAC å¤´éƒ¨å°±æ˜¯å¹²è¿™ä¸ªç”¨çš„ï¼Œæ‰€ä»¥ï¼Œåœ¨ä»¥å¤ªç½‘è¿›è¡Œé€šè®¯è¦ç”¨åˆ° MAC åœ°å€ã€‚</p><p>MAC å¤´éƒ¨æ˜¯ä»¥å¤ªç½‘ä½¿ç”¨çš„å¤´éƒ¨ï¼Œå®ƒåŒ…å«äº†æ¥æ”¶æ–¹å’Œå‘é€æ–¹çš„ MAC åœ°å€ç­‰ä¿¡æ¯ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ ARP åè®®è·å–å¯¹æ–¹çš„ MAC åœ°å€ã€‚</p><p>æ‰€ä»¥è¯´ï¼Œç½‘ç»œæ¥å£å±‚ä¸»è¦ä¸ºç½‘ç»œå±‚æä¾›ã€Œé“¾è·¯çº§åˆ«ã€ä¼ è¾“çš„æœåŠ¡ï¼Œè´Ÿè´£åœ¨ä»¥å¤ªç½‘ã€WiFi è¿™æ ·çš„åº•å±‚ç½‘ç»œä¸Šå‘é€åŸå§‹æ•°æ®åŒ…ï¼Œå·¥ä½œåœ¨ç½‘å¡è¿™ä¸ªå±‚æ¬¡ï¼Œä½¿ç”¨ MAC åœ°å€æ¥æ ‡è¯†ç½‘ç»œä¸Šçš„è®¾å¤‡ã€‚</p><ul><li><strong>æ€»ç»“</strong></li></ul><p>ç»¼ä¸Šæ‰€è¿°ï¼ŒTCP/IP ç½‘ç»œé€šå¸¸æ˜¯ç”±ä¸Šåˆ°ä¸‹åˆ†æˆ 4 å±‚ï¼Œåˆ†åˆ«æ˜¯<strong>åº”ç”¨å±‚ï¼Œä¼ è¾“å±‚ï¼Œç½‘ç»œå±‚å’Œç½‘ç»œæ¥å£å±‚</strong>ã€‚</p><img src="'+_+'" alt="img" style="zoom:67%;"><p>å†ç»™å¤§å®¶è´´ä¸€ä¸‹æ¯ä¸€å±‚çš„å°è£…æ ¼å¼ï¼š</p><img src="'+P+'" alt="img" style="zoom:67%;"><p>ç½‘ç»œæ¥å£å±‚çš„ä¼ è¾“å•ä½æ˜¯å¸§ï¼ˆframeï¼‰ï¼ŒIP å±‚çš„ä¼ è¾“å•ä½æ˜¯åŒ…ï¼ˆpacketï¼‰ï¼ŒTCP å±‚çš„ä¼ è¾“å•ä½æ˜¯æ®µï¼ˆsegmentï¼‰ï¼ŒHTTP çš„ä¼ è¾“å•ä½åˆ™æ˜¯æ¶ˆæ¯æˆ–æŠ¥æ–‡ï¼ˆmessageï¼‰ã€‚ä½†è¿™äº›åè¯å¹¶æ²¡æœ‰ä»€ä¹ˆæœ¬è´¨çš„åŒºåˆ†ï¼Œå¯ä»¥ç»Ÿç§°ä¸ºæ•°æ®åŒ…ã€‚</p><h2 id="_2-2-é”®å…¥ç½‘å€åˆ°ç½‘é¡µæ˜¾ç¤º-æœŸé—´å‘ç”Ÿäº†ä»€ä¹ˆ" tabindex="-1"><a class="header-anchor" href="#_2-2-é”®å…¥ç½‘å€åˆ°ç½‘é¡µæ˜¾ç¤º-æœŸé—´å‘ç”Ÿäº†ä»€ä¹ˆ"><span>2.2 <mark>é”®å…¥ç½‘å€åˆ°ç½‘é¡µæ˜¾ç¤ºï¼ŒæœŸé—´å‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ</mark></span></a></h2><blockquote><p>æƒ³å¿…ä¸å°‘å°ä¼™ä¼´é¢è¯•è¿‡ç¨‹ä¸­ï¼Œä¼šé‡åˆ°ã€Œ<strong>å½“é”®å…¥ç½‘å€åï¼Œåˆ°ç½‘é¡µæ˜¾ç¤ºï¼Œå…¶é—´å‘ç”Ÿäº†ä»€ä¹ˆ</strong>ã€çš„é¢è¯•é¢˜ã€‚</p></blockquote><p>è¿˜åˆ«è¯´ï¼Œè¿™é—®é¢˜çœŸæŒºå¸¸é—®çš„ï¼Œå‰å‡ å¤©ååœ¨æˆ‘æ—è¾¹çš„ä¸»ç®¡ç”µè¯é¢è¯•åº”è˜è€…çš„æ—¶å€™ï¼Œä¹Ÿé—®äº†è¿™ä¸ªé—®é¢˜ã€‚</p><p>æ¥ä¸‹æ¥ä»¥ä¸‹å›¾è¾ƒç®€å•çš„ç½‘ç»œæ‹“æ‰‘æ¨¡å‹ä½œä¸ºä¾‹å­ï¼Œæ¢ç©¶æ¢ç©¶å…¶é—´å‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ</p><img src="'+C+'" alt="ç®€å•çš„ç½‘ç»œæ¨¡å‹"><h4 id="å­¤å•å°å¼Ÿ-â€”â€”-http" tabindex="-1"><a class="header-anchor" href="#å­¤å•å°å¼Ÿ-â€”â€”-http"><span>- å­¤å•å°å¼Ÿ â€”â€” HTTP</span></a></h4><blockquote><p>æµè§ˆå™¨åšçš„ç¬¬ä¸€æ­¥å·¥ä½œæ˜¯<strong>è§£æ URL</strong></p></blockquote><p>é¦–å…ˆ<strong>æµè§ˆå™¨</strong>åšçš„ç¬¬ä¸€æ­¥å·¥ä½œå°±æ˜¯è¦å¯¹ <code>URL</code> è¿›è¡Œ<strong>è§£æ</strong>ï¼Œä»è€Œç”Ÿæˆå‘é€ç»™ <code>Web</code> æœåŠ¡å™¨çš„è¯·æ±‚ä¿¡æ¯ã€‚</p><p>è®©æˆ‘ä»¬çœ‹çœ‹ä¸€æ¡é•¿é•¿çš„ URL é‡Œçš„å„ä¸ªå…ƒç´ çš„ä»£è¡¨ä»€ä¹ˆï¼Œè§ä¸‹å›¾ï¼š</p><img src="'+b+'" alt="URL è§£æ" style="zoom:67%;"><blockquote><p>æ‰€ä»¥å›¾ä¸­çš„<strong>é•¿é•¿çš„ URL</strong> å®é™…ä¸Šæ˜¯<strong>è¯·æ±‚æœåŠ¡å™¨é‡Œçš„æ–‡ä»¶èµ„æº</strong>ã€‚</p></blockquote><blockquote><p>è¦æ˜¯ä¸Šå›¾ä¸­çš„è“è‰²éƒ¨åˆ† URL å…ƒç´ éƒ½çœç•¥äº†ï¼Œé‚£åº”è¯¥æ˜¯è¯·æ±‚å“ªä¸ªæ–‡ä»¶å‘¢ï¼Ÿ</p></blockquote><p>å½“<strong>æ²¡æœ‰è·¯å¾„åæ—¶</strong>ï¼Œå°±ä»£è¡¨è®¿é—®æ ¹ç›®å½•ä¸‹äº‹å…ˆè®¾ç½®çš„<strong>é»˜è®¤æ–‡ä»¶</strong>ï¼Œä¹Ÿå°±æ˜¯ <code>/index.html</code> æˆ–è€… <code>/default.html</code> è¿™äº›æ–‡ä»¶ï¼Œè¿™æ ·å°±ä¸ä¼šå‘ç”Ÿæ··ä¹±äº†ã€‚</p><blockquote><h4 id="ç”Ÿäº§-http-è¯·æ±‚ä¿¡æ¯" tabindex="-1"><a class="header-anchor" href="#ç”Ÿäº§-http-è¯·æ±‚ä¿¡æ¯"><span>ç”Ÿäº§ HTTP è¯·æ±‚ä¿¡æ¯</span></a></h4></blockquote><p>å¯¹ <code>URL</code> è¿›è¡Œè§£æä¹‹åï¼Œæµè§ˆå™¨ç¡®å®šäº† Web æœåŠ¡å™¨å’Œæ–‡ä»¶åï¼Œæ¥ä¸‹æ¥å°±æ˜¯<strong>æ ¹æ®è¿™äº›ä¿¡æ¯æ¥ç”Ÿæˆ HTTP è¯·æ±‚æ¶ˆæ¯äº†ã€‚</strong></p><img src="'+k+'" alt="HTTP çš„æ¶ˆæ¯æ ¼å¼" style="zoom:67%;"><blockquote><p>ä¸€ä¸ªå­¤å• HTTP æ•°æ®åŒ…è¡¨ç¤ºï¼šâ€œæˆ‘è¿™ä¹ˆä¸€ä¸ªå°å°çš„æ•°æ®åŒ…ï¼Œæ²¡äº²æ²¡å‹ï¼Œç›´æ¥å‘åˆ°æµ©ç€šçš„ç½‘ç»œï¼Œè°ä¼šçŸ¥é“æˆ‘å‘¢ï¼Ÿè°èƒ½è½½æˆ‘ä¸€ç¨‹å‘¢ï¼Ÿè°èƒ½ä¿æŠ¤æˆ‘å‘¢ï¼Ÿæˆ‘çš„ç›®çš„åœ°åœ¨å“ªå‘¢ï¼Ÿâ€ã€‚å……æ»¡å„ç§ç–‘é—®çš„å®ƒï¼Œæ²¡æœ‰åœæ»ä¸å‰ï¼Œä¾ç„¶è¸ä¸Šäº†å¾é€”ï¼</p></blockquote><h4 id="çœŸå®åœ°å€æŸ¥è¯¢-â€”â€”-dns" tabindex="-1"><a class="header-anchor" href="#çœŸå®åœ°å€æŸ¥è¯¢-â€”â€”-dns"><span>- <strong>çœŸå®åœ°å€æŸ¥è¯¢ â€”â€” DNS</strong></span></a></h4><p>é€šè¿‡æµè§ˆå™¨è§£æ URL å¹¶ç”Ÿæˆ HTTP æ¶ˆæ¯åï¼Œéœ€è¦<strong>å§”æ‰˜æ“ä½œç³»ç»Ÿ</strong>å°†æ¶ˆæ¯å‘é€ç»™ <code>Web</code> æœåŠ¡å™¨ã€‚</p><p>ä½†åœ¨å‘é€ä¹‹å‰ï¼Œè¿˜æœ‰ä¸€é¡¹å·¥ä½œéœ€è¦å®Œæˆï¼Œé‚£å°±æ˜¯ <strong>æŸ¥è¯¢æœåŠ¡å™¨åŸŸåå¯¹åº”çš„ IP åœ°å€</strong> ï¼Œå› ä¸ºå§”æ‰˜æ“ä½œç³»ç»Ÿå‘é€æ¶ˆæ¯æ—¶ï¼Œå¿…é¡»æä¾›é€šä¿¡å¯¹è±¡çš„ IP åœ°å€ã€‚</p><p>æ¯”å¦‚æˆ‘ä»¬æ‰“ç”µè¯çš„æ—¶å€™ï¼Œå¿…é¡»è¦çŸ¥é“å¯¹æ–¹çš„ç”µè¯å·ç ï¼Œä½†ç”±äºç”µè¯å·ç éš¾ä»¥è®°å¿†ï¼Œæ‰€ä»¥é€šå¸¸æˆ‘ä»¬ä¼šå°†å¯¹æ–¹ç”µè¯å· + å§“åä¿å­˜åœ¨é€šè®¯å½•é‡Œã€‚</p><p>æ‰€ä»¥ï¼Œæœ‰ä¸€ç§<strong>æœåŠ¡å™¨</strong>å°±ä¸“é—¨ä¿å­˜äº† <strong><code>Web</code> æœåŠ¡å™¨åŸŸåä¸ <code>IP</code> çš„å¯¹åº”å…³ç³»</strong>ï¼Œå®ƒå°±æ˜¯ <strong><code>DNS</code> æœåŠ¡å™¨ã€‚</strong></p><blockquote><h5 id="åŸŸåçš„å±‚çº§å…³ç³»" tabindex="-1"><a class="header-anchor" href="#åŸŸåçš„å±‚çº§å…³ç³»"><span>åŸŸåçš„å±‚çº§å…³ç³»</span></a></h5></blockquote><p>DNS ä¸­çš„åŸŸåéƒ½æ˜¯ç”¨<strong>å¥ç‚¹</strong>æ¥åˆ†éš”çš„ï¼Œæ¯”å¦‚ <code>www.server.com</code>ï¼Œè¿™é‡Œçš„å¥ç‚¹ä»£è¡¨äº†ä¸åŒå±‚æ¬¡ä¹‹é—´çš„<strong>ç•Œé™</strong>ã€‚</p><p>åœ¨åŸŸåä¸­ï¼Œ<strong>è¶Šé å³</strong>çš„ä½ç½®è¡¨ç¤ºå…¶å±‚çº§<strong>è¶Šé«˜</strong>ã€‚</p><p>æ¯•ç«ŸåŸŸåæ˜¯å¤–å›½äººå‘æ˜ï¼Œæ‰€ä»¥æ€ç»´å’Œä¸­å›½äººç›¸åï¼Œæ¯”å¦‚è¯´ä¸€ä¸ªåŸå¸‚åœ°ç‚¹çš„æ—¶å€™ï¼Œå¤–å›½å–œæ¬¢ä»å°åˆ°å¤§çš„æ–¹å¼é¡ºåºè¯´èµ·ï¼ˆå¦‚ XX è¡—é“ XX åŒº XX å¸‚ XX çœï¼‰ï¼Œè€Œä¸­å›½åˆ™å–œæ¬¢ä»å¤§åˆ°å°çš„é¡ºåºï¼ˆå¦‚ XX çœ XX å¸‚ XX åŒº XX è¡—é“ï¼‰ã€‚</p><p>å®é™…ä¸ŠåŸŸåæœ€åè¿˜æœ‰ä¸€ä¸ªç‚¹ï¼Œæ¯”å¦‚ <code>www.server.com.</code>ï¼Œè¿™ä¸ªæœ€åçš„ä¸€ä¸ªç‚¹ä»£è¡¨<strong>æ ¹åŸŸå</strong>ã€‚</p><p>ä¹Ÿå°±æ˜¯ï¼Œ<code>.</code> æ ¹åŸŸæ˜¯åœ¨æœ€é¡¶å±‚ï¼Œå®ƒçš„ä¸‹ä¸€å±‚å°±æ˜¯ <code>.com</code> é¡¶çº§åŸŸï¼Œå†ä¸‹é¢æ˜¯ <code>server.com</code>ã€‚</p><p>æ‰€ä»¥åŸŸåçš„å±‚çº§å…³ç³»ç±»ä¼¼ä¸€ä¸ªæ ‘çŠ¶ç»“æ„ï¼š</p><ul><li>æ ¹ DNS æœåŠ¡å™¨ï¼ˆ.ï¼‰</li><li>é¡¶çº§åŸŸ DNS æœåŠ¡å™¨ï¼ˆ.comï¼‰</li><li>æƒå¨ DNS æœåŠ¡å™¨ï¼ˆserver.comï¼‰</li></ul><img src="'+f+'" alt="DNS æ ‘çŠ¶ç»“æ„" style="zoom:67%;"><p><strong>æ ¹åŸŸçš„ DNS æœåŠ¡å™¨ä¿¡æ¯ä¿å­˜åœ¨äº’è”ç½‘ä¸­æ‰€æœ‰çš„ DNS æœåŠ¡å™¨ä¸­ã€‚</strong></p><p>è¿™æ ·ä¸€æ¥ï¼Œä»»ä½• DNS æœåŠ¡å™¨å°±éƒ½å¯ä»¥æ‰¾åˆ°å¹¶è®¿é—®æ ¹åŸŸ DNS æœåŠ¡å™¨äº†ã€‚</p><p>å› æ­¤ï¼Œå®¢æˆ·ç«¯åªè¦èƒ½å¤Ÿæ‰¾åˆ°<strong>ä»»æ„ä¸€å° DNS æœåŠ¡å™¨</strong>ï¼Œå°±å¯ä»¥é€šè¿‡å®ƒæ‰¾åˆ°æ ¹åŸŸ DNS æœåŠ¡å™¨ï¼Œç„¶åå†ä¸€è·¯é¡ºè—¤æ‘¸ç“œæ‰¾åˆ°ä½äºä¸‹å±‚çš„æŸå°ç›®æ ‡ DNS æœåŠ¡å™¨ã€‚</p><blockquote><h4 id="åŸŸåè§£æçš„å·¥ä½œæµç¨‹" tabindex="-1"><a class="header-anchor" href="#åŸŸåè§£æçš„å·¥ä½œæµç¨‹"><span>åŸŸåè§£æçš„å·¥ä½œæµç¨‹</span></a></h4></blockquote><ol><li>å®¢æˆ·ç«¯é¦–å…ˆä¼šå‘å‡ºä¸€ä¸ª DNS è¯·æ±‚ï¼Œé—® www.server.com çš„ <strong>IP æ˜¯å•¥</strong>ï¼Œå¹¶å‘ç»™æœ¬åœ° DNS æœåŠ¡å™¨ï¼ˆä¹Ÿå°±æ˜¯å®¢æˆ·ç«¯çš„ TCP/IP è®¾ç½®ä¸­å¡«å†™çš„ DNS æœåŠ¡å™¨åœ°å€ï¼‰ã€‚</li><li>æœ¬åœ°åŸŸåæœåŠ¡å™¨æ”¶åˆ°å®¢æˆ·ç«¯çš„è¯·æ±‚åï¼Œå¦‚æœç¼“å­˜é‡Œçš„è¡¨æ ¼èƒ½æ‰¾åˆ° www.server.comï¼Œåˆ™å®ƒç›´æ¥è¿”å› IP åœ°å€ã€‚å¦‚æœæ²¡æœ‰ï¼Œæœ¬åœ° DNS ä¼šå»é—®å®ƒçš„æ ¹åŸŸåæœåŠ¡å™¨ï¼šâ€œè€å¤§ï¼Œ èƒ½å‘Šè¯‰æˆ‘ www.server.com çš„ IP åœ°å€å—ï¼Ÿâ€ æ ¹åŸŸåæœåŠ¡å™¨æ˜¯æœ€é«˜å±‚æ¬¡çš„ï¼Œå®ƒä¸ç›´æ¥ç”¨äºåŸŸåè§£æï¼Œä½†èƒ½<strong>æŒ‡æ˜ä¸€æ¡é“è·¯</strong>ã€‚</li><li>æ ¹ DNS æ”¶åˆ°æ¥è‡ªæœ¬åœ° DNS çš„è¯·æ±‚åï¼Œå‘ç°åç½®æ˜¯ .comï¼Œè¯´ï¼šâ€œwww.server.com è¿™ä¸ªåŸŸåå½’ .com åŒºåŸŸç®¡ç†â€ï¼Œæˆ‘ç»™ä½  .com é¡¶çº§åŸŸåæœåŠ¡å™¨åœ°å€ç»™ä½ ï¼Œä½ å»é—®é—®å®ƒå§ã€‚â€</li><li>æœ¬åœ° DNS æ”¶åˆ°é¡¶çº§åŸŸåæœåŠ¡å™¨çš„åœ°å€åï¼Œå‘èµ·è¯·æ±‚é—®â€œè€äºŒï¼Œ ä½ èƒ½å‘Šè¯‰æˆ‘ www.server.com çš„ IP åœ°å€å—ï¼Ÿâ€</li><li>é¡¶çº§åŸŸåæœåŠ¡å™¨è¯´ï¼šâ€œæˆ‘ç»™ä½ è´Ÿè´£ www.server.com åŒºåŸŸçš„æƒå¨ DNS æœåŠ¡å™¨çš„åœ°å€ï¼Œä½ å»é—®å®ƒåº”è¯¥èƒ½é—®åˆ°â€ã€‚</li><li>æœ¬åœ° DNS äºæ˜¯è½¬å‘é—®æƒå¨ DNS æœåŠ¡å™¨ï¼šâ€œè€ä¸‰ï¼Œwww.server.comå¯¹åº”çš„IPæ˜¯å•¥å‘€ï¼Ÿâ€ server.com çš„æƒå¨ DNS æœåŠ¡å™¨ï¼Œå®ƒæ˜¯åŸŸåè§£æç»“æœçš„åŸå‡ºå¤„ã€‚ä¸ºå•¥å«æƒå¨å‘¢ï¼Ÿå°±æ˜¯æˆ‘çš„åŸŸåæˆ‘åšä¸»ã€‚</li><li>æƒå¨ DNS æœåŠ¡å™¨æŸ¥è¯¢åå°†å¯¹åº”çš„ IP åœ°å€ X.X.X.X å‘Šè¯‰æœ¬åœ° DNSã€‚</li><li>æœ¬åœ° DNS å†å°† IP åœ°å€è¿”å›å®¢æˆ·ç«¯ï¼Œå®¢æˆ·ç«¯å’Œç›®æ ‡å»ºç«‹è¿æ¥ã€‚</li></ol><p>è‡³æ­¤ï¼Œæˆ‘ä»¬å®Œæˆäº† DNS çš„è§£æè¿‡ç¨‹ã€‚ç°åœ¨æ€»ç»“ä¸€ä¸‹ï¼Œæ•´ä¸ªè¿‡ç¨‹æˆ‘ç”»æˆäº†ä¸€ä¸ªå›¾ã€‚</p><img src="'+S+'" alt="åŸŸåè§£æçš„å·¥ä½œæµç¨‹" style="zoom:67%;"><p>DNS åŸŸåè§£æçš„è¿‡ç¨‹è›®æœ‰æ„æ€çš„ï¼Œæ•´ä¸ªè¿‡ç¨‹å°±å’Œæˆ‘ä»¬æ—¥å¸¸ç”Ÿæ´»ä¸­æ‰¾äººé—®è·¯çš„è¿‡ç¨‹ç±»ä¼¼ï¼Œ<strong>åªæŒ‡è·¯ä¸å¸¦è·¯</strong>ã€‚</p><blockquote><p>é‚£æ˜¯ä¸æ˜¯æ¯æ¬¡è§£æåŸŸåéƒ½è¦ç»è¿‡é‚£ä¹ˆå¤šçš„æ­¥éª¤å‘¢ï¼Ÿ</p></blockquote><p>å½“ç„¶ä¸æ˜¯äº†ï¼Œè¿˜æœ‰<strong>ç¼“å­˜</strong>è¿™ä¸ªä¸œè¥¿çš„å˜›ã€‚</p><p>æµè§ˆå™¨ä¼šå…ˆçœ‹<strong>è‡ªèº«æœ‰æ²¡æœ‰å¯¹è¿™ä¸ªåŸŸåçš„ç¼“å­˜</strong>ï¼Œå¦‚æœæœ‰ï¼Œå°±ç›´æ¥è¿”å›ï¼Œå¦‚æœæ²¡æœ‰ï¼Œå°±å»é—®æ“ä½œç³»ç»Ÿï¼Œæ“ä½œç³»ç»Ÿä¹Ÿä¼šå»çœ‹è‡ªå·±çš„<strong>ç¼“å­˜</strong>ï¼Œå¦‚æœæœ‰ï¼Œå°±ç›´æ¥è¿”å›ï¼Œå¦‚æœæ²¡æœ‰ï¼Œå†å» hosts æ–‡ä»¶çœ‹ï¼Œä¹Ÿæ²¡æœ‰ï¼Œæ‰ä¼šå»é—®ã€Œæœ¬åœ° DNS æœåŠ¡å™¨ã€ã€‚</p><blockquote><p>æ•°æ®åŒ…è¡¨ç¤ºï¼šâ€œDNS è€å¤§å“¥å‰å®³å‘€ï¼Œæ‰¾åˆ°äº†ç›®çš„åœ°äº†ï¼æˆ‘è¿˜æ˜¯å¾ˆè¿·èŒ«å‘€ï¼Œæˆ‘è¦å‘å‡ºå»ï¼Œæ¥ä¸‹æ¥æˆ‘éœ€è¦è°çš„å¸®åŠ©å‘¢?â€</p></blockquote><h4 id="æŒ‡å—å¥½å¸®æ‰‹-â€”â€”-åè®®æ ˆ" tabindex="-1"><a class="header-anchor" href="#æŒ‡å—å¥½å¸®æ‰‹-â€”â€”-åè®®æ ˆ"><span>- <strong>æŒ‡å—å¥½å¸®æ‰‹ â€”â€” åè®®æ ˆ</strong></span></a></h4><p>é€šè¿‡ DNS è·å–åˆ° IP åï¼Œå°±å¯ä»¥æŠŠ HTTP çš„ä¼ è¾“å·¥ä½œäº¤ç»™æ“ä½œç³»ç»Ÿä¸­çš„ <strong>åè®®æ ˆ</strong>ã€‚</p><p>åè®®æ ˆçš„å†…éƒ¨åˆ†ä¸º<strong>å‡ ä¸ªéƒ¨åˆ†</strong>ï¼Œåˆ†åˆ«æ‰¿æ‹…ä¸åŒçš„å·¥ä½œã€‚ä¸Šä¸‹å…³ç³»æ˜¯æœ‰ä¸€å®šçš„è§„åˆ™çš„ï¼Œä¸Šé¢çš„éƒ¨åˆ†ä¼šå‘ä¸‹é¢çš„éƒ¨åˆ†å§”æ‰˜å·¥ä½œï¼Œä¸‹é¢çš„éƒ¨åˆ†æ”¶åˆ°å§”æ‰˜çš„å·¥ä½œå¹¶æ‰§è¡Œã€‚</p><img src="'+A+'" alt="img" style="zoom:80%;"><blockquote><p>åº”ç”¨ç¨‹åºï¼ˆæµè§ˆå™¨ï¼‰é€šè¿‡<strong>è°ƒç”¨ Socket åº“</strong>ï¼Œæ¥**<code>å§”æ‰˜åè®®æ ˆ</code>å·¥ä½œ**ã€‚åè®®æ ˆçš„ä¸ŠåŠéƒ¨åˆ†æœ‰ä¸¤å—ï¼Œåˆ†åˆ«æ˜¯è´Ÿè´£æ”¶å‘æ•°æ®çš„ TCP å’Œ UDP åè®®ï¼Œè¿™ä¸¤ä¸ªä¼ è¾“åè®®ä¼šæ¥å—åº”ç”¨å±‚çš„å§”æ‰˜æ‰§è¡Œæ”¶å‘æ•°æ®çš„æ“ä½œã€‚</p></blockquote><p>åè®®æ ˆçš„ä¸‹é¢ä¸€èˆ¬æ˜¯ç”¨ IP åè®®æ§åˆ¶ç½‘ç»œåŒ…æ”¶å‘æ“ä½œï¼Œåœ¨äº’è”ç½‘ä¸Šä¼ æ•°æ®æ—¶ï¼Œæ•°æ®ä¼šè¢«åˆ‡åˆ†æˆä¸€å—å—çš„ç½‘ç»œåŒ…ï¼Œè€Œå°†ç½‘ç»œåŒ…å‘é€ç»™å¯¹æ–¹çš„æ“ä½œå°±æ˜¯ç”± IP è´Ÿè´£çš„ã€‚</p><p>æ­¤å¤– IP ä¸­è¿˜åŒ…æ‹¬ <code>ICMP</code> åè®®å’Œ <code>ARP</code> åè®®ã€‚</p><ul><li><code>ICMP</code> ç”¨äºå‘ŠçŸ¥ç½‘ç»œåŒ…ä¼ é€è¿‡ç¨‹ä¸­äº§ç”Ÿçš„é”™è¯¯ä»¥åŠå„ç§æ§åˆ¶ä¿¡æ¯ã€‚</li><li><code>ARP</code> ç”¨äºæ ¹æ® IP åœ°å€<strong>æŸ¥è¯¢</strong>ç›¸åº”çš„ä»¥å¤ªç½‘ MAC åœ°å€ã€‚</li></ul><p>IP ä¸‹é¢çš„ç½‘å¡é©±åŠ¨ç¨‹åºè´Ÿè´£æ§åˆ¶ç½‘å¡ç¡¬ä»¶ï¼Œè€Œæœ€ä¸‹é¢çš„ç½‘å¡åˆ™è´Ÿè´£å®Œæˆå®é™…çš„æ”¶å‘æ“ä½œï¼Œä¹Ÿå°±æ˜¯å¯¹ç½‘çº¿ä¸­çš„ä¿¡å·æ‰§è¡Œå‘é€å’Œæ¥æ”¶æ“ä½œã€‚</p><blockquote><p>æ•°æ®åŒ…çœ‹äº†è¿™ä»½æŒ‡å—è¡¨ç¤ºï¼šâ€œåŸæ¥æˆ‘éœ€è¦é‚£ä¹ˆå¤šå¤§ä½¬çš„ååŠ©å•Šï¼Œé‚£æˆ‘å…ˆå»æ‰¾æ‰¾ TCP å¤§ä½¬ï¼â€</p></blockquote><h4 id="å¯é ä¼ è¾“-â€”â€”-tcp" tabindex="-1"><a class="header-anchor" href="#å¯é ä¼ è¾“-â€”â€”-tcp"><span>- å¯é ä¼ è¾“ â€”â€” TCP</span></a></h4><p>HTTP æ˜¯åŸºäº TCP åè®®ä¼ è¾“çš„ï¼Œæ‰€ä»¥åœ¨è¿™æˆ‘ä»¬å…ˆäº†è§£ä¸‹ TCP åè®®ã€‚</p><blockquote><h4 id="tcp-åŒ…å¤´æ ¼å¼" tabindex="-1"><a class="header-anchor" href="#tcp-åŒ…å¤´æ ¼å¼"><span>TCP åŒ…å¤´æ ¼å¼</span></a></h4></blockquote><p>æˆ‘ä»¬å…ˆçœ‹çœ‹ TCP æŠ¥æ–‡å¤´éƒ¨çš„æ ¼å¼ï¼š</p><img src="'+I+'" alt="TCP åŒ…å¤´æ ¼å¼" style="zoom:67%;"><p>é¦–å…ˆï¼Œ<strong>æºç«¯å£å·</strong>å’Œ<strong>ç›®æ ‡ç«¯å£</strong>å·æ˜¯ä¸å¯å°‘çš„ï¼Œå¦‚æœæ²¡æœ‰è¿™ä¸¤ä¸ªç«¯å£å·ï¼Œæ•°æ®å°±ä¸çŸ¥é“åº”è¯¥å‘ç»™å“ªä¸ªåº”ç”¨ã€‚</p><p>æ¥ä¸‹æ¥æœ‰åŒ…çš„<strong>åº</strong>å·ï¼Œè¿™ä¸ªæ˜¯ä¸ºäº†<strong>è§£å†³åŒ…ä¹±åº</strong>çš„é—®é¢˜ã€‚</p><p>è¿˜æœ‰åº”è¯¥æœ‰çš„æ˜¯<strong>ç¡®è®¤å·</strong>ï¼Œç›®çš„æ˜¯<strong>ç¡®è®¤å‘å‡ºå»å¯¹æ–¹æ˜¯å¦æœ‰æ”¶åˆ°</strong>ã€‚å¦‚æœæ²¡æœ‰æ”¶åˆ°å°±åº”è¯¥é‡æ–°å‘é€ï¼Œç›´åˆ°é€è¾¾ï¼Œè¿™ä¸ªæ˜¯ä¸ºäº†<strong>è§£å†³ä¸¢åŒ…</strong>çš„é—®é¢˜ã€‚</p><p>æ¥ä¸‹æ¥è¿˜æœ‰ä¸€äº›<strong>çŠ¶æ€ä½</strong>ã€‚ä¾‹å¦‚ <code>SYN</code> æ˜¯å‘èµ·ä¸€ä¸ªè¿æ¥ï¼Œ<code>ACK</code> æ˜¯å›å¤ï¼Œ<code>RST</code> æ˜¯é‡æ–°è¿æ¥ï¼Œ<code>FIN</code> æ˜¯ç»“æŸè¿æ¥ç­‰ã€‚TCP æ˜¯é¢å‘è¿æ¥çš„ï¼Œå› è€Œ<strong>åŒæ–¹è¦ç»´æŠ¤è¿æ¥çš„çŠ¶æ€</strong>ï¼Œè¿™äº›å¸¦çŠ¶æ€ä½çš„åŒ…çš„å‘é€ï¼Œä¼šå¼•èµ·åŒæ–¹çš„<strong>çŠ¶æ€å˜æ›´</strong>ã€‚</p><p>è¿˜æœ‰ä¸€ä¸ªé‡è¦çš„å°±æ˜¯<strong>çª—å£å¤§å°</strong>ã€‚TCP è¦åš<strong>æµé‡æ§åˆ¶</strong>ï¼Œé€šä¿¡åŒæ–¹å„å£°æ˜ä¸€ä¸ªçª—å£ï¼ˆç¼“å­˜å¤§å°ï¼‰ï¼Œæ ‡è¯†è‡ªå·±å½“å‰èƒ½å¤Ÿçš„å¤„ç†èƒ½åŠ›ï¼Œåˆ«å‘é€çš„å¤ªå¿«ï¼Œæ’‘æ­»æˆ‘ï¼Œä¹Ÿåˆ«å‘çš„å¤ªæ…¢ï¼Œé¥¿æ­»æˆ‘ã€‚</p><p>é™¤äº†åšæµé‡æ§åˆ¶ä»¥å¤–ï¼ŒTCPè¿˜ä¼šåš<strong>æ‹¥å¡æ§åˆ¶</strong>ï¼Œå¯¹äºçœŸæ­£çš„é€šè·¯å µè½¦ä¸å µè½¦ï¼Œå®ƒæ— èƒ½ä¸ºåŠ›ï¼Œå”¯ä¸€èƒ½åšçš„å°±æ˜¯æ§åˆ¶è‡ªå·±ï¼Œä¹Ÿå³<strong>æ§åˆ¶å‘é€çš„é€Ÿåº¦</strong>ã€‚ä¸èƒ½æ”¹å˜ä¸–ç•Œï¼Œå°±æ”¹å˜è‡ªå·±å˜›ã€‚</p><blockquote><p>TCP ä¼ è¾“æ•°æ®ä¹‹å‰ï¼Œè¦å…ˆ<strong>ä¸‰æ¬¡æ¡æ‰‹å»ºç«‹è¿æ¥</strong></p></blockquote><p>åœ¨ <strong><code>HTTP ä¼ è¾“æ•°æ®ä¹‹å‰</code>ï¼Œé¦–å…ˆéœ€è¦ <code>TCP å»ºç«‹è¿æ¥</code></strong>ï¼ŒTCP è¿æ¥çš„å»ºç«‹ï¼Œé€šå¸¸ç§°ä¸º<strong>ä¸‰æ¬¡æ¡æ‰‹</strong>ã€‚</p><p>è¿™ä¸ªæ‰€è°“çš„ã€Œè¿æ¥ã€ï¼Œåªæ˜¯åŒæ–¹è®¡ç®—æœºé‡Œç»´æŠ¤ä¸€ä¸ªçŠ¶æ€æœºï¼Œåœ¨è¿æ¥å»ºç«‹çš„è¿‡ç¨‹ä¸­ï¼ŒåŒæ–¹çš„çŠ¶æ€å˜åŒ–æ—¶åºå›¾å°±åƒè¿™æ ·ã€‚</p><img src="'+x+'" alt="TCP ä¸‰æ¬¡æ¡æ‰‹" style="zoom:50%;"><ul><li>ä¸€å¼€å§‹ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯éƒ½å¤„äº <code>CLOSED</code> çŠ¶æ€ã€‚å…ˆæ˜¯<strong>æœåŠ¡ç«¯ä¸»åŠ¨ç›‘å¬æŸä¸ªç«¯å£</strong>ï¼Œå¤„äº <code>LISTEN</code> çŠ¶æ€ã€‚</li><li>ç„¶å<strong>å®¢æˆ·ç«¯ä¸»åŠ¨å‘èµ·è¿æ¥</strong> <code>SYN</code>ï¼Œä¹‹åå¤„äº <code>SYN-SENT</code> çŠ¶æ€ã€‚</li><li>æœåŠ¡ç«¯æ”¶åˆ°å‘èµ·çš„è¿æ¥ï¼Œè¿”å› <code>SYN</code>ï¼Œå¹¶ä¸” <code>ACK</code> å®¢æˆ·ç«¯çš„ <code>SYN</code>ï¼Œä¹‹åå¤„äº <code>SYN-RCVD</code> çŠ¶æ€ã€‚</li><li>å®¢æˆ·ç«¯æ”¶åˆ°æœåŠ¡ç«¯å‘é€çš„ <code>SYN</code> å’Œ <code>ACK</code> ä¹‹åï¼Œ<strong>å‘é€</strong>å¯¹ <code>SYN</code> ç¡®è®¤çš„ <code>ACK</code>ï¼Œä¹‹åå¤„äº <code>ESTABLISHED</code> çŠ¶æ€ï¼Œ<strong>å› ä¸ºå®ƒä¸€å‘ä¸€æ”¶æˆåŠŸäº†ã€‚</strong></li><li>æœåŠ¡ç«¯æ”¶åˆ° <code>ACK</code> çš„ <code>ACK</code> ä¹‹åï¼Œå¤„äº <code>ESTABLISHED</code> çŠ¶æ€ï¼Œå› ä¸º<strong>å®ƒä¹Ÿä¸€å‘ä¸€æ”¶äº†ã€‚</strong></li></ul><p>æ‰€ä»¥ä¸‰æ¬¡æ¡æ‰‹ç›®çš„æ˜¯<strong>ä¿è¯åŒæ–¹éƒ½æœ‰å‘é€å’Œæ¥æ”¶çš„èƒ½åŠ›</strong>ã€‚</p><blockquote><p>å¦‚ä½•æŸ¥çœ‹ TCP çš„è¿æ¥çŠ¶æ€ï¼Ÿ</p></blockquote><p>TCP çš„è¿æ¥çŠ¶æ€æŸ¥çœ‹ï¼Œåœ¨ Linux å¯ä»¥é€šè¿‡ <code>netstat -napt</code> å‘½ä»¤æŸ¥çœ‹ã€‚</p><img src="'+N+'" alt="TCP è¿æ¥çŠ¶æ€æŸ¥çœ‹" style="zoom:50%;"><blockquote><p>TCP åˆ†å‰²æ•°æ®</p></blockquote><p>å¦‚æœ <strong>HTTP è¯·æ±‚æ¶ˆæ¯æ¯”è¾ƒé•¿</strong>ï¼Œè¶…è¿‡äº† <code>MSS</code> çš„é•¿åº¦ï¼Œè¿™æ—¶ TCP å°±éœ€è¦<strong>æŠŠ HTTP çš„æ•°æ®æ‹†è§£æˆä¸€å—å—çš„æ•°æ®å‘é€</strong>ï¼Œè€Œä¸æ˜¯ä¸€æ¬¡æ€§å‘é€æ‰€æœ‰æ•°æ®ã€‚</p><img src="'+q+'" alt="MTU ä¸ MSS" style="zoom:67%;"><ul><li><code>MTU</code>ï¼šä¸€ä¸ªç½‘ç»œåŒ…çš„æœ€å¤§é•¿åº¦ï¼Œä»¥å¤ªç½‘ä¸­ä¸€èˆ¬ä¸º <code>1500</code> å­—èŠ‚ã€‚</li><li><code>MSS</code>ï¼šé™¤å» IP å’Œ TCP å¤´éƒ¨ä¹‹åï¼Œä¸€ä¸ªç½‘ç»œåŒ…æ‰€èƒ½å®¹çº³çš„ TCP æ•°æ®çš„æœ€å¤§é•¿åº¦ã€‚</li></ul><p>æ•°æ®ä¼šè¢«ä»¥ <code>MSS</code> çš„é•¿åº¦ä¸ºå•ä½è¿›è¡Œæ‹†åˆ†ï¼Œæ‹†åˆ†å‡ºæ¥çš„æ¯ä¸€å—æ•°æ®éƒ½ä¼šè¢«æ”¾è¿›å•ç‹¬çš„ç½‘ç»œåŒ…ä¸­ã€‚ä¹Ÿå°±æ˜¯åœ¨æ¯ä¸ªè¢«æ‹†åˆ†çš„æ•°æ®åŠ ä¸Š TCP å¤´ä¿¡æ¯ï¼Œç„¶åäº¤ç»™ IP æ¨¡å—æ¥å‘é€æ•°æ®ã€‚</p><img src="'+y+'" alt="æ•°æ®åŒ…åˆ†å‰²" style="zoom:67%;"><blockquote><p>TCP æŠ¥æ–‡ç”Ÿæˆ</p></blockquote><p>TCP åè®®é‡Œé¢ä¼šæœ‰ä¸¤ä¸ªç«¯å£ï¼Œä¸€ä¸ªæ˜¯<strong>æµè§ˆå™¨ç›‘å¬çš„ç«¯å£ï¼ˆé€šå¸¸æ˜¯éšæœºç”Ÿæˆçš„ï¼‰</strong>ï¼Œä¸€ä¸ªæ˜¯ <strong>Web æœåŠ¡å™¨ç›‘å¬çš„ç«¯å£</strong> <strong>ï¼ˆHTTP é»˜è®¤ç«¯å£å·æ˜¯ <code>80</code>ï¼Œ HTTPS é»˜è®¤ç«¯å£å·æ˜¯ <code>443</code>ï¼‰ã€‚</strong></p><p>åœ¨åŒæ–¹å»ºç«‹äº†è¿æ¥åï¼Œ<strong>TCP æŠ¥æ–‡ä¸­çš„æ•°æ®</strong>éƒ¨åˆ†å°±æ˜¯<strong>å­˜æ”¾ HTTP å¤´éƒ¨ + æ•°æ®</strong>ï¼Œç»„è£…å¥½ TCP æŠ¥æ–‡ä¹‹åï¼Œå°±éœ€äº¤ç»™ä¸‹é¢çš„ç½‘ç»œå±‚å¤„ç†ã€‚</p><p>è‡³æ­¤ï¼Œç½‘ç»œåŒ…çš„æŠ¥æ–‡å¦‚ä¸‹å›¾ã€‚</p><img src="'+H+'" alt="TCP å±‚æŠ¥æ–‡" style="zoom:67%;"><blockquote><p>æ­¤æ—¶ï¼Œé‡ä¸Šäº† TCP çš„ æ•°æ®åŒ…æ¿€åŠ¨è¡¨ç¤ºï¼šâ€œå¤ªå¥½äº†ï¼Œç¢°åˆ°äº†å¯é ä¼ è¾“çš„ TCP ä¼ è¾“ï¼Œå®ƒç»™æˆ‘åŠ ä¸Š TCP å¤´éƒ¨ï¼Œæˆ‘ä¸å†å­¤å•äº†ï¼Œå®‰å…¨æ„Ÿåè¶³å•Šï¼æœ‰å¤§ä½¬å¯ä»¥ä¿æŠ¤æˆ‘çš„å¯é é€è¾¾ï¼ä½†æˆ‘åº”è¯¥å¾€å“ªèµ°å‘¢ï¼Ÿâ€</p></blockquote><h4 id="è¿œç¨‹å®šä½-â€”â€”-ip" tabindex="-1"><a class="header-anchor" href="#è¿œç¨‹å®šä½-â€”â€”-ip"><span>- <strong>è¿œç¨‹å®šä½ â€”â€” IP</strong></span></a></h4><p>TCP æ¨¡å—åœ¨æ‰§è¡Œè¿æ¥ã€æ”¶å‘ã€æ–­å¼€ç­‰å„é˜¶æ®µæ“ä½œæ—¶ï¼Œéƒ½éœ€è¦å§”æ‰˜ IP æ¨¡å—å°†æ•°æ®å°è£…æˆ<strong>ç½‘ç»œåŒ…</strong>å‘é€ç»™é€šä¿¡å¯¹è±¡ã€‚</p><blockquote><h4 id="ip-åŒ…å¤´æ ¼å¼" tabindex="-1"><a class="header-anchor" href="#ip-åŒ…å¤´æ ¼å¼"><span>IP åŒ…å¤´æ ¼å¼</span></a></h4></blockquote><p>æˆ‘ä»¬å…ˆçœ‹çœ‹ IP æŠ¥æ–‡å¤´éƒ¨çš„æ ¼å¼ï¼š</p><img src="'+v+'" alt="IP åŒ…å¤´æ ¼å¼" style="zoom:67%;"><p>åœ¨ IP åè®®é‡Œé¢éœ€è¦æœ‰<strong>æºåœ°å€ IP</strong> å’Œ <strong>ç›®æ ‡åœ°å€ IP</strong>ï¼š</p><ul><li>æºåœ°å€IPï¼Œå³æ˜¯å®¢æˆ·ç«¯è¾“å‡ºçš„ IP åœ°å€ï¼›</li><li>ç›®æ ‡åœ°å€ï¼Œå³é€šè¿‡ DNS åŸŸåè§£æå¾—åˆ°çš„ Web æœåŠ¡å™¨ IPã€‚</li></ul><p>å› ä¸º HTTP æ˜¯ç»è¿‡ TCP ä¼ è¾“çš„ï¼Œæ‰€ä»¥åœ¨ IP åŒ…å¤´çš„<strong>åè®®å·</strong>ï¼Œè¦å¡«å†™ä¸º <code>06</code>ï¼ˆåå…­è¿›åˆ¶ï¼‰ï¼Œè¡¨ç¤ºåè®®ä¸º TCPã€‚</p><blockquote><p>å‡è®¾å®¢æˆ·ç«¯æœ‰å¤šä¸ªç½‘å¡ï¼Œå°±ä¼šæœ‰å¤šä¸ª IP åœ°å€ï¼Œé‚£ IP å¤´éƒ¨çš„æºåœ°å€åº”è¯¥é€‰æ‹©å“ªä¸ª IP å‘¢ï¼Ÿ</p></blockquote><p>å½“å­˜åœ¨å¤šä¸ªç½‘å¡æ—¶ï¼Œåœ¨å¡«å†™æºåœ°å€ IP æ—¶ï¼Œå°±éœ€è¦åˆ¤æ–­åˆ°åº•åº”è¯¥å¡«å†™å“ªä¸ªåœ°å€ã€‚è¿™ä¸ªåˆ¤æ–­ç›¸å½“äºåœ¨å¤šå—ç½‘å¡ä¸­åˆ¤æ–­åº”è¯¥ä½¿ç”¨å“ªä¸ªä¸€å—ç½‘å¡æ¥å‘é€åŒ…ã€‚</p><p>è¿™ä¸ªæ—¶å€™å°±éœ€è¦æ ¹æ®<strong>è·¯ç”±è¡¨</strong>è§„åˆ™ï¼Œæ¥åˆ¤æ–­<strong>å“ªä¸€ä¸ªç½‘å¡ä½œä¸ºæºåœ°å€ IPã€‚</strong></p><p>åœ¨ Linux æ“ä½œç³»ç»Ÿï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>route -n</code> å‘½ä»¤æŸ¥çœ‹å½“å‰ç³»ç»Ÿçš„è·¯ç”±è¡¨ã€‚</p><img src="'+z+'" alt="è·¯ç”±è¡¨" style="zoom:67%;"><p>ä¸¾ä¸ªä¾‹å­ï¼Œæ ¹æ®ä¸Šé¢çš„è·¯ç”±è¡¨ï¼Œæˆ‘ä»¬å‡è®¾ Web æœåŠ¡å™¨çš„ç›®æ ‡åœ°å€æ˜¯ <code>192.168.10.200</code>ã€‚</p><img src="'+E+'" alt="è·¯ç”±è§„åˆ™åˆ¤æ–­" style="zoom:67%;"><ol><li>é¦–å…ˆå…ˆå’Œç¬¬ä¸€æ¡ç›®çš„å­ç½‘æ©ç ï¼ˆ<code>Genmask</code>ï¼‰è¿›è¡Œ <strong>ä¸è¿ç®—</strong>ï¼Œå¾—åˆ°ç»“æœä¸º <code>192.168.10.0</code>ï¼Œä½†æ˜¯ç¬¬ä¸€ä¸ªæ¡ç›®çš„ <code>Destination</code> æ˜¯ <code>192.168.3.0</code>ï¼Œä¸¤è€…ä¸ä¸€è‡´æ‰€ä»¥åŒ¹é…å¤±è´¥ã€‚</li><li>å†ä¸ç¬¬äºŒæ¡ç›®çš„å­ç½‘æ©ç è¿›è¡Œ <strong>ä¸è¿ç®—</strong>ï¼Œå¾—åˆ°çš„ç»“æœä¸º <code>192.168.10.0</code>ï¼Œä¸ç¬¬äºŒæ¡ç›®çš„ <code>Destination 192.168.10.0</code> åŒ¹é…æˆåŠŸï¼Œæ‰€ä»¥å°†ä½¿ç”¨ <code>eth1</code> ç½‘å¡çš„ IP åœ°å€ä½œä¸º IP åŒ…å¤´çš„æºåœ°å€ã€‚</li></ol><p>é‚£ä¹ˆå‡è®¾ Web æœåŠ¡å™¨çš„ç›®æ ‡åœ°å€æ˜¯ <code>10.100.20.100</code>ï¼Œé‚£ä¹ˆä¾ç„¶ä¾ç…§ä¸Šé¢çš„è·¯ç”±è¡¨è§„åˆ™åˆ¤æ–­ï¼Œåˆ¤æ–­åçš„ç»“æœæ˜¯å’Œç¬¬ä¸‰æ¡ç›®åŒ¹é…ã€‚</p><p>ç¬¬ä¸‰æ¡ç›®æ¯”è¾ƒç‰¹æ®Šï¼Œå®ƒç›®æ ‡åœ°å€å’Œå­ç½‘æ©ç éƒ½æ˜¯ <code>0.0.0.0</code>ï¼Œè¿™è¡¨ç¤º<strong>é»˜è®¤ç½‘å…³</strong>ï¼Œå¦‚æœå…¶ä»–æ‰€æœ‰æ¡ç›®éƒ½æ— æ³•åŒ¹é…ï¼Œå°±ä¼šè‡ªåŠ¨åŒ¹é…è¿™ä¸€è¡Œã€‚å¹¶ä¸”åç»­å°±æŠŠåŒ…å‘ç»™è·¯ç”±å™¨ï¼Œ<code>Gateway</code> å³æ˜¯è·¯ç”±å™¨çš„ IP åœ°å€ã€‚</p><blockquote><p>IP æŠ¥æ–‡ç”Ÿæˆ</p></blockquote><p>è‡³æ­¤ï¼Œç½‘ç»œåŒ…çš„æŠ¥æ–‡å¦‚ä¸‹å›¾ã€‚</p><img src="'+w+'" alt="IP å±‚æŠ¥æ–‡" style="zoom:50%;"><blockquote><p>æ­¤æ—¶ï¼ŒåŠ ä¸Šäº† IP å¤´éƒ¨çš„æ•°æ®åŒ…è¡¨ç¤º ï¼šâ€œæœ‰ IP å¤§ä½¬ç»™æˆ‘æŒ‡è·¯äº†ï¼Œæ„Ÿè°¢ IP å±‚ç»™æˆ‘åŠ ä¸Šäº† IP åŒ…å¤´ï¼Œè®©æˆ‘æœ‰äº†è¿œç¨‹å®šä½çš„èƒ½åŠ›ï¼ä¸ä¼šå®³æ€•åœ¨æµ©ç€šçš„äº’è”ç½‘è¿·èŒ«äº†ï¼å¯æ˜¯ç›®çš„åœ°å¥½è¿œå•Šï¼Œæˆ‘ä¸‹ä¸€ç«™åº”è¯¥å»å“ªå‘¢ï¼Ÿâ€</p></blockquote><h4 id="ä¸¤ç‚¹ä¼ è¾“-â€”â€”-mac" tabindex="-1"><a class="header-anchor" href="#ä¸¤ç‚¹ä¼ è¾“-â€”â€”-mac"><span>- <strong>ä¸¤ç‚¹ä¼ è¾“ â€”â€” MAC</strong></span></a></h4><p>ç”Ÿæˆäº† IP å¤´éƒ¨ä¹‹åï¼Œæ¥ä¸‹æ¥ç½‘ç»œåŒ…è¿˜éœ€è¦åœ¨ IP å¤´éƒ¨çš„å‰é¢åŠ ä¸Š <strong>MAC å¤´éƒ¨</strong>ã€‚</p><blockquote><h4 id="mac-åŒ…å¤´æ ¼å¼" tabindex="-1"><a class="header-anchor" href="#mac-åŒ…å¤´æ ¼å¼"><span>MAC åŒ…å¤´æ ¼å¼</span></a></h4></blockquote><p><strong>MAC å¤´éƒ¨</strong>æ˜¯<strong>ä»¥å¤ªç½‘ä½¿ç”¨çš„å¤´éƒ¨</strong>ï¼Œå®ƒåŒ…å«äº†æ¥æ”¶æ–¹å’Œå‘é€æ–¹çš„ <strong>MAC åœ°å€</strong>ç­‰ä¿¡æ¯ã€‚</p><img src="'+K+'" alt="MAC åŒ…å¤´æ ¼å¼" style="zoom:67%;"><p>åœ¨ MAC åŒ…å¤´é‡Œéœ€è¦<strong>å‘é€æ–¹ MAC åœ°å€</strong>å’Œ<strong>æ¥æ”¶æ–¹ç›®æ ‡ MAC åœ°å€</strong>ï¼Œç”¨äº<strong>ä¸¤ç‚¹ä¹‹é—´çš„ä¼ è¾“</strong>ã€‚</p><p>ä¸€èˆ¬åœ¨ TCP/IP é€šä¿¡é‡Œï¼ŒMAC åŒ…å¤´çš„<strong>åè®®ç±»å‹</strong>åªä½¿ç”¨ï¼š</p><ul><li><code>0800</code> ï¼š IP åè®®</li><li><code>0806</code> ï¼š ARP åè®®</li></ul><blockquote><p>MAC å‘é€æ–¹å’Œæ¥æ”¶æ–¹å¦‚ä½•ç¡®è®¤?</p></blockquote><p><strong>å‘é€æ–¹</strong>çš„ MAC åœ°å€è·å–å°±æ¯”è¾ƒç®€å•äº†ï¼Œ<strong>MAC åœ°å€</strong>æ˜¯<strong>åœ¨ç½‘å¡ç”Ÿäº§æ—¶å†™å…¥åˆ° ROM é‡Œçš„</strong>ï¼Œåªè¦å°†è¿™ä¸ªå€¼è¯»å–å‡ºæ¥å†™å…¥åˆ° MAC å¤´éƒ¨å°±å¯ä»¥äº†ã€‚</p><p><strong>æ¥æ”¶æ–¹</strong>çš„ MAC åœ°å€å°±æœ‰ç‚¹å¤æ‚äº†ï¼Œåªè¦å‘Šè¯‰ä»¥å¤ªç½‘å¯¹æ–¹çš„ MAC çš„åœ°å€ï¼Œä»¥å¤ªç½‘å°±ä¼šå¸®æˆ‘ä»¬æŠŠåŒ…å‘é€è¿‡å»ï¼Œé‚£ä¹ˆå¾ˆæ˜¾ç„¶è¿™é‡Œåº”è¯¥å¡«å†™å¯¹æ–¹çš„ MAC åœ°å€ã€‚</p><p>æ‰€ä»¥å…ˆå¾—ææ¸…æ¥šåº”è¯¥æŠŠåŒ…å‘ç»™è°ï¼Œè¿™ä¸ªåªè¦æŸ¥ä¸€ä¸‹<strong>è·¯ç”±è¡¨</strong>å°±çŸ¥é“äº†ã€‚åœ¨è·¯ç”±è¡¨ä¸­æ‰¾åˆ°ç›¸åŒ¹é…çš„æ¡ç›®ï¼Œç„¶åæŠŠåŒ…å‘ç»™ <code>Gateway</code> åˆ—ä¸­çš„ IP åœ°å€å°±å¯ä»¥äº†ã€‚</p><blockquote><p>æ—¢ç„¶çŸ¥é“è¦å‘ç»™è°ï¼ŒæŒ‰å¦‚ä½•è·å–å¯¹æ–¹çš„ MAC åœ°å€å‘¢ï¼Ÿ</p></blockquote><p>ä¸çŸ¥é“å¯¹æ–¹ MAC åœ°å€ï¼Ÿä¸çŸ¥é“å°±å–Šå‘—ã€‚</p><p>æ­¤æ—¶å°±éœ€è¦ <code>ARP</code> åè®®å¸®æˆ‘ä»¬<strong>æ‰¾åˆ°è·¯ç”±å™¨çš„ MAC åœ°å€ã€‚</strong></p><img src="'+D+'" alt="ARP å¹¿æ’­" style="zoom:67%;"><p>ARP åè®®ä¼šåœ¨ä»¥å¤ªç½‘ä¸­ä»¥<strong>å¹¿æ’­</strong>çš„å½¢å¼ï¼Œå¯¹ä»¥å¤ªç½‘æ‰€æœ‰çš„è®¾å¤‡å–Šå‡ºï¼šâ€œè¿™ä¸ª IP åœ°å€æ˜¯è°çš„ï¼Ÿè¯·æŠŠä½ çš„ MAC åœ°å€å‘Šè¯‰æˆ‘â€ã€‚</p><p>ç„¶åå°±ä¼šæœ‰äººå›ç­”ï¼šâ€œè¿™ä¸ª IP åœ°å€æ˜¯æˆ‘çš„ï¼Œæˆ‘çš„ MAC åœ°å€æ˜¯ XXXXâ€ã€‚</p><p>å¦‚æœå¯¹æ–¹å’Œè‡ªå·±å¤„äºåŒä¸€ä¸ªå­ç½‘ä¸­ï¼Œé‚£ä¹ˆé€šè¿‡ä¸Šé¢çš„æ“ä½œå°±å¯ä»¥å¾—åˆ°å¯¹æ–¹çš„ MAC åœ°å€ã€‚ç„¶åï¼Œæˆ‘ä»¬å°†è¿™ä¸ª MAC åœ°å€å†™å…¥ MAC å¤´éƒ¨ï¼ŒMAC å¤´éƒ¨å°±å®Œæˆäº†ã€‚</p><blockquote><p>å¥½åƒæ¯æ¬¡éƒ½è¦å¹¿æ’­è·å–ï¼Œè¿™ä¸æ˜¯å¾ˆéº»çƒ¦å—ï¼Ÿ</p></blockquote><p>æ”¾å¿ƒï¼Œåœ¨åç»­æ“ä½œç³»ç»Ÿä¼šæŠŠæœ¬æ¬¡æŸ¥è¯¢ç»“æœæ”¾åˆ°ä¸€å—å«åš <strong>ARP ç¼“å­˜</strong>çš„å†…å­˜ç©ºé—´ç•™ç€ä»¥åç”¨ï¼Œä¸è¿‡ç¼“å­˜çš„æ—¶é—´å°±å‡ åˆ†é’Ÿã€‚</p><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨å‘åŒ…æ—¶ï¼š</p><ul><li>å…ˆæŸ¥è¯¢ ARP ç¼“å­˜ï¼Œå¦‚æœå…¶ä¸­å·²ç»ä¿å­˜äº†å¯¹æ–¹çš„ MAC åœ°å€ï¼Œå°±ä¸éœ€è¦å‘é€ ARP æŸ¥è¯¢ï¼Œç›´æ¥ä½¿ç”¨ ARP ç¼“å­˜ä¸­çš„åœ°å€ã€‚</li><li>è€Œå½“ ARP ç¼“å­˜ä¸­ä¸å­˜åœ¨å¯¹æ–¹ MAC åœ°å€æ—¶ï¼Œåˆ™å‘é€ ARP å¹¿æ’­æŸ¥è¯¢ã€‚</li></ul><blockquote><p>æŸ¥çœ‹ ARP ç¼“å­˜å†…å®¹</p></blockquote><p>åœ¨ Linux ç³»ç»Ÿä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>arp -a</code> å‘½ä»¤æ¥æŸ¥çœ‹ ARP ç¼“å­˜çš„å†…å®¹ã€‚</p><img src="'+M+'" alt="ARP ç¼“å­˜å†…å®¹" style="zoom:50%;"><blockquote><p><strong>MAC æŠ¥æ–‡ç”Ÿæˆ</strong></p></blockquote><p>è‡³æ­¤ï¼Œç½‘ç»œåŒ…çš„æŠ¥æ–‡å¦‚ä¸‹å›¾ã€‚</p><img src="'+L+'" alt="MAC å±‚æŠ¥æ–‡" style="zoom:50%;"><blockquote><p>æ­¤æ—¶ï¼ŒåŠ ä¸Šäº† MAC å¤´éƒ¨çš„æ•°æ®åŒ…ä¸‡åˆ†æ„Ÿè°¢ï¼Œè¯´é“ ï¼šâ€œæ„Ÿè°¢ MAC å¤§ä½¬ï¼Œæˆ‘çŸ¥é“æˆ‘ä¸‹ä¸€æ­¥è¦å»å“ªäº†ï¼æˆ‘ç°åœ¨æœ‰å¾ˆå¤šå¤´éƒ¨å…„å¼Ÿï¼Œç›¸ä¿¡æˆ‘å¯ä»¥åˆ°è¾¾æœ€ç»ˆçš„ç›®çš„åœ°ï¼â€ã€‚ å¸¦ç€ä¼—å¤šå¤´éƒ¨å…„å¼Ÿçš„æ•°æ®åŒ…ï¼Œç»ˆäºå‡†å¤‡è¦å‡ºé—¨äº†ã€‚</p></blockquote><h4 id="å‡ºå£-â€”â€”-ç½‘å¡" tabindex="-1"><a class="header-anchor" href="#å‡ºå£-â€”â€”-ç½‘å¡"><span>- <strong>å‡ºå£ â€”â€” ç½‘å¡</strong></span></a></h4><p>ç½‘ç»œåŒ…åªæ˜¯å­˜æ”¾åœ¨å†…å­˜ä¸­çš„ä¸€ä¸²äºŒè¿›åˆ¶æ•°å­—ä¿¡æ¯ï¼Œæ²¡æœ‰åŠæ³•ç›´æ¥å‘é€ç»™å¯¹æ–¹ã€‚å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦å°†<strong>æ•°å­—ä¿¡æ¯è½¬æ¢ä¸ºç”µä¿¡å·</strong>ï¼Œæ‰èƒ½åœ¨ç½‘çº¿ä¸Šä¼ è¾“ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™æ‰æ˜¯çœŸæ­£çš„æ•°æ®å‘é€è¿‡ç¨‹ã€‚</p><p>è´Ÿè´£æ‰§è¡Œè¿™ä¸€æ“ä½œçš„æ˜¯<strong>ç½‘å¡</strong>ï¼Œè¦<strong>æ§åˆ¶ç½‘å¡</strong>è¿˜éœ€è¦é <strong>ç½‘å¡é©±åŠ¨ç¨‹åº</strong>ã€‚</p><p>ç½‘å¡é©±åŠ¨è·å–ç½‘ç»œåŒ…ä¹‹åï¼Œä¼šå°†å…¶<strong>å¤åˆ¶</strong>åˆ°<strong>ç½‘å¡å†…çš„ç¼“å­˜åŒºä¸­</strong>ï¼Œæ¥ç€ä¼šåœ¨å…¶<strong>å¼€å¤´åŠ ä¸Š æŠ¥å¤´ å’Œ èµ·å§‹å¸§åˆ†ç•Œç¬¦ï¼Œåœ¨æœ«å°¾åŠ ä¸Šç”¨äºæ£€æµ‹é”™è¯¯çš„ å¸§æ ¡éªŒåºåˆ—</strong>ã€‚</p><img src="'+R+'" alt="æ•°æ®åŒ…" style="zoom:67%;"><ul><li>èµ·å§‹å¸§åˆ†ç•Œç¬¦æ˜¯ä¸€ä¸ªç”¨æ¥<strong>è¡¨ç¤ºåŒ…èµ·å§‹ä½ç½®çš„æ ‡è®°</strong></li><li>æœ«å°¾çš„ <code>FCS</code>ï¼ˆå¸§æ ¡éªŒåºåˆ—ï¼‰ç”¨æ¥<strong>æ£€æŸ¥åŒ…ä¼ è¾“è¿‡ç¨‹æ˜¯å¦æœ‰æŸå</strong></li></ul><p>æœ€å<strong>ç½‘å¡</strong>ä¼šå°†åŒ…è½¬ä¸º<strong>ç”µä¿¡å·</strong>ï¼Œé€šè¿‡ç½‘çº¿å‘é€å‡ºå»ã€‚</p><blockquote><p>å”‰ï¼ŒçœŸæ˜¯ä¸å®¹æ˜“ï¼Œå‘ä¸€ä¸ªåŒ…ï¼ŒçœŸæ˜¯å†ç»åƒè¾›ä¸‡è‹¦ã€‚è‡´æ­¤ï¼Œä¸€ä¸ªå¸¦æœ‰è®¸å¤šå¤´éƒ¨çš„æ•°æ®ç»ˆäºè¸ä¸Šå¯»æ‰¾ç›®çš„åœ°çš„å¾é€”äº†ï¼</p></blockquote><ul><li><h4 id="é€åˆ«è€…-â€”â€”-äº¤æ¢æœº" tabindex="-1"><a class="header-anchor" href="#é€åˆ«è€…-â€”â€”-äº¤æ¢æœº"><span><strong>é€åˆ«è€… â€”â€” äº¤æ¢æœº</strong></span></a></h4></li></ul><p>ä¸‹é¢æ¥çœ‹ä¸€ä¸‹åŒ…æ˜¯å¦‚ä½•é€šè¿‡äº¤æ¢æœºçš„ã€‚äº¤æ¢æœºçš„è®¾è®¡æ˜¯å°†ç½‘ç»œåŒ…<strong>åŸæ ·</strong>è½¬å‘åˆ°ç›®çš„åœ°ã€‚äº¤æ¢æœºå·¥ä½œåœ¨ <strong>MAC å±‚</strong>ï¼Œä¹Ÿç§°ä¸º<strong>äºŒå±‚ç½‘ç»œè®¾å¤‡</strong>ã€‚</p><blockquote><p>äº¤æ¢æœºçš„åŒ…æ¥æ”¶æ“ä½œ</p></blockquote><p>é¦–å…ˆï¼Œç”µä¿¡å·åˆ°è¾¾ç½‘çº¿æ¥å£ï¼Œäº¤æ¢æœºé‡Œçš„æ¨¡å—è¿›è¡Œæ¥æ”¶ï¼Œæ¥ä¸‹æ¥äº¤æ¢æœºé‡Œçš„æ¨¡å—å°†ç”µä¿¡å·è½¬æ¢ä¸ºæ•°å­—ä¿¡å·ã€‚</p><p>ç„¶åé€šè¿‡åŒ…æœ«å°¾çš„ <code>FCS</code> æ ¡éªŒé”™è¯¯ï¼Œå¦‚æœæ²¡é—®é¢˜åˆ™æ”¾åˆ°ç¼“å†²åŒºã€‚è¿™éƒ¨åˆ†æ“ä½œåŸºæœ¬å’Œè®¡ç®—æœºçš„ç½‘å¡ç›¸åŒï¼Œä½†äº¤æ¢æœºçš„å·¥ä½œæ–¹å¼å’Œç½‘å¡ä¸åŒã€‚</p><p>è®¡ç®—æœºçš„ç½‘å¡æœ¬èº«å…·æœ‰ MAC åœ°å€ï¼Œå¹¶é€šè¿‡æ ¸å¯¹æ”¶åˆ°çš„åŒ…çš„æ¥æ”¶æ–¹ MAC åœ°å€åˆ¤æ–­æ˜¯ä¸æ˜¯å‘ç»™è‡ªå·±çš„ï¼Œå¦‚æœä¸æ˜¯å‘ç»™è‡ªå·±çš„åˆ™ä¸¢å¼ƒï¼›ç›¸å¯¹åœ°ï¼Œäº¤æ¢æœºçš„ç«¯å£ä¸æ ¸å¯¹æ¥æ”¶æ–¹ MAC åœ°å€ï¼Œè€Œæ˜¯ç›´æ¥æ¥æ”¶æ‰€æœ‰çš„åŒ…å¹¶å­˜æ”¾åˆ°ç¼“å†²åŒºä¸­ã€‚å› æ­¤ï¼Œå’Œç½‘å¡ä¸åŒï¼Œ<strong>äº¤æ¢æœºçš„ç«¯å£ä¸å…·æœ‰ MAC åœ°å€</strong>ã€‚</p><p>å°†åŒ…å­˜å…¥ç¼“å†²åŒºåï¼Œæ¥ä¸‹æ¥éœ€è¦æŸ¥è¯¢ä¸€ä¸‹è¿™ä¸ªåŒ…çš„æ¥æ”¶æ–¹ MAC åœ°å€æ˜¯å¦å·²ç»åœ¨ MAC åœ°å€è¡¨ä¸­æœ‰è®°å½•äº†ã€‚</p><p>äº¤æ¢æœºçš„ MAC åœ°å€è¡¨ä¸»è¦åŒ…å«ä¸¤ä¸ªä¿¡æ¯ï¼š</p><ul><li>ä¸€ä¸ªæ˜¯è®¾å¤‡çš„ MAC åœ°å€ï¼Œ</li><li>å¦ä¸€ä¸ªæ˜¯è¯¥è®¾å¤‡è¿æ¥åœ¨äº¤æ¢æœºçš„å“ªä¸ªç«¯å£ä¸Šã€‚</li></ul><img src="'+Y+'" alt="äº¤æ¢æœºçš„ MAC åœ°å€è¡¨" style="zoom:50%;"><p>ä¸¾ä¸ªä¾‹å­ï¼Œå¦‚æœæ”¶åˆ°çš„åŒ…çš„æ¥æ”¶æ–¹ MAC åœ°å€ä¸º <code>00-02-B3-1C-9C-F9</code>ï¼Œåˆ™ä¸å›¾ä¸­è¡¨ä¸­çš„ç¬¬ 3 è¡ŒåŒ¹é…ï¼Œæ ¹æ®ç«¯å£åˆ—çš„ä¿¡æ¯ï¼Œå¯çŸ¥è¿™ä¸ªåœ°å€ä½äº <code>3</code> å·ç«¯å£ä¸Šï¼Œç„¶åå°±å¯ä»¥é€šè¿‡äº¤æ¢ç”µè·¯å°†åŒ…å‘é€åˆ°ç›¸åº”çš„ç«¯å£äº†ã€‚</p><p>æ‰€ä»¥ï¼Œ<strong>äº¤æ¢æœºæ ¹æ® MAC åœ°å€è¡¨æŸ¥æ‰¾ MAC åœ°å€ï¼Œç„¶åå°†ä¿¡å·å‘é€åˆ°ç›¸åº”çš„ç«¯å£</strong>ã€‚</p><blockquote><p>å½“ MAC åœ°å€è¡¨æ‰¾ä¸åˆ°æŒ‡å®šçš„ MAC åœ°å€ä¼šæ€ä¹ˆæ ·ï¼Ÿ</p></blockquote><p>åœ°å€è¡¨ä¸­æ‰¾ä¸åˆ°æŒ‡å®šçš„ MAC åœ°å€ã€‚è¿™å¯èƒ½æ˜¯å› ä¸ºå…·æœ‰è¯¥åœ°å€çš„è®¾å¤‡è¿˜æ²¡æœ‰å‘äº¤æ¢æœºå‘é€è¿‡åŒ…ï¼Œæˆ–è€…è¿™ä¸ªè®¾å¤‡ä¸€æ®µæ—¶é—´æ²¡æœ‰å·¥ä½œå¯¼è‡´åœ°å€è¢«ä»åœ°å€è¡¨ä¸­åˆ é™¤äº†ã€‚</p><p>è¿™ç§æƒ…å†µä¸‹ï¼Œäº¤æ¢æœºæ— æ³•åˆ¤æ–­åº”è¯¥æŠŠåŒ…è½¬å‘åˆ°å“ªä¸ªç«¯å£ï¼Œåªèƒ½å°†åŒ…è½¬å‘åˆ°é™¤äº†æºç«¯å£ä¹‹å¤–çš„æ‰€æœ‰ç«¯å£ä¸Šï¼Œæ— è®ºè¯¥è®¾å¤‡è¿æ¥åœ¨å“ªä¸ªç«¯å£ä¸Šéƒ½èƒ½æ”¶åˆ°è¿™ä¸ªåŒ…ã€‚</p><p>è¿™æ ·åšä¸ä¼šäº§ç”Ÿä»€ä¹ˆé—®é¢˜ï¼Œå› ä¸ºä»¥å¤ªç½‘çš„è®¾è®¡æœ¬æ¥å°±æ˜¯å°†åŒ…å‘é€åˆ°æ•´ä¸ªç½‘ç»œçš„ï¼Œç„¶å<strong>åªæœ‰ç›¸åº”çš„æ¥æ”¶è€…æ‰æ¥æ”¶åŒ…ï¼Œè€Œå…¶ä»–è®¾å¤‡åˆ™ä¼šå¿½ç•¥è¿™ä¸ªåŒ…</strong>ã€‚</p><p>æœ‰äººä¼šè¯´ï¼šâ€œè¿™æ ·åšä¼šå‘é€å¤šä½™çš„åŒ…ï¼Œä¼šä¸ä¼šé€ æˆç½‘ç»œæ‹¥å¡å‘¢ï¼Ÿâ€</p><p>å…¶å®å®Œå…¨ä¸ç”¨è¿‡äºæ‹…å¿ƒï¼Œå› ä¸ºå‘é€äº†åŒ…ä¹‹åç›®æ ‡è®¾å¤‡ä¼šä½œå‡ºå“åº”ï¼Œåªè¦è¿”å›äº†å“åº”åŒ…ï¼Œäº¤æ¢æœºå°±å¯ä»¥å°†å®ƒçš„åœ°å€å†™å…¥ MAC åœ°å€è¡¨ï¼Œä¸‹æ¬¡ä¹Ÿå°±ä¸éœ€è¦æŠŠåŒ…å‘åˆ°æ‰€æœ‰ç«¯å£äº†ã€‚</p><p>å±€åŸŸç½‘ä¸­æ¯ç§’å¯ä»¥ä¼ è¾“ä¸Šåƒä¸ªåŒ…ï¼Œå¤šå‡ºä¸€ä¸¤ä¸ªåŒ…å¹¶æ— å¤§ç¢ã€‚</p><p>æ­¤å¤–ï¼Œå¦‚æœæ¥æ”¶æ–¹ MAC åœ°å€æ˜¯ä¸€ä¸ª<strong>å¹¿æ’­åœ°å€</strong>ï¼Œé‚£ä¹ˆäº¤æ¢æœºä¼šå°†åŒ…å‘é€åˆ°é™¤æºç«¯å£ä¹‹å¤–çš„æ‰€æœ‰ç«¯å£ã€‚</p><p>ä»¥ä¸‹ä¸¤ä¸ªå±äºå¹¿æ’­åœ°å€ï¼š</p><ul><li>MAC åœ°å€ä¸­çš„ <code>FF:FF:FF:FF:FF:FF</code></li><li>IP åœ°å€ä¸­çš„ <code>255.255.255.255</code></li></ul><blockquote><p>æ•°æ®åŒ…é€šè¿‡äº¤æ¢æœºè½¬å‘æŠµè¾¾äº†è·¯ç”±å™¨ï¼Œå‡†å¤‡è¦ç¦»å¼€åœŸç”ŸåœŸé•¿çš„å­ç½‘äº†ã€‚æ­¤æ—¶ï¼Œæ•°æ®åŒ…å’Œäº¤æ¢æœºç¦»åˆ«æ—¶è¯´é“ï¼šâ€œæ„Ÿè°¢äº¤æ¢æœºå…„å¼Ÿï¼Œå¸®æˆ‘è½¬å‘åˆ°å‡ºå¢ƒçš„å¤§é—¨ï¼Œæˆ‘è¦å‡ºè¿œé—¨å•¦ï¼â€</p></blockquote><h4 id="å‡ºå¢ƒå¤§é—¨-â€”â€”-è·¯ç”±å™¨" tabindex="-1"><a class="header-anchor" href="#å‡ºå¢ƒå¤§é—¨-â€”â€”-è·¯ç”±å™¨"><span>- <strong>å‡ºå¢ƒå¤§é—¨ â€”â€” è·¯ç”±å™¨</strong></span></a></h4><blockquote><p><strong>è·¯ç”±å™¨ä¸äº¤æ¢æœºçš„åŒºåˆ«</strong></p></blockquote><p>ç½‘ç»œåŒ…ç»è¿‡äº¤æ¢æœºä¹‹åï¼Œç°åœ¨åˆ°è¾¾äº†<strong>è·¯ç”±å™¨</strong>ï¼Œå¹¶åœ¨æ­¤è¢«è½¬å‘åˆ°ä¸‹ä¸€ä¸ªè·¯ç”±å™¨æˆ–ç›®æ ‡è®¾å¤‡ã€‚</p><p>è¿™ä¸€æ­¥è½¬å‘çš„å·¥ä½œåŸç†å’Œäº¤æ¢æœºç±»ä¼¼ï¼Œä¹Ÿæ˜¯é€šè¿‡æŸ¥è¡¨åˆ¤æ–­åŒ…è½¬å‘çš„ç›®æ ‡ã€‚</p><p>ä¸è¿‡åœ¨å…·ä½“çš„æ“ä½œè¿‡ç¨‹ä¸Šï¼Œè·¯ç”±å™¨å’Œäº¤æ¢æœºæ˜¯æœ‰åŒºåˆ«çš„ã€‚</p><ul><li>å› ä¸º<strong>è·¯ç”±å™¨</strong>æ˜¯åŸºäº <strong>IP</strong> è®¾è®¡çš„ï¼Œä¿—ç§°<strong>ä¸‰å±‚</strong>ç½‘ç»œè®¾å¤‡ï¼Œè·¯ç”±å™¨çš„å„ä¸ªç«¯å£éƒ½å…·æœ‰ MAC åœ°å€å’Œ IP åœ°å€ï¼›</li><li>è€Œ<strong>äº¤æ¢æœº</strong>æ˜¯åŸºäº<strong>ä»¥å¤ªç½‘</strong>è®¾è®¡çš„ï¼Œä¿—ç§°<strong>äºŒå±‚</strong>ç½‘ç»œè®¾å¤‡ï¼Œäº¤æ¢æœºçš„ç«¯å£ä¸å…·æœ‰ MAC åœ°å€ã€‚</li></ul><blockquote><p>è·¯ç”±å™¨åŸºæœ¬åŸç†</p></blockquote><p>è·¯ç”±å™¨çš„ç«¯å£å…·æœ‰ MAC åœ°å€ï¼Œå› æ­¤å®ƒå°±èƒ½å¤Ÿæˆä¸ºä»¥å¤ªç½‘çš„å‘é€æ–¹å’Œæ¥æ”¶æ–¹ï¼›åŒæ—¶è¿˜å…·æœ‰ IP åœ°å€ï¼Œä»è¿™ä¸ªæ„ä¹‰ä¸Šæ¥è¯´ï¼Œå®ƒå’Œè®¡ç®—æœºçš„ç½‘å¡æ˜¯ä¸€æ ·çš„ã€‚</p><p>å½“è½¬å‘åŒ…æ—¶ï¼Œé¦–å…ˆè·¯ç”±å™¨ç«¯å£ä¼šæ¥æ”¶å‘ç»™è‡ªå·±çš„ä»¥å¤ªç½‘åŒ…ï¼Œç„¶å<strong>è·¯ç”±è¡¨</strong>æŸ¥è¯¢è½¬å‘ç›®æ ‡ï¼Œå†ç”±ç›¸åº”çš„ç«¯å£ä½œä¸ºå‘é€æ–¹å°†ä»¥å¤ªç½‘åŒ…å‘é€å‡ºå»ã€‚</p><blockquote><p>è·¯ç”±å™¨çš„åŒ…æ¥æ”¶æ“ä½œ</p></blockquote><p>é¦–å…ˆï¼Œç”µä¿¡å·åˆ°è¾¾ç½‘çº¿æ¥å£éƒ¨åˆ†ï¼Œè·¯ç”±å™¨ä¸­çš„æ¨¡å—ä¼š<strong>å°†ç”µä¿¡å·è½¬æˆæ•°å­—ä¿¡å·</strong>ï¼Œç„¶åé€šè¿‡åŒ…æœ«å°¾çš„ <code>FCS</code> è¿›è¡Œé”™è¯¯æ ¡éªŒã€‚</p><p>å¦‚æœæ²¡é—®é¢˜åˆ™æ£€æŸ¥ MAC å¤´éƒ¨ä¸­çš„<strong>æ¥æ”¶æ–¹ MAC åœ°å€</strong>ï¼Œçœ‹çœ‹æ˜¯ä¸æ˜¯å‘ç»™è‡ªå·±çš„åŒ…ï¼Œå¦‚æœæ˜¯å°±æ”¾åˆ°æ¥æ”¶ç¼“å†²åŒºä¸­ï¼Œå¦åˆ™å°±ä¸¢å¼ƒè¿™ä¸ªåŒ…ã€‚</p><p>æ€»çš„æ¥è¯´ï¼Œè·¯ç”±å™¨çš„ç«¯å£éƒ½å…·æœ‰ MAC åœ°å€ï¼Œåªæ¥æ”¶ä¸è‡ªèº«åœ°å€åŒ¹é…çš„åŒ…ï¼Œé‡åˆ°ä¸åŒ¹é…çš„åŒ…åˆ™ç›´æ¥ä¸¢å¼ƒã€‚</p><blockquote><p>æŸ¥è¯¢è·¯ç”±è¡¨ç¡®å®šè¾“å‡ºç«¯å£</p></blockquote><p>å®ŒæˆåŒ…æ¥æ”¶æ“ä½œä¹‹åï¼Œè·¯ç”±å™¨å°±ä¼š<strong>å»æ‰</strong>åŒ…å¼€å¤´çš„ MAC å¤´éƒ¨ã€‚</p><p><strong>MAC å¤´éƒ¨çš„ä½œç”¨å°±æ˜¯å°†åŒ…é€è¾¾è·¯ç”±å™¨</strong>ï¼Œå…¶ä¸­çš„æ¥æ”¶æ–¹ MAC åœ°å€å°±æ˜¯è·¯ç”±å™¨ç«¯å£çš„ MAC åœ°å€ã€‚å› æ­¤ï¼Œå½“<strong>åŒ…åˆ°è¾¾è·¯ç”±å™¨ä¹‹å</strong>ï¼ŒMAC å¤´éƒ¨çš„ä»»åŠ¡å°±å®Œæˆäº†ï¼Œäºæ˜¯ MAC å¤´éƒ¨å°±ä¼š<strong>è¢«ä¸¢å¼ƒ</strong>ã€‚</p><p>æ¥ä¸‹æ¥ï¼Œè·¯ç”±å™¨ä¼šæ ¹æ® MAC å¤´éƒ¨åæ–¹çš„ <code>IP</code> å¤´éƒ¨ä¸­çš„å†…å®¹è¿›è¡Œ<strong>åŒ…çš„è½¬å‘æ“ä½œ</strong>ã€‚</p><p>è½¬å‘æ“ä½œåˆ†ä¸ºå‡ ä¸ªé˜¶æ®µï¼Œé¦–å…ˆæ˜¯æŸ¥è¯¢<strong>è·¯ç”±è¡¨</strong>åˆ¤æ–­è½¬å‘ç›®æ ‡ã€‚</p><img src="'+U+'" alt="è·¯ç”±å™¨è½¬å‘" style="zoom:67%;"><p>å…·ä½“çš„å·¥ä½œæµç¨‹æ ¹æ®ä¸Šå›¾ï¼Œä¸¾ä¸ªä¾‹å­ã€‚</p><p>å‡è®¾åœ°å€ä¸º <code>10.10.1.101</code> çš„è®¡ç®—æœºè¦å‘åœ°å€ä¸º <code>192.168.1.100</code> çš„æœåŠ¡å™¨å‘é€ä¸€ä¸ªåŒ…ï¼Œè¿™ä¸ªåŒ…å…ˆåˆ°è¾¾å›¾ä¸­çš„<strong>è·¯ç”±å™¨</strong>ã€‚</p><p>åˆ¤æ–­è½¬å‘ç›®æ ‡çš„ç¬¬ä¸€æ­¥ï¼Œå°±æ˜¯æ ¹æ®åŒ…çš„æ¥æ”¶æ–¹ IP åœ°å€æŸ¥è¯¢è·¯ç”±è¡¨ä¸­çš„ç›®æ ‡åœ°å€æ ï¼Œä»¥æ‰¾åˆ°ç›¸åŒ¹é…çš„è®°å½•ã€‚</p><p>è·¯ç”±åŒ¹é…å’Œå‰é¢è®²çš„ä¸€æ ·ï¼Œæ¯ä¸ªæ¡ç›®çš„å­ç½‘æ©ç å’Œ <code>192.168.1.100</code> IP åš <strong>&amp; ä¸è¿ç®—</strong>åï¼Œå¾—åˆ°çš„ç»“æœä¸å¯¹åº”æ¡ç›®çš„ç›®æ ‡åœ°å€è¿›è¡ŒåŒ¹é…ï¼Œå¦‚æœåŒ¹é…å°±ä¼šä½œä¸ºå€™é€‰è½¬å‘ç›®æ ‡ï¼Œå¦‚æœä¸åŒ¹é…å°±ç»§ç»­ä¸ä¸‹ä¸ªæ¡ç›®è¿›è¡Œè·¯ç”±åŒ¹é…ã€‚</p><p>å¦‚ç¬¬äºŒæ¡ç›®çš„å­ç½‘æ©ç  <code>255.255.255.0</code> ä¸ <code>192.168.1.100</code> IP åš <strong>&amp; ä¸è¿ç®—</strong>åï¼Œå¾—åˆ°ç»“æœæ˜¯ <code>192.168.1.0</code> ï¼Œè¿™ä¸ç¬¬äºŒæ¡ç›®çš„ç›®æ ‡åœ°å€ <code>192.168.1.0</code> åŒ¹é…ï¼Œè¯¥ç¬¬äºŒæ¡ç›®è®°å½•å°±ä¼šè¢«ä½œä¸ºè½¬å‘ç›®æ ‡ã€‚</p><p>å®åœ¨æ‰¾ä¸åˆ°åŒ¹é…è·¯ç”±æ—¶ï¼Œå°±ä¼šé€‰æ‹©<strong>é»˜è®¤è·¯ç”±</strong>ï¼Œè·¯ç”±è¡¨ä¸­å­ç½‘æ©ç ä¸º <code>0.0.0.0</code> çš„è®°å½•è¡¨ç¤ºã€Œé»˜è®¤è·¯ç”±ã€ã€‚</p><blockquote><p>è·¯ç”±å™¨çš„å‘é€æ“ä½œ</p></blockquote><p>æ¥ä¸‹æ¥å°±ä¼šè¿›å…¥åŒ…çš„<strong>å‘é€æ“ä½œ</strong>ã€‚</p><p>é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦æ ¹æ®<strong>è·¯ç”±è¡¨çš„ç½‘å…³åˆ—</strong>åˆ¤æ–­å¯¹æ–¹çš„åœ°å€ã€‚</p><ul><li>å¦‚æœç½‘å…³æ˜¯ä¸€ä¸ª IP åœ°å€ï¼Œåˆ™è¿™ä¸ªIP åœ°å€å°±æ˜¯æˆ‘ä»¬è¦è½¬å‘åˆ°çš„ç›®æ ‡åœ°å€ï¼Œ<strong>è¿˜æœªæŠµè¾¾ç»ˆç‚¹</strong>ï¼Œè¿˜éœ€ç»§ç»­éœ€è¦è·¯ç”±å™¨è½¬å‘ã€‚</li><li>å¦‚æœç½‘å…³ä¸ºç©ºï¼Œåˆ™ IP å¤´éƒ¨ä¸­çš„æ¥æ”¶æ–¹ IP åœ°å€å°±æ˜¯è¦è½¬å‘åˆ°çš„ç›®æ ‡åœ°å€ï¼Œä¹Ÿæ˜¯å°±ç»ˆäºæ‰¾åˆ° IP åŒ…å¤´é‡Œçš„ç›®æ ‡åœ°å€äº†ï¼Œè¯´æ˜<strong>å·²æŠµè¾¾ç»ˆç‚¹</strong>ã€‚</li></ul><p>çŸ¥é“å¯¹æ–¹çš„ IP åœ°å€ä¹‹åï¼Œæ¥ä¸‹æ¥éœ€è¦é€šè¿‡ <code>ARP</code> åè®®æ ¹æ® IP åœ°å€æŸ¥è¯¢ MAC åœ°å€ï¼Œå¹¶å°†æŸ¥è¯¢çš„ç»“æœä½œä¸ºæ¥æ”¶æ–¹ MAC åœ°å€ã€‚</p><p>è·¯ç”±å™¨ä¹Ÿæœ‰ ARP ç¼“å­˜ï¼Œå› æ­¤é¦–å…ˆä¼šåœ¨ ARP ç¼“å­˜ä¸­æŸ¥è¯¢ï¼Œå¦‚æœæ‰¾ä¸åˆ°åˆ™å‘é€ ARP æŸ¥è¯¢è¯·æ±‚ã€‚</p><p>æ¥ä¸‹æ¥æ˜¯å‘é€æ–¹ MAC åœ°å€å­—æ®µï¼Œè¿™é‡Œå¡«å†™è¾“å‡ºç«¯å£çš„ MAC åœ°å€ã€‚è¿˜æœ‰ä¸€ä¸ªä»¥å¤ªç±»å‹å­—æ®µï¼Œå¡«å†™ <code>0800</code> ï¼ˆåå…­è¿›åˆ¶ï¼‰è¡¨ç¤º IP åè®®ã€‚</p><p>ç½‘ç»œåŒ…å®Œæˆåï¼Œæ¥ä¸‹æ¥ä¼šå°†å…¶è½¬æ¢æˆç”µä¿¡å·å¹¶é€šè¿‡ç«¯å£å‘é€å‡ºå»ã€‚è¿™ä¸€æ­¥çš„å·¥ä½œè¿‡ç¨‹å’Œè®¡ç®—æœºä¹Ÿæ˜¯ç›¸åŒçš„ã€‚</p><p>å‘é€å‡ºå»çš„ç½‘ç»œåŒ…ä¼šé€šè¿‡<strong>äº¤æ¢æœº</strong>åˆ°è¾¾ä¸‹ä¸€ä¸ªè·¯ç”±å™¨ã€‚ç”±äºæ¥æ”¶æ–¹ MAC åœ°å€å°±æ˜¯ä¸‹ä¸€ä¸ªè·¯ç”±å™¨çš„åœ°å€ï¼Œæ‰€ä»¥äº¤æ¢æœºä¼šæ ¹æ®è¿™ä¸€åœ°å€å°†åŒ…ä¼ è¾“åˆ°ä¸‹ä¸€ä¸ªè·¯ç”±å™¨ã€‚</p><p>æ¥ä¸‹æ¥ï¼Œä¸‹ä¸€ä¸ªè·¯ç”±å™¨ä¼šå°†åŒ…è½¬å‘ç»™å†ä¸‹ä¸€ä¸ªè·¯ç”±å™¨ï¼Œç»è¿‡å±‚å±‚è½¬å‘ä¹‹åï¼Œç½‘ç»œåŒ…å°±åˆ°è¾¾äº†æœ€ç»ˆçš„ç›®çš„åœ°ã€‚</p><p>ä¸çŸ¥ä½ å‘ç°äº†æ²¡æœ‰ï¼Œåœ¨ç½‘ç»œåŒ…ä¼ è¾“çš„è¿‡ç¨‹ä¸­ï¼Œ<strong>æº IP å’Œç›®æ ‡ IP å§‹ç»ˆæ˜¯ä¸ä¼šå˜çš„ï¼Œä¸€ç›´å˜åŒ–çš„æ˜¯ MAC åœ°å€</strong>ï¼Œå› ä¸ºéœ€è¦ MAC åœ°å€åœ¨ä»¥å¤ªç½‘å†…è¿›è¡Œ<strong>ä¸¤ä¸ªè®¾å¤‡</strong>ä¹‹é—´çš„åŒ…ä¼ è¾“ã€‚</p><blockquote><p>æ•°æ®åŒ…é€šè¿‡å¤šä¸ªè·¯ç”±å™¨é“å‹çš„å¸®åŠ©ï¼Œåœ¨ç½‘ç»œä¸–ç•Œé€”ç»äº†å¾ˆå¤šè·¯ç¨‹ï¼Œæœ€ç»ˆæŠµè¾¾äº†ç›®çš„åœ°çš„åŸé—¨ï¼åŸé—¨å€¼å®ˆçš„è·¯ç”±å™¨ï¼Œå‘ç°äº†è¿™ä¸ªå°å…„å¼Ÿæ•°æ®åŒ…åŸæ¥æ˜¯æ‰¾åŸå†…çš„äººï¼Œäºæ˜¯å®ƒå°±å°†æ•°æ®åŒ…é€è¿›äº†åŸå†…ï¼Œå†ç»ç”±åŸå†…çš„äº¤æ¢æœºå¸®åŠ©ä¸‹ï¼Œæœ€ç»ˆè½¬å‘åˆ°äº†ç›®çš„åœ°äº†ã€‚æ•°æ®åŒ…æ„Ÿæ…¨ä¸‡åƒçš„è¯´é“ï¼šâ€œå¤šè°¢è¿™ä¸€è·¯ä¸Šï¼Œå„è·¯å¤§ä¾ çš„ç›¸åŠ©ï¼â€</p></blockquote><h4 id="äº’ç›¸æ‰’çš®-â€”â€”-æœåŠ¡å™¨-ä¸-å®¢æˆ·ç«¯" tabindex="-1"><a class="header-anchor" href="#äº’ç›¸æ‰’çš®-â€”â€”-æœåŠ¡å™¨-ä¸-å®¢æˆ·ç«¯"><span>- äº’ç›¸æ‰’çš® â€”â€” æœåŠ¡å™¨ ä¸ å®¢æˆ·ç«¯</span></a></h4><p>æ•°æ®åŒ…æŠµè¾¾äº†<strong>æœåŠ¡å™¨</strong>ï¼ŒæœåŠ¡å™¨è‚¯å®šé«˜å…´å‘€ï¼Œæ­£æ‰€è°“æœ‰æœ‹è‡ªè¿œæ–¹æ¥ï¼Œä¸äº¦ä¹ä¹ï¼Ÿ</p><p>æœåŠ¡å™¨é«˜å…´çš„ä¸å¾—äº†ï¼Œäºæ˜¯å¼€å§‹<strong>æ‰’æ•°æ®åŒ…çš„çš®</strong>ï¼å°±å¥½åƒä½ æ”¶åˆ°å¿«é€’ï¼Œèƒ½ä¸å…´å¥‹å—ï¼Ÿ</p><img src="'+F+'" alt="ç½‘ç»œåˆ†å±‚æ¨¡å‹" style="zoom:67%;"><p>æ•°æ®åŒ…æŠµè¾¾æœåŠ¡å™¨åï¼ŒæœåŠ¡å™¨ä¼šå…ˆæ‰’å¼€æ•°æ®åŒ…çš„ MAC å¤´éƒ¨ï¼ŒæŸ¥çœ‹æ˜¯å¦å’ŒæœåŠ¡å™¨è‡ªå·±çš„ <strong>MAC åœ°å€ç¬¦åˆ</strong>ï¼Œç¬¦åˆå°±å°†åŒ…æ”¶èµ·æ¥ã€‚</p><p>æ¥ç€ç»§ç»­æ‰’å¼€æ•°æ®åŒ…çš„ IP å¤´ï¼Œå‘ç° IP åœ°å€ç¬¦åˆï¼Œæ ¹æ® IP å¤´ä¸­åè®®é¡¹ï¼ŒçŸ¥é“è‡ªå·±ä¸Šå±‚æ˜¯ TCP åè®®ã€‚</p><p>äºæ˜¯ï¼Œæ‰’å¼€ TCP çš„å¤´ï¼Œé‡Œé¢æœ‰åºåˆ—å·ï¼Œéœ€è¦çœ‹ä¸€çœ‹è¿™ä¸ªåºåˆ—åŒ…æ˜¯ä¸æ˜¯æˆ‘æƒ³è¦çš„ï¼Œå¦‚æœæ˜¯å°±æ”¾å…¥ç¼“å­˜ä¸­ç„¶åè¿”å›ä¸€ä¸ª ACKï¼Œå¦‚æœä¸æ˜¯å°±ä¸¢å¼ƒã€‚TCPå¤´éƒ¨é‡Œé¢è¿˜æœ‰<strong>ç«¯å£å·</strong>ï¼Œ HTTP çš„æœåŠ¡å™¨æ­£åœ¨ç›‘å¬è¿™ä¸ªç«¯å£å·ã€‚</p><p>äºæ˜¯ï¼ŒæœåŠ¡å™¨è‡ªç„¶å°±çŸ¥é“æ˜¯ <strong>HTTP è¿›ç¨‹æƒ³è¦è¿™ä¸ªåŒ…</strong>ï¼Œäºæ˜¯å°±å°†åŒ…å‘ç»™ HTTP è¿›ç¨‹ã€‚</p><p>æœåŠ¡å™¨çš„ HTTP è¿›ç¨‹çœ‹åˆ°ï¼ŒåŸæ¥è¿™ä¸ªè¯·æ±‚æ˜¯è¦è®¿é—®ä¸€ä¸ªé¡µé¢ï¼Œäºæ˜¯å°±<strong>æŠŠè¿™ä¸ªç½‘é¡µå°è£…åœ¨ HTTP å“åº”æŠ¥æ–‡</strong>é‡Œã€‚</p><p>HTTP å“åº”æŠ¥æ–‡ä¹Ÿéœ€è¦ç©¿ä¸Š TCPã€IPã€MAC å¤´éƒ¨ï¼Œä¸è¿‡è¿™æ¬¡æ˜¯æºåœ°å€æ˜¯æœåŠ¡å™¨ IP åœ°å€ï¼Œç›®çš„åœ°å€æ˜¯å®¢æˆ·ç«¯ IP åœ°å€ã€‚</p><p>ç©¿å¥½å¤´éƒ¨è¡£æœåï¼Œä»ç½‘å¡å‡ºå»ï¼Œäº¤ç”±äº¤æ¢æœºè½¬å‘åˆ°å‡ºåŸçš„è·¯ç”±å™¨ï¼Œè·¯ç”±å™¨å°±æŠŠå“åº”æ•°æ®åŒ…å‘åˆ°äº†ä¸‹ä¸€ä¸ªè·¯ç”±å™¨ï¼Œå°±è¿™æ ·è·³å•Šè·³ã€‚</p><p>æœ€åè·³åˆ°äº†å®¢æˆ·ç«¯çš„åŸé—¨æŠŠå®ˆçš„è·¯ç”±å™¨ï¼Œè·¯ç”±å™¨æ‰’å¼€ IP å¤´éƒ¨å‘ç°æ˜¯è¦æ‰¾åŸå†…çš„äººï¼Œäºæ˜¯åˆæŠŠåŒ…å‘ç»™äº†åŸå†…çš„äº¤æ¢æœºï¼Œå†ç”±äº¤æ¢æœºè½¬å‘åˆ°å®¢æˆ·ç«¯ã€‚</p><p>å®¢æˆ·ç«¯æ”¶åˆ°äº†æœåŠ¡å™¨çš„å“åº”æ•°æ®åŒ…åï¼ŒåŒæ ·ä¹Ÿéå¸¸çš„é«˜å…´ï¼Œå®¢æˆ·èƒ½æ‹†å¿«é€’äº†ï¼</p><p>äºæ˜¯ï¼Œå®¢æˆ·ç«¯å¼€å§‹æ‰’çš®ï¼ŒæŠŠæ”¶åˆ°çš„æ•°æ®åŒ…çš„çš®æ‰’å‰© HTTP å“åº”æŠ¥æ–‡åï¼Œäº¤ç»™æµè§ˆå™¨å»æ¸²æŸ“é¡µé¢ï¼Œä¸€ä»½ç‰¹åˆ«çš„æ•°æ®åŒ…å¿«é€’ï¼Œå°±è¿™æ ·æ˜¾ç¤ºå‡ºæ¥äº†ï¼</p><p>æœ€åï¼Œå®¢æˆ·ç«¯è¦ç¦»å¼€äº†ï¼Œå‘æœåŠ¡å™¨å‘èµ·äº† TCP å››æ¬¡æŒ¥æ‰‹ï¼Œè‡³æ­¤åŒæ–¹çš„è¿æ¥å°±æ–­å¼€äº†ã€‚</p><h4 id="ä¸€ä¸ªæ•°æ®åŒ…è‡­ä¸è¦è„¸çš„æ„Ÿå—" tabindex="-1"><a class="header-anchor" href="#ä¸€ä¸ªæ•°æ®åŒ…è‡­ä¸è¦è„¸çš„æ„Ÿå—"><span>- ä¸€ä¸ªæ•°æ®åŒ…è‡­ä¸è¦è„¸çš„æ„Ÿå—</span></a></h4><blockquote><p>ä¸‹é¢å†…å®¹çš„ ã€Œæˆ‘ã€ï¼Œä»£è¡¨ã€Œè‡­ç¾çš„æ•°æ®åŒ…è§’è‰²ã€ã€‚æ³¨ï¼šï¼ˆæ‹¬å·çš„å†…å®¹ï¼‰ä»£è¡¨æˆ‘çš„åæ§½ï¼Œä¸‰è¿å‘¸ï¼</p></blockquote><p>æˆ‘ä¸€å¼€å§‹æˆ‘è™½ç„¶å­¤å•ã€ä¸çŸ¥æ‰€æªï¼Œä½†æ²¡æœ‰åœæ»ä¸å‰ã€‚æˆ‘ä¾ç„¶æ»¡æ€€ä¿¡å¿ƒå’Œå‹‡æ°”å¼€å§‹äº†å¾é€”ã€‚ï¼ˆ<strong>ä½ å½“ç„¶æœ‰å‹‡æ°”ï¼Œä½ æ˜¯åº”ç”¨å±‚æ•°æ®ï¼Œåé¢æœ‰åº•å±‚å…„å¼Ÿå½“é å±±ï¼Œæˆ‘å‘¸ï¼</strong>ï¼‰</p><p>æˆ‘å¾ˆåº†å¹¸é‡åˆ°äº†å„è·¯ç¥é€šå¹¿å¤§çš„å¤§ä½¬ï¼Œæœ‰å¯é ä¼ è¾“çš„ TCPã€æœ‰è¿œç¨‹å®šä½åŠŸèƒ½çš„ IPã€æœ‰æŒ‡æ˜ä¸‹ä¸€ç«™ä½ç½®çš„ MAC ç­‰ï¼ˆ<strong>ä½ å½“ç„¶ä¼šé‡åˆ°ï¼Œå› ä¸ºéƒ½è¢«è®¡ç®—æœºå®‰æ’å¥½çš„ï¼Œæˆ‘å‘¸ï¼</strong>ï¼‰ã€‚</p><p>è¿™äº›å¤§ä½¬éƒ½ç»™æˆ‘å‰é¢åŠ ä¸Šäº†å¤´éƒ¨ï¼Œä½¿å¾—æˆ‘èƒ½åœ¨äº¤æ¢æœºå’Œè·¯ç”±å™¨çš„è½¬å‘ä¸‹ï¼ŒæŠµè¾¾åˆ°äº†ç›®çš„åœ°ï¼ï¼ˆ<strong>å“ï¼Œä½ ä¹Ÿä¸å®¹æ˜“ï¼Œä¸åæ§½äº†ï¼Œæ”¾è¿‡ä½ ï¼</strong>ï¼‰</p><p>è¿™ä¸€è·¯ä¸Šçš„ç»å†ï¼Œè®©æˆ‘è®¤è¯†åˆ°äº†ç½‘ç»œä¸–ç•Œä¸­å„è·¯å¤§ä¾ åä½œçš„é‡è¦æ€§ï¼Œæ˜¯ä»–ä»¬ç»´æŠ¤äº†ç½‘ç»œä¸–ç•Œçš„ç§©åºï¼Œæ„Ÿè°¢ä»–ä»¬ï¼ï¼ˆ<strong>æˆ‘å‘¸ï¼Œä½ åº”è¯¥æ„Ÿè°¢ä¼—å¤šè®¡ç®—æœºç§‘å­¦å®¶ï¼</strong>ï¼‰</p><h2 id="_2-3-linux-ç³»ç»Ÿæ˜¯å¦‚ä½•æ”¶å‘ç½‘ç»œåŒ…çš„" tabindex="-1"><a class="header-anchor" href="#_2-3-linux-ç³»ç»Ÿæ˜¯å¦‚ä½•æ”¶å‘ç½‘ç»œåŒ…çš„"><span>2.3 Linux ç³»ç»Ÿæ˜¯å¦‚ä½•æ”¶å‘ç½‘ç»œåŒ…çš„ï¼Ÿ</span></a></h2><p>è¿™æ¬¡ï¼Œå°±å›´ç»•ä¸€ä¸ªé—®é¢˜æ¥è¯´ã€‚</p><p><strong>Linux ç³»ç»Ÿæ˜¯å¦‚ä½•æ”¶å‘ç½‘ç»œåŒ…çš„ï¼Ÿ</strong></p><ul><li><h3 id="ç½‘ç»œæ¨¡å‹" tabindex="-1"><a class="header-anchor" href="#ç½‘ç»œæ¨¡å‹"><span>ç½‘ç»œæ¨¡å‹</span></a></h3></li></ul><p>ä¸ºäº†ä½¿å¾—å¤šç§è®¾å¤‡èƒ½é€šè¿‡ç½‘ç»œç›¸äº’é€šä¿¡ï¼Œå’Œä¸ºäº†è§£å†³å„ç§ä¸åŒè®¾å¤‡åœ¨ç½‘ç»œäº’è”ä¸­çš„å…¼å®¹æ€§é—®é¢˜ï¼Œå›½é™…æ ‡å‡†åŒ–ç»„ç»‡åˆ¶å®šäº†å¼€æ”¾å¼ç³»ç»Ÿäº’è”é€šä¿¡å‚è€ƒæ¨¡å‹ï¼ˆ<em>Open System Interconnection Reference Model</em>ï¼‰ï¼Œä¹Ÿå°±æ˜¯ OSI ç½‘ç»œæ¨¡å‹ï¼Œè¯¥æ¨¡å‹ä¸»è¦æœ‰ 7 å±‚ï¼Œåˆ†åˆ«æ˜¯åº”ç”¨å±‚ã€è¡¨ç¤ºå±‚ã€ä¼šè¯å±‚ã€ä¼ è¾“å±‚ã€ç½‘ç»œå±‚ã€æ•°æ®é“¾è·¯å±‚ä»¥åŠç‰©ç†å±‚ã€‚</p><blockquote><p>æ¯ä¸€å±‚è´Ÿè´£çš„èŒèƒ½éƒ½ä¸åŒï¼Œå¦‚ä¸‹ï¼š</p><ul><li>åº”ç”¨å±‚ï¼Œè´Ÿè´£ç»™åº”ç”¨ç¨‹åºæä¾›ç»Ÿä¸€çš„æ¥å£ï¼›</li><li>è¡¨ç¤ºå±‚ï¼Œè´Ÿè´£æŠŠæ•°æ®è½¬æ¢æˆå…¼å®¹å¦ä¸€ä¸ªç³»ç»Ÿèƒ½è¯†åˆ«çš„æ ¼å¼ï¼›</li><li>ä¼šè¯å±‚ï¼Œè´Ÿè´£å»ºç«‹ã€ç®¡ç†å’Œç»ˆæ­¢è¡¨ç¤ºå±‚å®ä½“ä¹‹é—´çš„é€šä¿¡ä¼šè¯ï¼›</li><li>ä¼ è¾“å±‚ï¼Œè´Ÿè´£ç«¯åˆ°ç«¯çš„æ•°æ®ä¼ è¾“ï¼›</li><li>ç½‘ç»œå±‚ï¼Œè´Ÿè´£æ•°æ®çš„è·¯ç”±ã€è½¬å‘ã€åˆ†ç‰‡ï¼›</li><li>æ•°æ®é“¾è·¯å±‚ï¼Œè´Ÿè´£æ•°æ®çš„å°å¸§å’Œå·®é”™æ£€æµ‹ï¼Œä»¥åŠ MAC å¯»å€ï¼›</li><li>ç‰©ç†å±‚ï¼Œè´Ÿè´£åœ¨ç‰©ç†ç½‘ç»œä¸­ä¼ è¾“æ•°æ®å¸§ï¼›</li></ul></blockquote><p>ç”±äº OSI æ¨¡å‹å®åœ¨å¤ªå¤æ‚ï¼Œæå‡ºçš„ä¹Ÿåªæ˜¯æ¦‚å¿µç†è®ºä¸Šçš„åˆ†å±‚ï¼Œ<strong>å¹¶æ²¡æœ‰æä¾›å…·ä½“çš„å®ç°æ–¹æ¡ˆ</strong>ã€‚</p><p>äº‹å®ä¸Šï¼Œæˆ‘ä»¬æ¯”è¾ƒå¸¸è§ï¼Œä¹Ÿæ¯”è¾ƒå®ç”¨çš„æ˜¯å››å±‚æ¨¡å‹ï¼Œå³ TCP/IP ç½‘ç»œæ¨¡å‹ï¼ŒLinux ç³»ç»Ÿæ­£æ˜¯æŒ‰ç…§è¿™å¥—ç½‘ç»œæ¨¡å‹æ¥å®ç°ç½‘ç»œåè®®æ ˆçš„ã€‚</p><p>TCP/IP ç½‘ç»œæ¨¡å‹å…±æœ‰ 4 å±‚ï¼Œåˆ†åˆ«æ˜¯åº”ç”¨å±‚ã€ä¼ è¾“å±‚ã€ç½‘ç»œå±‚å’Œç½‘ç»œæ¥å£å±‚ï¼Œæ¯ä¸€å±‚è´Ÿè´£çš„èŒèƒ½å¦‚ä¸‹ï¼š</p><ul><li>åº”ç”¨å±‚ï¼Œè´Ÿè´£å‘ç”¨æˆ·æä¾›ä¸€ç»„åº”ç”¨ç¨‹åºï¼Œæ¯”å¦‚ HTTPã€DNSã€FTP ç­‰;</li><li>ä¼ è¾“å±‚ï¼Œè´Ÿè´£ç«¯åˆ°ç«¯çš„é€šä¿¡ï¼Œæ¯”å¦‚ TCPã€UDP ç­‰ï¼›</li><li>ç½‘ç»œå±‚ï¼Œè´Ÿè´£ç½‘ç»œåŒ…çš„å°è£…ã€åˆ†ç‰‡ã€è·¯ç”±ã€è½¬å‘ï¼Œæ¯”å¦‚ IPã€ICMP ç­‰ï¼›</li><li>ç½‘ç»œæ¥å£å±‚ï¼Œè´Ÿè´£ç½‘ç»œåŒ…åœ¨ç‰©ç†ç½‘ç»œä¸­çš„ä¼ è¾“ï¼Œæ¯”å¦‚ç½‘ç»œåŒ…çš„å°å¸§ã€ MAC å¯»å€ã€å·®é”™æ£€æµ‹ï¼Œä»¥åŠé€šè¿‡ç½‘å¡ä¼ è¾“ç½‘ç»œå¸§ç­‰ï¼›</li></ul><p>TCP/IP ç½‘ç»œæ¨¡å‹ç›¸æ¯” OSI ç½‘ç»œæ¨¡å‹ç®€åŒ–äº†ä¸å°‘ï¼Œä¹Ÿæ›´åŠ æ˜“è®°ï¼Œå®ƒä»¬ä¹‹é—´çš„å…³ç³»å¦‚ä¸‹å›¾ï¼š</p><img src="'+j+'" alt="img" style="zoom:67%;"><p>ä¸è¿‡ï¼Œæˆ‘ä»¬å¸¸è¯´çš„ä¸ƒå±‚å’Œå››å±‚è´Ÿè½½å‡è¡¡ï¼Œæ˜¯ç”¨ OSI ç½‘ç»œæ¨¡å‹æ¥æè¿°çš„ï¼Œä¸ƒå±‚å¯¹åº”çš„æ˜¯åº”ç”¨å±‚ï¼Œå››å±‚å¯¹åº”çš„æ˜¯ä¼ è¾“å±‚ã€‚</p><ul><li><h3 id="linux-ç½‘ç»œåè®®æ ˆ" tabindex="-1"><a class="header-anchor" href="#linux-ç½‘ç»œåè®®æ ˆ"><span>Linux ç½‘ç»œåè®®æ ˆ</span></a></h3></li></ul><p>æˆ‘ä»¬å¯ä»¥æŠŠè‡ªå·±çš„èº«ä½“æ¯”ä½œåº”ç”¨å±‚ä¸­çš„æ•°æ®ï¼Œæ‰“åº•è¡£æœæ¯”ä½œä¼ è¾“å±‚ä¸­çš„ TCP å¤´ï¼Œå¤–å¥—æ¯”ä½œç½‘ç»œå±‚ä¸­ IP å¤´ï¼Œå¸½å­å’Œé‹å­åˆ†åˆ«æ¯”ä½œç½‘ç»œæ¥å£å±‚çš„å¸§å¤´å’Œå¸§å°¾ã€‚</p><p>åœ¨å†¬å¤©è¿™ä¸ªå­£èŠ‚ï¼Œå½“æˆ‘ä»¬è¦ä»å®¶é‡Œå‡ºå»ç©çš„æ—¶å€™ï¼Œè‡ªç„¶è¦å…ˆç©¿ä¸ªæ‰“åº•è¡£æœï¼Œå†å¥—ä¸Šä¿æš–å¤–å¥—ï¼Œæœ€åç©¿ä¸Šå¸½å­å’Œé‹å­æ‰å‡ºé—¨ï¼Œè¿™ä¸ªè¿‡ç¨‹å°±å¥½åƒæˆ‘ä»¬æŠŠ TCP åè®®é€šä¿¡çš„ç½‘ç»œåŒ…å‘å‡ºå»çš„æ—¶å€™ï¼Œä¼šæŠŠåº”ç”¨å±‚çš„æ•°æ®<strong>æŒ‰ç…§ç½‘ç»œåè®®æ ˆ</strong> <strong>å±‚å±‚å°è£…å’Œå¤„ç†ã€‚</strong></p><p>ä½ ä»ä¸‹é¢è¿™å¼ å›¾å¯ä»¥çœ‹åˆ°ï¼Œåº”ç”¨å±‚æ•°æ®åœ¨æ¯ä¸€å±‚çš„å°è£…æ ¼å¼ã€‚</p><figure><img src="'+W+'" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><p>å…¶ä¸­ï¼š</p><ul><li>ä¼ è¾“å±‚ï¼Œç»™åº”ç”¨æ•°æ®å‰é¢å¢åŠ äº† TCP å¤´ï¼›</li><li>ç½‘ç»œå±‚ï¼Œç»™ TCP æ•°æ®åŒ…å‰é¢å¢åŠ äº† IP å¤´ï¼›</li><li>ç½‘ç»œæ¥å£å±‚ï¼Œç»™ IP æ•°æ®åŒ…å‰ååˆ†åˆ«å¢åŠ äº†å¸§å¤´å’Œå¸§å°¾ï¼›</li></ul><blockquote><p>è¿™äº›æ–°å¢çš„å¤´éƒ¨å’Œå°¾éƒ¨ï¼Œéƒ½æœ‰å„è‡ªçš„ä½œç”¨ï¼Œä¹Ÿéƒ½æ˜¯æŒ‰ç…§ç‰¹å®šçš„åè®®æ ¼å¼å¡«å……ï¼Œè¿™æ¯ä¸€å±‚éƒ½å¢åŠ äº†å„è‡ªçš„åè®®å¤´ï¼Œé‚£è‡ªç„¶ç½‘ç»œåŒ…çš„å¤§å°å°±å¢å¤§äº†ï¼Œä½†<strong>ç‰©ç†é“¾è·¯</strong>å¹¶ä¸èƒ½<strong>ä¼ è¾“ä»»æ„å¤§å°</strong>çš„æ•°æ®åŒ…ï¼Œæ‰€ä»¥åœ¨ä»¥å¤ªç½‘ä¸­ï¼Œè§„å®šäº†**æœ€å¤§ä¼ è¾“å•å…ƒï¼ˆMTUï¼‰**æ˜¯ <code>1500</code> å­—èŠ‚ï¼Œä¹Ÿå°±æ˜¯è§„å®šäº†å•æ¬¡ä¼ è¾“çš„æœ€å¤§ IP åŒ…å¤§å°ã€‚</p></blockquote><p>å½“ç½‘ç»œåŒ…è¶…è¿‡ MTU çš„å¤§å°ï¼Œå°±ä¼š<strong>åœ¨ç½‘ç»œå±‚åˆ†ç‰‡</strong>ï¼Œä»¥ç¡®ä¿åˆ†ç‰‡åçš„ IP åŒ…ä¸ä¼šè¶…è¿‡ MTU å¤§å°ï¼Œå¦‚æœ MTU è¶Šå°ï¼Œéœ€è¦çš„åˆ†åŒ…å°±è¶Šå¤šï¼Œé‚£ä¹ˆç½‘ç»œååèƒ½åŠ›å°±è¶Šå·®ï¼Œç›¸åçš„ï¼Œå¦‚æœ MTU è¶Šå¤§ï¼Œéœ€è¦çš„åˆ†åŒ…å°±è¶Šå°‘ï¼Œé‚£ä¹ˆç½‘ç»œååèƒ½åŠ›å°±è¶Šå¥½ã€‚</p><p>çŸ¥é“äº† TCP/IP ç½‘ç»œæ¨¡å‹ï¼Œä»¥åŠç½‘ç»œåŒ…çš„å°è£…åŸç†åï¼Œé‚£ä¹ˆ <strong>Linux ç½‘ç»œåè®®æ ˆ</strong>çš„æ ·å­ï¼Œä½ æƒ³å¿…çŒœåˆ°äº†å¤§æ¦‚ï¼Œå®ƒå…¶å®å°±ç±»ä¼¼äº TCP/IP çš„å››å±‚ç»“æ„ï¼š</p><img src="'+B+'" alt="img" style="zoom:67%;"><p>ä»ä¸Šå›¾çš„çš„ç½‘ç»œåè®®æ ˆï¼Œä½ å¯ä»¥çœ‹åˆ°ï¼š</p><ul><li><blockquote><p>åº”ç”¨ç¨‹åºéœ€è¦é€šè¿‡<strong>ç³»ç»Ÿè°ƒç”¨</strong>ï¼Œæ¥è·Ÿ <strong>Socket å±‚</strong>è¿›è¡Œæ•°æ®äº¤äº’ï¼›</p></blockquote></li><li><p><strong>Socket å±‚</strong>çš„ä¸‹é¢å°±æ˜¯<strong>ä¼ è¾“å±‚ã€ç½‘ç»œå±‚å’Œç½‘ç»œæ¥å£å±‚</strong>ï¼›</p></li><li><p>æœ€ä¸‹é¢çš„ä¸€å±‚ï¼Œåˆ™æ˜¯ç½‘å¡é©±åŠ¨ç¨‹åºå’Œç¡¬ä»¶ç½‘å¡è®¾å¤‡ï¼›</p></li><li><h3 id="linux-æ¥æ”¶ç½‘ç»œåŒ…çš„æµç¨‹" tabindex="-1"><a class="header-anchor" href="#linux-æ¥æ”¶ç½‘ç»œåŒ…çš„æµç¨‹"><span>Linux æ¥æ”¶ç½‘ç»œåŒ…çš„æµç¨‹</span></a></h3></li></ul><p>ç½‘å¡æ˜¯è®¡ç®—æœºé‡Œçš„ä¸€ä¸ªç¡¬ä»¶ï¼Œä¸“é—¨è´Ÿè´£æ¥æ”¶å’Œå‘é€ç½‘ç»œåŒ…ï¼Œå½“ç½‘å¡æ¥æ”¶åˆ°ä¸€ä¸ªç½‘ç»œåŒ…åï¼Œä¼šé€šè¿‡ DMA æŠ€æœ¯ï¼Œå°†ç½‘ç»œåŒ…å†™å…¥åˆ°æŒ‡å®šçš„å†…å­˜åœ°å€ï¼Œä¹Ÿå°±æ˜¯å†™å…¥åˆ° Ring Buffer ï¼Œè¿™ä¸ªæ˜¯ä¸€ä¸ªç¯å½¢ç¼“å†²åŒºï¼Œæ¥ç€å°±ä¼šå‘Šè¯‰æ“ä½œç³»ç»Ÿè¿™ä¸ªç½‘ç»œåŒ…å·²ç»åˆ°è¾¾ã€‚</p><blockquote><p>é‚£åº”è¯¥æ€ä¹ˆå‘Šè¯‰æ“ä½œç³»ç»Ÿè¿™ä¸ªç½‘ç»œåŒ…å·²ç»åˆ°è¾¾äº†å‘¢ï¼Ÿ</p></blockquote><p>æœ€ç®€å•çš„ä¸€ç§æ–¹å¼å°±æ˜¯è§¦å‘ä¸­æ–­ï¼Œä¹Ÿå°±æ˜¯æ¯å½“ç½‘å¡æ”¶åˆ°ä¸€ä¸ªç½‘ç»œåŒ…ï¼Œå°±è§¦å‘ä¸€ä¸ªä¸­æ–­å‘Šè¯‰æ“ä½œç³»ç»Ÿã€‚</p><p>ä½†æ˜¯ï¼Œè¿™å­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼Œåœ¨é«˜æ€§èƒ½ç½‘ç»œåœºæ™¯ä¸‹ï¼Œç½‘ç»œåŒ…çš„æ•°é‡ä¼šéå¸¸å¤šï¼Œé‚£ä¹ˆå°±ä¼šè§¦å‘éå¸¸å¤šçš„ä¸­æ–­ï¼Œè¦çŸ¥é“å½“ CPU æ”¶åˆ°äº†ä¸­æ–­ï¼Œå°±ä¼šåœä¸‹æ‰‹é‡Œçš„äº‹æƒ…ï¼Œè€Œå»å¤„ç†è¿™äº›ç½‘ç»œåŒ…ï¼Œå¤„ç†å®Œæ¯•åï¼Œæ‰ä¼šå›å»ç»§ç»­å…¶ä»–äº‹æƒ…ï¼Œé‚£ä¹ˆé¢‘ç¹åœ°è§¦å‘ä¸­æ–­ï¼Œåˆ™ä¼šå¯¼è‡´ CPU ä¸€ç›´æ²¡å®Œæ²¡äº†çš„å¤„ç†ä¸­æ–­ï¼Œè€Œå¯¼è‡´å…¶ä»–ä»»åŠ¡å¯èƒ½æ— æ³•ç»§ç»­å‰è¿›ï¼Œä»è€Œå½±å“ç³»ç»Ÿçš„æ•´ä½“æ•ˆç‡ã€‚</p><p>æ‰€ä»¥ä¸ºäº†è§£å†³é¢‘ç¹ä¸­æ–­å¸¦æ¥çš„æ€§èƒ½å¼€é”€ï¼ŒLinux å†…æ ¸åœ¨ 2.6 ç‰ˆæœ¬ä¸­å¼•å…¥äº† <strong>NAPI æœºåˆ¶</strong>ï¼Œå®ƒæ˜¯æ··åˆã€Œä¸­æ–­å’Œè½®è¯¢ã€çš„æ–¹å¼æ¥æ¥æ”¶ç½‘ç»œåŒ…ï¼Œå®ƒçš„æ ¸å¿ƒæ¦‚å¿µå°±æ˜¯<strong>ä¸é‡‡ç”¨ä¸­æ–­çš„æ–¹å¼è¯»å–æ•°æ®</strong>ï¼Œè€Œæ˜¯é¦–å…ˆé‡‡ç”¨ä¸­æ–­å”¤é†’æ•°æ®æ¥æ”¶çš„æœåŠ¡ç¨‹åºï¼Œç„¶å <code>poll</code> çš„æ–¹æ³•æ¥è½®è¯¢æ•°æ®ã€‚</p><p>å› æ­¤ï¼Œå½“æœ‰ç½‘ç»œåŒ…åˆ°è¾¾æ—¶ï¼Œä¼šé€šè¿‡ DMA æŠ€æœ¯ï¼Œå°†ç½‘ç»œåŒ…å†™å…¥åˆ°æŒ‡å®šçš„å†…å­˜åœ°å€ï¼Œæ¥ç€ç½‘å¡å‘ CPU å‘èµ·ç¡¬ä»¶ä¸­æ–­ï¼Œå½“ CPU æ”¶åˆ°ç¡¬ä»¶ä¸­æ–­è¯·æ±‚åï¼Œæ ¹æ®ä¸­æ–­è¡¨ï¼Œè°ƒç”¨å·²ç»æ³¨å†Œçš„ä¸­æ–­å¤„ç†å‡½æ•°ã€‚</p><p>ç¡¬ä»¶ä¸­æ–­å¤„ç†å‡½æ•°ä¼šåšå¦‚ä¸‹çš„äº‹æƒ…ï¼š</p><ul><li>éœ€è¦å…ˆã€Œæš‚æ—¶å±è”½ä¸­æ–­ã€ï¼Œè¡¨ç¤ºå·²ç»çŸ¥é“å†…å­˜ä¸­æœ‰æ•°æ®äº†ï¼Œå‘Šè¯‰ç½‘å¡ä¸‹æ¬¡å†æ”¶åˆ°æ•°æ®åŒ…ç›´æ¥å†™å†…å­˜å°±å¯ä»¥äº†ï¼Œä¸è¦å†é€šçŸ¥ CPU äº†ï¼Œè¿™æ ·å¯ä»¥æé«˜æ•ˆç‡ï¼Œé¿å… CPU ä¸åœçš„è¢«ä¸­æ–­ã€‚</li><li>æ¥ç€ï¼Œå‘èµ·ã€Œè½¯ä¸­æ–­ã€ï¼Œç„¶åæ¢å¤åˆšæ‰å±è”½çš„ä¸­æ–­ã€‚</li></ul><p>è‡³æ­¤ï¼Œç¡¬ä»¶ä¸­æ–­å¤„ç†å‡½æ•°çš„å·¥ä½œå°±å·²ç»å®Œæˆã€‚</p><p>ç¡¬ä»¶ä¸­æ–­å¤„ç†å‡½æ•°åšçš„äº‹æƒ…å¾ˆå°‘ï¼Œä¸»è¦è€—æ—¶çš„å·¥ä½œéƒ½äº¤ç»™è½¯ä¸­æ–­å¤„ç†å‡½æ•°äº†ã€‚</p><blockquote><p>è½¯ä¸­æ–­çš„å¤„ç†</p></blockquote><p>å†…æ ¸ä¸­çš„ ksoftirqd çº¿ç¨‹ä¸“é—¨è´Ÿè´£è½¯ä¸­æ–­çš„å¤„ç†ï¼Œå½“ ksoftirqd å†…æ ¸çº¿ç¨‹æ”¶åˆ°è½¯ä¸­æ–­åï¼Œå°±ä¼šæ¥è½®è¯¢å¤„ç†æ•°æ®ã€‚</p><p>ksoftirqd çº¿ç¨‹ä¼šä» Ring Buffer ä¸­è·å–ä¸€ä¸ªæ•°æ®å¸§ï¼Œç”¨ sk_buff è¡¨ç¤ºï¼Œä»è€Œå¯ä»¥ä½œä¸ºä¸€ä¸ªç½‘ç»œåŒ…äº¤ç»™ç½‘ç»œåè®®æ ˆè¿›è¡Œé€å±‚å¤„ç†ã€‚</p><blockquote><p>ç½‘ç»œåè®®æ ˆ</p></blockquote><p>é¦–å…ˆï¼Œä¼šå…ˆè¿›å…¥åˆ°ç½‘ç»œæ¥å£å±‚ï¼Œåœ¨è¿™ä¸€å±‚ä¼šæ£€æŸ¥æŠ¥æ–‡çš„åˆæ³•æ€§ï¼Œå¦‚æœä¸åˆæ³•åˆ™ä¸¢å¼ƒï¼Œåˆæ³•åˆ™ä¼šæ‰¾å‡ºè¯¥ç½‘ç»œåŒ…çš„ä¸Šå±‚åè®®çš„ç±»å‹ï¼Œæ¯”å¦‚æ˜¯ IPv4ï¼Œè¿˜æ˜¯ IPv6ï¼Œæ¥ç€å†å»æ‰å¸§å¤´å’Œå¸§å°¾ï¼Œç„¶åäº¤ç»™ç½‘ç»œå±‚ã€‚</p><p>åˆ°äº†ç½‘ç»œå±‚ï¼Œåˆ™å–å‡º IP åŒ…ï¼Œåˆ¤æ–­ç½‘ç»œåŒ…ä¸‹ä¸€æ­¥çš„èµ°å‘ï¼Œæ¯”å¦‚æ˜¯äº¤ç»™ä¸Šå±‚å¤„ç†è¿˜æ˜¯è½¬å‘å‡ºå»ã€‚å½“ç¡®è®¤è¿™ä¸ªç½‘ç»œåŒ…è¦å‘é€ç»™æœ¬æœºåï¼Œå°±ä¼šä» IP å¤´é‡Œçœ‹çœ‹ä¸Šä¸€å±‚åè®®çš„ç±»å‹æ˜¯ TCP è¿˜æ˜¯ UDPï¼Œæ¥ç€å»æ‰ IP å¤´ï¼Œç„¶åäº¤ç»™ä¼ è¾“å±‚ã€‚</p><p>ä¼ è¾“å±‚å–å‡º TCP å¤´æˆ– UDP å¤´ï¼Œæ ¹æ®å››å…ƒç»„ã€Œæº IPã€æºç«¯å£ã€ç›®çš„ IPã€ç›®çš„ç«¯å£ã€ ä½œä¸ºæ ‡è¯†ï¼Œæ‰¾å‡ºå¯¹åº”çš„ Socketï¼Œå¹¶æŠŠæ•°æ®æ”¾åˆ° Socket çš„æ¥æ”¶ç¼“å†²åŒºã€‚</p><p>æœ€åï¼Œåº”ç”¨å±‚ç¨‹åºè°ƒç”¨ Socket æ¥å£ï¼Œå°†å†…æ ¸çš„ Socket æ¥æ”¶ç¼“å†²åŒºçš„æ•°æ®ã€Œæ‹·è´ã€åˆ°åº”ç”¨å±‚çš„ç¼“å†²åŒºï¼Œç„¶åå”¤é†’ç”¨æˆ·è¿›ç¨‹ã€‚</p><p>è‡³æ­¤ï¼Œä¸€ä¸ªç½‘ç»œåŒ…çš„æ¥æ”¶è¿‡ç¨‹å°±å·²ç»ç»“æŸäº†ï¼Œä½ ä¹Ÿå¯ä»¥ä»ä¸‹å›¾å·¦è¾¹éƒ¨åˆ†çœ‹åˆ°ç½‘ç»œåŒ…æ¥æ”¶çš„æµç¨‹ï¼Œå³è¾¹éƒ¨åˆ†åˆšå¥½åè¿‡æ¥ï¼Œå®ƒæ˜¯ç½‘ç»œåŒ…å‘é€çš„æµç¨‹ã€‚</p><figure><img src="'+O+'" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><ul><li><h3 id="linux-å‘é€ç½‘ç»œåŒ…çš„æµç¨‹" tabindex="-1"><a class="header-anchor" href="#linux-å‘é€ç½‘ç»œåŒ…çš„æµç¨‹"><span>Linux å‘é€ç½‘ç»œåŒ…çš„æµç¨‹</span></a></h3></li></ul><p>å¦‚ä¸Šå›¾çš„å³åŠéƒ¨åˆ†ï¼Œå‘é€ç½‘ç»œåŒ…çš„æµç¨‹æ­£å¥½å’Œæ¥æ”¶æµç¨‹ç›¸åã€‚</p><p>é¦–å…ˆï¼Œåº”ç”¨ç¨‹åºä¼šè°ƒç”¨ Socket å‘é€æ•°æ®åŒ…çš„æ¥å£ï¼Œç”±äºè¿™ä¸ªæ˜¯ç³»ç»Ÿè°ƒç”¨ï¼Œæ‰€ä»¥ä¼šä»ç”¨æˆ·æ€é™·å…¥åˆ°å†…æ ¸æ€ä¸­çš„ Socket å±‚ï¼Œå†…æ ¸ä¼šç”³è¯·ä¸€ä¸ªå†…æ ¸æ€çš„ sk_buff å†…å­˜ï¼Œ<strong>å°†ç”¨æˆ·å¾…å‘é€çš„æ•°æ®æ‹·è´åˆ° sk_buff å†…å­˜ï¼Œå¹¶å°†å…¶åŠ å…¥åˆ°å‘é€ç¼“å†²åŒº</strong>ã€‚</p><p>æ¥ä¸‹æ¥ï¼Œç½‘ç»œåè®®æ ˆä» Socket å‘é€ç¼“å†²åŒºä¸­å–å‡º sk_buffï¼Œå¹¶æŒ‰ç…§ TCP/IP åè®®æ ˆä»ä¸Šåˆ°ä¸‹é€å±‚å¤„ç†ã€‚</p><p>å¦‚æœä½¿ç”¨çš„æ˜¯ TCP ä¼ è¾“åè®®å‘é€æ•°æ®ï¼Œé‚£ä¹ˆ<strong>å…ˆæ‹·è´ä¸€ä¸ªæ–°çš„ sk_buff å‰¯æœ¬</strong> ï¼Œè¿™æ˜¯å› ä¸º sk_buff åç»­åœ¨è°ƒç”¨ç½‘ç»œå±‚ï¼Œæœ€ååˆ°è¾¾ç½‘å¡å‘é€å®Œæˆçš„æ—¶å€™ï¼Œè¿™ä¸ª sk_buff ä¼šè¢«é‡Šæ”¾æ‰ã€‚è€Œ TCP åè®®æ˜¯æ”¯æŒä¸¢å¤±é‡ä¼ çš„ï¼Œåœ¨æ”¶åˆ°å¯¹æ–¹çš„ ACK ä¹‹å‰ï¼Œè¿™ä¸ª sk_buff ä¸èƒ½è¢«åˆ é™¤ã€‚æ‰€ä»¥å†…æ ¸çš„åšæ³•å°±æ˜¯æ¯æ¬¡è°ƒç”¨ç½‘å¡å‘é€çš„æ—¶å€™ï¼Œå®é™…ä¸Šä¼ é€’å‡ºå»çš„æ˜¯ sk_buff çš„ä¸€ä¸ªæ‹·è´ï¼Œç­‰æ”¶åˆ° ACK å†çœŸæ­£åˆ é™¤ã€‚</p><p>æ¥ç€ï¼Œå¯¹ sk_buff å¡«å…… TCP å¤´ã€‚è¿™é‡Œæä¸€ä¸‹ï¼Œsk_buff å¯ä»¥è¡¨ç¤ºå„ä¸ªå±‚çš„æ•°æ®åŒ…ï¼Œåœ¨åº”ç”¨å±‚æ•°æ®åŒ…å« dataï¼Œåœ¨ TCP å±‚æˆ‘ä»¬ç§°ä¸º segmentï¼Œåœ¨ IP å±‚æˆ‘ä»¬å« packetï¼Œåœ¨æ•°æ®é“¾è·¯å±‚ç§°ä¸º frameã€‚</p><p>ä½ å¯èƒ½ä¼šå¥½å¥‡ï¼Œä¸ºä»€ä¹ˆå…¨éƒ¨æ•°æ®åŒ…åªç”¨ä¸€ä¸ªç»“æ„ä½“æ¥æè¿°å‘¢ï¼Ÿåè®®æ ˆé‡‡ç”¨çš„æ˜¯åˆ†å±‚ç»“æ„ï¼Œä¸Šå±‚å‘ä¸‹å±‚ä¼ é€’æ•°æ®æ—¶éœ€è¦å¢åŠ åŒ…å¤´ï¼Œä¸‹å±‚å‘ä¸Šå±‚æ•°æ®æ—¶åˆéœ€è¦å»æ‰åŒ…å¤´ï¼Œå¦‚æœæ¯ä¸€å±‚éƒ½ç”¨ä¸€ä¸ªç»“æ„ä½“ï¼Œé‚£åœ¨å±‚ä¹‹é—´ä¼ é€’æ•°æ®çš„æ—¶å€™ï¼Œå°±è¦å‘ç”Ÿå¤šæ¬¡æ‹·è´ï¼Œè¿™å°†å¤§å¤§é™ä½ CPU æ•ˆç‡ã€‚</p><p>äºæ˜¯ï¼Œä¸ºäº†åœ¨å±‚çº§ä¹‹é—´ä¼ é€’æ•°æ®æ—¶ï¼Œä¸å‘ç”Ÿæ‹·è´ï¼Œåªç”¨ sk_buff ä¸€ä¸ªç»“æ„ä½“æ¥æè¿°æ‰€æœ‰çš„ç½‘ç»œåŒ…ï¼Œé‚£å®ƒæ˜¯å¦‚ä½•åšåˆ°çš„å‘¢ï¼Ÿæ˜¯é€šè¿‡è°ƒæ•´ sk_buff ä¸­ <code>data</code> çš„æŒ‡é’ˆï¼Œæ¯”å¦‚ï¼š</p><ul><li>å½“æ¥æ”¶æŠ¥æ–‡æ—¶ï¼Œä»ç½‘å¡é©±åŠ¨å¼€å§‹ï¼Œé€šè¿‡åè®®æ ˆå±‚å±‚å¾€ä¸Šä¼ é€æ•°æ®æŠ¥ï¼Œé€šè¿‡å¢åŠ  skb-&gt;data çš„å€¼ï¼Œæ¥é€æ­¥å‰¥ç¦»åè®®é¦–éƒ¨ã€‚</li><li>å½“è¦å‘é€æŠ¥æ–‡æ—¶ï¼Œåˆ›å»º sk_buff ç»“æ„ä½“ï¼Œæ•°æ®ç¼“å­˜åŒºçš„å¤´éƒ¨é¢„ç•™è¶³å¤Ÿçš„ç©ºé—´ï¼Œç”¨æ¥å¡«å……å„å±‚é¦–éƒ¨ï¼Œåœ¨ç»è¿‡å„ä¸‹å±‚åè®®æ—¶ï¼Œé€šè¿‡å‡å°‘ skb-&gt;data çš„å€¼æ¥å¢åŠ åè®®é¦–éƒ¨ã€‚</li></ul><p>ä½ å¯ä»¥ä»ä¸‹é¢è¿™å¼ å›¾çœ‹åˆ°ï¼Œå½“å‘é€æŠ¥æ–‡æ—¶ï¼Œdata æŒ‡é’ˆçš„ç§»åŠ¨è¿‡ç¨‹ã€‚</p><figure><img src="'+Q+'" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><p>è‡³æ­¤ï¼Œä¼ è¾“å±‚çš„å·¥ä½œä¹Ÿå°±éƒ½å®Œæˆäº†ã€‚</p><p>ç„¶åäº¤ç»™ç½‘ç»œå±‚ï¼Œåœ¨ç½‘ç»œå±‚é‡Œä¼šåšè¿™äº›å·¥ä½œï¼šé€‰å–è·¯ç”±ï¼ˆç¡®è®¤ä¸‹ä¸€è·³çš„ IPï¼‰ã€å¡«å…… IP å¤´ã€netfilter è¿‡æ»¤ã€å¯¹è¶…è¿‡ MTU å¤§å°çš„æ•°æ®åŒ…è¿›è¡Œåˆ†ç‰‡ã€‚å¤„ç†å®Œè¿™äº›å·¥ä½œåä¼šäº¤ç»™ç½‘ç»œæ¥å£å±‚å¤„ç†ã€‚</p><p>ç½‘ç»œæ¥å£å±‚ä¼šé€šè¿‡ ARP åè®®è·å¾—ä¸‹ä¸€è·³çš„ MAC åœ°å€ï¼Œç„¶åå¯¹ sk_buff å¡«å……å¸§å¤´å’Œå¸§å°¾ï¼Œæ¥ç€å°† sk_buff æ”¾åˆ°ç½‘å¡çš„å‘é€é˜Ÿåˆ—ä¸­ã€‚</p><p>è¿™ä¸€äº›å·¥ä½œå‡†å¤‡å¥½åï¼Œä¼šè§¦å‘ã€Œè½¯ä¸­æ–­ã€å‘Šè¯‰ç½‘å¡é©±åŠ¨ç¨‹åºï¼Œè¿™é‡Œæœ‰æ–°çš„ç½‘ç»œåŒ…éœ€è¦å‘é€ï¼Œé©±åŠ¨ç¨‹åºä¼šä»å‘é€é˜Ÿåˆ—ä¸­è¯»å– sk_buffï¼Œå°†è¿™ä¸ª sk_buff æŒ‚åˆ° RingBuffer ä¸­ï¼Œæ¥ç€å°† sk_buff æ•°æ®æ˜ å°„åˆ°ç½‘å¡å¯è®¿é—®çš„å†…å­˜ DMA åŒºåŸŸï¼Œæœ€åè§¦å‘çœŸå®çš„å‘é€ã€‚</p><p>å½“æ•°æ®å‘é€å®Œæˆä»¥åï¼Œå…¶å®å·¥ä½œå¹¶æ²¡æœ‰ç»“æŸï¼Œå› ä¸ºå†…å­˜è¿˜æ²¡æœ‰æ¸…ç†ã€‚å½“å‘é€å®Œæˆçš„æ—¶å€™ï¼Œç½‘å¡è®¾å¤‡ä¼šè§¦å‘ä¸€ä¸ªç¡¬ä¸­æ–­æ¥é‡Šæ”¾å†…å­˜ï¼Œä¸»è¦æ˜¯é‡Šæ”¾ sk_buff å†…å­˜å’Œæ¸…ç† RingBuffer å†…å­˜ã€‚</p><p>æœ€åï¼Œå½“æ”¶åˆ°è¿™ä¸ª TCP æŠ¥æ–‡çš„ ACK åº”ç­”æ—¶ï¼Œä¼ è¾“å±‚å°±ä¼šé‡Šæ”¾åŸå§‹çš„ sk_buff ã€‚</p><blockquote><p>å‘é€ç½‘ç»œæ•°æ®çš„æ—¶å€™ï¼Œæ¶‰åŠå‡ æ¬¡å†…å­˜æ‹·è´æ“ä½œï¼Ÿ</p></blockquote><p>ç¬¬ä¸€æ¬¡ï¼Œè°ƒç”¨å‘é€æ•°æ®çš„ç³»ç»Ÿè°ƒç”¨çš„æ—¶å€™ï¼Œå†…æ ¸ä¼šç”³è¯·ä¸€ä¸ªå†…æ ¸æ€çš„ sk_buff å†…å­˜ï¼Œå°†ç”¨æˆ·å¾…å‘é€çš„æ•°æ®æ‹·è´åˆ° sk_buff å†…å­˜ï¼Œå¹¶å°†å…¶åŠ å…¥åˆ°å‘é€ç¼“å†²åŒºã€‚</p><p>ç¬¬äºŒæ¬¡ï¼Œåœ¨ä½¿ç”¨ TCP ä¼ è¾“åè®®çš„æƒ…å†µä¸‹ï¼Œä»ä¼ è¾“å±‚è¿›å…¥ç½‘ç»œå±‚çš„æ—¶å€™ï¼Œæ¯ä¸€ä¸ª sk_buff éƒ½ä¼šè¢«å…‹éš†ä¸€ä¸ªæ–°çš„å‰¯æœ¬å‡ºæ¥ã€‚å‰¯æœ¬ sk_buff ä¼šè¢«é€å¾€ç½‘ç»œå±‚ï¼Œç­‰å®ƒå‘é€å®Œçš„æ—¶å€™å°±ä¼šé‡Šæ”¾æ‰ï¼Œç„¶ååŸå§‹çš„ sk_buff è¿˜ä¿ç•™åœ¨ä¼ è¾“å±‚ï¼Œç›®çš„æ˜¯ä¸ºäº†å®ç° TCP çš„å¯é ä¼ è¾“ï¼Œç­‰æ”¶åˆ°è¿™ä¸ªæ•°æ®åŒ…çš„ ACK æ—¶ï¼Œæ‰ä¼šé‡Šæ”¾åŸå§‹çš„ sk_buff ã€‚</p><p>ç¬¬ä¸‰æ¬¡ï¼Œå½“ IP å±‚å‘ç° sk_buff å¤§äº MTU æ—¶æ‰éœ€è¦è¿›è¡Œã€‚ä¼šå†ç”³è¯·é¢å¤–çš„ sk_buffï¼Œå¹¶å°†åŸæ¥çš„ sk_buff æ‹·è´ä¸ºå¤šä¸ªå°çš„ sk_buffã€‚</p><ul><li><h3 id="æ€»ç»“" tabindex="-1"><a class="header-anchor" href="#æ€»ç»“"><span>æ€»ç»“</span></a></h3></li></ul><p>ç”µè„‘ä¸ç”µè„‘ä¹‹é—´é€šå¸¸éƒ½æ˜¯é€šè¿‡ç½‘å¡ã€äº¤æ¢æœºã€è·¯ç”±å™¨ç­‰ç½‘ç»œè®¾å¤‡è¿æ¥åˆ°ä¸€èµ·ï¼Œé‚£ç”±äºç½‘ç»œè®¾å¤‡çš„å¼‚æ„æ€§ï¼Œå›½é™…æ ‡å‡†åŒ–ç»„ç»‡å®šä¹‰äº†ä¸€ä¸ªä¸ƒå±‚çš„ OSI ç½‘ç»œæ¨¡å‹ï¼Œä½†æ˜¯è¿™ä¸ªæ¨¡å‹ç”±äºæ¯”è¾ƒå¤æ‚ï¼Œå®é™…åº”ç”¨ä¸­å¹¶æ²¡æœ‰é‡‡ç”¨ï¼Œè€Œæ˜¯é‡‡ç”¨äº†æ›´ä¸ºç®€åŒ–çš„ TCP/IP æ¨¡å‹ï¼ŒLinux ç½‘ç»œåè®®æ ˆå°±æ˜¯æŒ‰ç…§äº†è¯¥æ¨¡å‹æ¥å®ç°çš„ã€‚</p><p>TCP/IP æ¨¡å‹ä¸»è¦åˆ†ä¸ºåº”ç”¨å±‚ã€ä¼ è¾“å±‚ã€ç½‘ç»œå±‚ã€ç½‘ç»œæ¥å£å±‚å››å±‚ï¼Œæ¯ä¸€å±‚è´Ÿè´£çš„èŒè´£éƒ½ä¸åŒï¼Œè¿™ä¹Ÿæ˜¯ Linux ç½‘ç»œåè®®æ ˆä¸»è¦æ„æˆéƒ¨åˆ†ã€‚</p><p>å½“åº”ç”¨ç¨‹åºé€šè¿‡ <strong>Socket æ¥å£</strong>å‘é€æ•°æ®åŒ…ï¼Œæ•°æ®åŒ…ä¼šè¢«ç½‘ç»œåè®®æ ˆä»ä¸Šåˆ°ä¸‹è¿›è¡Œé€å±‚å¤„ç†åï¼Œæ‰ä¼šè¢«é€åˆ°ç½‘å¡é˜Ÿåˆ—ä¸­ï¼Œéšåç”±ç½‘å¡å°†ç½‘ç»œåŒ…å‘é€å‡ºå»ã€‚</p><p>è€Œåœ¨æ¥æ”¶ç½‘ç»œåŒ…æ—¶ï¼ŒåŒæ ·ä¹Ÿè¦å…ˆç»è¿‡ç½‘ç»œåè®®æ ˆä»ä¸‹åˆ°ä¸Šçš„é€å±‚å¤„ç†ï¼Œæœ€åæ‰ä¼šè¢«é€åˆ°åº”ç”¨ç¨‹åºã€‚</p><h1 id="-1" tabindex="-1"><a class="header-anchor" href="#-1"><span>----------------</span></a></h1><h1 id="ä¸‰ã€-httpç¯‡" tabindex="-1"><a class="header-anchor" href="#ä¸‰ã€-httpç¯‡"><span>ä¸‰ã€ HTTPç¯‡</span></a></h1><h2 id="_3-1-http-å¸¸è§é¢è¯•é¢˜" tabindex="-1"><a class="header-anchor" href="#_3-1-http-å¸¸è§é¢è¯•é¢˜"><span>3.1 HTTP å¸¸è§é¢è¯•é¢˜</span></a></h2><p>åœ¨é¢è¯•è¿‡ç¨‹ä¸­ï¼ŒHTTP è¢«æé—®çš„æ¦‚ç‡è¿˜æ˜¯æ¯”è¾ƒé«˜çš„ã€‚</p><p>å°æ—æˆ‘æœé›†äº† 6 å¤§ç±» HTTP é¢è¯•å¸¸é—®çš„é¢˜ç›®ï¼ŒåŒæ—¶è¿™ 6 å¤§ç±»é¢˜è·Ÿ <strong>HTTP çš„å‘å±•å’Œæ¼”å˜</strong>å…³è”æ€§æ˜¯æ¯”è¾ƒå¤§çš„ï¼Œé€šè¿‡<strong>é—®ç­” + å›¾è§£</strong>çš„å½¢å¼<strong>ç”±æµ…å…¥æ·±</strong>çš„æ–¹å¼å¸®åŠ©å¤§å®¶è¿›ä¸€æ­¥çš„å­¦ä¹ å’Œç†è§£ HTTPã€‚</p><blockquote><ol><li>HTTP åŸºæœ¬æ¦‚å¿µ</li><li>Get ä¸ Post</li><li>HTTP ç‰¹æ€§</li><li>HTTP ç¼“å­˜æŠ€æœ¯</li><li>HTTPS ä¸ HTTP</li><li>HTTP/1.1ã€HTTP/2ã€HTTP/3 æ¼”å˜</li></ol></blockquote><img src="'+G+'" alt="æçº²" style="zoom:50%;"><h3 id="_3-1-1-http-åŸºæœ¬æ¦‚å¿µ" tabindex="-1"><a class="header-anchor" href="#_3-1-1-http-åŸºæœ¬æ¦‚å¿µ"><span>3.1.1 HTTP åŸºæœ¬æ¦‚å¿µ</span></a></h3><h4 id="http-æ˜¯ä»€ä¹ˆ" tabindex="-1"><a class="header-anchor" href="#http-æ˜¯ä»€ä¹ˆ"><span>- HTTP æ˜¯ä»€ä¹ˆï¼Ÿ</span></a></h4><p>HTTP æ˜¯è¶…æ–‡æœ¬ä¼ è¾“åè®®ï¼Œä¹Ÿå°±æ˜¯ HyperText <strong>T</strong>ransfer <strong>P</strong>rotocolã€‚</p><blockquote><p>èƒ½å¦è¯¦ç»†è§£é‡Šã€Œè¶…æ–‡æœ¬ä¼ è¾“åè®®ã€ï¼Ÿ</p></blockquote><p>HTTP çš„åå­—ã€Œè¶…æ–‡æœ¬åè®®ä¼ è¾“ã€ï¼Œå®ƒå¯ä»¥æ‹†æˆä¸‰ä¸ªéƒ¨åˆ†ï¼š</p><ul><li>è¶…æ–‡æœ¬</li><li>ä¼ è¾“</li><li>åè®®</li></ul><img src="'+V+'" alt="ä¸‰ä¸ªéƒ¨åˆ†" style="zoom:67%;"><p><em>1. ã€Œåè®®ã€</em></p><p>åœ¨ç”Ÿæ´»ä¸­ï¼Œæˆ‘ä»¬ä¹Ÿèƒ½éšå¤„å¯è§ã€Œåè®®ã€ï¼Œä¾‹å¦‚ï¼š</p><ul><li>åˆšæ¯•ä¸šæ—¶ä¼šç­¾ä¸€ä¸ªã€Œä¸‰æ–¹åè®®ã€ï¼›</li><li>æ‰¾æˆ¿å­æ—¶ä¼šç­¾ä¸€ä¸ªã€Œç§Ÿæˆ¿åè®®ã€ï¼›</li></ul><img src="'+X+'" alt="ä¸‰æ–¹åè®®å’Œç§Ÿæˆ¿åè®®" style="zoom:67%;"><p>ç”Ÿæ´»ä¸­çš„åè®®ï¼Œæœ¬è´¨ä¸Šä¸è®¡ç®—æœºä¸­çš„åè®®æ˜¯ç›¸åŒçš„ï¼Œåè®®çš„ç‰¹ç‚¹:</p><blockquote><ul><li>ã€Œ<strong>å</strong>ã€å­—ï¼Œä»£è¡¨çš„æ„æ€æ˜¯å¿…é¡»æœ‰<strong>ä¸¤ä¸ªä»¥ä¸Šçš„å‚ä¸è€…</strong>ã€‚ä¾‹å¦‚ä¸‰æ–¹åè®®é‡Œçš„å‚ä¸è€…æœ‰ä¸‰ä¸ªï¼šä½ ã€å…¬å¸ã€å­¦æ ¡ä¸‰ä¸ªï¼›ç§Ÿæˆ¿åè®®é‡Œçš„å‚ä¸è€…æœ‰ä¸¤ä¸ªï¼šä½ å’Œæˆ¿ä¸œã€‚</li><li>ã€Œ<strong>è®®</strong>ã€å­—ï¼Œä»£è¡¨çš„æ„æ€æ˜¯å¯¹å‚ä¸è€…çš„ä¸€ç§<strong>è¡Œä¸ºçº¦å®šå’Œè§„èŒƒ</strong>ã€‚ä¾‹å¦‚ä¸‰æ–¹åè®®é‡Œè§„å®šè¯•ç”¨æœŸæœŸé™ã€æ¯çº¦é‡‘ç­‰ï¼›ç§Ÿæˆ¿åè®®é‡Œè§„å®šç§ŸæœŸæœŸé™ã€æ¯æœˆç§Ÿé‡‘é‡‘é¢ã€è¿çº¦å¦‚ä½•å¤„ç†ç­‰ã€‚</li></ul></blockquote><p>é’ˆå¯¹ HTTP <strong>åè®®</strong>ï¼Œæˆ‘ä»¬å¯ä»¥è¿™ä¹ˆç†è§£ã€‚</p><p>HTTP æ˜¯ä¸€ä¸ªç”¨åœ¨è®¡ç®—æœºä¸–ç•Œé‡Œçš„<strong>åè®®</strong>ã€‚å®ƒä½¿ç”¨è®¡ç®—æœºèƒ½å¤Ÿç†è§£çš„è¯­è¨€ç¡®ç«‹äº†ä¸€ç§<strong>è®¡ç®—æœºä¹‹é—´äº¤æµé€šä¿¡çš„è§„èŒƒ</strong>ï¼ˆ<strong>ä¸¤ä¸ªä»¥ä¸Šçš„å‚ä¸è€…</strong>ï¼‰ï¼Œä»¥åŠç›¸å…³çš„å„ç§æ§åˆ¶å’Œé”™è¯¯å¤„ç†æ–¹å¼ï¼ˆ<strong>è¡Œä¸ºçº¦å®šå’Œè§„èŒƒ</strong>ï¼‰ã€‚</p><p><em>2. ã€Œä¼ è¾“ã€</em></p><p>æ‰€è°“çš„ã€Œä¼ è¾“ã€ï¼Œå¾ˆå¥½ç†è§£ï¼Œå°±æ˜¯æŠŠä¸€å †ä¸œè¥¿ä» A ç‚¹æ¬åˆ° B ç‚¹ï¼Œæˆ–è€…ä» B ç‚¹ æ¬åˆ° A ç‚¹ã€‚</p><p>åˆ«è½»è§†äº†è¿™ä¸ªç®€å•çš„åŠ¨ä½œï¼Œå®ƒè‡³å°‘åŒ…å«ä¸¤é¡¹é‡è¦çš„ä¿¡æ¯ã€‚</p><p>HTTP åè®®æ˜¯ä¸€ä¸ª<strong>åŒå‘åè®®</strong>ã€‚</p><p>æˆ‘ä»¬åœ¨ä¸Šç½‘å†²æµªæ—¶ï¼Œ<strong>æµè§ˆå™¨æ˜¯è¯·æ±‚æ–¹ A</strong>ï¼Œ<strong>ç™¾åº¦ç½‘ç«™å°±æ˜¯åº”ç­”æ–¹ B</strong>ã€‚åŒæ–¹çº¦å®šç”¨ HTTP åè®®æ¥é€šä¿¡ï¼Œäºæ˜¯æµè§ˆå™¨æŠŠè¯·æ±‚æ•°æ®å‘é€ç»™ç½‘ç«™ï¼Œç½‘ç«™å†æŠŠä¸€äº›æ•°æ®è¿”å›ç»™æµè§ˆå™¨ï¼Œæœ€åç”±æµè§ˆå™¨æ¸²æŸ“åœ¨å±å¹•ï¼Œå°±å¯ä»¥çœ‹åˆ°å›¾ç‰‡ã€è§†é¢‘äº†ã€‚</p><img src="'+Z+'" alt="è¯·æ±‚ - åº”ç­”" style="zoom:67%;"><p>æ•°æ®è™½ç„¶æ˜¯åœ¨ A å’Œ B ä¹‹é—´ä¼ è¾“ï¼Œä½†å…è®¸ä¸­é—´æœ‰<strong>ä¸­è½¬æˆ–æ¥åŠ›</strong>ã€‚</p><p>å°±å¥½åƒç¬¬ä¸€æ’çš„åŒå­¦æƒ³ä¼ é€’çº¸æ¡ç»™æœ€åä¸€æ’çš„åŒå­¦ï¼Œé‚£ä¹ˆä¼ é€’çš„è¿‡ç¨‹ä¸­å°±éœ€è¦ç»è¿‡å¥½å¤šä¸ªåŒå­¦ï¼ˆä¸­é—´äººï¼‰ï¼Œè¿™æ ·çš„ä¼ è¾“æ–¹å¼å°±ä»ã€ŒA &lt; --- &gt; Bã€ï¼Œå˜æˆäº†ã€ŒA &lt;-&gt; N &lt;-&gt; M &lt;-&gt; Bã€ã€‚</p><p>è€Œåœ¨ HTTP é‡Œï¼Œéœ€è¦ä¸­é—´äººéµä» HTTP åè®®ï¼Œåªè¦ä¸æ‰“æ‰°åŸºæœ¬çš„æ•°æ®ä¼ è¾“ï¼Œå°±å¯ä»¥æ·»åŠ ä»»æ„é¢å¤–çš„ä¸œè¥¿ã€‚</p><p>é’ˆå¯¹<strong>ä¼ è¾“</strong>ï¼Œæˆ‘ä»¬å¯ä»¥è¿›ä¸€æ­¥ç†è§£äº† HTTPã€‚</p><p>HTTP æ˜¯ä¸€ä¸ªåœ¨è®¡ç®—æœºä¸–ç•Œé‡Œä¸“é—¨ç”¨æ¥åœ¨<strong>ä¸¤ç‚¹ä¹‹é—´ä¼ è¾“æ•°æ®</strong>çš„çº¦å®šå’Œè§„èŒƒã€‚</p><p><em>3. ã€Œè¶…æ–‡æœ¬ã€</em></p><p>HTTP ä¼ è¾“çš„å†…å®¹æ˜¯**ã€Œè¶…æ–‡æœ¬ã€**ã€‚</p><p>æˆ‘ä»¬å…ˆæ¥ç†è§£ã€Œæ–‡æœ¬ã€ï¼Œåœ¨äº’è”ç½‘æ—©æœŸçš„æ—¶å€™åªæ˜¯ç®€å•çš„å­—ç¬¦æ–‡å­—ï¼Œä½†ç°åœ¨**ã€Œæ–‡æœ¬ã€çš„æ¶µä¹‰å·²ç»å¯ä»¥æ‰©å±•ä¸ºå›¾ç‰‡ã€è§†é¢‘ã€å‹ç¼©åŒ…ç­‰**ï¼Œåœ¨ HTTP çœ¼é‡Œè¿™äº›éƒ½ç®—ä½œã€Œæ–‡æœ¬ã€ã€‚</p><p>å†æ¥ç†è§£ã€Œè¶…æ–‡æœ¬ã€ï¼Œå®ƒå°±æ˜¯<strong>è¶…è¶Šäº†æ™®é€šæ–‡æœ¬çš„æ–‡æœ¬</strong>ï¼Œå®ƒæ˜¯<strong>æ–‡å­—ã€å›¾ç‰‡ã€è§†é¢‘ç­‰çš„æ··åˆä½“</strong>ï¼Œæœ€å…³é”®æœ‰<strong>è¶…é“¾æ¥</strong>ï¼Œèƒ½ä»ä¸€ä¸ªè¶…æ–‡æœ¬<strong>è·³è½¬</strong>åˆ°å¦å¤–ä¸€ä¸ªè¶…æ–‡æœ¬ã€‚</p><p><strong>HTML å°±æ˜¯æœ€å¸¸è§çš„è¶…æ–‡æœ¬äº†</strong>ï¼Œå®ƒæœ¬èº«åªæ˜¯çº¯æ–‡å­—æ–‡ä»¶ï¼Œä½†å†…éƒ¨ç”¨å¾ˆå¤šæ ‡ç­¾å®šä¹‰äº†å›¾ç‰‡ã€è§†é¢‘ç­‰çš„é“¾æ¥ï¼Œå†ç»è¿‡<strong>æµè§ˆå™¨çš„è§£é‡Š</strong>ï¼Œå‘ˆç°ç»™æˆ‘ä»¬çš„å°±æ˜¯ä¸€ä¸ªæ–‡å­—ã€æœ‰ç”»é¢çš„ç½‘é¡µäº†ã€‚</p><p>OKï¼Œç»è¿‡äº†å¯¹ HTTP é‡Œè¿™ä¸‰ä¸ªåè¯çš„è¯¦ç»†è§£é‡Šï¼Œå°±å¯ä»¥ç»™å‡ºæ¯”ã€Œè¶…æ–‡æœ¬ä¼ è¾“åè®®ã€è¿™ä¸ƒä¸ªå­—æ›´å‡†ç¡®æ›´æœ‰æŠ€æœ¯å«é‡çš„ç­”æ¡ˆï¼š</p><p><strong>HTTP æ˜¯ä¸€ä¸ªåœ¨è®¡ç®—æœºä¸–ç•Œé‡Œä¸“é—¨åœ¨ã€Œä¸¤ç‚¹ã€ä¹‹é—´ã€Œä¼ è¾“ã€æ–‡å­—ã€å›¾ç‰‡ã€éŸ³é¢‘ã€è§†é¢‘ç­‰ã€Œè¶…æ–‡æœ¬ã€æ•°æ®çš„ã€Œçº¦å®šå’Œè§„èŒƒã€ã€‚</strong></p><blockquote><p>é‚£ã€ŒHTTP æ˜¯ç”¨äºä»äº’è”ç½‘æœåŠ¡å™¨ä¼ è¾“è¶…æ–‡æœ¬åˆ°æœ¬åœ°æµè§ˆå™¨çš„åè®®ã€ï¼Œè¿™ç§è¯´æ³•æ­£ç¡®å—ï¼Ÿ</p></blockquote><p>è¿™ç§è¯´æ³•æ˜¯<strong>ä¸æ­£ç¡®</strong>çš„ã€‚å› ä¸ºä¹Ÿå¯ä»¥æ˜¯ã€ŒæœåŠ¡å™¨&lt; -- &gt;æœåŠ¡å™¨ã€ï¼Œæ‰€ä»¥é‡‡ç”¨<strong>ä¸¤ç‚¹ä¹‹é—´</strong>çš„æè¿°ä¼šæ›´å‡†ç¡®ã€‚</p><h4 id="http-å¸¸è§çš„çŠ¶æ€ç æœ‰å“ªäº›" tabindex="-1"><a class="header-anchor" href="#http-å¸¸è§çš„çŠ¶æ€ç æœ‰å“ªäº›"><span>- HTTP å¸¸è§çš„çŠ¶æ€ç æœ‰å“ªäº›ï¼Ÿ</span></a></h4><img src="'+J+'" alt=" äº”å¤§ç±» HTTP çŠ¶æ€ç  " style="zoom:67%;"><p><code>1xx</code> ç±»çŠ¶æ€ç å±äº<strong>æç¤ºä¿¡æ¯</strong>ï¼Œæ˜¯åè®®å¤„ç†ä¸­çš„ä¸€ç§ä¸­é—´çŠ¶æ€ï¼Œå®é™…ç”¨åˆ°çš„æ¯”è¾ƒå°‘ã€‚</p><p><code>2xx</code> ç±»çŠ¶æ€ç è¡¨ç¤ºæœåŠ¡å™¨<strong>æˆåŠŸ</strong>å¤„ç†äº†å®¢æˆ·ç«¯çš„è¯·æ±‚ï¼Œä¹Ÿæ˜¯æˆ‘ä»¬æœ€æ„¿æ„çœ‹åˆ°çš„çŠ¶æ€ã€‚</p><ul><li>ã€Œ<strong>200 OK</strong>ã€æ˜¯æœ€å¸¸è§çš„æˆåŠŸçŠ¶æ€ç ï¼Œè¡¨ç¤ºä¸€åˆ‡æ­£å¸¸ã€‚å¦‚æœæ˜¯é <code>HEAD</code> è¯·æ±‚ï¼ŒæœåŠ¡å™¨è¿”å›çš„å“åº”å¤´éƒ½ä¼šæœ‰ body æ•°æ®ã€‚</li><li>ã€Œ<strong>204 No Content</strong>ã€ä¹Ÿæ˜¯å¸¸è§çš„æˆåŠŸçŠ¶æ€ç ï¼Œä¸ 200 OK åŸºæœ¬ç›¸åŒï¼Œä½†å“åº”å¤´æ²¡æœ‰ body æ•°æ®ã€‚</li><li>ã€Œ<strong>206 Partial Content</strong>ã€æ˜¯åº”ç”¨äº HTTP åˆ†å—ä¸‹è½½æˆ–æ–­ç‚¹ç»­ä¼ ï¼Œè¡¨ç¤ºå“åº”è¿”å›çš„ body æ•°æ®å¹¶ä¸æ˜¯èµ„æºçš„å…¨éƒ¨ï¼Œè€Œæ˜¯å…¶ä¸­çš„ä¸€éƒ¨åˆ†ï¼Œä¹Ÿæ˜¯æœåŠ¡å™¨å¤„ç†æˆåŠŸçš„çŠ¶æ€ã€‚</li></ul><p><code>3xx</code> ç±»çŠ¶æ€ç è¡¨ç¤º<strong>å®¢æˆ·ç«¯è¯·æ±‚çš„èµ„æºå‘ç”Ÿäº†å˜åŠ¨</strong>ï¼Œéœ€è¦å®¢æˆ·ç«¯ç”¨æ–°çš„ URL é‡æ–°å‘é€è¯·æ±‚è·å–èµ„æºï¼Œä¹Ÿå°±æ˜¯<strong>é‡å®šå‘</strong>ã€‚</p><ul><li>ã€Œ<strong>301 Moved Permanently</strong>ã€è¡¨ç¤º<strong>æ°¸ä¹…é‡å®šå‘</strong>ï¼Œè¯´æ˜è¯·æ±‚çš„èµ„æºå·²ç»ä¸å­˜åœ¨äº†ï¼Œéœ€æ”¹ç”¨æ–°çš„ URL å†æ¬¡è®¿é—®ã€‚</li><li>ã€Œ<strong>302 Found</strong>ã€è¡¨ç¤º<strong>ä¸´æ—¶é‡å®šå‘</strong>ï¼Œè¯´æ˜è¯·æ±‚çš„èµ„æºè¿˜åœ¨ï¼Œä½†æš‚æ—¶éœ€è¦ç”¨å¦ä¸€ä¸ª URL æ¥è®¿é—®ã€‚</li></ul><p>301 å’Œ 302 éƒ½ä¼šåœ¨å“åº”å¤´é‡Œä½¿ç”¨å­—æ®µ <code>Location</code>ï¼ŒæŒ‡æ˜åç»­è¦è·³è½¬çš„ URLï¼Œæµè§ˆå™¨ä¼šè‡ªåŠ¨é‡å®šå‘æ–°çš„ URLã€‚</p><ul><li>ã€Œ<strong>304 Not Modified</strong>ã€ä¸å…·æœ‰è·³è½¬çš„å«ä¹‰ï¼Œè¡¨ç¤ºèµ„æºæœªä¿®æ”¹ï¼Œé‡å®šå‘å·²å­˜åœ¨çš„ç¼“å†²æ–‡ä»¶ï¼Œä¹Ÿç§°ç¼“å­˜é‡å®šå‘ï¼Œä¹Ÿå°±æ˜¯å‘Šè¯‰å®¢æˆ·ç«¯å¯ä»¥ç»§ç»­ä½¿ç”¨ç¼“å­˜èµ„æºï¼Œç”¨äºç¼“å­˜æ§åˆ¶ã€‚</li></ul><p><code>4xx</code> ç±»çŠ¶æ€ç è¡¨ç¤ºå®¢æˆ·ç«¯å‘é€çš„<strong>æŠ¥æ–‡æœ‰è¯¯</strong>ï¼ŒæœåŠ¡å™¨æ— æ³•å¤„ç†ï¼Œä¹Ÿå°±æ˜¯<strong>é”™è¯¯ç </strong>çš„å«ä¹‰ã€‚</p><ul><li>ã€Œ<strong>400 Bad Request</strong>ã€è¡¨ç¤º<strong>å®¢æˆ·ç«¯è¯·æ±‚çš„æŠ¥æ–‡æœ‰é”™è¯¯</strong>ï¼Œä½†åªæ˜¯ä¸ªç¬¼ç»Ÿçš„é”™è¯¯ã€‚</li><li>ã€Œ<strong>403 Forbidden</strong>ã€è¡¨ç¤º**æœåŠ¡å™¨ç¦æ­¢è®¿é—®èµ„æºï¼Œ**å¹¶ä¸æ˜¯å®¢æˆ·ç«¯çš„è¯·æ±‚å‡ºé”™ã€‚</li><li>ã€Œ<strong>404 Not Found</strong>ã€è¡¨ç¤º<strong>è¯·æ±‚çš„èµ„æºåœ¨æœåŠ¡å™¨ä¸Šä¸å­˜åœ¨æˆ–æœªæ‰¾åˆ°</strong>ï¼Œæ‰€ä»¥æ— æ³•æä¾›ç»™å®¢æˆ·ç«¯ã€‚</li></ul><p><code>5xx</code> ç±»çŠ¶æ€ç è¡¨ç¤ºå®¢æˆ·ç«¯è¯·æ±‚æŠ¥æ–‡æ­£ç¡®ï¼Œä½†æ˜¯<strong>æœåŠ¡å™¨å¤„ç†æ—¶å†…éƒ¨å‘ç”Ÿäº†é”™è¯¯</strong>ï¼Œå±äºæœåŠ¡å™¨ç«¯çš„é”™è¯¯ç ã€‚</p><ul><li>ã€Œ<strong>500 Internal Server Error</strong>ã€ä¸ 400 ç±»å‹ï¼Œæ˜¯ä¸ªç¬¼ç»Ÿé€šç”¨çš„é”™è¯¯ç ï¼ŒæœåŠ¡å™¨å‘ç”Ÿäº†ä»€ä¹ˆé”™è¯¯ï¼Œæˆ‘ä»¬å¹¶ä¸çŸ¥é“ã€‚</li><li>ã€Œ<strong>501 Not Implemented</strong>ã€è¡¨ç¤ºå®¢æˆ·ç«¯è¯·æ±‚çš„åŠŸèƒ½è¿˜ä¸æ”¯æŒï¼Œç±»ä¼¼â€œå³å°†å¼€ä¸šï¼Œæ•¬è¯·æœŸå¾…â€çš„æ„æ€ã€‚</li><li>ã€Œ<strong>502 Bad Gateway</strong>ã€é€šå¸¸æ˜¯æœåŠ¡å™¨ä½œä¸ºç½‘å…³æˆ–ä»£ç†æ—¶è¿”å›çš„é”™è¯¯ç ï¼Œè¡¨ç¤ºæœåŠ¡å™¨è‡ªèº«å·¥ä½œæ­£å¸¸ï¼Œè®¿é—®åç«¯æœåŠ¡å™¨å‘ç”Ÿäº†é”™è¯¯ã€‚</li><li>ã€Œ<strong>503 Service Unavailable</strong>ã€è¡¨ç¤ºæœåŠ¡å™¨å½“å‰å¾ˆå¿™ï¼Œæš‚æ—¶æ— æ³•å“åº”å®¢æˆ·ç«¯ï¼Œç±»ä¼¼â€œç½‘ç»œæœåŠ¡æ­£å¿™ï¼Œè¯·ç¨åé‡è¯•â€çš„æ„æ€ã€‚</li><li></li></ul><h4 id="http-å¸¸è§å­—æ®µæœ‰å“ªäº›" tabindex="-1"><a class="header-anchor" href="#http-å¸¸è§å­—æ®µæœ‰å“ªäº›"><span>- HTTP å¸¸è§å­—æ®µæœ‰å“ªäº›ï¼Ÿ</span></a></h4><p><em>Host</em> å­—æ®µ</p><p>å®¢æˆ·ç«¯å‘é€è¯·æ±‚æ—¶ï¼Œç”¨æ¥æŒ‡å®šæœåŠ¡å™¨çš„åŸŸåã€‚</p><img src="'+$+`" alt="img" style="zoom:67%;"><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>Host: www.A.com
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>æœ‰äº† <code>Host</code> å­—æ®µï¼Œå°±å¯ä»¥å°†è¯·æ±‚å‘å¾€ã€ŒåŒä¸€å°ã€æœåŠ¡å™¨ä¸Šçš„ä¸åŒç½‘ç«™ã€‚</p><p><em>Content-Length å­—æ®µ</em></p><p>æœåŠ¡å™¨åœ¨è¿”å›æ•°æ®æ—¶ï¼Œä¼šæœ‰ <code>Content-Length</code> å­—æ®µï¼Œè¡¨æ˜<strong>æœ¬æ¬¡å›åº”çš„æ•°æ®é•¿åº¦</strong>ã€‚</p><img src="`+oo+`" alt="img" style="zoom:67%;"><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>Content-Length: 1000
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>å¦‚ä¸Šé¢åˆ™æ˜¯å‘Šè¯‰æµè§ˆå™¨ï¼Œæœ¬æ¬¡æœåŠ¡å™¨å›åº”çš„æ•°æ®é•¿åº¦æ˜¯ 1000 ä¸ªå­—èŠ‚ï¼Œåé¢çš„å­—èŠ‚å°±å±äºä¸‹ä¸€ä¸ªå›åº”äº†ã€‚</p><p>å¤§å®¶åº”è¯¥éƒ½çŸ¥é“ HTTP æ˜¯åŸºäº TCP ä¼ è¾“åè®®è¿›è¡Œé€šä¿¡çš„ï¼Œè€Œä½¿ç”¨äº† TCP ä¼ è¾“åè®®ï¼Œå°±ä¼šå­˜åœ¨ä¸€ä¸ªâ€œç²˜åŒ…â€çš„é—®é¢˜ï¼Œ<strong>HTTP åè®®é€šè¿‡è®¾ç½®å›è½¦ç¬¦ã€æ¢è¡Œç¬¦ä½œä¸º HTTP header çš„è¾¹ç•Œï¼Œé€šè¿‡ Content-Length å­—æ®µä½œä¸º HTTP body çš„è¾¹ç•Œï¼Œè¿™ä¸¤ä¸ªæ–¹å¼éƒ½æ˜¯ä¸ºäº†è§£å†³â€œç²˜åŒ…â€çš„é—®é¢˜</strong>ã€‚</p>`,424),Er={href:"https://xiaolincoding.com/network/3_tcp/tcp_stream.html",target:"_blank",rel:"noopener noreferrer"},wr=n('<p><em>Connection å­—æ®µ</em></p><p><code>Connection</code> å­—æ®µæœ€å¸¸ç”¨äºå®¢æˆ·ç«¯è¦æ±‚æœåŠ¡å™¨ä½¿ç”¨**ã€ŒHTTP é•¿è¿æ¥ã€**æœºåˆ¶ï¼Œä»¥ä¾¿å…¶ä»–è¯·æ±‚å¤ç”¨ã€‚</p><img src="'+to+'" alt="img" style="zoom:67%;"><p>HTTP é•¿è¿æ¥çš„ç‰¹ç‚¹æ˜¯ï¼Œåªè¦ä»»æ„ä¸€ç«¯æ²¡æœ‰æ˜ç¡®æå‡ºæ–­å¼€è¿æ¥ï¼Œåˆ™ä¿æŒ TCP è¿æ¥çŠ¶æ€ã€‚</p><img src="'+so+`" alt="HTTP é•¿è¿æ¥" style="zoom:67%;"><p>HTTP/1.1 ç‰ˆæœ¬çš„é»˜è®¤è¿æ¥éƒ½æ˜¯é•¿è¿æ¥ï¼Œä½†ä¸ºäº†å…¼å®¹è€ç‰ˆæœ¬çš„ HTTPï¼Œéœ€è¦æŒ‡å®š <code>Connection</code> é¦–éƒ¨å­—æ®µçš„å€¼ä¸º <code>Keep-Alive</code>ã€‚</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>Connection: Keep-Alive
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>å¼€å¯äº† HTTP Keep-Alive æœºåˆ¶åï¼Œ è¿æ¥å°±ä¸ä¼šä¸­æ–­ï¼Œè€Œæ˜¯ä¿æŒè¿æ¥ã€‚å½“å®¢æˆ·ç«¯å‘é€å¦ä¸€ä¸ªè¯·æ±‚æ—¶ï¼Œå®ƒä¼šä½¿ç”¨åŒä¸€ä¸ªè¿æ¥ï¼Œä¸€ç›´æŒç»­åˆ°å®¢æˆ·ç«¯æˆ–æœåŠ¡å™¨ç«¯æå‡ºæ–­å¼€è¿æ¥ã€‚</p>`,8),Kr={href:"https://xiaolincoding.com/network/3_tcp/tcp_http_keepalive.html",target:"_blank",rel:"noopener noreferrer"},Dr=n('<p><em>Content-Type å­—æ®µ</em></p><p><code>Content-Type</code> å­—æ®µç”¨äºæœåŠ¡å™¨å›åº”æ—¶ï¼Œå‘Šè¯‰å®¢æˆ·ç«¯ï¼Œæœ¬æ¬¡æ•°æ®æ˜¯ä»€ä¹ˆæ ¼å¼ã€‚</p><img src="'+eo+`" alt="img" style="zoom:67%;"><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>Content-Type: text/html; Charset=utf-8
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>ä¸Šé¢çš„ç±»å‹è¡¨æ˜ï¼Œå‘é€çš„æ˜¯ç½‘é¡µï¼Œè€Œä¸”ç¼–ç æ˜¯UTF-8ã€‚</p><p>å®¢æˆ·ç«¯è¯·æ±‚çš„æ—¶å€™ï¼Œå¯ä»¥ä½¿ç”¨ <code>Accept</code> å­—æ®µå£°æ˜è‡ªå·±å¯ä»¥æ¥å—å“ªäº›æ•°æ®æ ¼å¼ã€‚</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>Accept: */*
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>ä¸Šé¢ä»£ç ä¸­ï¼Œå®¢æˆ·ç«¯å£°æ˜è‡ªå·±å¯ä»¥æ¥å—ä»»ä½•æ ¼å¼çš„æ•°æ®ã€‚</p><p><em>Content-Encoding å­—æ®µ</em></p><p><code>Content-Encoding</code> å­—æ®µè¯´æ˜æ•°æ®çš„å‹ç¼©æ–¹æ³•ã€‚è¡¨ç¤ºæœåŠ¡å™¨è¿”å›çš„æ•°æ®ä½¿ç”¨äº†ä»€ä¹ˆå‹ç¼©æ ¼å¼</p><img src="`+no+`" alt="img" style="zoom:67%;"><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>Content-Encoding: gzip
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>ä¸Šé¢è¡¨ç¤ºæœåŠ¡å™¨è¿”å›çš„æ•°æ®é‡‡ç”¨äº† gzip æ–¹å¼å‹ç¼©ï¼Œå‘ŠçŸ¥å®¢æˆ·ç«¯éœ€è¦ç”¨æ­¤æ–¹å¼è§£å‹ã€‚</p><p>å®¢æˆ·ç«¯åœ¨è¯·æ±‚æ—¶ï¼Œç”¨ <code>Accept-Encoding</code> å­—æ®µè¯´æ˜è‡ªå·±å¯ä»¥æ¥å—å“ªäº›å‹ç¼©æ–¹æ³•ã€‚</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>Accept-Encoding: gzip, deflate
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="_3-1-2-get-ä¸-post" tabindex="-1"><a class="header-anchor" href="#_3-1-2-get-ä¸-post"><span>3.1.2 GET ä¸ POST</span></a></h3><h4 id="get-å’Œ-post-æœ‰ä»€ä¹ˆåŒºåˆ«" tabindex="-1"><a class="header-anchor" href="#get-å’Œ-post-æœ‰ä»€ä¹ˆåŒºåˆ«"><span>- GET å’Œ POST æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</span></a></h4><p>æ ¹æ® RFC è§„èŒƒï¼Œ<strong>GET çš„è¯­ä¹‰æ˜¯ä»æœåŠ¡å™¨è·å–æŒ‡å®šçš„èµ„æº</strong>ï¼Œè¿™ä¸ªèµ„æºå¯ä»¥æ˜¯é™æ€çš„æ–‡æœ¬ã€é¡µé¢ã€å›¾ç‰‡è§†é¢‘ç­‰ã€‚GET è¯·æ±‚çš„å‚æ•°ä½ç½®ä¸€èˆ¬æ˜¯å†™åœ¨ URL ä¸­ï¼ŒURL è§„å®šåªèƒ½æ”¯æŒ ASCIIï¼Œæ‰€ä»¥ GET è¯·æ±‚çš„å‚æ•°åªå…è®¸ ASCII å­—ç¬¦ ï¼Œè€Œä¸”æµè§ˆå™¨ä¼šå¯¹ URL çš„é•¿åº¦æœ‰é™åˆ¶ï¼ˆHTTPåè®®æœ¬èº«å¯¹ URLé•¿åº¦å¹¶æ²¡æœ‰åšä»»ä½•è§„å®šï¼‰ã€‚</p><p>æ¯”å¦‚ï¼Œä½ æ‰“å¼€æˆ‘çš„æ–‡ç« ï¼Œæµè§ˆå™¨å°±ä¼šå‘é€ <strong>GET è¯·æ±‚</strong>ç»™æœåŠ¡å™¨ï¼ŒæœåŠ¡å™¨å°±ä¼šè¿”å›æ–‡ç« çš„æ‰€æœ‰æ–‡å­—åŠèµ„æºã€‚</p><figure><img src="`+po+'" alt="GET è¯·æ±‚" tabindex="0" loading="lazy"><figcaption>GET è¯·æ±‚</figcaption></figure><p>æ ¹æ® RFC è§„èŒƒï¼Œ<strong>POST çš„è¯­ä¹‰æ˜¯æ ¹æ®è¯·æ±‚è´Ÿè·ï¼ˆæŠ¥æ–‡bodyï¼‰ å¯¹æŒ‡å®šçš„èµ„æºåšå‡ºå¤„ç† <strong>ï¼Œå…·ä½“çš„å¤„ç†æ–¹å¼è§†èµ„æºç±»å‹è€Œä¸åŒã€‚POST è¯·æ±‚æºå¸¦æ•°æ®çš„ä½ç½®ä¸€èˆ¬æ˜¯å†™åœ¨</strong>æŠ¥æ–‡ body ä¸­</strong>ï¼Œbody ä¸­çš„æ•°æ®å¯ä»¥æ˜¯<strong>ä»»æ„æ ¼å¼çš„æ•°æ®</strong>ï¼Œåªè¦å®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯åå•†å¥½å³å¯ï¼Œè€Œä¸”æµè§ˆå™¨ä¸ä¼šå¯¹ body å¤§å°åšé™åˆ¶ã€‚</p><p>æ¯”å¦‚ï¼Œä½ åœ¨æˆ‘æ–‡ç« åº•éƒ¨ï¼Œæ•²å…¥äº†ç•™è¨€åç‚¹å‡»ã€Œæäº¤ã€ï¼ˆ<strong>æš—ç¤ºä½ ä»¬ç•™è¨€</strong>ï¼‰ï¼Œæµè§ˆå™¨å°±ä¼šæ‰§è¡Œä¸€æ¬¡ POST è¯·æ±‚ï¼ŒæŠŠä½ çš„ç•™è¨€æ–‡å­—æ”¾è¿›äº†æŠ¥æ–‡ body é‡Œï¼Œç„¶åæ‹¼æ¥å¥½ POST è¯·æ±‚å¤´ï¼Œé€šè¿‡ TCP åè®®å‘é€ç»™æœåŠ¡å™¨ã€‚</p><figure><img src="'+ro+'" alt="POST è¯·æ±‚" tabindex="0" loading="lazy"><figcaption>POST è¯·æ±‚</figcaption></figure><h4 id="get-å’Œ-post-æ–¹æ³•éƒ½æ˜¯å®‰å…¨å’Œå¹‚ç­‰çš„å—" tabindex="-1"><a class="header-anchor" href="#get-å’Œ-post-æ–¹æ³•éƒ½æ˜¯å®‰å…¨å’Œå¹‚ç­‰çš„å—"><span>- GET å’Œ POST æ–¹æ³•éƒ½æ˜¯å®‰å…¨å’Œå¹‚ç­‰çš„å—ï¼Ÿ</span></a></h4><p>å…ˆè¯´æ˜ä¸‹å®‰å…¨å’Œå¹‚ç­‰çš„æ¦‚å¿µï¼š</p><ul><li>åœ¨ HTTP åè®®é‡Œï¼Œæ‰€è°“çš„ã€Œå®‰å…¨ã€æ˜¯æŒ‡è¯·æ±‚æ–¹æ³•ä¸ä¼šã€Œç ´åã€æœåŠ¡å™¨ä¸Šçš„èµ„æºã€‚</li><li>æ‰€è°“çš„ã€Œå¹‚ç­‰ã€ï¼Œæ„æ€æ˜¯å¤šæ¬¡æ‰§è¡Œç›¸åŒçš„æ“ä½œï¼Œç»“æœéƒ½æ˜¯ã€Œç›¸åŒã€çš„ã€‚</li></ul><p>å¦‚æœä» RFC è§„èŒƒå®šä¹‰çš„è¯­ä¹‰æ¥çœ‹ï¼š</p><ul><li><strong>GET æ–¹æ³•å°±æ˜¯å®‰å…¨ä¸”å¹‚ç­‰çš„</strong>ï¼Œå› ä¸ºå®ƒæ˜¯ã€Œåªè¯»ã€æ“ä½œï¼Œæ— è®ºæ“ä½œå¤šå°‘æ¬¡ï¼ŒæœåŠ¡å™¨ä¸Šçš„æ•°æ®éƒ½æ˜¯å®‰å…¨çš„ï¼Œä¸”æ¯æ¬¡çš„ç»“æœéƒ½æ˜¯ç›¸åŒçš„ã€‚æ‰€ä»¥ï¼Œ<strong>å¯ä»¥å¯¹ GET è¯·æ±‚çš„æ•°æ®åšç¼“å­˜ï¼Œè¿™ä¸ªç¼“å­˜å¯ä»¥åšåˆ°æµè§ˆå™¨æœ¬èº«ä¸Šï¼ˆå½»åº•é¿å…æµè§ˆå™¨å‘è¯·æ±‚ï¼‰ï¼Œä¹Ÿå¯ä»¥åšåˆ°ä»£ç†ä¸Šï¼ˆå¦‚nginxï¼‰ï¼Œè€Œä¸”åœ¨æµè§ˆå™¨ä¸­ GET è¯·æ±‚å¯ä»¥ä¿å­˜ä¸ºä¹¦ç­¾</strong>ã€‚</li><li><strong>POST</strong> å› ä¸ºæ˜¯ã€Œæ–°å¢æˆ–æäº¤æ•°æ®ã€çš„æ“ä½œï¼Œä¼šä¿®æ”¹æœåŠ¡å™¨ä¸Šçš„èµ„æºï¼Œæ‰€ä»¥æ˜¯<strong>ä¸å®‰å…¨</strong>çš„ï¼Œä¸”å¤šæ¬¡æäº¤æ•°æ®å°±ä¼šåˆ›å»ºå¤šä¸ªèµ„æºï¼Œæ‰€ä»¥<strong>ä¸æ˜¯å¹‚ç­‰</strong>çš„ã€‚æ‰€ä»¥ï¼Œ<strong>æµè§ˆå™¨ä¸€èˆ¬ä¸ä¼šç¼“å­˜ POST è¯·æ±‚ï¼Œä¹Ÿä¸èƒ½æŠŠ POST è¯·æ±‚ä¿å­˜ä¸ºä¹¦ç­¾</strong>ã€‚</li></ul><p>åšä¸ªç®€è¦çš„å°ç»“ã€‚</p><p>GET çš„è¯­ä¹‰æ˜¯è¯·æ±‚è·å–æŒ‡å®šçš„èµ„æºã€‚GET æ–¹æ³•æ˜¯å®‰å…¨ã€å¹‚ç­‰ã€å¯è¢«ç¼“å­˜çš„ã€‚</p><p>POST çš„è¯­ä¹‰æ˜¯æ ¹æ®è¯·æ±‚è´Ÿè·ï¼ˆæŠ¥æ–‡ä¸»ä½“ï¼‰å¯¹æŒ‡å®šçš„èµ„æºåšå‡ºå¤„ç†ï¼Œå…·ä½“çš„å¤„ç†æ–¹å¼è§†èµ„æºç±»å‹è€Œä¸åŒã€‚POST ä¸å®‰å…¨ï¼Œä¸å¹‚ç­‰ï¼Œï¼ˆå¤§éƒ¨åˆ†å®ç°ï¼‰ä¸å¯ç¼“å­˜ã€‚</p><p>æ³¨æ„ï¼Œ ä¸Šé¢æ˜¯ä» RFC è§„èŒƒå®šä¹‰çš„è¯­ä¹‰æ¥åˆ†æçš„ã€‚</p><p>ä½†æ˜¯å®é™…è¿‡ç¨‹ä¸­ï¼Œå¼€å‘è€…ä¸ä¸€å®šä¼šæŒ‰ç…§ RFC è§„èŒƒå®šä¹‰çš„è¯­ä¹‰æ¥å®ç° GET å’Œ POST æ–¹æ³•ã€‚æ¯”å¦‚ï¼š</p><ul><li>å¯ä»¥ç”¨ GET æ–¹æ³•å®ç°æ–°å¢æˆ–åˆ é™¤æ•°æ®çš„è¯·æ±‚ï¼Œè¿™æ ·å®ç°çš„ GET æ–¹æ³•è‡ªç„¶å°±ä¸æ˜¯å®‰å…¨å’Œå¹‚ç­‰ã€‚</li><li>å¯ä»¥ç”¨ POST æ–¹æ³•å®ç°æŸ¥è¯¢æ•°æ®çš„è¯·æ±‚ï¼Œè¿™æ ·å®ç°çš„ POST æ–¹æ³•è‡ªç„¶å°±æ˜¯å®‰å…¨å’Œå¹‚ç­‰ã€‚</li></ul><p>æ›¾ç»æœ‰ä¸ªç¬‘è¯ï¼Œæœ‰äººå†™äº†ä¸ªåšå®¢ï¼Œåˆ é™¤åšå®¢ç”¨çš„æ˜¯ GET è¯·æ±‚ï¼Œä»–è§‰å¾—æ²¡äººè®¿é—®å°±è¿é‰´æƒéƒ½æ²¡åšã€‚ç„¶å Google æœåŠ¡å™¨çˆ¬è™«çˆ¬äº†ä¸€éï¼Œä»–æ‰€æœ‰åšæ–‡å°±æ²¡äº†ã€‚ã€‚ã€‚</p><p>å¦‚æœã€Œå®‰å…¨ã€æ”¾å…¥æ¦‚å¿µæ˜¯æŒ‡ä¿¡æ¯æ˜¯å¦ä¼šè¢«æ³„æ¼çš„è¯ï¼Œè™½ç„¶ POST ç”¨ body ä¼ è¾“æ•°æ®ï¼Œè€Œ GET ç”¨ URL ä¼ è¾“ï¼Œè¿™æ ·æ•°æ®ä¼šåœ¨æµè§ˆå™¨åœ°å€æ‹¦å®¹æ˜“çœ‹åˆ°ï¼Œä½†æ˜¯å¹¶ä¸èƒ½è¯´ GET ä¸å¦‚ POST å®‰å…¨çš„ã€‚</p><p>å› ä¸º HTTP ä¼ è¾“çš„å†…å®¹éƒ½æ˜¯æ˜æ–‡çš„ï¼Œè™½ç„¶åœ¨æµè§ˆå™¨åœ°å€æ‹¦çœ‹ä¸åˆ° POST æäº¤çš„ body æ•°æ®ï¼Œä½†æ˜¯åªè¦æŠ“ä¸ªåŒ…å°±éƒ½èƒ½çœ‹åˆ°äº†ã€‚</p><p>æ‰€ä»¥ï¼Œè¦é¿å…ä¼ è¾“è¿‡ç¨‹ä¸­æ•°æ®è¢«çªƒå–ï¼Œå°±è¦ä½¿ç”¨ HTTPS åè®®ï¼Œè¿™æ ·æ‰€æœ‰ HTTP çš„æ•°æ®éƒ½ä¼šè¢«åŠ å¯†ä¼ è¾“ã€‚</p><blockquote><p>GET è¯·æ±‚å¯ä»¥å¸¦ body å—ï¼Ÿ</p></blockquote><p>RFC è§„èŒƒå¹¶æ²¡æœ‰è§„å®š GET è¯·æ±‚ä¸èƒ½å¸¦ body çš„ã€‚ç†è®ºä¸Šï¼Œä»»ä½•è¯·æ±‚éƒ½å¯ä»¥å¸¦ body çš„ã€‚åªæ˜¯å› ä¸º RFC è§„èŒƒå®šä¹‰çš„ GET è¯·æ±‚æ˜¯è·å–èµ„æºï¼Œæ‰€ä»¥æ ¹æ®è¿™ä¸ªè¯­ä¹‰ä¸éœ€è¦ç”¨åˆ° bodyã€‚</p><p>å¦å¤–ï¼ŒURL ä¸­çš„æŸ¥è¯¢å‚æ•°ä¹Ÿä¸æ˜¯ GET æ‰€ç‹¬æœ‰çš„ï¼ŒPOST è¯·æ±‚çš„ URL ä¸­ä¹Ÿå¯ä»¥æœ‰å‚æ•°çš„ã€‚</p><h3 id="_3-1-3-http-ç¼“å­˜æŠ€æœ¯" tabindex="-1"><a class="header-anchor" href="#_3-1-3-http-ç¼“å­˜æŠ€æœ¯"><span>3.1.3 HTTP ç¼“å­˜æŠ€æœ¯</span></a></h3><h4 id="http-ç¼“å­˜æœ‰å“ªäº›å®ç°æ–¹å¼" tabindex="-1"><a class="header-anchor" href="#http-ç¼“å­˜æœ‰å“ªäº›å®ç°æ–¹å¼"><span>- HTTP ç¼“å­˜æœ‰å“ªäº›å®ç°æ–¹å¼ï¼Ÿ</span></a></h4><p>å¯¹äºä¸€äº›<strong>å…·æœ‰é‡å¤æ€§çš„ HTTP è¯·æ±‚</strong>ï¼Œæ¯”å¦‚æ¯æ¬¡è¯·æ±‚å¾—åˆ°çš„<strong>æ•°æ®éƒ½ä¸€æ ·çš„</strong>ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠè¿™å¯¹ã€Œè¯·æ±‚-å“åº”ã€çš„æ•°æ®éƒ½<strong>ç¼“å­˜åœ¨æœ¬åœ°</strong>ï¼Œé‚£ä¹ˆä¸‹æ¬¡å°±ç›´æ¥è¯»å–æœ¬åœ°çš„æ•°æ®ï¼Œä¸å¿…åœ¨é€šè¿‡ç½‘ç»œè·å–æœåŠ¡å™¨çš„å“åº”äº†ï¼Œè¿™æ ·çš„è¯ HTTP/1.1 çš„æ€§èƒ½è‚¯å®šè‚‰çœ¼å¯è§çš„æå‡ã€‚</p><p>æ‰€ä»¥ï¼Œé¿å…å‘é€ HTTP è¯·æ±‚çš„æ–¹æ³•å°±æ˜¯é€šè¿‡<strong>ç¼“å­˜æŠ€æœ¯</strong>ï¼ŒHTTP è®¾è®¡è€…æ—©åœ¨ä¹‹å‰å°±è€ƒè™‘åˆ°äº†è¿™ç‚¹ï¼Œå› æ­¤ HTTP åè®®çš„å¤´éƒ¨æœ‰ä¸å°‘æ˜¯é’ˆå¯¹ç¼“å­˜çš„å­—æ®µã€‚</p><p>HTTP ç¼“å­˜æœ‰ä¸¤ç§å®ç°æ–¹å¼ï¼Œåˆ†åˆ«æ˜¯<strong>å¼ºåˆ¶ç¼“å­˜å’Œåå•†ç¼“å­˜</strong>ã€‚</p><h4 id="ä»€ä¹ˆæ˜¯å¼ºåˆ¶ç¼“å­˜" tabindex="-1"><a class="header-anchor" href="#ä»€ä¹ˆæ˜¯å¼ºåˆ¶ç¼“å­˜"><span>- ä»€ä¹ˆæ˜¯å¼ºåˆ¶ç¼“å­˜ï¼Ÿ</span></a></h4><p>å¼ºç¼“å­˜æŒ‡çš„æ˜¯åªè¦<strong>æµè§ˆå™¨åˆ¤æ–­ç¼“å­˜æ²¡æœ‰è¿‡æœŸ</strong>ï¼Œåˆ™ç›´æ¥ä½¿ç”¨æµè§ˆå™¨çš„æœ¬åœ°ç¼“å­˜ï¼Œå†³å®šæ˜¯å¦ä½¿ç”¨ç¼“å­˜çš„ä¸»åŠ¨æ€§åœ¨äºæµè§ˆå™¨è¿™è¾¹ã€‚</p><p>å¦‚ä¸‹å›¾ä¸­ï¼Œè¿”å›çš„æ˜¯ 200 çŠ¶æ€ç ï¼Œä½†åœ¨ size é¡¹ä¸­æ ‡è¯†çš„æ˜¯ from disk cacheï¼Œå°±æ˜¯ä½¿ç”¨äº†å¼ºåˆ¶ç¼“å­˜ã€‚</p><img src="'+io+'" alt="img" style="zoom:67%;"><p>å¼ºç¼“å­˜æ˜¯åˆ©ç”¨ä¸‹é¢è¿™ä¸¤ä¸ª HTTP å“åº”å¤´éƒ¨ï¼ˆResponse Headerï¼‰å­—æ®µå®ç°çš„ï¼Œå®ƒä»¬éƒ½ç”¨æ¥è¡¨ç¤ºèµ„æºåœ¨å®¢æˆ·ç«¯ç¼“å­˜çš„æœ‰æ•ˆæœŸï¼š</p><ul><li><code>Cache-Control</code>ï¼Œ æ˜¯ä¸€ä¸ªç›¸å¯¹æ—¶é—´ï¼›</li><li><code>Expires</code>ï¼Œæ˜¯ä¸€ä¸ªç»å¯¹æ—¶é—´ï¼›</li></ul><p>å¦‚æœ HTTP å“åº”å¤´éƒ¨åŒæ—¶æœ‰ Cache-Control å’Œ Expires å­—æ®µçš„è¯ï¼Œ<strong>Cache-Control çš„ä¼˜å…ˆçº§é«˜äº Expires</strong> ã€‚</p><p>Cache-control é€‰é¡¹æ›´å¤šä¸€äº›ï¼Œè®¾ç½®æ›´åŠ ç²¾ç»†ï¼Œæ‰€ä»¥å»ºè®®ä½¿ç”¨ Cache-Control æ¥å®ç°å¼ºç¼“å­˜ã€‚å…·ä½“çš„å®ç°æµç¨‹å¦‚ä¸‹ï¼š</p><ul><li>å½“æµè§ˆå™¨ç¬¬ä¸€æ¬¡è¯·æ±‚è®¿é—®æœåŠ¡å™¨èµ„æºæ—¶ï¼ŒæœåŠ¡å™¨ä¼šåœ¨è¿”å›è¿™ä¸ªèµ„æºçš„åŒæ—¶ï¼Œåœ¨ Response å¤´éƒ¨åŠ ä¸Š Cache-Controlï¼ŒCache-Control ä¸­è®¾ç½®äº†è¿‡æœŸæ—¶é—´å¤§å°ï¼›</li><li>æµè§ˆå™¨å†æ¬¡è¯·æ±‚è®¿é—®æœåŠ¡å™¨ä¸­çš„è¯¥èµ„æºæ—¶ï¼Œä¼šå…ˆ<strong>é€šè¿‡è¯·æ±‚èµ„æºçš„æ—¶é—´ä¸ Cache-Control ä¸­è®¾ç½®çš„è¿‡æœŸæ—¶é—´å¤§å°ï¼Œæ¥è®¡ç®—å‡ºè¯¥èµ„æºæ˜¯å¦è¿‡æœŸ</strong>ï¼Œå¦‚æœæ²¡æœ‰ï¼Œåˆ™ä½¿ç”¨è¯¥ç¼“å­˜ï¼Œå¦åˆ™é‡æ–°è¯·æ±‚æœåŠ¡å™¨ï¼›</li><li>æœåŠ¡å™¨å†æ¬¡æ”¶åˆ°è¯·æ±‚åï¼Œä¼šå†æ¬¡æ›´æ–° Response å¤´éƒ¨çš„ Cache-Controlã€‚</li></ul><h4 id="ä»€ä¹ˆæ˜¯åå•†ç¼“å­˜" tabindex="-1"><a class="header-anchor" href="#ä»€ä¹ˆæ˜¯åå•†ç¼“å­˜"><span>- ä»€ä¹ˆæ˜¯åå•†ç¼“å­˜ï¼Ÿ</span></a></h4><p>å½“æˆ‘ä»¬åœ¨æµè§ˆå™¨ä½¿ç”¨å¼€å‘è€…å·¥å…·çš„æ—¶å€™ï¼Œä½ å¯èƒ½ä¼šçœ‹åˆ°è¿‡æŸäº›è¯·æ±‚çš„å“åº”ç æ˜¯ <code>304</code>ï¼Œè¿™ä¸ªæ˜¯å‘Šè¯‰æµè§ˆå™¨å¯ä»¥ä½¿ç”¨æœ¬åœ°ç¼“å­˜çš„èµ„æºï¼Œé€šå¸¸è¿™ç§<strong>é€šè¿‡æœåŠ¡ç«¯å‘ŠçŸ¥å®¢æˆ·ç«¯æ˜¯å¦å¯ä»¥ä½¿ç”¨ç¼“å­˜</strong>çš„æ–¹å¼è¢«ç§°ä¸º<strong>åå•†ç¼“å­˜</strong>ã€‚</p><img src="'+go+'" alt="img" style="zoom:67%;"><p>ä¸Šå›¾å°±æ˜¯ä¸€ä¸ª<strong>åå•†ç¼“å­˜</strong>çš„è¿‡ç¨‹ï¼Œæ‰€ä»¥<strong>åå•†ç¼“å­˜å°±æ˜¯ä¸æœåŠ¡ç«¯åå•†ä¹‹åï¼Œé€šè¿‡åå•†ç»“æœæ¥åˆ¤æ–­æ˜¯å¦ä½¿ç”¨æœ¬åœ°ç¼“å­˜</strong>ã€‚</p><p>åå•†ç¼“å­˜å¯ä»¥åŸºäºä¸¤ç§å¤´éƒ¨æ¥å®ç°ã€‚</p><p>ç¬¬ä¸€ç§ï¼šè¯·æ±‚å¤´éƒ¨ä¸­çš„ <code>If-Modified-Since</code> å­—æ®µä¸å“åº”å¤´éƒ¨ä¸­çš„ <code>Last-Modified</code> å­—æ®µå®ç°ï¼Œè¿™ä¸¤ä¸ªå­—æ®µçš„æ„æ€æ˜¯ï¼š</p><ul><li>å“åº”å¤´éƒ¨ä¸­çš„ <code>Last-Modified</code>ï¼šæ ‡ç¤ºè¿™ä¸ªå“åº”èµ„æºçš„æœ€åä¿®æ”¹æ—¶é—´ï¼›</li><li>è¯·æ±‚å¤´éƒ¨ä¸­çš„ <code>If-Modified-Since</code>ï¼šå½“èµ„æºè¿‡æœŸäº†ï¼Œå‘ç°å“åº”å¤´ä¸­å…·æœ‰ Last-Modified å£°æ˜ï¼Œåˆ™å†æ¬¡å‘èµ·è¯·æ±‚çš„æ—¶å€™å¸¦ä¸Š Last-Modified çš„æ—¶é—´ï¼ŒæœåŠ¡å™¨æ”¶åˆ°è¯·æ±‚åå‘ç°æœ‰ If-Modified-Since åˆ™ä¸è¢«è¯·æ±‚èµ„æºçš„æœ€åä¿®æ”¹æ—¶é—´è¿›è¡Œå¯¹æ¯”ï¼ˆLast-Modifiedï¼‰ï¼Œå¦‚æœæœ€åä¿®æ”¹æ—¶é—´è¾ƒæ–°ï¼ˆå¤§ï¼‰ï¼Œè¯´æ˜èµ„æºåˆè¢«æ”¹è¿‡ï¼Œåˆ™è¿”å›æœ€æ–°èµ„æºï¼ŒHTTP 200 OKï¼›å¦‚æœæœ€åä¿®æ”¹æ—¶é—´è¾ƒæ—§ï¼ˆå°ï¼‰ï¼Œè¯´æ˜èµ„æºæ— æ–°ä¿®æ”¹ï¼Œå“åº” HTTP 304 èµ°ç¼“å­˜ã€‚</li></ul><p>ç¬¬äºŒç§ï¼šè¯·æ±‚å¤´éƒ¨ä¸­çš„ <code>If-None-Match</code> å­—æ®µä¸å“åº”å¤´éƒ¨ä¸­çš„ <code>ETag</code> å­—æ®µï¼Œè¿™ä¸¤ä¸ªå­—æ®µçš„æ„æ€æ˜¯ï¼š</p><ul><li>å“åº”å¤´éƒ¨ä¸­ <code>Etag</code>ï¼šå”¯ä¸€æ ‡è¯†å“åº”èµ„æºï¼›</li><li>è¯·æ±‚å¤´éƒ¨ä¸­çš„ <code>If-None-Match</code>ï¼šå½“èµ„æºè¿‡æœŸæ—¶ï¼Œæµè§ˆå™¨å‘ç°å“åº”å¤´é‡Œæœ‰ Etagï¼Œåˆ™å†æ¬¡å‘æœåŠ¡å™¨å‘èµ·è¯·æ±‚æ—¶ï¼Œä¼šå°†è¯·æ±‚å¤´ If-None-Match å€¼è®¾ç½®ä¸º Etag çš„å€¼ã€‚æœåŠ¡å™¨æ”¶åˆ°è¯·æ±‚åè¿›è¡Œæ¯”å¯¹ï¼Œå¦‚æœèµ„æºæ²¡æœ‰å˜åŒ–è¿”å› 304ï¼Œå¦‚æœèµ„æºå˜åŒ–äº†è¿”å› 200ã€‚</li></ul><p>ç¬¬ä¸€ç§å®ç°æ–¹å¼æ˜¯åŸºäºæ—¶é—´å®ç°çš„ï¼Œç¬¬äºŒç§å®ç°æ–¹å¼æ˜¯åŸºäºä¸€ä¸ªå”¯ä¸€æ ‡è¯†å®ç°çš„ï¼Œç›¸å¯¹æ¥è¯´åè€…å¯ä»¥æ›´åŠ å‡†ç¡®åœ°åˆ¤æ–­æ–‡ä»¶å†…å®¹æ˜¯å¦è¢«ä¿®æ”¹ï¼Œé¿å…ç”±äºæ—¶é—´ç¯¡æ”¹å¯¼è‡´çš„ä¸å¯é é—®é¢˜ã€‚</p><p>å¦‚æœåœ¨ç¬¬ä¸€æ¬¡è¯·æ±‚èµ„æºçš„æ—¶å€™ï¼ŒæœåŠ¡ç«¯è¿”å›çš„ HTTP å“åº”å¤´éƒ¨åŒæ—¶æœ‰ Etag å’Œ Last-Modified å­—æ®µï¼Œé‚£ä¹ˆå®¢æˆ·ç«¯å†ä¸‹ä¸€æ¬¡è¯·æ±‚çš„æ—¶å€™ï¼Œå¦‚æœå¸¦ä¸Šäº† ETag å’Œ Last-Modified å­—æ®µä¿¡æ¯ç»™æœåŠ¡ç«¯ï¼Œ<strong>è¿™æ—¶ Etag çš„ä¼˜å…ˆçº§æ›´é«˜</strong>ï¼Œä¹Ÿå°±æ˜¯æœåŠ¡ç«¯å…ˆä¼šåˆ¤æ–­ Etag æ˜¯å¦å˜åŒ–äº†ï¼Œå¦‚æœ Etag æœ‰å˜åŒ–å°±ä¸ç”¨åœ¨åˆ¤æ–­ Last-Modified äº†ï¼Œå¦‚æœ Etag æ²¡æœ‰å˜åŒ–ï¼Œç„¶åå†çœ‹ Last-Modifiedã€‚</p><p>**ä¸ºä»€ä¹ˆ ETag çš„ä¼˜å…ˆçº§æ›´é«˜ï¼Ÿ**è¿™æ˜¯å› ä¸º ETag ä¸»è¦èƒ½è§£å†³ Last-Modified å‡ ä¸ªæ¯”è¾ƒéš¾ä»¥è§£å†³çš„é—®é¢˜ï¼š</p><ol><li>åœ¨æ²¡æœ‰ä¿®æ”¹æ–‡ä»¶å†…å®¹æƒ…å†µä¸‹æ–‡ä»¶çš„æœ€åä¿®æ”¹æ—¶é—´å¯èƒ½ä¹Ÿä¼šæ”¹å˜ï¼Œè¿™ä¼šå¯¼è‡´å®¢æˆ·ç«¯è®¤ä¸ºè¿™æ–‡ä»¶è¢«æ”¹åŠ¨äº†ï¼Œä»è€Œé‡æ–°è¯·æ±‚ï¼›</li><li>å¯èƒ½æœ‰äº›æ–‡ä»¶æ˜¯åœ¨ç§’çº§ä»¥å†…ä¿®æ”¹çš„ï¼Œ<code>If-Modified-Since</code> èƒ½æ£€æŸ¥åˆ°çš„ç²’åº¦æ˜¯ç§’çº§çš„ï¼Œä½¿ç”¨ Etagå°±èƒ½å¤Ÿä¿è¯è¿™ç§éœ€æ±‚ä¸‹å®¢æˆ·ç«¯åœ¨ 1 ç§’å†…èƒ½åˆ·æ–°å¤šæ¬¡ï¼›</li><li>æœ‰äº›æœåŠ¡å™¨ä¸èƒ½ç²¾ç¡®è·å–æ–‡ä»¶çš„æœ€åä¿®æ”¹æ—¶é—´ã€‚</li></ol><p>æ³¨æ„ï¼Œ<strong>åå•†ç¼“å­˜è¿™ä¸¤ä¸ªå­—æ®µéƒ½éœ€è¦é…åˆå¼ºåˆ¶ç¼“å­˜ä¸­ Cache-Control å­—æ®µæ¥ä½¿ç”¨ï¼Œåªæœ‰åœ¨æœªèƒ½å‘½ä¸­å¼ºåˆ¶ç¼“å­˜çš„æ—¶å€™ï¼Œæ‰èƒ½å‘èµ·å¸¦æœ‰åå•†ç¼“å­˜å­—æ®µçš„è¯·æ±‚</strong>ã€‚</p><p>ä¸‹å›¾æ˜¯å¼ºåˆ¶ç¼“å­˜å’Œåå•†ç¼“å­˜çš„å·¥ä½œæµç¨‹ï¼š</p><img src="'+ao+'" alt="img" style="zoom:67%;"><p>å½“ä½¿ç”¨ ETag å­—æ®µå®ç°çš„åå•†ç¼“å­˜çš„è¿‡ç¨‹ï¼š</p><ul><li><p>å½“æµè§ˆå™¨ç¬¬ä¸€æ¬¡è¯·æ±‚è®¿é—®æœåŠ¡å™¨èµ„æºæ—¶ï¼ŒæœåŠ¡å™¨ä¼šåœ¨è¿”å›è¿™ä¸ªèµ„æºçš„åŒæ—¶ï¼Œåœ¨ Response å¤´éƒ¨åŠ ä¸Š ETag å”¯ä¸€æ ‡è¯†ï¼Œè¿™ä¸ªå”¯ä¸€æ ‡è¯†çš„å€¼æ˜¯æ ¹æ®å½“å‰è¯·æ±‚çš„èµ„æºç”Ÿæˆçš„ï¼›</p></li><li><p>å½“æµè§ˆå™¨å†æ¬¡è¯·æ±‚è®¿é—®æœåŠ¡å™¨ä¸­çš„è¯¥èµ„æºæ—¶ï¼Œé¦–å…ˆä¼šå…ˆæ£€æŸ¥å¼ºåˆ¶ç¼“å­˜æ˜¯å¦è¿‡æœŸï¼š</p><ul><li>å¦‚æœæ²¡æœ‰è¿‡æœŸï¼Œåˆ™ç›´æ¥ä½¿ç”¨æœ¬åœ°ç¼“å­˜ï¼›</li><li>å¦‚æœç¼“å­˜è¿‡æœŸäº†ï¼Œä¼šåœ¨ Request å¤´éƒ¨åŠ ä¸Š If-None-Match å­—æ®µï¼Œè¯¥å­—æ®µçš„å€¼å°±æ˜¯ ETag å”¯ä¸€æ ‡è¯†ï¼›</li></ul></li><li><p>æœåŠ¡å™¨å†æ¬¡æ”¶åˆ°è¯·æ±‚åï¼Œ</p><p>ä¼šæ ¹æ®è¯·æ±‚ä¸­çš„ If-None-Match å€¼ä¸å½“å‰è¯·æ±‚çš„èµ„æºç”Ÿæˆçš„å”¯ä¸€æ ‡è¯†è¿›è¡Œæ¯”è¾ƒ</p><p>ï¼š</p><ul><li><strong>å¦‚æœå€¼ç›¸ç­‰ï¼Œåˆ™è¿”å› 304 Not Modifiedï¼Œä¸ä¼šè¿”å›èµ„æº</strong>ï¼›</li><li>å¦‚æœä¸ç›¸ç­‰ï¼Œåˆ™è¿”å› 200 çŠ¶æ€ç å’Œè¿”å›èµ„æºï¼Œå¹¶åœ¨ Response å¤´éƒ¨åŠ ä¸Šæ–°çš„ ETag å”¯ä¸€æ ‡è¯†ï¼›</li></ul></li><li><p>å¦‚æœæµè§ˆå™¨æ”¶åˆ° 304 çš„è¯·æ±‚å“åº”çŠ¶æ€ç ï¼Œåˆ™ä¼šä»æœ¬åœ°ç¼“å­˜ä¸­åŠ è½½èµ„æºï¼Œå¦åˆ™æ›´æ–°èµ„æºã€‚</p></li></ul><h3 id="_3-1-4-http-ç‰¹æ€§" tabindex="-1"><a class="header-anchor" href="#_3-1-4-http-ç‰¹æ€§"><span>3.1.4 <mark>HTTP ç‰¹æ€§</mark></span></a></h3><p>åˆ°ç›®å‰ä¸ºæ­¢ï¼ŒHTTP å¸¸è§åˆ°ç‰ˆæœ¬æœ‰ HTTP/1.1ï¼ŒHTTP/2.0ï¼ŒHTTP/3.0ï¼Œä¸åŒç‰ˆæœ¬çš„ HTTP ç‰¹æ€§æ˜¯ä¸ä¸€æ ·çš„ã€‚</p><p>è¿™é‡Œå…ˆç”¨ HTTP/1.1 ç‰ˆæœ¬ç»™å¤§å®¶ä»‹ç»ï¼Œå…¶ä»–ç‰ˆæœ¬çš„åç»­ä¹Ÿä¼šä»‹ç»ã€‚</p><h4 id="http-1-1-çš„ä¼˜ç‚¹æœ‰å“ªäº›" tabindex="-1"><a class="header-anchor" href="#http-1-1-çš„ä¼˜ç‚¹æœ‰å“ªäº›"><span>- HTTP/1.1 çš„ä¼˜ç‚¹æœ‰å“ªäº›ï¼Ÿ</span></a></h4><p>HTTP æœ€çªå‡ºçš„ä¼˜ç‚¹æ˜¯ã€Œç®€å•ã€çµæ´»å’Œæ˜“äºæ‰©å±•ã€åº”ç”¨å¹¿æ³›å’Œè·¨å¹³å°ã€ã€‚</p><p><em>1. ç®€å•</em></p><p>HTTP åŸºæœ¬çš„æŠ¥æ–‡æ ¼å¼å°±æ˜¯ <code>header + body</code>ï¼Œå¤´éƒ¨ä¿¡æ¯ä¹Ÿæ˜¯ <code>key-value</code> ç®€å•æ–‡æœ¬çš„å½¢å¼ï¼Œ<strong>æ˜“äºç†è§£</strong>ï¼Œé™ä½äº†å­¦ä¹ å’Œä½¿ç”¨çš„é—¨æ§›ã€‚</p><p><em>2. çµæ´»å’Œæ˜“äºæ‰©å±•</em></p><p>HTTP åè®®é‡Œçš„å„ç±»è¯·æ±‚æ–¹æ³•ã€URI/URLã€çŠ¶æ€ç ã€å¤´å­—æ®µç­‰æ¯ä¸ªç»„æˆè¦æ±‚éƒ½æ²¡æœ‰è¢«å›ºå®šæ­»ï¼Œéƒ½å…è®¸å¼€å‘äººå‘˜<strong>è‡ªå®šä¹‰å’Œæ‰©å……</strong>ã€‚</p><p>åŒæ—¶ HTTP ç”±äºæ˜¯å·¥ä½œåœ¨åº”ç”¨å±‚ï¼ˆ <code>OSI</code> ç¬¬ä¸ƒå±‚ï¼‰ï¼Œåˆ™å®ƒ<strong>ä¸‹å±‚å¯ä»¥éšæ„å˜åŒ–</strong>ï¼Œæ¯”å¦‚ï¼š</p><ul><li>HTTPS å°±æ˜¯åœ¨ HTTP ä¸ TCP å±‚ä¹‹é—´å¢åŠ äº† SSL/TLS å®‰å…¨ä¼ è¾“å±‚ï¼›</li><li><strong>HTTP/1.1 å’Œ HTTP/2.0 ä¼ è¾“åè®®</strong>ä½¿ç”¨çš„æ˜¯ <strong>TCP åè®®</strong>ï¼Œè€Œåˆ°äº† <strong>HTTP/3.0 ä¼ è¾“åè®®æ”¹ç”¨äº† UDP åè®®</strong>ã€‚</li></ul><p><em>3. åº”ç”¨å¹¿æ³›å’Œè·¨å¹³å°</em></p><p>äº’è”ç½‘å‘å±•è‡³ä»Šï¼ŒHTTP çš„åº”ç”¨èŒƒå›´éå¸¸çš„å¹¿æ³›ï¼Œä»å°å¼æœºçš„æµè§ˆå™¨åˆ°æ‰‹æœºä¸Šçš„å„ç§ APPï¼Œä»çœ‹æ–°é—»ã€åˆ·è´´å§åˆ°è´­ç‰©ã€ç†è´¢ã€åƒé¸¡ï¼ŒHTTP çš„åº”ç”¨éåœ°å¼€èŠ±ï¼ŒåŒæ—¶å¤©ç„¶å…·æœ‰<strong>è·¨å¹³å°</strong>çš„ä¼˜è¶Šæ€§ã€‚</p><h4 id="http-1-1-çš„ç¼ºç‚¹æœ‰å“ªäº›" tabindex="-1"><a class="header-anchor" href="#http-1-1-çš„ç¼ºç‚¹æœ‰å“ªäº›"><span>- HTTP/1.1 çš„ç¼ºç‚¹æœ‰å“ªäº›ï¼Ÿ</span></a></h4><p>HTTP åè®®é‡Œæœ‰ä¼˜ç¼ºç‚¹ä¸€ä½“çš„<strong>åŒåˆƒå‰‘</strong>ï¼Œåˆ†åˆ«æ˜¯ã€Œæ— çŠ¶æ€ã€æ˜æ–‡ä¼ è¾“ã€ï¼ŒåŒæ—¶è¿˜æœ‰ä¸€å¤§ç¼ºç‚¹ã€Œä¸å®‰å…¨ã€ã€‚</p><p><em>1. æ— çŠ¶æ€åŒåˆƒå‰‘</em></p><p>æ— çŠ¶æ€çš„<strong>å¥½å¤„</strong>ï¼Œå› ä¸ºæœåŠ¡å™¨ä¸ä¼šå»è®°å¿† HTTP çš„çŠ¶æ€ï¼Œæ‰€ä»¥ä¸éœ€è¦é¢å¤–çš„èµ„æºæ¥è®°å½•çŠ¶æ€ä¿¡æ¯ï¼Œè¿™èƒ½å‡è½»æœåŠ¡å™¨çš„è´Ÿæ‹…ï¼Œèƒ½å¤ŸæŠŠæ›´å¤šçš„ CPU å’Œå†…å­˜ç”¨æ¥å¯¹å¤–æä¾›æœåŠ¡ã€‚</p><p>æ— çŠ¶æ€çš„<strong>åå¤„</strong>ï¼Œæ—¢ç„¶æœåŠ¡å™¨<strong>æ²¡æœ‰è®°å¿†èƒ½åŠ›</strong>ï¼Œå®ƒåœ¨å®Œæˆæœ‰<strong>å…³è”æ€§çš„æ“ä½œæ—¶ä¼šéå¸¸éº»çƒ¦</strong>ã€‚</p><p>ä¾‹å¦‚ç™»å½•-&gt;æ·»åŠ è´­ç‰©è½¦-&gt;ä¸‹å•-&gt;ç»“ç®—-&gt;æ”¯ä»˜ï¼Œè¿™ç³»åˆ—æ“ä½œéƒ½è¦çŸ¥é“ç”¨æˆ·çš„èº«ä»½æ‰è¡Œã€‚ä½†æœåŠ¡å™¨ä¸çŸ¥é“è¿™äº›è¯·æ±‚æ˜¯æœ‰å…³è”çš„ï¼Œæ¯æ¬¡éƒ½è¦é—®ä¸€éèº«ä»½ä¿¡æ¯ã€‚</p><p><strong>è¿™æ ·æ¯æ“ä½œä¸€æ¬¡ï¼Œéƒ½è¦éªŒè¯ä¿¡æ¯</strong>ï¼Œè¿™æ ·çš„è´­ç‰©ä½“éªŒè¿˜èƒ½æ„‰å¿«å—ï¼Ÿåˆ«é—®ï¼Œé—®å°±æ˜¯<strong>é…¸çˆ½</strong>ï¼</p><p>å¯¹äºæ— çŠ¶æ€çš„é—®é¢˜ï¼Œè§£æ³•æ–¹æ¡ˆæœ‰å¾ˆå¤šç§ï¼Œå…¶ä¸­æ¯”è¾ƒç®€å•çš„æ–¹å¼ç”¨ <strong>Cookie</strong> æŠ€æœ¯ã€‚</p><p><code>Cookie</code> é€šè¿‡åœ¨è¯·æ±‚å’Œå“åº”æŠ¥æ–‡ä¸­å†™å…¥ Cookie ä¿¡æ¯æ¥æ§åˆ¶å®¢æˆ·ç«¯çš„çŠ¶æ€ã€‚</p><p>ç›¸å½“äºï¼Œ<strong>åœ¨å®¢æˆ·ç«¯ç¬¬ä¸€æ¬¡è¯·æ±‚åï¼ŒæœåŠ¡å™¨ä¼šä¸‹å‘ä¸€ä¸ªè£…æœ‰å®¢æˆ·ä¿¡æ¯çš„ã€Œå°è´´çº¸ã€ï¼Œåç»­å®¢æˆ·ç«¯è¯·æ±‚æœåŠ¡å™¨çš„æ—¶å€™ï¼Œå¸¦ä¸Šã€Œå°è´´çº¸ã€ï¼ŒæœåŠ¡å™¨å°±èƒ½è®¤å¾—äº†äº†</strong>ï¼Œ</p><img src="'+lo+'" alt="Cookie æŠ€æœ¯" style="zoom:67%;"><p><em>2. æ˜æ–‡ä¼ è¾“åŒåˆƒå‰‘</em></p><p>æ˜æ–‡æ„å‘³ç€åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­çš„ä¿¡æ¯ï¼Œæ˜¯å¯æ–¹ä¾¿é˜…è¯»çš„ï¼Œæ¯”å¦‚ Wireshark æŠ“åŒ…éƒ½å¯ä»¥ç›´æ¥è‚‰çœ¼æŸ¥çœ‹ï¼Œä¸ºæˆ‘ä»¬è°ƒè¯•å·¥ä½œå¸¦äº†æå¤§çš„ä¾¿åˆ©æ€§ã€‚</p><p>ä½†æ˜¯è¿™æ­£æ˜¯è¿™æ ·ï¼ŒHTTP çš„æ‰€æœ‰ä¿¡æ¯éƒ½æš´éœ²åœ¨äº†å…‰å¤©åŒ–æ—¥ä¸‹ï¼Œç›¸å½“äº<strong>ä¿¡æ¯è£¸å¥”</strong>ã€‚åœ¨ä¼ è¾“çš„æ¼«é•¿çš„è¿‡ç¨‹ä¸­ï¼Œä¿¡æ¯çš„å†…å®¹éƒ½æ¯«æ— éšç§å¯è¨€ï¼Œå¾ˆå®¹æ˜“å°±èƒ½è¢«çªƒå–ï¼Œå¦‚æœé‡Œé¢æœ‰ä½ çš„è´¦å·å¯†ç ä¿¡æ¯ï¼Œé‚£<strong>ä½ å·æ²¡äº†</strong>ã€‚</p><figure><img src="'+co+'" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><p><em>3. ä¸å®‰å…¨</em></p><p>HTTP æ¯”è¾ƒä¸¥é‡çš„ç¼ºç‚¹å°±æ˜¯ä¸å®‰å…¨ï¼š</p><ul><li>é€šä¿¡ä½¿ç”¨æ˜æ–‡ï¼ˆä¸åŠ å¯†ï¼‰ï¼Œå†…å®¹å¯èƒ½ä¼šè¢«çªƒå¬ã€‚æ¯”å¦‚ï¼Œ<strong>è´¦å·ä¿¡æ¯å®¹æ˜“æ³„æ¼ï¼Œé‚£ä½ å·æ²¡äº†ã€‚</strong></li><li>ä¸éªŒè¯é€šä¿¡æ–¹çš„èº«ä»½ï¼Œå› æ­¤æœ‰å¯èƒ½é­é‡ä¼ªè£…ã€‚æ¯”å¦‚ï¼Œ<strong>è®¿é—®å‡çš„æ·˜å®ã€æ‹¼å¤šå¤šï¼Œé‚£ä½ é’±æ²¡äº†ã€‚</strong></li><li>æ— æ³•è¯æ˜æŠ¥æ–‡çš„å®Œæ•´æ€§ï¼Œæ‰€ä»¥æœ‰å¯èƒ½å·²é­ç¯¡æ”¹ã€‚æ¯”å¦‚ï¼Œ<strong>ç½‘é¡µä¸Šæ¤å…¥åƒåœ¾å¹¿å‘Šï¼Œè§†è§‰æ±¡æŸ“ï¼Œçœ¼æ²¡äº†ã€‚</strong></li></ul><p>HTTP çš„å®‰å…¨é—®é¢˜ï¼Œå¯ä»¥ç”¨ <strong>HTTPS çš„æ–¹å¼</strong>è§£å†³ï¼Œä¹Ÿå°±æ˜¯é€šè¿‡å¼•å…¥ SSL/TLS å±‚ï¼Œä½¿å¾—åœ¨å®‰å…¨ä¸Šè¾¾åˆ°äº†æè‡´ã€‚</p><h4 id="http-1-1-çš„æ€§èƒ½å¦‚ä½•" tabindex="-1"><a class="header-anchor" href="#http-1-1-çš„æ€§èƒ½å¦‚ä½•"><span>- HTTP/1.1 çš„æ€§èƒ½å¦‚ä½•ï¼Ÿ</span></a></h4><p>HTTP åè®®æ˜¯åŸºäº <strong>TCP/IP</strong>ï¼Œå¹¶ä¸”ä½¿ç”¨äº†ã€Œ<strong>è¯·æ±‚ - åº”ç­”</strong>ã€çš„é€šä¿¡æ¨¡å¼ï¼Œæ‰€ä»¥æ€§èƒ½çš„å…³é”®å°±åœ¨è¿™<strong>ä¸¤ç‚¹</strong>é‡Œã€‚</p><p><em>1. é•¿è¿æ¥</em></p><p>æ—©æœŸ HTTP/1.0 æ€§èƒ½ä¸Šçš„ä¸€ä¸ªå¾ˆå¤§çš„é—®é¢˜ï¼Œé‚£å°±æ˜¯<strong>æ¯å‘èµ·ä¸€ä¸ªè¯·æ±‚ï¼Œéƒ½è¦æ–°å»ºä¸€æ¬¡ TCP è¿æ¥</strong>ï¼ˆä¸‰æ¬¡æ¡æ‰‹ï¼‰ï¼Œè€Œä¸”æ˜¯ä¸²è¡Œè¯·æ±‚ï¼Œåšäº†æ— è°“çš„ TCP è¿æ¥å»ºç«‹å’Œæ–­å¼€ï¼Œå¢åŠ äº†é€šä¿¡å¼€é”€ã€‚</p><p>ä¸ºäº†è§£å†³ä¸Šè¿° TCP è¿æ¥é—®é¢˜ï¼ŒHTTP/1.1 æå‡ºäº†<strong>é•¿è¿æ¥</strong>çš„é€šä¿¡æ–¹å¼ï¼Œä¹Ÿå«æŒä¹…è¿æ¥ã€‚è¿™ç§æ–¹å¼çš„å¥½å¤„åœ¨äºå‡å°‘äº† TCP è¿æ¥çš„é‡å¤å»ºç«‹å’Œæ–­å¼€æ‰€é€ æˆçš„é¢å¤–å¼€é”€ï¼Œå‡è½»äº†æœåŠ¡å™¨ç«¯çš„è´Ÿè½½ã€‚</p><p>æŒä¹…è¿æ¥çš„ç‰¹ç‚¹æ˜¯ï¼Œåªè¦ä»»æ„ä¸€ç«¯æ²¡æœ‰æ˜ç¡®æå‡ºæ–­å¼€è¿æ¥ï¼Œåˆ™ä¿æŒ TCP è¿æ¥çŠ¶æ€ã€‚</p><figure><img src="'+mo+'" alt="çŸ­è¿æ¥ä¸é•¿è¿æ¥" tabindex="0" loading="lazy"><figcaption>çŸ­è¿æ¥ä¸é•¿è¿æ¥</figcaption></figure><p>å½“ç„¶ï¼Œå¦‚æœæŸä¸ª HTTP é•¿è¿æ¥<strong>è¶…è¿‡ä¸€å®šæ—¶é—´æ²¡æœ‰ä»»ä½•æ•°æ®äº¤äº’</strong>ï¼ŒæœåŠ¡ç«¯å°±ä¼šä¸»åŠ¨æ–­å¼€è¿™ä¸ªè¿æ¥ã€‚</p><p><em>2. ç®¡é“ç½‘ç»œä¼ è¾“</em></p><p>HTTP/1.1 é‡‡ç”¨äº†é•¿è¿æ¥çš„æ–¹å¼ï¼Œè¿™ä½¿å¾—<strong>ç®¡é“ï¼ˆpipelineï¼‰ç½‘ç»œä¼ è¾“</strong>æˆä¸ºäº†å¯èƒ½ã€‚</p><p>å³å¯åœ¨åŒä¸€ä¸ª TCP è¿æ¥é‡Œé¢ï¼Œå®¢æˆ·ç«¯å¯ä»¥<strong>å‘èµ·å¤šä¸ªè¯·æ±‚</strong>ï¼Œåªè¦<strong>ç¬¬ä¸€ä¸ªè¯·æ±‚å‘å‡ºå»äº†ï¼Œä¸å¿…ç­‰å…¶å›æ¥</strong>ï¼Œå°±å¯ä»¥å‘ç¬¬äºŒä¸ªè¯·æ±‚å‡ºå»ï¼Œå¯ä»¥<strong>å‡å°‘æ•´ä½“çš„å“åº”æ—¶é—´ã€‚</strong></p><p>ä¸¾ä¾‹æ¥è¯´ï¼Œå®¢æˆ·ç«¯éœ€è¦è¯·æ±‚ä¸¤ä¸ªèµ„æºã€‚ä»¥å‰çš„åšæ³•æ˜¯ï¼Œåœ¨åŒä¸€ä¸ª TCP è¿æ¥é‡Œé¢ï¼Œå…ˆå‘é€ A è¯·æ±‚ï¼Œç„¶åç­‰å¾…æœåŠ¡å™¨åšå‡ºå›åº”ï¼Œæ”¶åˆ°åå†å‘å‡º B è¯·æ±‚ã€‚é‚£ä¹ˆï¼Œç®¡é“æœºåˆ¶åˆ™æ˜¯å…è®¸æµè§ˆå™¨åŒæ—¶å‘å‡º A è¯·æ±‚å’Œ B è¯·æ±‚ï¼Œå¦‚ä¸‹å›¾ï¼š</p><figure><img src="'+To+'" alt="ç®¡é“ç½‘ç»œä¼ è¾“" tabindex="0" loading="lazy"><figcaption>ç®¡é“ç½‘ç»œä¼ è¾“</figcaption></figure><p>ä½†æ˜¯<strong>æœåŠ¡å™¨å¿…é¡»æŒ‰ç…§æ¥æ”¶è¯·æ±‚çš„é¡ºåºå‘é€å¯¹è¿™äº›ç®¡é“åŒ–è¯·æ±‚çš„å“åº”</strong>ã€‚</p><p>å¦‚æœæœåŠ¡ç«¯åœ¨å¤„ç† A è¯·æ±‚æ—¶è€—æ—¶æ¯”è¾ƒé•¿ï¼Œé‚£ä¹ˆåç»­çš„è¯·æ±‚çš„å¤„ç†éƒ½ä¼šè¢«é˜»å¡ä½ï¼Œè¿™ç§°ä¸ºã€Œé˜Ÿå¤´å µå¡ã€ã€‚</p><p>æ‰€ä»¥ï¼Œ<strong>HTTP/1.1 ç®¡é“è§£å†³äº†è¯·æ±‚çš„é˜Ÿå¤´é˜»å¡ï¼Œä½†æ˜¯æ²¡æœ‰è§£å†³å“åº”çš„é˜Ÿå¤´é˜»å¡</strong>ã€‚</p><blockquote><p>TIP</p><p><strong>æ³¨æ„!!!</strong></p><p>å®é™…ä¸Š HTTP/1.1 ç®¡é“åŒ–æŠ€æœ¯ä¸æ˜¯é»˜è®¤å¼€å¯ï¼Œ<strong>è€Œä¸”æµè§ˆå™¨åŸºæœ¬éƒ½æ²¡æœ‰æ”¯æŒ</strong>ï¼Œæ‰€ä»¥<strong>åé¢æ‰€æœ‰æ–‡ç« è®¨è®º HTTP/1.1 éƒ½æ˜¯å»ºç«‹åœ¨æ²¡æœ‰ä½¿ç”¨ç®¡é“åŒ–çš„å‰æ</strong>ã€‚å¤§å®¶çŸ¥é“æœ‰è¿™ä¸ªåŠŸèƒ½ï¼Œä½†æ˜¯æ²¡æœ‰è¢«ä½¿ç”¨å°±è¡Œäº†ã€‚</p></blockquote><p><em>3. é˜Ÿå¤´é˜»å¡</em></p><p>ã€Œè¯·æ±‚ - åº”ç­”ã€çš„æ¨¡å¼ä¼šé€ æˆ HTTP çš„æ€§èƒ½é—®é¢˜ã€‚ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ</p><p>å› ä¸ºå½“é¡ºåºå‘é€çš„è¯·æ±‚åºåˆ—ä¸­çš„ä¸€ä¸ªè¯·æ±‚å› ä¸ºæŸç§åŸå› è¢«é˜»å¡æ—¶ï¼Œåœ¨åé¢æ’é˜Ÿçš„æ‰€æœ‰è¯·æ±‚ä¹Ÿä¸€åŒè¢«é˜»å¡äº†ï¼Œä¼šæ‹›è‡´å®¢æˆ·ç«¯ä¸€ç›´è¯·æ±‚ä¸åˆ°æ•°æ®ï¼Œè¿™ä¹Ÿå°±æ˜¯ã€Œ<strong>é˜Ÿå¤´é˜»å¡</strong>ã€ï¼Œå¥½æ¯”ä¸Šç­çš„è·¯ä¸Šå¡è½¦ã€‚</p><figure><img src="'+ho+'" alt="é˜Ÿå¤´é˜»å¡" tabindex="0" loading="lazy"><figcaption>é˜Ÿå¤´é˜»å¡</figcaption></figure><p>æ€»ä¹‹ HTTP/1.1 çš„æ€§èƒ½ä¸€èˆ¬èˆ¬ï¼Œåç»­çš„ HTTP/2 å’Œ HTTP/3 å°±æ˜¯åœ¨<strong>ä¼˜åŒ– HTTP çš„æ€§èƒ½ã€‚</strong></p><h3 id="_3-1-5-http-ä¸-https" tabindex="-1"><a class="header-anchor" href="#_3-1-5-http-ä¸-https"><span>3.1.5 HTTP ä¸ HTTPS</span></a></h3><h4 id="http-ä¸-https-æœ‰å“ªäº›åŒºåˆ«" tabindex="-1"><a class="header-anchor" href="#http-ä¸-https-æœ‰å“ªäº›åŒºåˆ«"><span>- HTTP ä¸ HTTPS æœ‰å“ªäº›åŒºåˆ«ï¼Ÿ</span></a></h4><ul><li><p>HTTP æ˜¯è¶…æ–‡æœ¬ä¼ è¾“åè®®ï¼Œä¿¡æ¯æ˜¯æ˜æ–‡ä¼ è¾“ï¼Œå­˜åœ¨å®‰å…¨é£é™©çš„é—®é¢˜ã€‚HTTPS åˆ™è§£å†³ HTTP ä¸å®‰å…¨çš„ç¼ºé™·ï¼Œåœ¨ TCP å’Œ HTTP ç½‘ç»œå±‚ä¹‹é—´åŠ å…¥äº† <strong>SSL/TLS</strong> å®‰å…¨åè®®ï¼Œä½¿å¾—æŠ¥æ–‡èƒ½å¤ŸåŠ å¯†ä¼ è¾“ã€‚</p></li><li><p>HTTP è¿æ¥å»ºç«‹ç›¸å¯¹ç®€å•ï¼Œ TCP ä¸‰æ¬¡æ¡æ‰‹ä¹‹åä¾¿å¯è¿›è¡Œ HTTP çš„æŠ¥æ–‡ä¼ è¾“ã€‚è€Œ HTTPS <strong>åœ¨ TCP ä¸‰æ¬¡æ¡æ‰‹ä¹‹å</strong>ï¼Œè¿˜éœ€è¿›è¡Œ <strong>SSL/TLS çš„æ¡æ‰‹è¿‡ç¨‹</strong>ï¼Œæ‰å¯è¿›å…¥åŠ å¯†æŠ¥æ–‡ä¼ è¾“ã€‚</p></li><li><blockquote><p>ä¸¤è€…çš„é»˜è®¤ç«¯å£ä¸ä¸€æ ·ï¼ŒHTTP é»˜è®¤ç«¯å£å·æ˜¯ 80ï¼ŒHTTPS é»˜è®¤ç«¯å£å·æ˜¯ 443ã€‚</p></blockquote></li><li><p>HTTPS åè®®éœ€è¦å‘ CAï¼ˆè¯ä¹¦æƒå¨æœºæ„ï¼‰ç”³è¯·æ•°å­—è¯ä¹¦ï¼Œæ¥ä¿è¯æœåŠ¡å™¨çš„èº«ä»½æ˜¯å¯ä¿¡çš„ã€‚</p></li></ul><h4 id="https-è§£å†³äº†-http-çš„å“ªäº›é—®é¢˜" tabindex="-1"><a class="header-anchor" href="#https-è§£å†³äº†-http-çš„å“ªäº›é—®é¢˜"><span>- HTTPS è§£å†³äº† HTTP çš„å“ªäº›é—®é¢˜ï¼Ÿ</span></a></h4><p>HTTP ç”±äºæ˜¯æ˜æ–‡ä¼ è¾“ï¼Œæ‰€ä»¥å®‰å…¨ä¸Šå­˜åœ¨ä»¥ä¸‹ä¸‰ä¸ªé£é™©ï¼š</p><ul><li><strong>çªƒå¬é£é™©</strong>ï¼Œæ¯”å¦‚é€šä¿¡é“¾è·¯ä¸Šå¯ä»¥è·å–é€šä¿¡å†…å®¹ï¼Œç”¨æˆ·å·å®¹æ˜“æ²¡ã€‚</li><li><strong>ç¯¡æ”¹é£é™©</strong>ï¼Œæ¯”å¦‚å¼ºåˆ¶æ¤å…¥åƒåœ¾å¹¿å‘Šï¼Œè§†è§‰æ±¡æŸ“ï¼Œç”¨æˆ·çœ¼å®¹æ˜“çã€‚</li><li><strong>å†’å……é£é™©</strong>ï¼Œæ¯”å¦‚å†’å……æ·˜å®ç½‘ç«™ï¼Œç”¨æˆ·é’±å®¹æ˜“æ²¡ã€‚</li></ul><img src="'+uo+'" alt="HTTP ä¸ HTTPS ç½‘ç»œå±‚" style="zoom:67%;"><p>HTTP<strong>S</strong> åœ¨ HTTP ä¸ TCP å±‚ä¹‹é—´åŠ å…¥äº† <code>SSL/TLS</code> åè®®ï¼Œå¯ä»¥å¾ˆå¥½çš„è§£å†³äº†ä¸Šè¿°çš„é£é™©ï¼š</p><ul><li><strong>ä¿¡æ¯åŠ å¯†</strong>ï¼šäº¤äº’ä¿¡æ¯æ— æ³•è¢«çªƒå–ï¼Œä½†ä½ çš„å·ä¼šå› ä¸ºã€Œè‡ªèº«å¿˜è®°ã€è´¦å·è€Œæ²¡ã€‚</li><li><strong>æ ¡éªŒæœºåˆ¶</strong>ï¼šæ— æ³•ç¯¡æ”¹é€šä¿¡å†…å®¹ï¼Œç¯¡æ”¹äº†å°±ä¸èƒ½æ­£å¸¸æ˜¾ç¤ºï¼Œä½†ç™¾åº¦ã€Œç«ä»·æ’åã€ä¾ç„¶å¯ä»¥æœç´¢åƒåœ¾å¹¿å‘Šã€‚</li><li><strong>èº«ä»½è¯ä¹¦</strong>ï¼šè¯æ˜æ·˜å®æ˜¯çœŸçš„æ·˜å®ç½‘ï¼Œä½†ä½ çš„é’±è¿˜æ˜¯ä¼šå› ä¸ºã€Œå‰æ‰‹ã€è€Œæ²¡ã€‚</li></ul><p>å¯è§ï¼Œåªè¦è‡ªèº«ä¸åšã€Œæ¶ã€ï¼ŒSSL/TLS åè®®æ˜¯èƒ½ä¿è¯é€šä¿¡æ˜¯å®‰å…¨çš„ã€‚</p><blockquote><p>HTTPS æ˜¯å¦‚ä½•è§£å†³ä¸Šé¢çš„ä¸‰ä¸ªé£é™©çš„ï¼Ÿ</p></blockquote><ul><li><strong>æ··åˆåŠ å¯†</strong>çš„æ–¹å¼å®ç°ä¿¡æ¯çš„<strong>æœºå¯†æ€§</strong>ï¼Œè§£å†³äº†çªƒå¬çš„é£é™©ã€‚</li><li><strong>æ‘˜è¦ç®—æ³•</strong>çš„æ–¹å¼æ¥å®ç°<strong>å®Œæ•´æ€§</strong>ï¼Œå®ƒèƒ½å¤Ÿä¸ºæ•°æ®ç”Ÿæˆç‹¬ä¸€æ— äºŒçš„ã€ŒæŒ‡çº¹ã€ï¼ŒæŒ‡çº¹ç”¨äºæ ¡éªŒæ•°æ®çš„å®Œæ•´æ€§ï¼Œè§£å†³äº†ç¯¡æ”¹çš„é£é™©ã€‚</li><li>å°†æœåŠ¡å™¨å…¬é’¥æ”¾å…¥åˆ°<strong>æ•°å­—è¯ä¹¦</strong>ä¸­ï¼Œè§£å†³äº†å†’å……çš„é£é™©ã€‚</li></ul><p><em>1. æ··åˆåŠ å¯†</em></p><p>é€šè¿‡<strong>æ··åˆåŠ å¯†</strong>çš„æ–¹å¼å¯ä»¥ä¿è¯ä¿¡æ¯çš„<strong>æœºå¯†æ€§</strong>ï¼Œè§£å†³äº†çªƒå¬çš„é£é™©ã€‚</p><img src="'+_o+'" alt="æ··åˆåŠ å¯†" style="zoom:67%;"><p>HTTPS é‡‡ç”¨çš„æ˜¯<strong>å¯¹ç§°åŠ å¯†</strong>å’Œ<strong>éå¯¹ç§°åŠ å¯†</strong>ç»“åˆçš„ã€Œæ··åˆåŠ å¯†ã€æ–¹å¼ï¼š</p><ul><li>åœ¨é€šä¿¡å»ºç«‹å‰é‡‡ç”¨<strong>éå¯¹ç§°åŠ å¯†</strong>çš„æ–¹å¼äº¤æ¢ã€Œä¼šè¯ç§˜é’¥ã€ï¼Œåç»­å°±ä¸å†ä½¿ç”¨éå¯¹ç§°åŠ å¯†ã€‚</li><li>åœ¨é€šä¿¡è¿‡ç¨‹ä¸­å…¨éƒ¨ä½¿ç”¨<strong>å¯¹ç§°åŠ å¯†</strong>çš„ã€Œä¼šè¯ç§˜é’¥ã€çš„æ–¹å¼åŠ å¯†æ˜æ–‡æ•°æ®ã€‚</li></ul><p>é‡‡ç”¨ã€Œæ··åˆåŠ å¯†ã€çš„æ–¹å¼çš„åŸå› ï¼š</p><ul><li><strong>å¯¹ç§°åŠ å¯†</strong>åªä½¿ç”¨ä¸€ä¸ªå¯†é’¥ï¼Œè¿ç®—é€Ÿåº¦å¿«ï¼Œå¯†é’¥å¿…é¡»ä¿å¯†ï¼Œæ— æ³•åšåˆ°å®‰å…¨çš„å¯†é’¥äº¤æ¢ã€‚</li><li><strong>éå¯¹ç§°åŠ å¯†</strong>ä½¿ç”¨ä¸¤ä¸ªå¯†é’¥ï¼šå…¬é’¥å’Œç§é’¥ï¼Œå…¬é’¥å¯ä»¥ä»»æ„åˆ†å‘è€Œç§é’¥ä¿å¯†ï¼Œè§£å†³äº†å¯†é’¥äº¤æ¢é—®é¢˜ä½†é€Ÿåº¦æ…¢ã€‚</li></ul><p><em>2. æ‘˜è¦ç®—æ³• + æ•°å­—ç­¾å</em></p><p>ä¸ºäº†ä¿è¯ä¼ è¾“çš„å†…å®¹ä¸è¢«ç¯¡æ”¹ï¼Œæˆ‘ä»¬éœ€è¦å¯¹å†…å®¹è®¡ç®—å‡ºä¸€ä¸ªã€ŒæŒ‡çº¹ã€ï¼Œç„¶ååŒå†…å®¹ä¸€èµ·ä¼ è¾“ç»™å¯¹æ–¹ã€‚</p><p>å¯¹æ–¹æ”¶åˆ°åï¼Œå…ˆæ˜¯å¯¹å†…å®¹ä¹Ÿè®¡ç®—å‡ºä¸€ä¸ªã€ŒæŒ‡çº¹ã€ï¼Œç„¶åè·Ÿå‘é€æ–¹å‘é€çš„ã€ŒæŒ‡çº¹ã€åšä¸€ä¸ªæ¯”è¾ƒï¼Œå¦‚æœã€ŒæŒ‡çº¹ã€ç›¸åŒï¼Œè¯´æ˜å†…å®¹æ²¡æœ‰è¢«ç¯¡æ”¹ï¼Œå¦åˆ™å°±å¯ä»¥åˆ¤æ–­å‡ºå†…å®¹è¢«ç¯¡æ”¹äº†ã€‚</p><p>é‚£ä¹ˆï¼Œåœ¨è®¡ç®—æœºé‡Œä¼š<strong>ç”¨æ‘˜è¦ç®—æ³•ï¼ˆå“ˆå¸Œå‡½æ•°ï¼‰æ¥è®¡ç®—å‡ºå†…å®¹çš„å“ˆå¸Œå€¼</strong>ï¼Œä¹Ÿå°±æ˜¯å†…å®¹çš„ã€ŒæŒ‡çº¹ã€ï¼Œè¿™ä¸ª<strong>å“ˆå¸Œå€¼æ˜¯å”¯ä¸€çš„ï¼Œä¸”æ— æ³•é€šè¿‡å“ˆå¸Œå€¼æ¨å¯¼å‡ºå†…å®¹</strong>ã€‚</p><img src="'+Po+'" alt="img" style="zoom:67%;"><p>é€šè¿‡å“ˆå¸Œç®—æ³•å¯ä»¥ç¡®ä¿å†…å®¹ä¸ä¼šè¢«ç¯¡æ”¹ï¼Œ<strong>ä½†æ˜¯å¹¶ä¸èƒ½ä¿è¯ã€Œå†…å®¹ + å“ˆå¸Œå€¼ã€ä¸ä¼šè¢«ä¸­é—´äººæ›¿æ¢ï¼Œå› ä¸ºè¿™é‡Œç¼ºå°‘å¯¹å®¢æˆ·ç«¯æ”¶åˆ°çš„æ¶ˆæ¯æ˜¯å¦æ¥æºäºæœåŠ¡ç«¯çš„è¯æ˜</strong>ã€‚</p><p>ä¸¾ä¸ªä¾‹å­ï¼Œä½ æƒ³å‘è€å¸ˆè¯·å‡ï¼Œä¸€èˆ¬æ¥è¯´æ˜¯è¦æ±‚ç”±å®¶é•¿å†™ä¸€ä»½è¯·å‡ç†ç”±å¹¶ç­¾åï¼Œè€å¸ˆæ‰èƒ½å…è®¸ä½ è¯·å‡ã€‚</p><p>ä½†æ˜¯ä½ æœ‰æ¨¡ä»¿ä½ çˆ¸çˆ¸å­—è¿¹çš„èƒ½åŠ›ï¼Œä½ ç”¨ä½ çˆ¸çˆ¸çš„å­—è¿¹å†™äº†ä¸€ä»½è¯·å‡ç†ç”±ç„¶åç­¾ä¸Šä½ çˆ¸çˆ¸çš„åå­—ï¼Œè€å¸ˆä¸€çœ‹åˆ°è¿™ä¸ªè¯·å‡æ¡ï¼ŒæŸ¥çœ‹å­—è¿¹å’Œç­¾åï¼Œå°±è¯¯ä»¥ä¸ºæ˜¯ä½ çˆ¸çˆ¸å†™çš„ï¼Œå°±ä¼šå…è®¸ä½ è¯·å‡ã€‚</p><p>é‚£ä½œä¸ºè€å¸ˆï¼Œè¦å¦‚ä½•é¿å…è¿™ç§æƒ…å†µå‘ç”Ÿå‘¢ï¼Ÿç°å®ç”Ÿæ´»ä¸­çš„ï¼Œå¯ä»¥é€šè¿‡ç”µè¯æˆ–è§†é¢‘æ¥ç¡®è®¤æ˜¯å¦æ˜¯ç”±çˆ¶æ¯å‘å‡ºçš„è¯·å‡ï¼Œä½†æ˜¯è®¡ç®—æœºé‡Œå¯æ²¡æœ‰è¿™ç§æ“ä½œã€‚</p><p>é‚£ä¸ºäº†é¿å…è¿™ç§æƒ…å†µï¼Œè®¡ç®—æœºé‡Œä¼šç”¨<strong>éå¯¹ç§°åŠ å¯†ç®—æ³•</strong>æ¥è§£å†³ï¼Œå…±æœ‰ä¸¤ä¸ªå¯†é’¥ï¼š</p><ul><li>ä¸€ä¸ªæ˜¯å…¬é’¥ï¼Œè¿™ä¸ªæ˜¯å¯ä»¥å…¬å¼€ç»™æ‰€æœ‰äººçš„ï¼›</li><li>ä¸€ä¸ªæ˜¯ç§é’¥ï¼Œè¿™ä¸ªå¿…é¡»ç”±æœ¬äººç®¡ç†ï¼Œä¸å¯æ³„éœ²ã€‚</li></ul><p>è¿™ä¸¤ä¸ªå¯†é’¥å¯ä»¥<strong>åŒå‘åŠ è§£å¯†</strong>çš„ï¼Œæ¯”å¦‚å¯ä»¥ç”¨å…¬é’¥åŠ å¯†å†…å®¹ï¼Œç„¶åç”¨ç§é’¥è§£å¯†ï¼Œä¹Ÿå¯ä»¥ç”¨ç§é’¥åŠ å¯†å†…å®¹ï¼Œå…¬é’¥è§£å¯†å†…å®¹ã€‚</p><p>æµç¨‹çš„ä¸åŒï¼Œæ„å‘³ç€ç›®çš„ä¹Ÿä¸ç›¸åŒï¼š</p><ul><li><strong>å…¬é’¥åŠ å¯†ï¼Œç§é’¥è§£å¯†</strong>ã€‚è¿™ä¸ªç›®çš„æ˜¯ä¸ºäº†<strong>ä¿è¯å†…å®¹ä¼ è¾“çš„å®‰å…¨</strong>ï¼Œå› ä¸ºè¢«å…¬é’¥åŠ å¯†çš„å†…å®¹ï¼Œå…¶ä»–äººæ˜¯æ— æ³•è§£å¯†çš„ï¼Œåªæœ‰æŒæœ‰ç§é’¥çš„äººï¼Œæ‰èƒ½è§£å¯†å‡ºå®é™…çš„å†…å®¹ï¼›</li><li><strong>ç§é’¥åŠ å¯†ï¼Œå…¬é’¥è§£å¯†</strong>ã€‚è¿™ä¸ªç›®çš„æ˜¯ä¸ºäº†<strong>ä¿è¯æ¶ˆæ¯ä¸ä¼šè¢«å†’å……</strong>ï¼Œå› ä¸ºç§é’¥æ˜¯ä¸å¯æ³„éœ²çš„ï¼Œå¦‚æœå…¬é’¥èƒ½æ­£å¸¸è§£å¯†å‡ºç§é’¥åŠ å¯†çš„å†…å®¹ï¼Œå°±èƒ½è¯æ˜è¿™ä¸ªæ¶ˆæ¯æ˜¯æ¥æºäºæŒæœ‰ç§é’¥èº«ä»½çš„äººå‘é€çš„ã€‚</li></ul><p>ä¸€èˆ¬æˆ‘ä»¬ä¸ä¼šç”¨éå¯¹ç§°åŠ å¯†æ¥åŠ å¯†å®é™…çš„ä¼ è¾“å†…å®¹ï¼Œå› ä¸ºéå¯¹ç§°åŠ å¯†çš„è®¡ç®—æ¯”è¾ƒè€—è´¹æ€§èƒ½çš„ã€‚</p><p>æ‰€ä»¥éå¯¹ç§°åŠ å¯†çš„ç”¨é€”ä¸»è¦åœ¨äº<strong>é€šè¿‡ã€Œç§é’¥åŠ å¯†ï¼Œå…¬é’¥è§£å¯†ã€çš„æ–¹å¼ï¼Œæ¥ç¡®è®¤æ¶ˆæ¯çš„èº«ä»½</strong>ï¼Œæˆ‘ä»¬å¸¸è¯´çš„<strong>æ•°å­—ç­¾åç®—æ³•</strong>ï¼Œå°±æ˜¯ç”¨çš„æ˜¯è¿™ç§æ–¹å¼ï¼Œä¸è¿‡ç§é’¥åŠ å¯†å†…å®¹ä¸æ˜¯å†…å®¹æœ¬èº«ï¼Œè€Œæ˜¯<strong>å¯¹å†…å®¹çš„å“ˆå¸Œå€¼åŠ å¯†</strong>ã€‚</p><img src="'+Co+'" alt="img" style="zoom:67%;"><p>ç§é’¥æ˜¯ç”±æœåŠ¡ç«¯ä¿ç®¡ï¼Œç„¶åæœåŠ¡ç«¯ä¼šå‘å®¢æˆ·ç«¯é¢å‘å¯¹åº”çš„å…¬é’¥ã€‚å¦‚æœå®¢æˆ·ç«¯æ”¶åˆ°çš„ä¿¡æ¯ï¼Œèƒ½è¢«å…¬é’¥è§£å¯†ï¼Œå°±è¯´æ˜è¯¥æ¶ˆæ¯æ˜¯ç”±æœåŠ¡å™¨å‘é€çš„ã€‚</p><p>å¼•å…¥äº†æ•°å­—ç­¾åç®—æ³•åï¼Œä½ å°±æ— æ³•æ¨¡ä»¿ä½ çˆ¸çˆ¸çš„å­—è¿¹æ¥è¯·å‡äº†ï¼Œä½ çˆ¸çˆ¸æ‰‹ä¸ŠæŒæœ‰ç€ç§é’¥ï¼Œä½ è€å¸ˆæŒæœ‰ç€å…¬é’¥ã€‚</p><p>è¿™æ ·åªæœ‰ç”¨ä½ çˆ¸çˆ¸æ‰‹ä¸Šçš„ç§é’¥æ‰å¯¹è¯·å‡æ¡è¿›è¡Œã€Œç­¾åã€ï¼Œè€å¸ˆé€šè¿‡å…¬é’¥çœ‹èƒ½ä¸èƒ½è§£å‡ºè¿™ä¸ªã€Œç­¾åã€ï¼Œå¦‚æœèƒ½è§£å‡ºå¹¶ä¸”ç¡®è®¤å†…å®¹çš„å®Œæ•´æ€§ï¼Œå°±èƒ½è¯æ˜æ˜¯ç”±ä½ çˆ¸çˆ¸å‘èµ·çš„è¯·å‡æ¡ï¼Œè¿™æ ·è€å¸ˆæ‰å…è®¸ä½ è¯·å‡ï¼Œå¦åˆ™è€å¸ˆå°±ä¸è®¤ã€‚</p><p><em>3. æ•°å­—è¯ä¹¦</em></p><p>å‰é¢æˆ‘ä»¬çŸ¥é“ï¼š</p><ul><li>å¯ä»¥é€šè¿‡å“ˆå¸Œç®—æ³•æ¥ä¿è¯æ¶ˆæ¯çš„å®Œæ•´æ€§ï¼›</li><li>å¯ä»¥é€šè¿‡æ•°å­—ç­¾åæ¥ä¿è¯æ¶ˆæ¯çš„æ¥æºå¯é æ€§ï¼ˆèƒ½ç¡®è®¤æ¶ˆæ¯æ˜¯ç”±æŒæœ‰ç§é’¥çš„ä¸€æ–¹å‘é€çš„ï¼‰ï¼›</li></ul><p>ä½†æ˜¯è¿™è¿˜è¿œè¿œä¸å¤Ÿï¼Œ<strong>è¿˜ç¼ºå°‘èº«ä»½éªŒè¯çš„ç¯èŠ‚</strong>ï¼Œä¸‡ä¸€å…¬é’¥æ˜¯è¢«ä¼ªé€ çš„å‘¢ï¼Ÿ</p><p>è¿˜æ˜¯æ‹¿è¯·å‡çš„ä¾‹å­ï¼Œè™½ç„¶ä½ çˆ¸çˆ¸æŒæœ‰ç§é’¥ï¼Œè€å¸ˆé€šè¿‡æ˜¯å¦èƒ½ç”¨å…¬é’¥è§£å¯†æ¥ç¡®è®¤è¿™ä¸ªè¯·å‡æ¡æ˜¯ä¸æ˜¯æ¥æºä½ çˆ¶äº²çš„ã€‚</p><p>ä½†æ˜¯æˆ‘ä»¬è¿˜å¯ä»¥è‡ªå·±ä¼ªé€ å‡ºä¸€å¯¹å…¬ç§é’¥å•Šï¼</p><p>ä½ æ‰¾äº†ä¸ªå¤œæ™šï¼Œå·å·æŠŠè€å¸ˆæ¡Œé¢ä¸Šå’Œä½ çˆ¸çˆ¸é…å¯¹çš„å…¬é’¥ï¼Œæ¢æˆäº†ä½ çš„å…¬é’¥ï¼Œé‚£ä¹ˆä¸‹æ¬¡ä½ åœ¨è¯·å‡çš„æ—¶å€™ï¼Œä½ ç»§ç»­æ¨¡ä»¿ä½ çˆ¸çˆ¸çš„å­—è¿¹å†™äº†ä¸ªè¯·å‡æ¡ï¼Œç„¶åç”¨ä½ çš„ç§é’¥åšä¸ªäº†ã€Œæ•°å­—ç­¾åã€ã€‚</p><p>ä½†æ˜¯è€å¸ˆå¹¶ä¸çŸ¥é“è‡ªå·±çš„å…¬é’¥è¢«ä½ æ›¿æ¢è¿‡äº†ï¼Œæ‰€ä»¥ä»–è¿˜æ˜¯æŒ‰ç…§å¾€å¸¸ä¸€æ ·ç”¨å…¬é’¥è§£å¯†ï¼Œç”±äºè¿™ä¸ªå…¬é’¥å’Œä½ çš„ç§é’¥æ˜¯é…å¯¹çš„ï¼Œè€å¸ˆå½“ç„¶èƒ½ç”¨è¿™ä¸ªè¢«æ›¿æ¢çš„å…¬é’¥è§£å¯†å‡ºæ¥ï¼Œå¹¶ä¸”ç¡®è®¤äº†å†…å®¹çš„å®Œæ•´æ€§ï¼Œäºæ˜¯è€å¸ˆå°±ä¼šä»¥ä¸ºæ˜¯ä½ çˆ¶äº²å†™çš„è¯·å‡æ¡ï¼Œåˆå…è®¸ä½ è¯·å‡äº†ã€‚</p><p>å¥½å®¶ä¼™ï¼Œä¸ºäº†ä¸€ä¸ªè¯·å‡ï¼ŒçœŸçš„æ˜¯æ–—æ™ºæ–—å‹‡ã€‚</p><p>åé¢ä½ çš„è€å¸ˆå’Œçˆ¶äº²å‘ç°äº†ä½ ä¼ªé€ å…¬ç§é’¥çš„äº‹æƒ…åï¼Œå†³å®šé‡æ–°å•†é‡ä¸€ä¸ªå¯¹ç­–æ¥åº”å¯¹ä½ è¿™ä¸ªè‡­å®¶ä¼™ã€‚</p><p>æ­£æ‰€è°“é­”é«˜ä¸€ä¸ˆï¼Œé“é«˜ä¸€å°ºã€‚</p><p>æ—¢ç„¶ä¼ªé€ å…¬ç§é’¥é‚£ä¹ˆéšæ„ï¼Œæ‰€ä»¥ä½ çˆ¸æŠŠä»–çš„å…¬é’¥æ³¨å†Œåˆ°<strong>è­¦å¯Ÿå±€</strong>ï¼Œè­¦å¯Ÿå±€ç”¨ä»–ä»¬è‡ªå·±çš„ç§é’¥å¯¹ä½ çˆ¶äº²çš„å…¬é’¥åšäº†ä¸ªæ•°å­—ç­¾åï¼Œç„¶åæŠŠä½ çˆ¸çˆ¸çš„ã€Œä¸ªäººä¿¡æ¯ + å…¬é’¥ + æ•°å­—ç­¾åã€æ‰“åŒ…æˆä¸€ä¸ª<strong>æ•°å­—è¯ä¹¦ï¼Œä¹Ÿå°±æ˜¯è¯´è¿™ä¸ªæ•°å­—è¯ä¹¦åŒ…å«ä½ çˆ¸çˆ¸çš„å…¬é’¥ã€‚</strong></p><p>è¿™æ ·ï¼Œä½ çˆ¸çˆ¸å¦‚æœå› ä¸ºå®¶é‡Œç¡®å®æœ‰äº‹è¦å‘è€å¸ˆå¸®ä½ è¯·å‡çš„æ—¶å€™ï¼Œä¸ä»…ä¼šç”¨è‡ªå·±çš„ç§é’¥å¯¹å†…å®¹è¿›è¡Œç­¾åï¼Œè¿˜ä¼šæŠŠæ•°å­—è¯ä¹¦ç»™åˆ°è€å¸ˆã€‚</p><p>è€å¸ˆæ‹¿åˆ°äº†æ•°å­—è¯ä¹¦åï¼Œ<strong>é¦–å…ˆä¼šå»è­¦å¯Ÿå±€éªŒè¯è¿™ä¸ªæ•°å­—è¯ä¹¦æ˜¯å¦åˆæ³•</strong>ï¼Œå› ä¸ºæ•°å­—è¯ä¹¦é‡Œæœ‰è­¦å¯Ÿå±€çš„æ•°å­—ç­¾åï¼Œè­¦å¯Ÿå±€è¦éªŒè¯è¯ä¹¦åˆæ³•æ€§çš„æ—¶å€™ï¼Œç”¨è‡ªå·±çš„å…¬é’¥è§£å¯†ï¼Œå¦‚æœèƒ½è§£å¯†æˆåŠŸï¼Œå°±è¯´æ˜è¿™ä¸ªæ•°å­—è¯ä¹¦æ˜¯åœ¨è­¦å¯Ÿå±€æ³¨å†Œè¿‡çš„ï¼Œå°±è®¤ä¸ºè¯¥æ•°å­—è¯ä¹¦æ˜¯åˆæ³•çš„ï¼Œç„¶åå°±ä¼šæŠŠæ•°å­—è¯ä¹¦é‡Œå¤´çš„å…¬é’¥ï¼ˆä½ çˆ¸çˆ¸çš„ï¼‰ç»™åˆ°è€å¸ˆã€‚</p><p><strong>ç”±äºé€šè¿‡è­¦å¯Ÿå±€éªŒè¯äº†æ•°å­—è¯ä¹¦æ˜¯åˆæ³•çš„ï¼Œé‚£ä¹ˆå°±èƒ½è¯æ˜è¿™ä¸ªå…¬é’¥å°±æ˜¯ä½ çˆ¶äº²çš„</strong>ï¼Œäºæ˜¯è€å¸ˆå°±å¯ä»¥å®‰å¿ƒçš„ç”¨è¿™ä¸ªå…¬é’¥è§£å¯†å‡ºè¯·å‡æ¡ï¼Œå¦‚æœèƒ½è§£å¯†å‡ºï¼Œå°±è¯æ˜æ˜¯ä½ çˆ¸çˆ¸å†™çš„è¯·å‡æ¡ã€‚</p><p>æ­£æ˜¯é€šè¿‡äº†ä¸€ä¸ªæƒå¨çš„æœºæ„æ¥è¯æ˜ä½ çˆ¸çˆ¸çš„èº«ä»½ï¼Œæ‰€ä»¥ä½ çš„ä¼ªé€ å…¬ç§é’¥è¿™ä¸ªå°ä¼ä¿©å°±æ²¡ç”¨äº†ã€‚</p><p>åœ¨è®¡ç®—æœºé‡Œï¼Œè¿™ä¸ªæƒå¨çš„æœºæ„å°±æ˜¯ CA ï¼ˆæ•°å­—è¯ä¹¦è®¤è¯æœºæ„ï¼‰ï¼Œå°†æœåŠ¡å™¨å…¬é’¥æ”¾åœ¨æ•°å­—è¯ä¹¦ï¼ˆç”±æ•°å­—è¯ä¹¦è®¤è¯æœºæ„é¢å‘ï¼‰ä¸­ï¼Œåªè¦è¯ä¹¦æ˜¯å¯ä¿¡çš„ï¼Œå…¬é’¥å°±æ˜¯å¯ä¿¡çš„ã€‚</p><p>æ•°å­—è¯ä¹¦çš„å·¥ä½œæµç¨‹ï¼Œæˆ‘ä¹Ÿç”»äº†ä¸€å¼ å›¾ï¼Œæ–¹ä¾¿å¤§å®¶ç†è§£ï¼š</p><img src="'+bo+'" alt="æ•°å­è¯ä¹¦å·¥ä½œæµç¨‹" style="zoom:67%;"><p>é€šè¿‡æ•°å­—è¯ä¹¦çš„æ–¹å¼ä¿è¯æœåŠ¡å™¨å…¬é’¥çš„èº«ä»½ï¼Œè§£å†³å†’å……çš„é£é™©ã€‚</p><h4 id="https-æ˜¯å¦‚ä½•å»ºç«‹è¿æ¥çš„-å…¶é—´äº¤äº’äº†ä»€ä¹ˆ" tabindex="-1"><a class="header-anchor" href="#https-æ˜¯å¦‚ä½•å»ºç«‹è¿æ¥çš„-å…¶é—´äº¤äº’äº†ä»€ä¹ˆ"><span>- HTTPS æ˜¯å¦‚ä½•å»ºç«‹è¿æ¥çš„ï¼Ÿå…¶é—´äº¤äº’äº†ä»€ä¹ˆï¼Ÿ</span></a></h4><p>SSL/TLS åè®®åŸºæœ¬æµç¨‹ï¼š</p><ul><li>å®¢æˆ·ç«¯å‘æœåŠ¡å™¨ç´¢è¦å¹¶éªŒè¯æœåŠ¡å™¨çš„å…¬é’¥ã€‚</li><li>åŒæ–¹åå•†ç”Ÿäº§ã€Œä¼šè¯ç§˜é’¥ã€ã€‚</li><li>åŒæ–¹é‡‡ç”¨ã€Œä¼šè¯ç§˜é’¥ã€è¿›è¡ŒåŠ å¯†é€šä¿¡ã€‚</li></ul><p>å‰ä¸¤æ­¥ä¹Ÿå°±æ˜¯ SSL/TLS çš„å»ºç«‹è¿‡ç¨‹ï¼Œä¹Ÿå°±æ˜¯ TLS æ¡æ‰‹é˜¶æ®µã€‚</p>',190),Mr=o("strong",null,"å››æ¬¡",-1),Lr={href:"https://xiaolincoding.com/network/2_http/https_rsa.html",target:"_blank",rel:"noopener noreferrer"},Rr={href:"https://xiaolincoding.com/network/2_http/https_ecdhe.html",target:"_blank",rel:"noopener noreferrer"},Yr=n('<p>åŸºäº RSA ç®—æ³•çš„ TLS æ¡æ‰‹è¿‡ç¨‹æ¯”è¾ƒå®¹æ˜“ç†è§£ï¼Œæ‰€ä»¥è¿™é‡Œå…ˆç”¨è¿™ä¸ªç»™å¤§å®¶å±•ç¤º TLS æ¡æ‰‹è¿‡ç¨‹ï¼Œå¦‚ä¸‹å›¾ï¼š</p><img src="'+ko+'" alt="HTTPS è¿æ¥å»ºç«‹è¿‡ç¨‹" style="zoom:67%;"><p>TLS åè®®å»ºç«‹çš„è¯¦ç»†æµç¨‹ï¼š</p><p><em>1. ClientHello</em></p><p>é¦–å…ˆï¼Œç”±å®¢æˆ·ç«¯å‘æœåŠ¡å™¨å‘èµ·åŠ å¯†é€šä¿¡è¯·æ±‚ï¼Œä¹Ÿå°±æ˜¯ <code>ClientHello</code> è¯·æ±‚ã€‚</p><p>åœ¨è¿™ä¸€æ­¥ï¼Œå®¢æˆ·ç«¯ä¸»è¦å‘æœåŠ¡å™¨å‘é€ä»¥ä¸‹ä¿¡æ¯ï¼š</p><p>ï¼ˆ1ï¼‰å®¢æˆ·ç«¯æ”¯æŒçš„ TLS åè®®ç‰ˆæœ¬ï¼Œå¦‚ TLS 1.2 ç‰ˆæœ¬ã€‚</p><p>ï¼ˆ2ï¼‰å®¢æˆ·ç«¯ç”Ÿäº§çš„éšæœºæ•°ï¼ˆ<code>Client Random</code>ï¼‰ï¼Œåé¢ç”¨äºç”Ÿæˆã€Œä¼šè¯ç§˜é’¥ã€æ¡ä»¶ä¹‹ä¸€ã€‚</p><p>ï¼ˆ3ï¼‰å®¢æˆ·ç«¯æ”¯æŒçš„å¯†ç å¥—ä»¶åˆ—è¡¨ï¼Œå¦‚ RSA åŠ å¯†ç®—æ³•ã€‚</p><p><em>2. SeverHello</em></p><p>æœåŠ¡å™¨æ”¶åˆ°å®¢æˆ·ç«¯è¯·æ±‚åï¼Œå‘å®¢æˆ·ç«¯å‘å‡ºå“åº”ï¼Œä¹Ÿå°±æ˜¯ <code>SeverHello</code>ã€‚æœåŠ¡å™¨å›åº”çš„å†…å®¹æœ‰å¦‚ä¸‹å†…å®¹ï¼š</p><p>ï¼ˆ1ï¼‰ç¡®è®¤ TLS åè®®ç‰ˆæœ¬ï¼Œå¦‚æœæµè§ˆå™¨ä¸æ”¯æŒï¼Œåˆ™å…³é—­åŠ å¯†é€šä¿¡ã€‚</p><p>ï¼ˆ2ï¼‰æœåŠ¡å™¨ç”Ÿäº§çš„éšæœºæ•°ï¼ˆ<code>Server Random</code>ï¼‰ï¼Œä¹Ÿæ˜¯åé¢ç”¨äºç”Ÿäº§ã€Œä¼šè¯ç§˜é’¥ã€æ¡ä»¶ä¹‹ä¸€ã€‚</p><p>ï¼ˆ3ï¼‰ç¡®è®¤çš„å¯†ç å¥—ä»¶åˆ—è¡¨ï¼Œå¦‚ RSA åŠ å¯†ç®—æ³•ã€‚</p><p>ï¼ˆ4ï¼‰æœåŠ¡å™¨çš„æ•°å­—è¯ä¹¦ã€‚</p><p><em>3.å®¢æˆ·ç«¯å›åº”</em></p><p>å®¢æˆ·ç«¯æ”¶åˆ°æœåŠ¡å™¨çš„å›åº”ä¹‹åï¼Œé¦–å…ˆé€šè¿‡æµè§ˆå™¨æˆ–è€…æ“ä½œç³»ç»Ÿä¸­çš„ CA å…¬é’¥ï¼Œç¡®è®¤æœåŠ¡å™¨çš„æ•°å­—è¯ä¹¦çš„çœŸå®æ€§ã€‚</p><p>å¦‚æœè¯ä¹¦æ²¡æœ‰é—®é¢˜ï¼Œå®¢æˆ·ç«¯ä¼š<strong>ä»æ•°å­—è¯ä¹¦ä¸­å–å‡ºæœåŠ¡å™¨çš„å…¬é’¥</strong>ï¼Œç„¶åä½¿ç”¨å®ƒåŠ å¯†æŠ¥æ–‡ï¼Œå‘æœåŠ¡å™¨å‘é€å¦‚ä¸‹ä¿¡æ¯ï¼š</p><p>ï¼ˆ1ï¼‰ä¸€ä¸ªéšæœºæ•°ï¼ˆ<code>pre-master key</code>ï¼‰ã€‚è¯¥éšæœºæ•°ä¼šè¢«æœåŠ¡å™¨å…¬é’¥åŠ å¯†ã€‚</p><p>ï¼ˆ2ï¼‰åŠ å¯†é€šä¿¡ç®—æ³•æ”¹å˜é€šçŸ¥ï¼Œè¡¨ç¤ºéšåçš„ä¿¡æ¯éƒ½å°†ç”¨ã€Œä¼šè¯ç§˜é’¥ã€åŠ å¯†é€šä¿¡ã€‚</p><p>ï¼ˆ3ï¼‰å®¢æˆ·ç«¯æ¡æ‰‹ç»“æŸé€šçŸ¥ï¼Œè¡¨ç¤ºå®¢æˆ·ç«¯çš„æ¡æ‰‹é˜¶æ®µå·²ç»ç»“æŸã€‚è¿™ä¸€é¡¹åŒæ—¶æŠŠä¹‹å‰æ‰€æœ‰å†…å®¹çš„å‘ç”Ÿçš„æ•°æ®åšä¸ªæ‘˜è¦ï¼Œç”¨æ¥ä¾›æœåŠ¡ç«¯æ ¡éªŒã€‚</p><p>ä¸Šé¢ç¬¬ä¸€é¡¹çš„éšæœºæ•°æ˜¯æ•´ä¸ªæ¡æ‰‹é˜¶æ®µçš„ç¬¬ä¸‰ä¸ªéšæœºæ•°ï¼Œä¼šå‘ç»™æœåŠ¡ç«¯ï¼Œæ‰€ä»¥è¿™ä¸ªéšæœºæ•°å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯éƒ½æ˜¯ä¸€æ ·çš„ã€‚</p><p><strong>æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯æœ‰äº†è¿™ä¸‰ä¸ªéšæœºæ•°ï¼ˆClient Randomã€Server Randomã€pre-master keyï¼‰ï¼Œæ¥ç€å°±ç”¨åŒæ–¹åå•†çš„åŠ å¯†ç®—æ³•ï¼Œå„è‡ªç”Ÿæˆæœ¬æ¬¡é€šä¿¡çš„ã€Œä¼šè¯ç§˜é’¥ã€</strong>ã€‚</p><p><em>4. æœåŠ¡å™¨çš„æœ€åå›åº”</em></p><p>æœåŠ¡å™¨æ”¶åˆ°å®¢æˆ·ç«¯çš„ç¬¬ä¸‰ä¸ªéšæœºæ•°ï¼ˆ<code>pre-master key</code>ï¼‰ä¹‹åï¼Œé€šè¿‡åå•†çš„åŠ å¯†ç®—æ³•ï¼Œè®¡ç®—å‡ºæœ¬æ¬¡é€šä¿¡çš„ã€Œä¼šè¯ç§˜é’¥ã€ã€‚</p><p>ç„¶åï¼Œå‘å®¢æˆ·ç«¯å‘é€æœ€åçš„ä¿¡æ¯ï¼š</p><p>ï¼ˆ1ï¼‰åŠ å¯†é€šä¿¡ç®—æ³•æ”¹å˜é€šçŸ¥ï¼Œè¡¨ç¤ºéšåçš„ä¿¡æ¯éƒ½å°†ç”¨ã€Œä¼šè¯ç§˜é’¥ã€åŠ å¯†é€šä¿¡ã€‚</p><p>ï¼ˆ2ï¼‰æœåŠ¡å™¨æ¡æ‰‹ç»“æŸé€šçŸ¥ï¼Œè¡¨ç¤ºæœåŠ¡å™¨çš„æ¡æ‰‹é˜¶æ®µå·²ç»ç»“æŸã€‚è¿™ä¸€é¡¹åŒæ—¶æŠŠä¹‹å‰æ‰€æœ‰å†…å®¹çš„å‘ç”Ÿçš„æ•°æ®åšä¸ªæ‘˜è¦ï¼Œç”¨æ¥ä¾›å®¢æˆ·ç«¯æ ¡éªŒã€‚</p><p>è‡³æ­¤ï¼Œæ•´ä¸ª TLS çš„æ¡æ‰‹é˜¶æ®µå…¨éƒ¨ç»“æŸã€‚æ¥ä¸‹æ¥ï¼Œå®¢æˆ·ç«¯ä¸æœåŠ¡å™¨è¿›å…¥åŠ å¯†é€šä¿¡ï¼Œå°±å®Œå…¨æ˜¯ä½¿ç”¨æ™®é€šçš„ HTTP åè®®ï¼Œåªä¸è¿‡ç”¨ã€Œä¼šè¯ç§˜é’¥ã€åŠ å¯†å†…å®¹ã€‚</p><p>TIP</p>',30),Ur={href:"https://xiaolincoding.com/network/2_http/https_rsa.html",target:"_blank",rel:"noopener noreferrer"},Fr=o("p",null,"ä¸è¿‡ï¼ŒåŸºäº RSA ç®—æ³•çš„ HTTPS å­˜åœ¨ã€Œå‰å‘å®‰å…¨ã€çš„é—®é¢˜ï¼šå¦‚æœæœåŠ¡ç«¯çš„ç§é’¥æ³„æ¼äº†ï¼Œè¿‡å»è¢«ç¬¬ä¸‰æ–¹æˆªè·çš„æ‰€æœ‰ TLS é€šè®¯å¯†æ–‡éƒ½ä¼šè¢«ç ´è§£ã€‚",-1),jr={href:"https://xiaolincoding.com/network/2_http/https_ecdhe.html#%E7%A6%BB%E6%95%A3%E5%AF%B9%E6%95%B0",target:"_blank",rel:"noopener noreferrer"},Wr=n('<blockquote><p>å®¢æˆ·ç«¯æ ¡éªŒæ•°å­—è¯ä¹¦çš„æµç¨‹æ˜¯æ€æ ·çš„ï¼Ÿ</p></blockquote><p>æ¥ä¸‹æ¥ï¼Œè¯¦ç»†è¯´ä¸€ä¸‹å®é™…ä¸­æ•°å­—è¯ä¹¦ç­¾å‘å’ŒéªŒè¯æµç¨‹ã€‚</p><p>å¦‚ä¸‹å›¾å›¾æ‰€ç¤ºï¼Œä¸ºæ•°å­—è¯ä¹¦ç­¾å‘å’ŒéªŒè¯æµç¨‹ï¼š</p><img src="'+fo+'" alt="img" style="zoom:67%;"><p>CA ç­¾å‘è¯ä¹¦çš„è¿‡ç¨‹ï¼Œå¦‚ä¸Šå›¾å·¦è¾¹éƒ¨åˆ†ï¼š</p><ul><li>é¦–å…ˆ CA ä¼šæŠŠæŒæœ‰è€…çš„å…¬é’¥ã€ç”¨é€”ã€é¢å‘è€…ã€æœ‰æ•ˆæ—¶é—´ç­‰ä¿¡æ¯æ‰“æˆä¸€ä¸ªåŒ…ï¼Œç„¶åå¯¹è¿™äº›ä¿¡æ¯è¿›è¡Œ Hash è®¡ç®—ï¼Œå¾—åˆ°ä¸€ä¸ª Hash å€¼ï¼›</li><li>ç„¶å CA ä¼šä½¿ç”¨è‡ªå·±çš„ç§é’¥å°†è¯¥ Hash å€¼åŠ å¯†ï¼Œç”Ÿæˆ Certificate Signatureï¼Œä¹Ÿå°±æ˜¯ CA å¯¹è¯ä¹¦åšäº†ç­¾åï¼›</li><li>æœ€åå°† Certificate Signature æ·»åŠ åœ¨æ–‡ä»¶è¯ä¹¦ä¸Šï¼Œå½¢æˆæ•°å­—è¯ä¹¦ï¼›</li></ul><p>å®¢æˆ·ç«¯æ ¡éªŒæœåŠ¡ç«¯çš„æ•°å­—è¯ä¹¦çš„è¿‡ç¨‹ï¼Œå¦‚ä¸Šå›¾å³è¾¹éƒ¨åˆ†ï¼š</p><ul><li>é¦–å…ˆå®¢æˆ·ç«¯ä¼šä½¿ç”¨åŒæ ·çš„ Hash ç®—æ³•è·å–è¯¥è¯ä¹¦çš„ Hash å€¼ H1ï¼›</li><li>é€šå¸¸æµè§ˆå™¨å’Œæ“ä½œç³»ç»Ÿä¸­é›†æˆäº† CA çš„å…¬é’¥ä¿¡æ¯ï¼Œæµè§ˆå™¨æ”¶åˆ°è¯ä¹¦åå¯ä»¥ä½¿ç”¨ CA çš„å…¬é’¥è§£å¯† Certificate Signature å†…å®¹ï¼Œå¾—åˆ°ä¸€ä¸ª Hash å€¼ H2 ï¼›</li><li>æœ€åæ¯”è¾ƒ H1 å’Œ H2ï¼Œå¦‚æœå€¼ç›¸åŒï¼Œåˆ™ä¸ºå¯ä¿¡èµ–çš„è¯ä¹¦ï¼Œå¦åˆ™åˆ™è®¤ä¸ºè¯ä¹¦ä¸å¯ä¿¡ã€‚</li></ul><p>ä½†äº‹å®ä¸Šï¼Œè¯ä¹¦çš„éªŒè¯è¿‡ç¨‹ä¸­<strong>è¿˜å­˜åœ¨ä¸€ä¸ªè¯ä¹¦ä¿¡ä»»é“¾çš„é—®é¢˜</strong>ï¼Œå› ä¸ºæˆ‘ä»¬å‘ CA ç”³è¯·çš„è¯ä¹¦ä¸€èˆ¬ä¸æ˜¯æ ¹è¯ä¹¦ç­¾å‘çš„ï¼Œè€Œæ˜¯ç”±ä¸­é—´è¯ä¹¦ç­¾å‘çš„ï¼Œæ¯”å¦‚ç™¾åº¦çš„è¯ä¹¦ï¼Œä»ä¸‹å›¾ä½ å¯ä»¥çœ‹åˆ°ï¼Œè¯ä¹¦çš„å±‚çº§æœ‰ä¸‰çº§ï¼š</p><figure><img src="'+So+'" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><p>å¯¹äºè¿™ç§ä¸‰çº§å±‚çº§å…³ç³»çš„è¯ä¹¦çš„éªŒè¯è¿‡ç¨‹å¦‚ä¸‹ï¼š</p><ul><li>å®¢æˆ·ç«¯æ”¶åˆ° baidu.com çš„è¯ä¹¦åï¼Œå‘ç°è¿™ä¸ªè¯ä¹¦çš„ç­¾å‘è€…ä¸æ˜¯æ ¹è¯ä¹¦ï¼Œå°±æ— æ³•æ ¹æ®æœ¬åœ°å·²æœ‰çš„æ ¹è¯ä¹¦ä¸­çš„å…¬é’¥å»éªŒè¯ baidu.com è¯ä¹¦æ˜¯å¦å¯ä¿¡ã€‚äºæ˜¯ï¼Œå®¢æˆ·ç«¯æ ¹æ® baidu.com è¯ä¹¦ä¸­çš„ç­¾å‘è€…ï¼Œæ‰¾åˆ°è¯¥è¯ä¹¦çš„é¢å‘æœºæ„æ˜¯ â€œGlobalSign Organization Validation CA - SHA256 - G2â€ï¼Œç„¶åå‘ CA è¯·æ±‚è¯¥ä¸­é—´è¯ä¹¦ã€‚</li><li>è¯·æ±‚åˆ°è¯ä¹¦åå‘ç° â€œGlobalSign Organization Validation CA - SHA256 - G2â€ è¯ä¹¦æ˜¯ç”± â€œGlobalSign Root CAâ€ ç­¾å‘çš„ï¼Œç”±äº â€œGlobalSign Root CAâ€ æ²¡æœ‰å†ä¸Šçº§ç­¾å‘æœºæ„ï¼Œè¯´æ˜å®ƒæ˜¯æ ¹è¯ä¹¦ï¼Œä¹Ÿå°±æ˜¯è‡ªç­¾è¯ä¹¦ã€‚åº”ç”¨è½¯ä»¶ä¼šæ£€æŸ¥æ­¤è¯ä¹¦æœ‰å¦å·²é¢„è½½äºæ ¹è¯ä¹¦æ¸…å•ä¸Šï¼Œå¦‚æœæœ‰ï¼Œåˆ™å¯ä»¥åˆ©ç”¨æ ¹è¯ä¹¦ä¸­çš„å…¬é’¥å»éªŒè¯ â€œGlobalSign Organization Validation CA - SHA256 - G2â€ è¯ä¹¦ï¼Œå¦‚æœå‘ç°éªŒè¯é€šè¿‡ï¼Œå°±è®¤ä¸ºè¯¥ä¸­é—´è¯ä¹¦æ˜¯å¯ä¿¡çš„ã€‚</li><li>â€œGlobalSign Organization Validation CA - SHA256 - G2â€ è¯ä¹¦è¢«ä¿¡ä»»åï¼Œå¯ä»¥ä½¿ç”¨ â€œGlobalSign Organization Validation CA - SHA256 - G2â€ è¯ä¹¦ä¸­çš„å…¬é’¥å»éªŒè¯ baidu.com è¯ä¹¦çš„å¯ä¿¡æ€§ï¼Œå¦‚æœéªŒè¯é€šè¿‡ï¼Œå°±å¯ä»¥ä¿¡ä»» baidu.com è¯ä¹¦ã€‚</li></ul><p>åœ¨è¿™å››ä¸ªæ­¥éª¤ä¸­ï¼Œæœ€å¼€å§‹å®¢æˆ·ç«¯åªä¿¡ä»»æ ¹è¯ä¹¦ GlobalSign Root CA è¯ä¹¦çš„ï¼Œç„¶å â€œGlobalSign Root CAâ€ è¯ä¹¦ä¿¡ä»» â€œGlobalSign Organization Validation CA - SHA256 - G2â€ è¯ä¹¦ï¼Œè€Œ â€œGlobalSign Organization Validation CA - SHA256 - G2â€ è¯ä¹¦åˆä¿¡ä»» baidu.com è¯ä¹¦ï¼Œäºæ˜¯å®¢æˆ·ç«¯ä¹Ÿä¿¡ä»» baidu.com è¯ä¹¦ã€‚</p><p>æ€»æ‹¬æ¥è¯´ï¼Œç”±äºç”¨æˆ·ä¿¡ä»» GlobalSignï¼Œæ‰€ä»¥ç”± GlobalSign æ‰€æ‹…ä¿çš„ baidu.com å¯ä»¥è¢«ä¿¡ä»»ï¼Œå¦å¤–ç”±äºç”¨æˆ·ä¿¡ä»»æ“ä½œç³»ç»Ÿæˆ–æµè§ˆå™¨çš„è½¯ä»¶å•†ï¼Œæ‰€ä»¥ç”±è½¯ä»¶å•†é¢„è½½äº†æ ¹è¯ä¹¦çš„ GlobalSign éƒ½å¯è¢«ä¿¡ä»»ã€‚</p><img src="'+Ao+'" alt="img" style="zoom:67%;"><p>æ“ä½œç³»ç»Ÿé‡Œä¸€èˆ¬éƒ½ä¼šå†…ç½®ä¸€äº›æ ¹è¯ä¹¦ï¼Œæ¯”å¦‚æˆ‘çš„ MAC ç”µè„‘é‡Œå†…ç½®çš„æ ¹è¯ä¹¦æœ‰è¿™ä¹ˆå¤šï¼š</p><img src="'+Io+'" alt="img" style="zoom:80%;"><p>è¿™æ ·çš„ä¸€å±‚å±‚åœ°éªŒè¯å°±æ„æˆäº†ä¸€æ¡ä¿¡ä»»é“¾è·¯ï¼Œæ•´ä¸ªè¯ä¹¦ä¿¡ä»»é“¾éªŒè¯æµç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><img src="'+xo+'" alt="img" style="zoom:67%;"><p>æœ€åä¸€ä¸ªé—®é¢˜ï¼Œä¸ºä»€ä¹ˆéœ€è¦è¯ä¹¦é“¾è¿™ä¹ˆéº»çƒ¦çš„æµç¨‹ï¼ŸRoot CA ä¸ºä»€ä¹ˆä¸ç›´æ¥é¢å‘è¯ä¹¦ï¼Œè€Œæ˜¯è¦æé‚£ä¹ˆå¤šä¸­é—´å±‚çº§å‘¢ï¼Ÿ</p><p><strong>è¿™æ˜¯ä¸ºäº†ç¡®ä¿æ ¹è¯ä¹¦çš„ç»å¯¹å®‰å…¨æ€§ï¼Œå°†æ ¹è¯ä¹¦éš”ç¦»åœ°è¶Šä¸¥æ ¼è¶Šå¥½ï¼Œä¸ç„¶æ ¹è¯ä¹¦å¦‚æœå¤±å®ˆäº†ï¼Œé‚£ä¹ˆæ•´ä¸ªä¿¡ä»»é“¾éƒ½ä¼šæœ‰é—®é¢˜ã€‚</strong></p><h4 id="https-çš„åº”ç”¨æ•°æ®æ˜¯å¦‚ä½•ä¿è¯å®Œæ•´æ€§çš„" tabindex="-1"><a class="header-anchor" href="#https-çš„åº”ç”¨æ•°æ®æ˜¯å¦‚ä½•ä¿è¯å®Œæ•´æ€§çš„"><span>- HTTPS çš„åº”ç”¨æ•°æ®æ˜¯å¦‚ä½•ä¿è¯å®Œæ•´æ€§çš„ï¼Ÿ</span></a></h4><p>TLS åœ¨å®ç°ä¸Šåˆ†ä¸º<strong>æ¡æ‰‹åè®®</strong>å’Œ<strong>è®°å½•åè®®</strong>ä¸¤å±‚ï¼š</p><ul><li>TLS æ¡æ‰‹åè®®å°±æ˜¯æˆ‘ä»¬å‰é¢è¯´çš„ TLS å››æ¬¡æ¡æ‰‹çš„è¿‡ç¨‹ï¼Œè´Ÿè´£åå•†åŠ å¯†ç®—æ³•å’Œç”Ÿæˆå¯¹ç§°å¯†é’¥ï¼Œåç»­ç”¨æ­¤å¯†é’¥æ¥ä¿æŠ¤åº”ç”¨ç¨‹åºæ•°æ®ï¼ˆå³ HTTP æ•°æ®ï¼‰ï¼›</li><li>TLS è®°å½•åè®®è´Ÿè´£ä¿æŠ¤åº”ç”¨ç¨‹åºæ•°æ®å¹¶éªŒè¯å…¶å®Œæ•´æ€§å’Œæ¥æºï¼Œæ‰€ä»¥å¯¹ HTTP æ•°æ®åŠ å¯†æ˜¯ä½¿ç”¨è®°å½•åè®®ï¼›</li></ul><p>TLS è®°å½•åè®®ä¸»è¦è´Ÿè´£æ¶ˆæ¯ï¼ˆHTTP æ•°æ®ï¼‰çš„å‹ç¼©ï¼ŒåŠ å¯†åŠæ•°æ®çš„è®¤è¯ï¼Œè¿‡ç¨‹å¦‚ä¸‹å›¾ï¼š</p><img src="'+No+'" alt="img" style="zoom:67%;"><p>å…·ä½“è¿‡ç¨‹å¦‚ä¸‹ï¼š</p><ul><li>é¦–å…ˆï¼Œæ¶ˆæ¯è¢«åˆ†å‰²æˆå¤šä¸ªè¾ƒçŸ­çš„ç‰‡æ®µ,ç„¶ååˆ†åˆ«å¯¹æ¯ä¸ªç‰‡æ®µè¿›è¡Œå‹ç¼©ã€‚</li><li>æ¥ä¸‹æ¥ï¼Œç»è¿‡å‹ç¼©çš„ç‰‡æ®µä¼šè¢«<strong>åŠ ä¸Šæ¶ˆæ¯è®¤è¯ç ï¼ˆMAC å€¼ï¼Œè¿™ä¸ªæ˜¯é€šè¿‡å“ˆå¸Œç®—æ³•ç”Ÿæˆçš„ï¼‰ï¼Œè¿™æ˜¯ä¸ºäº†ä¿è¯å®Œæ•´æ€§ï¼Œå¹¶è¿›è¡Œæ•°æ®çš„è®¤è¯</strong>ã€‚é€šè¿‡é™„åŠ æ¶ˆæ¯è®¤è¯ç çš„ MAC å€¼ï¼Œå¯ä»¥è¯†åˆ«å‡ºç¯¡æ”¹ã€‚ä¸æ­¤åŒæ—¶ï¼Œä¸ºäº†é˜²æ­¢é‡æ”¾æ”»å‡»ï¼Œåœ¨è®¡ç®—æ¶ˆæ¯è®¤è¯ç æ—¶ï¼Œè¿˜åŠ ä¸Šäº†ç‰‡æ®µçš„ç¼–ç ã€‚</li><li>å†æ¥ä¸‹æ¥ï¼Œç»è¿‡å‹ç¼©çš„ç‰‡æ®µå†åŠ ä¸Šæ¶ˆæ¯è®¤è¯ç ä¼šä¸€èµ·é€šè¿‡å¯¹ç§°å¯†ç è¿›è¡ŒåŠ å¯†ã€‚</li><li>æœ€åï¼Œä¸Šè¿°ç»è¿‡åŠ å¯†çš„æ•°æ®å†åŠ ä¸Šç”±æ•°æ®ç±»å‹ã€ç‰ˆæœ¬å·ã€å‹ç¼©åçš„é•¿åº¦ç»„æˆçš„æŠ¥å¤´å°±æ˜¯æœ€ç»ˆçš„æŠ¥æ–‡æ•°æ®ã€‚</li></ul><p>è®°å½•åè®®å®Œæˆåï¼Œæœ€ç»ˆçš„æŠ¥æ–‡æ•°æ®å°†ä¼ é€’åˆ°ä¼ è¾“æ§åˆ¶åè®® (TCP) å±‚è¿›è¡Œä¼ è¾“ã€‚</p>',29),Br={href:"https://blog.csdn.net/zhanyiwp/article/details/105627799",target:"_blank",rel:"noopener noreferrer"},Or=n('<h4 id="https-ä¸€å®šå®‰å…¨å¯é å—" tabindex="-1"><a class="header-anchor" href="#https-ä¸€å®šå®‰å…¨å¯é å—"><span>- HTTPS ä¸€å®šå®‰å…¨å¯é å—ï¼Ÿ</span></a></h4><p>ä¹‹å‰æœ‰è¯»è€…åœ¨å­—èŠ‚é¢è¯•çš„æ—¶å€™ï¼Œè¢«é—®åˆ°ï¼š<strong>HTTPS ä¸€å®šå®‰å…¨å¯é å—ï¼Ÿ</strong></p><img src="'+qo+'" alt="img" style="zoom:50%;"><p>è¿™ä¸ªé—®é¢˜çš„åœºæ™¯æ˜¯è¿™æ ·çš„ï¼šå®¢æˆ·ç«¯é€šè¿‡æµè§ˆå™¨å‘æœåŠ¡ç«¯å‘èµ· HTTPS è¯·æ±‚æ—¶ï¼Œè¢«ã€Œå‡åŸºç«™ã€è½¬å‘åˆ°äº†ä¸€ä¸ªã€Œä¸­é—´äººæœåŠ¡å™¨ã€ï¼Œäºæ˜¯å®¢æˆ·ç«¯æ˜¯å’Œã€Œä¸­é—´äººæœåŠ¡å™¨ã€å®Œæˆäº† TLS æ¡æ‰‹ï¼Œç„¶åè¿™ä¸ªã€Œä¸­é—´äººæœåŠ¡å™¨ã€å†ä¸çœŸæ­£çš„æœåŠ¡ç«¯å®Œæˆ TLS æ¡æ‰‹ã€‚</p><figure><img src="'+yo+'" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><p>å…·ä½“è¿‡ç¨‹å¦‚ä¸‹ï¼š</p><ul><li>å®¢æˆ·ç«¯å‘æœåŠ¡ç«¯å‘èµ· HTTPS å»ºç«‹è¿æ¥è¯·æ±‚æ—¶ï¼Œç„¶åè¢«ã€Œå‡åŸºç«™ã€è½¬å‘åˆ°äº†ä¸€ä¸ªã€Œä¸­é—´äººæœåŠ¡å™¨ã€ï¼Œæ¥ç€ä¸­é—´äººå‘æœåŠ¡ç«¯å‘èµ· HTTPS å»ºç«‹è¿æ¥è¯·æ±‚ï¼Œæ­¤æ—¶å®¢æˆ·ç«¯ä¸ä¸­é—´äººè¿›è¡Œ TLS æ¡æ‰‹ï¼Œä¸­é—´äººä¸æœåŠ¡ç«¯è¿›è¡Œ TLS æ¡æ‰‹ï¼›</li><li>åœ¨å®¢æˆ·ç«¯ä¸ä¸­é—´äººè¿›è¡Œ TLS æ¡æ‰‹è¿‡ç¨‹ä¸­ï¼Œä¸­é—´äººä¼šå‘é€è‡ªå·±çš„å…¬é’¥è¯ä¹¦ç»™å®¢æˆ·ç«¯ï¼Œ<strong>å®¢æˆ·ç«¯éªŒè¯è¯ä¹¦çš„çœŸä¼ª</strong>ï¼Œç„¶åä»è¯ä¹¦æ‹¿åˆ°å…¬é’¥ï¼Œå¹¶ç”Ÿæˆä¸€ä¸ªéšæœºæ•°ï¼Œç”¨å…¬é’¥åŠ å¯†éšæœºæ•°å‘é€ç»™ä¸­é—´äººï¼Œä¸­é—´äººä½¿ç”¨ç§é’¥è§£å¯†ï¼Œå¾—åˆ°éšæœºæ•°ï¼Œæ­¤æ—¶åŒæ–¹éƒ½æœ‰éšæœºæ•°ï¼Œç„¶åé€šè¿‡ç®—æ³•ç”Ÿæˆå¯¹ç§°åŠ å¯†å¯†é’¥ï¼ˆAï¼‰ï¼Œåç»­å®¢æˆ·ç«¯ä¸ä¸­é—´äººé€šä¿¡å°±ç”¨è¿™ä¸ªå¯¹ç§°åŠ å¯†å¯†é’¥æ¥åŠ å¯†æ•°æ®äº†ã€‚</li><li>åœ¨ä¸­é—´äººä¸æœåŠ¡ç«¯è¿›è¡Œ TLS æ¡æ‰‹è¿‡ç¨‹ä¸­ï¼ŒæœåŠ¡ç«¯ä¼šå‘é€ä» CA æœºæ„ç­¾å‘çš„å…¬é’¥è¯ä¹¦ç»™ä¸­é—´äººï¼Œä»è¯ä¹¦æ‹¿åˆ°å…¬é’¥ï¼Œå¹¶ç”Ÿæˆä¸€ä¸ªéšæœºæ•°ï¼Œç”¨å…¬é’¥åŠ å¯†éšæœºæ•°å‘é€ç»™æœåŠ¡ç«¯ï¼ŒæœåŠ¡ç«¯ä½¿ç”¨ç§é’¥è§£å¯†ï¼Œå¾—åˆ°éšæœºæ•°ï¼Œæ­¤æ—¶åŒæ–¹éƒ½æœ‰éšæœºæ•°ï¼Œç„¶åé€šè¿‡ç®—æ³•ç”Ÿæˆå¯¹ç§°åŠ å¯†å¯†é’¥ï¼ˆBï¼‰ï¼Œåç»­ä¸­é—´äººä¸æœåŠ¡ç«¯é€šä¿¡å°±ç”¨è¿™ä¸ªå¯¹ç§°åŠ å¯†å¯†é’¥æ¥åŠ å¯†æ•°æ®äº†ã€‚</li><li>åç»­çš„é€šä¿¡è¿‡ç¨‹ä¸­ï¼Œä¸­é—´äººç”¨å¯¹ç§°åŠ å¯†å¯†é’¥ï¼ˆAï¼‰è§£å¯†å®¢æˆ·ç«¯çš„ HTTPS è¯·æ±‚çš„æ•°æ®ï¼Œç„¶åç”¨å¯¹ç§°åŠ å¯†å¯†é’¥ï¼ˆBï¼‰åŠ å¯† HTTPS è¯·æ±‚åï¼Œè½¬å‘ç»™æœåŠ¡ç«¯ï¼Œæ¥ç€æœåŠ¡ç«¯å‘é€ HTTPS å“åº”æ•°æ®ç»™ä¸­é—´äººï¼Œä¸­é—´äººç”¨å¯¹ç§°åŠ å¯†å¯†é’¥ï¼ˆBï¼‰è§£å¯† HTTPS å“åº”æ•°æ®ï¼Œç„¶åå†ç”¨å¯¹ç§°åŠ å¯†å¯†é’¥ï¼ˆAï¼‰åŠ å¯†åï¼Œè½¬å‘ç»™å®¢æˆ·ç«¯ã€‚</li></ul><p>ä»å®¢æˆ·ç«¯çš„è§’åº¦çœ‹ï¼Œå…¶å®å¹¶ä¸çŸ¥é“ç½‘ç»œä¸­å­˜åœ¨ä¸­é—´äººæœåŠ¡å™¨è¿™ä¸ªè§’è‰²ã€‚é‚£ä¹ˆä¸­é—´äººå°±å¯ä»¥è§£å¼€æµè§ˆå™¨å‘èµ·çš„ HTTPS è¯·æ±‚é‡Œçš„æ•°æ®ï¼Œä¹Ÿå¯ä»¥è§£å¼€æœåŠ¡ç«¯å“åº”ç»™æµè§ˆå™¨çš„ HTTPS å“åº”æ•°æ®ã€‚ç›¸å½“äºï¼Œä¸­é—´äººèƒ½å¤Ÿ â€œå·çœ‹â€ æµè§ˆå™¨ä¸æœåŠ¡ç«¯ä¹‹é—´çš„ HTTPS è¯·æ±‚å’Œå“åº”çš„æ•°æ®ã€‚</p><p>ä½†æ˜¯è¦å‘ç”Ÿè¿™ç§åœºæ™¯æ˜¯æœ‰å‰æçš„ï¼Œå‰æ<strong>æ˜¯ç”¨æˆ·ç‚¹å‡»æ¥å—äº†ä¸­é—´äººæœåŠ¡å™¨çš„è¯ä¹¦ã€‚</strong></p><p>ä¸­é—´äººæœåŠ¡å™¨ä¸å®¢æˆ·ç«¯åœ¨ TLS æ¡æ‰‹è¿‡ç¨‹ä¸­ï¼Œå®é™…ä¸Šå‘é€äº†è‡ªå·±ä¼ªé€ çš„è¯ä¹¦ç»™æµè§ˆå™¨ï¼Œè€Œè¿™ä¸ªä¼ªé€ çš„è¯ä¹¦æ˜¯èƒ½è¢«æµè§ˆå™¨ï¼ˆå®¢æˆ·ç«¯ï¼‰è¯†åˆ«å‡ºæ˜¯éæ³•çš„**ï¼Œäºæ˜¯å°±ä¼šæé†’ç”¨æˆ·è¯¥è¯ä¹¦å­˜åœ¨é—®é¢˜ã€‚**</p><figure><img src="'+Ho+'" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><p>å¦‚æœç”¨æˆ·æ‰§æ„ç‚¹å‡»ã€Œç»§ç»­æµè§ˆæ­¤ç½‘ç«™ã€ï¼Œç›¸å½“äºç”¨æˆ·æ¥å—äº†ä¸­é—´äººä¼ªé€ çš„è¯ä¹¦ï¼Œé‚£ä¹ˆåç»­æ•´ä¸ª HTTPS é€šä¿¡éƒ½èƒ½è¢«ä¸­é—´äººç›‘å¬äº†ã€‚</p><p>æ‰€ä»¥ï¼Œè¿™å…¶å®å¹¶ä¸èƒ½è¯´ HTTPS ä¸å¤Ÿå®‰å…¨ï¼Œæ¯•ç«Ÿæµè§ˆå™¨éƒ½å·²ç»æç¤ºè¯ä¹¦æœ‰é—®é¢˜äº†ï¼Œå¦‚æœç”¨æˆ·åšå†³è¦è®¿é—®ï¼Œé‚£ä¸èƒ½æ€ª HTTPS ï¼Œå¾—æ€ªè‡ªå·±æ‰‹è´±ã€‚</p><p>å¦å¤–ï¼Œå¦‚æœä½ çš„ç”µè„‘ä¸­æ¯’äº†ï¼Œè¢«<strong>æ¶æ„å¯¼å…¥äº†ä¸­é—´äººçš„æ ¹è¯ä¹¦</strong>ï¼Œé‚£ä¹ˆåœ¨éªŒè¯ä¸­é—´äººçš„è¯ä¹¦çš„æ—¶å€™ï¼Œç”±äºä½ æ“ä½œç³»ç»Ÿä¿¡ä»»äº†ä¸­é—´äººçš„æ ¹è¯ä¹¦ï¼Œé‚£ä¹ˆç­‰åŒäºä¸­é—´äººçš„è¯ä¹¦æ˜¯åˆæ³•çš„ï¼Œè¿™ç§æƒ…å†µä¸‹ï¼Œæµè§ˆå™¨æ˜¯ä¸ä¼šå¼¹å‡ºè¯ä¹¦å­˜åœ¨é—®é¢˜çš„é£é™©æé†’çš„ã€‚</p><p>è¿™å…¶å®ä¹Ÿä¸å…³ HTTPS çš„äº‹æƒ…ï¼Œæ˜¯ä½ ç”µè„‘ä¸­æ¯’äº†æ‰å¯¼è‡´ HTTPS æ•°æ®è¢«ä¸­é—´äººåŠ«æŒçš„ã€‚</p><p>æ‰€ä»¥ï¼Œ<strong>HTTPS åè®®æœ¬èº«åˆ°ç›®å‰ä¸ºæ­¢è¿˜æ˜¯æ²¡æœ‰ä»»ä½•æ¼æ´çš„ï¼Œå³ä½¿ä½ æˆåŠŸè¿›è¡Œä¸­é—´äººæ”»å‡»ï¼Œæœ¬è´¨ä¸Šæ˜¯åˆ©ç”¨äº†å®¢æˆ·ç«¯çš„æ¼æ´ï¼ˆç”¨æˆ·ç‚¹å‡»ç»§ç»­è®¿é—®æˆ–è€…è¢«æ¶æ„å¯¼å…¥ä¼ªé€ çš„æ ¹è¯ä¹¦ï¼‰ï¼Œå¹¶ä¸æ˜¯ HTTPS ä¸å¤Ÿå®‰å…¨</strong>ã€‚</p><blockquote><p>ä¸ºä»€ä¹ˆæŠ“åŒ…å·¥å…·èƒ½æˆªå– HTTPS æ•°æ®ï¼Ÿ</p></blockquote><p>å¾ˆå¤šæŠ“åŒ…å·¥å…· ä¹‹æ‰€ä»¥å¯ä»¥æ˜æ–‡çœ‹åˆ° HTTPS æ•°æ®ï¼Œå·¥ä½œåŸç†ä¸ä¸­é—´äººä¸€è‡´çš„ã€‚</p><p>å¯¹äº HTTPS è¿æ¥æ¥è¯´ï¼Œä¸­é—´äººè¦æ»¡è¶³ä»¥ä¸‹ä¸¤ç‚¹ï¼Œæ‰èƒ½å®ç°çœŸæ­£çš„æ˜æ–‡ä»£ç†:</p><ol><li>ä¸­é—´äººï¼Œä½œä¸ºå®¢æˆ·ç«¯ä¸çœŸå®æœåŠ¡ç«¯å»ºç«‹è¿æ¥è¿™ä¸€æ­¥ä¸ä¼šæœ‰é—®é¢˜ï¼Œå› ä¸ºæœåŠ¡ç«¯ä¸ä¼šæ ¡éªŒå®¢æˆ·ç«¯çš„èº«ä»½ï¼›</li><li>ä¸­é—´äººï¼Œä½œä¸ºæœåŠ¡ç«¯ä¸çœŸå®å®¢æˆ·ç«¯å»ºç«‹è¿æ¥ï¼Œè¿™é‡Œä¼šæœ‰å®¢æˆ·ç«¯ä¿¡ä»»æœåŠ¡ç«¯çš„é—®é¢˜ï¼Œä¹Ÿå°±æ˜¯æœåŠ¡ç«¯å¿…é¡»æœ‰å¯¹åº”åŸŸåçš„ç§é’¥ï¼›</li></ol><p>ä¸­é—´äººè¦æ‹¿åˆ°ç§é’¥åªèƒ½é€šè¿‡å¦‚ä¸‹æ–¹å¼ï¼š</p><ol><li>å»ç½‘ç«™æœåŠ¡ç«¯æ‹¿åˆ°ç§é’¥ï¼›</li><li>å»CAå¤„æ‹¿åŸŸåç­¾å‘ç§é’¥ï¼›</li><li>è‡ªå·±ç­¾å‘è¯ä¹¦ï¼Œåˆ‡è¦è¢«æµè§ˆå™¨ä¿¡ä»»ï¼›</li></ol><p>ä¸ç”¨è§£é‡Šï¼ŒæŠ“åŒ…å·¥å…·åªèƒ½ä½¿ç”¨ç¬¬ä¸‰ç§æ–¹å¼å–å¾—ä¸­é—´äººçš„èº«ä»½ã€‚</p><p>ä½¿ç”¨æŠ“åŒ…å·¥å…·è¿›è¡Œ HTTPS æŠ“åŒ…çš„æ—¶å€™ï¼Œéœ€è¦åœ¨å®¢æˆ·ç«¯å®‰è£… Fiddler çš„æ ¹è¯ä¹¦ï¼Œè¿™é‡Œå®é™…ä¸Šèµ·è®¤è¯ä¸­å¿ƒï¼ˆCAï¼‰çš„ä½œç”¨ã€‚</p><p>æŠ“åŒ…å·¥å…·èƒ½å¤ŸæŠ“åŒ…çš„å…³é”®æ˜¯å®¢æˆ·ç«¯ä¼šå¾€ç³»ç»Ÿå—ä¿¡ä»»çš„æ ¹è¯ä¹¦åˆ—è¡¨ä¸­å¯¼å…¥æŠ“åŒ…å·¥å…·ç”Ÿæˆçš„è¯ä¹¦ï¼Œè€Œè¿™ä¸ªè¯ä¹¦ä¼šè¢«æµè§ˆå™¨ä¿¡ä»»ï¼Œä¹Ÿå°±æ˜¯æŠ“åŒ…å·¥å…·ç»™è‡ªå·±åˆ›å»ºäº†ä¸€ä¸ªè®¤è¯ä¸­å¿ƒ CAï¼Œå®¢æˆ·ç«¯æ‹¿ç€ä¸­é—´äººç­¾å‘çš„è¯ä¹¦å»ä¸­é—´äººè‡ªå·±çš„ CA å»è®¤è¯ï¼Œå½“ç„¶è®¤ä¸ºè¿™ä¸ªè¯ä¹¦æ˜¯æœ‰æ•ˆçš„ã€‚</p><blockquote><p>å¦‚ä½•é¿å…è¢«ä¸­é—´äººæŠ“å–æ•°æ®ï¼Ÿ</p></blockquote><p>æˆ‘ä»¬è¦ä¿è¯è‡ªå·±ç”µè„‘çš„å®‰å…¨ï¼Œä¸è¦è¢«ç—…æ¯’ä¹˜è™šè€Œå…¥ï¼Œè€Œä¸”ä¹Ÿä¸è¦ç‚¹å‡»ä»»ä½•è¯ä¹¦éæ³•çš„ç½‘ç«™ï¼Œè¿™æ · HTTPS æ•°æ®å°±ä¸ä¼šè¢«ä¸­é—´äººæˆªå–åˆ°äº†ã€‚</p><p>å½“ç„¶ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥é€šè¿‡ <strong>HTTPS åŒå‘è®¤è¯</strong>æ¥é¿å…è¿™ç§é—®é¢˜ã€‚</p><p>ä¸€èˆ¬æˆ‘ä»¬çš„ HTTPS æ˜¯å•å‘è®¤è¯ï¼Œå®¢æˆ·ç«¯åªä¼šéªŒè¯äº†æœåŠ¡ç«¯çš„èº«ä»½ï¼Œä½†æ˜¯æœåŠ¡ç«¯å¹¶ä¸ä¼šéªŒè¯å®¢æˆ·ç«¯çš„èº«ä»½ã€‚</p><img src="'+vo+'" alt="img" style="zoom:67%;"><p>å¦‚æœç”¨äº†åŒå‘è®¤è¯æ–¹å¼ï¼Œä¸ä»…å®¢æˆ·ç«¯ä¼šéªŒè¯æœåŠ¡ç«¯çš„èº«ä»½ï¼Œè€Œä¸”æœåŠ¡ç«¯ä¹Ÿä¼šéªŒè¯å®¢æˆ·ç«¯çš„èº«ä»½ã€‚æœåŠ¡ç«¯ä¸€æ—¦éªŒè¯åˆ°è¯·æ±‚è‡ªå·±çš„å®¢æˆ·ç«¯ä¸ºä¸å¯ä¿¡ä»»çš„ï¼ŒæœåŠ¡ç«¯å°±æ‹’ç»ç»§ç»­é€šä¿¡ï¼Œå®¢æˆ·ç«¯å¦‚æœå‘ç°æœåŠ¡ç«¯ä¸ºä¸å¯ä¿¡ä»»çš„ï¼Œé‚£ä¹ˆä¹Ÿä¸­æ­¢é€šä¿¡ã€‚</p><h2 id="_3-1-6-http-1-1ã€http-2ã€http-3-æ¼”å˜" tabindex="-1"><a class="header-anchor" href="#_3-1-6-http-1-1ã€http-2ã€http-3-æ¼”å˜"><span>3.1.6 HTTP/1.1ã€HTTP/2ã€HTTP/3 æ¼”å˜</span></a></h2><h4 id="http-1-1-ç›¸æ¯”-http-1-0-æé«˜äº†ä»€ä¹ˆæ€§èƒ½" tabindex="-1"><a class="header-anchor" href="#http-1-1-ç›¸æ¯”-http-1-0-æé«˜äº†ä»€ä¹ˆæ€§èƒ½"><span>- HTTP/1.1 ç›¸æ¯” HTTP/1.0 æé«˜äº†ä»€ä¹ˆæ€§èƒ½ï¼Ÿ</span></a></h4><p>HTTP/1.1 ç›¸æ¯” HTTP/1.0 æ€§èƒ½ä¸Šçš„æ”¹è¿›ï¼š</p><ul><li>ä½¿ç”¨<strong>é•¿è¿æ¥</strong>çš„æ–¹å¼æ”¹å–„äº† HTTP/1.0 çŸ­è¿æ¥é€ æˆçš„æ€§èƒ½å¼€é”€ã€‚</li><li>æ”¯æŒ<strong>ç®¡é“ï¼ˆpipelineï¼‰ç½‘ç»œä¼ è¾“</strong>ï¼Œåªè¦ç¬¬ä¸€ä¸ªè¯·æ±‚å‘å‡ºå»äº†ï¼Œä¸å¿…ç­‰å…¶å›æ¥ï¼Œå°±å¯ä»¥å‘ç¬¬äºŒä¸ªè¯·æ±‚å‡ºå»ï¼Œå¯ä»¥å‡å°‘æ•´ä½“çš„å“åº”æ—¶é—´ã€‚</li></ul><p>ä½† HTTP/1.1 è¿˜æ˜¯æœ‰æ€§èƒ½ç“¶é¢ˆï¼š</p><ul><li>è¯·æ±‚ / å“åº”å¤´éƒ¨ï¼ˆHeaderï¼‰æœªç»å‹ç¼©å°±å‘é€ï¼Œé¦–éƒ¨ä¿¡æ¯è¶Šå¤šå»¶è¿Ÿè¶Šå¤§ã€‚åªèƒ½å‹ç¼© <code>Body</code> çš„éƒ¨åˆ†ï¼›</li><li>å‘é€å†—é•¿çš„é¦–éƒ¨ã€‚æ¯æ¬¡äº’ç›¸å‘é€ç›¸åŒçš„é¦–éƒ¨é€ æˆçš„æµªè´¹è¾ƒå¤šï¼›</li><li>æœåŠ¡å™¨æ˜¯æŒ‰è¯·æ±‚çš„é¡ºåºå“åº”çš„ï¼Œå¦‚æœæœåŠ¡å™¨å“åº”æ…¢ï¼Œä¼šæ‹›è‡´å®¢æˆ·ç«¯ä¸€ç›´è¯·æ±‚ä¸åˆ°æ•°æ®ï¼Œä¹Ÿå°±æ˜¯é˜Ÿå¤´é˜»å¡ï¼›</li><li>æ²¡æœ‰è¯·æ±‚ä¼˜å…ˆçº§æ§åˆ¶ï¼›</li><li>è¯·æ±‚åªèƒ½ä»å®¢æˆ·ç«¯å¼€å§‹ï¼ŒæœåŠ¡å™¨åªèƒ½è¢«åŠ¨å“åº”ã€‚</li></ul><h4 id="http-2-åšäº†ä»€ä¹ˆä¼˜åŒ–" tabindex="-1"><a class="header-anchor" href="#http-2-åšäº†ä»€ä¹ˆä¼˜åŒ–"><span>- HTTP/2 åšäº†ä»€ä¹ˆä¼˜åŒ–ï¼Ÿ</span></a></h4><p>HTTP/2 åè®®æ˜¯åŸºäº <strong>HTTPS çš„</strong>ï¼Œæ‰€ä»¥ HTTP/2 çš„å®‰å…¨æ€§ä¹Ÿæ˜¯æœ‰ä¿éšœçš„ã€‚</p><figure><img src="'+zo+'" alt="HTT/1 ~ HTTP/2" tabindex="0" loading="lazy"><figcaption>HTT/1 ~ HTTP/2</figcaption></figure><p>é‚£ HTTP/2 ç›¸æ¯” HTTP/1.1 æ€§èƒ½ä¸Šçš„æ”¹è¿›ï¼š</p><ul><li>å¤´éƒ¨å‹ç¼©</li><li>äºŒè¿›åˆ¶æ ¼å¼</li><li>å¹¶å‘ä¼ è¾“</li><li>æœåŠ¡å™¨ä¸»åŠ¨æ¨é€èµ„æº</li></ul><p><em>1. å¤´éƒ¨å‹ç¼©</em></p><p>HTTP/2 ä¼š<strong>å‹ç¼©å¤´</strong>ï¼ˆHeaderï¼‰å¦‚æœä½ åŒæ—¶å‘å‡ºå¤šä¸ªè¯·æ±‚ï¼Œä»–ä»¬çš„<strong>å¤´æ˜¯ä¸€æ ·çš„æˆ–æ˜¯ç›¸ä¼¼çš„</strong>ï¼Œé‚£ä¹ˆï¼Œåè®®ä¼šå¸®ä½ <strong>æ¶ˆé™¤é‡å¤çš„éƒ¨åˆ†</strong>ã€‚</p><p>è¿™å°±æ˜¯æ‰€è°“çš„ <code>HPACK</code> ç®—æ³•ï¼šåœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨åŒæ—¶ç»´æŠ¤ä¸€å¼ <strong>å¤´ä¿¡æ¯è¡¨</strong>ï¼Œæ‰€æœ‰å­—æ®µéƒ½ä¼šå­˜å…¥è¿™ä¸ªè¡¨ï¼Œç”Ÿæˆä¸€ä¸ªç´¢å¼•å·ï¼Œä»¥åå°±ä¸å‘é€åŒæ ·å­—æ®µäº†ï¼Œåªå‘é€ç´¢å¼•å·ï¼Œè¿™æ ·å°±<strong>æé«˜é€Ÿåº¦</strong>äº†ã€‚</p><p><em>2. äºŒè¿›åˆ¶æ ¼å¼</em></p><p>HTTP/2 ä¸å†åƒ HTTP/1.1 é‡Œçš„çº¯æ–‡æœ¬å½¢å¼çš„æŠ¥æ–‡ï¼Œè€Œæ˜¯å…¨é¢é‡‡ç”¨äº†<strong>äºŒè¿›åˆ¶æ ¼å¼</strong>ï¼Œå¤´ä¿¡æ¯å’Œæ•°æ®ä½“éƒ½æ˜¯äºŒè¿›åˆ¶ï¼Œå¹¶ä¸”ç»Ÿç§°ä¸ºå¸§ï¼ˆframeï¼‰ï¼š<strong>å¤´ä¿¡æ¯å¸§ï¼ˆHeaders Frameï¼‰å’Œæ•°æ®å¸§ï¼ˆData Frameï¼‰</strong>ã€‚</p><img src="'+Eo+'" alt="HTTP/1 ä¸ HTTP/2 " style="zoom:67%;"><p>è¿™æ ·è™½ç„¶å¯¹äººä¸å‹å¥½ï¼Œä½†æ˜¯<strong>å¯¹è®¡ç®—æœºéå¸¸å‹å¥½</strong>ï¼Œå› ä¸ºè®¡ç®—æœºåªæ‡‚äºŒè¿›åˆ¶ï¼Œé‚£ä¹ˆæ”¶åˆ°æŠ¥æ–‡åï¼Œæ— éœ€å†å°†æ˜æ–‡çš„æŠ¥æ–‡è½¬æˆäºŒè¿›åˆ¶ï¼Œè€Œæ˜¯ç›´æ¥è§£æäºŒè¿›åˆ¶æŠ¥æ–‡ï¼Œè¿™<strong>å¢åŠ äº†æ•°æ®ä¼ è¾“çš„æ•ˆç‡</strong>ã€‚</p><p>æ¯”å¦‚çŠ¶æ€ç  200 ï¼Œåœ¨ HTTP/1.1 æ˜¯ç”¨ &#39;2&#39;&#39;0&#39;&#39;0&#39; ä¸‰ä¸ªå­—ç¬¦æ¥è¡¨ç¤ºï¼ˆäºŒè¿›åˆ¶ï¼š00110010 00110000 00110000ï¼‰ï¼Œå…±ç”¨äº† 3 ä¸ªå­—èŠ‚ï¼Œå¦‚ä¸‹å›¾</p><figure><img src="'+wo+'" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><p>åœ¨ HTTP/2 å¯¹äºçŠ¶æ€ç  200 çš„äºŒè¿›åˆ¶ç¼–ç æ˜¯ 10001000ï¼Œåªç”¨äº† 1 å­—èŠ‚å°±èƒ½è¡¨ç¤ºï¼Œç›¸æ¯”äº HTTP/1.1 èŠ‚çœäº† 2 ä¸ªå­—èŠ‚ï¼Œå¦‚ä¸‹å›¾ï¼š</p><figure><img src="'+Ko+'" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><p>Header: :status: 200 OK çš„ç¼–ç å†…å®¹ä¸ºï¼š1000 1000ï¼Œé‚£ä¹ˆè¡¨è¾¾çš„å«ä¹‰æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ</p><figure><img src="'+Do+'" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure>',55),Qr={href:"https://xiaolincoding.com/network/2_http/http2.html",target:"_blank",rel:"noopener noreferrer"},Gr=o("li",null,"åœ¨é™æ€è¡¨é‡Œï¼Œâ€œ:status: 200 okâ€ é™æ€è¡¨ç¼–ç æ˜¯ 8ï¼ŒäºŒè¿›åˆ¶å³æ˜¯ 1000ã€‚",-1),Vr=n('<p>å› æ­¤ï¼Œæ•´ä½“åŠ èµ·æ¥å°±æ˜¯ 1000 1000ã€‚</p><p><em>3. å¹¶å‘ä¼ è¾“</em></p><p>æˆ‘ä»¬éƒ½çŸ¥é“ HTTP/1.1 çš„å®ç°æ˜¯åŸºäºè¯·æ±‚-å“åº”æ¨¡å‹çš„ã€‚åŒä¸€ä¸ªè¿æ¥ä¸­ï¼ŒHTTP å®Œæˆä¸€ä¸ªäº‹åŠ¡ï¼ˆè¯·æ±‚ä¸å“åº”ï¼‰ï¼Œæ‰èƒ½å¤„ç†ä¸‹ä¸€ä¸ªäº‹åŠ¡ï¼Œä¹Ÿå°±æ˜¯è¯´åœ¨<strong>å‘å‡ºè¯·æ±‚ç­‰å¾…å“åº”çš„è¿‡ç¨‹</strong>ä¸­ï¼Œæ˜¯æ²¡åŠæ³•åšå…¶ä»–äº‹æƒ…çš„ï¼Œå¦‚æœå“åº”è¿Ÿè¿Ÿä¸æ¥ï¼Œé‚£ä¹ˆåç»­çš„è¯·æ±‚æ˜¯æ— æ³•å‘é€çš„ï¼Œä¹Ÿé€ æˆäº†<strong>é˜Ÿå¤´é˜»å¡</strong>çš„é—®é¢˜ã€‚</p><blockquote><p>è€Œ HTTP/2 å°±å¾ˆç‰›é€¼äº†ï¼Œå¼•å‡ºäº† Stream æ¦‚å¿µï¼Œ**å¤šä¸ª Stream å¤ç”¨åœ¨ ä¸€æ¡ TCP è¿æ¥ã€‚ **</p></blockquote><figure><img src="'+Mo+'" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><p>ä»ä¸Šå›¾å¯ä»¥çœ‹åˆ°ï¼Œ1 ä¸ª TCP è¿æ¥<strong>åŒ…å«å¤šä¸ª Stream</strong>ï¼ŒStream é‡Œå¯ä»¥åŒ…å« 1 ä¸ªæˆ–å¤šä¸ª Messageï¼Œ<strong>Message å¯¹åº” HTTP/1 ä¸­çš„è¯·æ±‚æˆ–å“åº”</strong>ï¼Œç”± HTTP å¤´éƒ¨å’ŒåŒ…ä½“æ„æˆã€‚Message é‡ŒåŒ…å«ä¸€æ¡æˆ–è€…å¤šä¸ª Frameï¼ŒFrame æ˜¯ HTTP/2 æœ€å°å•ä½ï¼Œä»¥äºŒè¿›åˆ¶å‹ç¼©æ ¼å¼å­˜æ”¾ HTTP/1 ä¸­çš„å†…å®¹ï¼ˆå¤´éƒ¨å’ŒåŒ…ä½“ï¼‰ã€‚</p><p><strong>é’ˆå¯¹<code>ä¸åŒçš„ HTTP è¯·æ±‚</code>,ç”¨ç‹¬ä¸€æ— äºŒçš„ <code>Stream ID æ¥åŒºåˆ†</code>ï¼Œæ¥æ”¶ç«¯å¯ä»¥é€šè¿‡ Stream ID æœ‰åºç»„è£…æˆ HTTP æ¶ˆæ¯ï¼Œä¸åŒ Stream çš„å¸§æ˜¯å¯ä»¥<code>ä¹±åºå‘é€</code>çš„ï¼Œå› æ­¤å¯ä»¥<code>å¹¶å‘ä¸åŒçš„ Stream</code> ï¼Œä¹Ÿå°±æ˜¯ HTTP/2 å¯ä»¥<code>å¹¶è¡Œäº¤é”™åœ°å‘é€è¯·æ±‚å’Œå“åº”</code></strong>ã€‚</p><p>æ¯”å¦‚ä¸‹å›¾ï¼ŒæœåŠ¡ç«¯<strong>å¹¶è¡Œäº¤é”™åœ°</strong>å‘é€äº†ä¸¤ä¸ªå“åº”ï¼š Stream 1 å’Œ Stream 3ï¼Œè¿™ä¸¤ä¸ª Stream éƒ½æ˜¯è·‘åœ¨<strong>ä¸€ä¸ª TCP è¿æ¥ä¸Š</strong>ï¼Œå®¢æˆ·ç«¯æ”¶åˆ°åï¼Œä¼š<strong>æ ¹æ®ç›¸åŒçš„ Stream ID</strong> <strong>æœ‰åºç»„è£…æˆ HTTP æ¶ˆæ¯</strong>ã€‚</p><figure><img src="'+Lo+'" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><p><em>4ã€æœåŠ¡å™¨æ¨é€</em></p><p>HTTP/2 è¿˜åœ¨ä¸€å®šç¨‹åº¦ä¸Šæ”¹å–„äº†ä¼ ç»Ÿçš„ã€Œè¯·æ±‚ - åº”ç­”ã€å·¥ä½œæ¨¡å¼ï¼ŒæœåŠ¡ç«¯ä¸å†æ˜¯è¢«åŠ¨åœ°å“åº”ï¼Œå¯ä»¥<strong>ä¸»åŠ¨</strong>å‘å®¢æˆ·ç«¯å‘é€æ¶ˆæ¯ã€‚</p><p>å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨<strong>åŒæ–¹éƒ½å¯ä»¥å»ºç«‹ Stream</strong>ï¼Œ Stream ID ä¹Ÿæ˜¯æœ‰åŒºåˆ«çš„ï¼Œå®¢æˆ·ç«¯å»ºç«‹çš„ Stream å¿…é¡»æ˜¯å¥‡æ•°å·ï¼Œè€ŒæœåŠ¡å™¨å»ºç«‹çš„ Stream å¿…é¡»æ˜¯å¶æ•°å·ã€‚</p><p>æ¯”å¦‚ä¸‹å›¾ï¼ŒStream 1 æ˜¯å®¢æˆ·ç«¯å‘æœåŠ¡ç«¯è¯·æ±‚çš„èµ„æºï¼Œå±äºå®¢æˆ·ç«¯å»ºç«‹çš„ Streamï¼Œæ‰€ä»¥è¯¥ Stream çš„ ID æ˜¯å¥‡æ•°ï¼ˆæ•°å­— 1ï¼‰ï¼›Stream 2 å’Œ 4 éƒ½æ˜¯æœåŠ¡ç«¯ä¸»åŠ¨å‘å®¢æˆ·ç«¯æ¨é€çš„èµ„æºï¼Œå±äºæœåŠ¡ç«¯å»ºç«‹çš„ Streamï¼Œæ‰€ä»¥è¿™ä¸¤ä¸ª Stream çš„ ID æ˜¯å¶æ•°ï¼ˆæ•°å­— 2 å’Œ 4ï¼‰ã€‚</p><img src="'+Ro+'" alt="img" style="zoom:67%;"><p>å†æ¯”å¦‚ï¼Œå®¢æˆ·ç«¯é€šè¿‡ HTTP/1.1 è¯·æ±‚ä»æœåŠ¡å™¨é‚£è·å–åˆ°äº† HTML æ–‡ä»¶ï¼Œè€Œ HTML å¯èƒ½è¿˜éœ€è¦ä¾èµ– CSS æ¥æ¸²æŸ“é¡µé¢ï¼Œè¿™æ—¶å®¢æˆ·ç«¯è¿˜è¦å†å‘èµ·è·å– CSS æ–‡ä»¶çš„è¯·æ±‚ï¼Œéœ€è¦ä¸¤æ¬¡æ¶ˆæ¯å¾€è¿”ï¼Œå¦‚ä¸‹å›¾å·¦è¾¹éƒ¨åˆ†ï¼š</p><figure><img src="'+Yo+'" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><p>å¦‚ä¸Šå›¾å³è¾¹éƒ¨åˆ†ï¼Œåœ¨ HTTP/2 ä¸­ï¼Œå®¢æˆ·ç«¯åœ¨è®¿é—® HTML æ—¶ï¼ŒæœåŠ¡å™¨å¯ä»¥ç›´æ¥ä¸»åŠ¨æ¨é€ CSS æ–‡ä»¶ï¼Œå‡å°‘äº†æ¶ˆæ¯ä¼ é€’çš„æ¬¡æ•°ã€‚</p><blockquote><p>HTTP/2 æœ‰ä»€ä¹ˆç¼ºé™·ï¼Ÿ</p></blockquote><p>HTTP/2 é€šè¿‡ Stream çš„å¹¶å‘èƒ½åŠ›ï¼Œè§£å†³äº† HTTP/1 é˜Ÿå¤´é˜»å¡çš„é—®é¢˜ï¼Œçœ‹ä¼¼å¾ˆå®Œç¾äº†ï¼Œä½†æ˜¯ HTTP/2 è¿˜æ˜¯å­˜åœ¨**â€œé˜Ÿå¤´é˜»å¡â€<strong>çš„é—®é¢˜ï¼Œåªä¸è¿‡</strong>é—®é¢˜<strong>ä¸æ˜¯åœ¨ HTTP è¿™ä¸€å±‚é¢ï¼Œè€Œ</strong>æ˜¯åœ¨ TCP è¿™ä¸€å±‚**ã€‚</p><p><strong>HTTP/2 æ˜¯åŸºäº TCP åè®®æ¥ä¼ è¾“æ•°æ®çš„ï¼ŒTCP æ˜¯å­—èŠ‚æµåè®®ï¼ŒTCP å±‚å¿…é¡»ä¿è¯æ”¶åˆ°çš„å­—èŠ‚æ•°æ®æ˜¯ å®Œæ•´ä¸”è¿ç»­çš„ï¼Œ è¿™æ ·å†…æ ¸æ‰ä¼šå°†ç¼“å†²åŒºé‡Œçš„æ•°æ®è¿”å›ç»™ HTTP åº”ç”¨ï¼Œé‚£ä¹ˆå½“ã€Œå‰ 1 ä¸ªå­—èŠ‚æ•°æ®ã€æ²¡æœ‰åˆ°è¾¾æ—¶ï¼Œåæ”¶åˆ°çš„å­—èŠ‚æ•°æ®åªèƒ½å­˜æ”¾åœ¨å†…æ ¸ç¼“å†²åŒºé‡Œï¼Œåªæœ‰ç­‰åˆ°è¿™ 1 ä¸ªå­—èŠ‚æ•°æ®åˆ°è¾¾æ—¶ï¼ŒHTTP/2 åº”ç”¨å±‚æ‰èƒ½ä»å†…æ ¸ä¸­æ‹¿åˆ°æ•°æ®ï¼Œè¿™å°±æ˜¯ HTTP/2 é˜Ÿå¤´é˜»å¡é—®é¢˜ã€‚</strong></p><figure><img src="'+Uo+'" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><p>ä¸¾ä¸ªä¾‹å­ï¼Œå¦‚ä¸‹å›¾ï¼š</p><figure><img src="'+Fo+'" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><p>å›¾ä¸­å‘é€æ–¹å‘é€äº†å¾ˆå¤šä¸ª packetï¼Œæ¯ä¸ª packet éƒ½æœ‰è‡ªå·±çš„åºå·ï¼Œä½ å¯ä»¥è®¤ä¸ºæ˜¯ TCP çš„åºåˆ—å·ï¼Œå…¶ä¸­ packet 3 åœ¨ç½‘ç»œä¸­ä¸¢å¤±äº†ï¼Œå³ä½¿ packet 4-6 è¢«æ¥æ”¶æ–¹æ”¶åˆ°åï¼Œç”±äºå†…æ ¸ä¸­çš„ TCP æ•°æ®ä¸æ˜¯è¿ç»­çš„ï¼Œäºæ˜¯æ¥æ”¶æ–¹çš„åº”ç”¨å±‚å°±æ— æ³•ä»å†…æ ¸ä¸­è¯»å–åˆ°ï¼Œåªæœ‰ç­‰åˆ° packet 3 é‡ä¼ åï¼Œæ¥æ”¶æ–¹çš„åº”ç”¨å±‚æ‰å¯ä»¥ä»å†…æ ¸ä¸­è¯»å–åˆ°æ•°æ®ï¼Œè¿™å°±æ˜¯ HTTP/2 çš„é˜Ÿå¤´é˜»å¡é—®é¢˜ï¼Œæ˜¯åœ¨ TCP å±‚é¢å‘ç”Ÿçš„ã€‚</p><p>æ‰€ä»¥ï¼Œä¸€æ—¦å‘ç”Ÿäº†ä¸¢åŒ…ç°è±¡ï¼Œå°±ä¼šè§¦å‘ TCP çš„é‡ä¼ æœºåˆ¶ï¼Œè¿™æ ·åœ¨ä¸€ä¸ª TCP è¿æ¥ä¸­çš„<strong>æ‰€æœ‰çš„ HTTP è¯·æ±‚éƒ½å¿…é¡»ç­‰å¾…è¿™ä¸ªä¸¢äº†çš„åŒ…è¢«é‡ä¼ å›æ¥</strong>ã€‚</p>',25),Xr=o("p",null,"TIP",-1),Zr={href:"https://xiaolincoding.com/network/2_http/http2.html",target:"_blank",rel:"noopener noreferrer"},Jr=n('<h4 id="http-3-åšäº†å“ªäº›ä¼˜åŒ–" tabindex="-1"><a class="header-anchor" href="#http-3-åšäº†å“ªäº›ä¼˜åŒ–"><span>- HTTP/3 åšäº†å“ªäº›ä¼˜åŒ–ï¼Ÿ</span></a></h4><p>å‰é¢æˆ‘ä»¬çŸ¥é“äº† HTTP/1.1 å’Œ HTTP/2 éƒ½æœ‰é˜Ÿå¤´é˜»å¡çš„é—®é¢˜ï¼š</p><ul><li>HTTP/1.1 ä¸­çš„ç®¡é“ï¼ˆ pipelineï¼‰è™½ç„¶è§£å†³äº†è¯·æ±‚çš„é˜Ÿå¤´é˜»å¡ï¼Œä½†æ˜¯<strong>æ²¡æœ‰è§£å†³å“åº”çš„é˜Ÿå¤´é˜»å¡</strong>ï¼Œå› ä¸ºæœåŠ¡ç«¯éœ€è¦æŒ‰é¡ºåºå“åº”æ”¶åˆ°çš„è¯·æ±‚ï¼Œå¦‚æœæœåŠ¡ç«¯å¤„ç†æŸä¸ªè¯·æ±‚æ¶ˆè€—çš„æ—¶é—´æ¯”è¾ƒé•¿ï¼Œé‚£ä¹ˆåªèƒ½ç­‰å“åº”å®Œè¿™ä¸ªè¯·æ±‚åï¼Œ æ‰èƒ½å¤„ç†ä¸‹ä¸€ä¸ªè¯·æ±‚ï¼Œè¿™å±äº HTTP å±‚é˜Ÿå¤´é˜»å¡ã€‚</li><li>HTTP/2 è™½ç„¶é€šè¿‡å¤šä¸ªè¯·æ±‚å¤ç”¨ä¸€ä¸ª TCP è¿æ¥è§£å†³äº† HTTP çš„é˜Ÿå¤´é˜»å¡ ï¼Œä½†æ˜¯<strong>ä¸€æ—¦å‘ç”Ÿä¸¢åŒ…ï¼Œå°±ä¼šé˜»å¡ä½æ‰€æœ‰çš„ HTTP è¯·æ±‚</strong>ï¼Œè¿™å±äº TCP å±‚é˜Ÿå¤´é˜»å¡ã€‚</li></ul><blockquote><p>HTTP/2 <strong>é˜Ÿå¤´é˜»å¡çš„é—®é¢˜æ˜¯å› ä¸º</strong> TCPï¼Œæ‰€ä»¥ <strong>HTTP/3 æŠŠ HTTP ä¸‹å±‚çš„ TCP åè®®æ”¹æˆäº† <code>UDPï¼</code></strong></p></blockquote><figure><img src="'+jo+'" alt="HTTP/1 ~ HTTP/3" tabindex="0" loading="lazy"><figcaption>HTTP/1 ~ HTTP/3</figcaption></figure><p>UDP å‘é€æ˜¯ä¸ç®¡é¡ºåºï¼Œä¹Ÿä¸ç®¡ä¸¢åŒ…çš„ï¼Œæ‰€ä»¥ä¸ä¼šå‡ºç°åƒ HTTP/2 é˜Ÿå¤´é˜»å¡çš„é—®é¢˜ã€‚å¤§å®¶éƒ½çŸ¥é“ UDP æ˜¯ä¸å¯é ä¼ è¾“çš„ï¼Œä½†åŸºäº UDP çš„ <strong>QUIC åè®®</strong> å¯ä»¥<strong>å®ç°ç±»ä¼¼ TCP çš„å¯é æ€§ä¼ è¾“ã€‚</strong></p><blockquote><p>QUIC æœ‰ä»¥ä¸‹ 3 ä¸ªç‰¹ç‚¹ã€‚</p><ul><li>æ— é˜Ÿå¤´é˜»å¡</li><li>æ›´å¿«çš„è¿æ¥å»ºç«‹</li><li>è¿æ¥è¿ç§»</li></ul></blockquote><p><em>1ã€æ— é˜Ÿå¤´é˜»å¡</em></p><p>QUIC åè®®ä¹Ÿæœ‰ç±»ä¼¼ HTTP/2 Stream ä¸å¤šè·¯å¤ç”¨çš„æ¦‚å¿µï¼Œä¹Ÿæ˜¯å¯ä»¥åœ¨åŒä¸€æ¡è¿æ¥ä¸Šå¹¶å‘ä¼ è¾“å¤šä¸ª Streamï¼ŒStream å¯ä»¥è®¤ä¸ºå°±æ˜¯ä¸€æ¡ HTTP è¯·æ±‚ã€‚</p><p>QUIC æœ‰è‡ªå·±çš„ä¸€å¥—æœºåˆ¶å¯ä»¥ä¿è¯ä¼ è¾“çš„å¯é æ€§çš„ã€‚<strong>å½“æŸä¸ªæµå‘ç”Ÿä¸¢åŒ…æ—¶ï¼Œåªä¼šé˜»å¡è¿™ä¸ªæµï¼Œå…¶ä»–æµä¸ä¼šå—åˆ°å½±å“ï¼Œå› æ­¤ä¸å­˜åœ¨é˜Ÿå¤´é˜»å¡é—®é¢˜</strong>ã€‚è¿™ä¸ HTTP/2 ä¸åŒï¼ŒHTTP/2 åªè¦æŸä¸ªæµä¸­çš„æ•°æ®åŒ…ä¸¢å¤±äº†ï¼Œå…¶ä»–æµä¹Ÿä¼šå› æ­¤å—å½±å“ã€‚</p><p>æ‰€ä»¥ï¼ŒQUIC è¿æ¥ä¸Šçš„å¤šä¸ª Stream ä¹‹é—´å¹¶æ²¡æœ‰ä¾èµ–ï¼Œéƒ½æ˜¯ç‹¬ç«‹çš„ï¼ŒæŸä¸ªæµå‘ç”Ÿä¸¢åŒ…äº†ï¼Œåªä¼šå½±å“è¯¥æµï¼Œå…¶ä»–æµä¸å—å½±å“ã€‚</p><figure><img src="'+Wo+'" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><p><em>2ã€æ›´å¿«çš„è¿æ¥å»ºç«‹</em></p><p>å¯¹äº HTTP/1 å’Œ HTTP/2 åè®®ï¼ŒTCP å’Œ TLS æ˜¯åˆ†å±‚çš„ï¼Œåˆ†åˆ«å±äºå†…æ ¸å®ç°çš„ä¼ è¾“å±‚ã€openssl åº“å®ç°çš„è¡¨ç¤ºå±‚ï¼Œå› æ­¤å®ƒä»¬éš¾ä»¥åˆå¹¶åœ¨ä¸€èµ·ï¼Œéœ€è¦åˆ†æ‰¹æ¬¡æ¥æ¡æ‰‹ï¼Œå…ˆ TCP æ¡æ‰‹ï¼Œå† TLS æ¡æ‰‹ã€‚</p><p>HTTP/3 åœ¨ä¼ è¾“æ•°æ®å‰è™½ç„¶éœ€è¦ QUIC åè®®æ¡æ‰‹ï¼Œä½†æ˜¯è¿™ä¸ªæ¡æ‰‹è¿‡ç¨‹åªéœ€è¦ 1 RTTï¼Œæ¡æ‰‹çš„ç›®çš„æ˜¯ä¸ºç¡®è®¤åŒæ–¹çš„ã€Œè¿æ¥ IDã€ï¼Œè¿æ¥è¿ç§»å°±æ˜¯åŸºäºè¿æ¥ ID å®ç°çš„ã€‚</p><p>ä½†æ˜¯ HTTP/3 çš„ QUIC åè®®å¹¶ä¸æ˜¯ä¸ TLS åˆ†å±‚ï¼Œè€Œæ˜¯ QUIC å†…éƒ¨åŒ…å«äº† TLSï¼Œå®ƒåœ¨è‡ªå·±çš„å¸§ä¼šæºå¸¦ TLS é‡Œçš„â€œè®°å½•â€ï¼Œå†åŠ ä¸Š QUIC ä½¿ç”¨çš„æ˜¯ TLS/1.3ï¼Œå› æ­¤ä»…éœ€ 1 ä¸ª RTT å°±å¯ä»¥ã€ŒåŒæ—¶ã€å®Œæˆå»ºç«‹è¿æ¥ä¸å¯†é’¥åå•†ï¼Œå¦‚ä¸‹å›¾ï¼š</p><figure><img src="'+Bo+'" alt="TCP HTTPSï¼ˆTLS/1.3ï¼‰ å’Œ QUIC HTTPS " tabindex="0" loading="lazy"><figcaption>TCP HTTPSï¼ˆTLS/1.3ï¼‰ å’Œ QUIC HTTPS </figcaption></figure><p>ç”šè‡³ï¼Œåœ¨ç¬¬äºŒæ¬¡è¿æ¥çš„æ—¶å€™ï¼Œåº”ç”¨æ•°æ®åŒ…å¯ä»¥å’Œ QUIC æ¡æ‰‹ä¿¡æ¯ï¼ˆè¿æ¥ä¿¡æ¯ + TLS ä¿¡æ¯ï¼‰ä¸€èµ·å‘é€ï¼Œè¾¾åˆ° 0-RTT çš„æ•ˆæœã€‚</p><p>å¦‚ä¸‹å›¾å³è¾¹éƒ¨åˆ†ï¼ŒHTTP/3 å½“ä¼šè¯æ¢å¤æ—¶ï¼Œæœ‰æ•ˆè´Ÿè½½æ•°æ®ä¸ç¬¬ä¸€ä¸ªæ•°æ®åŒ…ä¸€èµ·å‘é€ï¼Œå¯ä»¥åšåˆ° 0-RTTï¼ˆä¸‹å›¾çš„å³ä¸‹è§’ï¼‰ï¼š</p><figure><img src="'+Oo+'" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><p><em>3ã€è¿æ¥è¿ç§»</em></p><p>åŸºäº TCP ä¼ è¾“åè®®çš„ HTTP åè®®ï¼Œç”±äºæ˜¯é€šè¿‡å››å…ƒç»„ï¼ˆæº IPã€æºç«¯å£ã€ç›®çš„ IPã€ç›®çš„ç«¯å£ï¼‰ç¡®å®šä¸€æ¡ TCP è¿æ¥ã€‚</p><figure><img src="'+Qo+'" alt="TCP å››å…ƒç»„" tabindex="0" loading="lazy"><figcaption>TCP å››å…ƒç»„</figcaption></figure><p>é‚£ä¹ˆ<strong>å½“ç§»åŠ¨è®¾å¤‡çš„ç½‘ç»œä» 4G åˆ‡æ¢åˆ° WIFI æ—¶ï¼Œæ„å‘³ç€ IP åœ°å€å˜åŒ–äº†ï¼Œé‚£ä¹ˆå°±å¿…é¡»è¦æ–­å¼€è¿æ¥ï¼Œç„¶åé‡æ–°å»ºç«‹è¿æ¥</strong>ã€‚è€Œå»ºç«‹è¿æ¥çš„è¿‡ç¨‹åŒ…å« TCP ä¸‰æ¬¡æ¡æ‰‹å’Œ TLS å››æ¬¡æ¡æ‰‹çš„æ—¶å»¶ï¼Œä»¥åŠ TCP æ…¢å¯åŠ¨çš„å‡é€Ÿè¿‡ç¨‹ï¼Œç»™ç”¨æˆ·çš„æ„Ÿè§‰å°±æ˜¯ç½‘ç»œçªç„¶å¡é¡¿äº†ä¸€ä¸‹ï¼Œå› æ­¤è¿æ¥çš„è¿ç§»æˆæœ¬æ˜¯å¾ˆé«˜çš„ã€‚</p><p>è€Œ QUIC åè®®æ²¡æœ‰ç”¨å››å…ƒç»„çš„æ–¹å¼æ¥â€œç»‘å®šâ€è¿æ¥ï¼Œè€Œæ˜¯é€šè¿‡<strong>è¿æ¥ ID</strong> æ¥æ ‡è®°é€šä¿¡çš„ä¸¤ä¸ªç«¯ç‚¹ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨å¯ä»¥å„è‡ªé€‰æ‹©ä¸€ç»„ ID æ¥æ ‡è®°è‡ªå·±ï¼Œå› æ­¤å³ä½¿ç§»åŠ¨è®¾å¤‡çš„ç½‘ç»œå˜åŒ–åï¼Œå¯¼è‡´ IP åœ°å€å˜åŒ–äº†ï¼Œåªè¦ä»ä¿æœ‰ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼ˆæ¯”å¦‚è¿æ¥ IDã€TLS å¯†é’¥ç­‰ï¼‰ï¼Œå°±å¯ä»¥â€œæ— ç¼â€åœ°å¤ç”¨åŸè¿æ¥ï¼Œæ¶ˆé™¤é‡è¿çš„æˆæœ¬ï¼Œæ²¡æœ‰ä¸æ¯«å¡é¡¿æ„Ÿï¼Œè¾¾åˆ°äº†<strong>è¿æ¥è¿ç§»</strong>çš„åŠŸèƒ½ã€‚</p><p>æ‰€ä»¥ï¼Œ QUIC æ˜¯ä¸€ä¸ªåœ¨ UDP ä¹‹ä¸Šçš„<strong>ä¼ª</strong> TCP + TLS + HTTP/2 çš„å¤šè·¯å¤ç”¨çš„åè®®ã€‚</p><p>QUIC æ˜¯æ–°åè®®ï¼Œå¯¹äºå¾ˆå¤šç½‘ç»œè®¾å¤‡ï¼Œæ ¹æœ¬ä¸çŸ¥é“ä»€ä¹ˆæ˜¯ QUICï¼Œåªä¼šå½“åš UDPï¼Œè¿™æ ·ä¼šå‡ºç°æ–°çš„é—®é¢˜ï¼Œå› ä¸ºæœ‰çš„ç½‘ç»œè®¾å¤‡æ˜¯ä¼šä¸¢æ‰ UDP åŒ…çš„ï¼Œè€Œ QUIC æ˜¯åŸºäº UDP å®ç°çš„ï¼Œé‚£ä¹ˆå¦‚æœç½‘ç»œè®¾å¤‡æ— æ³•è¯†åˆ«è¿™ä¸ªæ˜¯ QUIC åŒ…ï¼Œé‚£ä¹ˆå°±ä¼šå½“ä½œ UDPåŒ…ï¼Œç„¶åè¢«ä¸¢å¼ƒã€‚</p><p>HTTP/3 ç°åœ¨æ™®åŠçš„è¿›åº¦éå¸¸çš„ç¼“æ…¢ï¼Œä¸çŸ¥é“æœªæ¥ UDP æ˜¯å¦èƒ½å¤Ÿé€†è¢­ TCPã€‚</p><p>TIP</p><p>å¦‚æœæƒ³æ›´è¿›ä¸€æ­¥äº†è§£ HTTP/3 å’Œ QUIC åè®®ï¼Œå¯ä»¥çœ‹æˆ‘è¿™ä¸¤ç¯‡æ–‡ç« ï¼š</p>',30),$r={href:"https://xiaolincoding.com/network/2_http/http3.html",target:"_blank",rel:"noopener noreferrer"},oi={href:"https://xiaolincoding.com/network/3_tcp/quic.html",target:"_blank",rel:"noopener noreferrer"},ti=n('<p>è¯»è€…é—®ç­”</p><blockquote><p>è¯»è€…é—®ï¼šâ€œhttps å’Œ http ç›¸æ¯”ï¼Œå°±æ˜¯ä¼ è¾“çš„å†…å®¹å¤šäº†å¯¹ç§°åŠ å¯†ï¼Œå¯ä»¥è¿™ä¹ˆç†è§£å—ï¼Ÿâ€</p></blockquote><ol><li>å»ºç«‹è¿æ¥æ—¶å€™ï¼šhttps æ¯” httpå¤šäº† <strong>TLS çš„æ¡æ‰‹è¿‡ç¨‹</strong>ï¼›</li><li>ä¼ è¾“å†…å®¹çš„æ—¶å€™ï¼šhttps ä¼š<strong>æŠŠæ•°æ®è¿›è¡ŒåŠ å¯†</strong>ï¼Œé€šå¸¸æ˜¯å¯¹ç§°åŠ å¯†æ•°æ®ï¼›</li></ol><blockquote><p>è¯»è€…é—®ï¼šâ€œ æˆ‘çœ‹æ–‡ä¸­ TLS å’Œ SSL æ²¡æœ‰åšåŒºåˆ†ï¼Œè¿™ä¸¤ä¸ªéœ€è¦åŒºåˆ†å—ï¼Ÿâ€</p></blockquote><p>è¿™ä¸¤å®é™…ä¸Šæ˜¯ä¸€ä¸ªä¸œè¥¿ã€‚</p><p>SSL æ˜¯æ´‹æ–‡ â€œ<em>Secure Sockets Layer</em>â€ çš„ç¼©å†™ï¼Œä¸­æ–‡å«åšã€Œå®‰å…¨å¥—æ¥å±‚ã€ã€‚å®ƒæ˜¯åœ¨ä¸Šä¸–çºª 90 å¹´ä»£ä¸­æœŸï¼Œç”±ç½‘æ™¯å…¬å¸è®¾è®¡çš„ã€‚</p><p>åˆ°äº†1999å¹´ï¼ŒSSL å› ä¸ºåº”ç”¨å¹¿æ³›ï¼Œå·²ç»æˆä¸ºäº’è”ç½‘ä¸Šçš„äº‹å®æ ‡å‡†ã€‚IETF å°±åœ¨é‚£å¹´æŠŠ SSL æ ‡å‡†åŒ–ã€‚æ ‡å‡†åŒ–ä¹‹åçš„åç§°æ”¹ä¸º TLSï¼ˆæ˜¯ â€œ<em>Transport Layer Security</em>â€ çš„ç¼©å†™ï¼‰ï¼Œä¸­æ–‡å«åš ã€Œä¼ è¾“å±‚å®‰å…¨åè®®ã€ã€‚</p><p>å¾ˆå¤šç›¸å…³çš„æ–‡ç« éƒ½æŠŠè¿™ä¸¤è€…å¹¶åˆ—ç§°å‘¼ï¼ˆSSL/TLSï¼‰ï¼Œå› ä¸ºè¿™ä¸¤è€…å¯ä»¥è§†ä½œåŒä¸€ä¸ªä¸œè¥¿çš„ä¸åŒé˜¶æ®µã€‚</p><blockquote><p>è¯»è€…é—®ï¼šâ€œä¸ºå•¥ SSL çš„æ¡æ‰‹æ˜¯ 4 æ¬¡ï¼Ÿâ€</p></blockquote><p>SSL/TLS 1.2 **éœ€è¦ 4 æ¡æ‰‹ï¼Œéœ€è¦ 2 ä¸ª RTT çš„æ—¶å»¶ï¼Œ**æˆ‘æ–‡ä¸­çš„å›¾æ˜¯æŠŠæ¯ä¸ªäº¤äº’åˆ†å¼€ç”»äº†ï¼Œå®é™…ä¸ŠæŠŠä»–ä»¬åˆåœ¨ä¸€èµ·å‘é€ï¼Œå°±æ˜¯ 4 æ¬¡æ¡æ‰‹ï¼š</p><figure><img src="'+Go+'" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><p>å¦å¤–ï¼Œ SSL/TLS 1.3 ä¼˜åŒ–äº†è¿‡ç¨‹ï¼Œåªéœ€è¦ 1 ä¸ª RTT å¾€è¿”æ—¶å»¶ï¼Œä¹Ÿå°±æ˜¯åªéœ€è¦ 3 æ¬¡æ¡æ‰‹ï¼š</p><figure><img src="'+Vo+'" alt="T" tabindex="0" loading="lazy"><figcaption>T</figcaption></figure><h1 id="-2" tabindex="-1"><a class="header-anchor" href="#-2"><span>----------------</span></a></h1><h1 id="å››ã€-tcpç¯‡" tabindex="-1"><a class="header-anchor" href="#å››ã€-tcpç¯‡"><span>å››ã€ TCPç¯‡</span></a></h1><h2 id="-3" tabindex="-1"><a class="header-anchor" href="#-3"><span>--------------</span></a></h2><h2 id="ğŸğŸğŸ4-1-tcp-ä¸‰æ¬¡æ¡æ‰‹ä¸å››æ¬¡æŒ¥æ‰‹é¢è¯•é¢˜" tabindex="-1"><a class="header-anchor" href="#ğŸğŸğŸ4-1-tcp-ä¸‰æ¬¡æ¡æ‰‹ä¸å››æ¬¡æŒ¥æ‰‹é¢è¯•é¢˜"><span>ğŸğŸğŸ4.1 TCP ä¸‰æ¬¡æ¡æ‰‹ä¸å››æ¬¡æŒ¥æ‰‹é¢è¯•é¢˜</span></a></h2><p>å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯å°æ—ã€‚</p><p><strong>ä»» TCP è™æˆ‘åƒç™¾éï¼Œæˆ‘ä»å¾… TCP å¦‚åˆæ‹ã€‚</strong></p><p>å·¨å·¨å·¨å·¨é•¿çš„æçº²ï¼Œå‘è½¦ï¼å‘è½¦ï¼</p><img src="'+Xo+'" alt="img"><h3 id="_4-1-1-tcp-åŸºæœ¬è®¤è¯†" tabindex="-1"><a class="header-anchor" href="#_4-1-1-tcp-åŸºæœ¬è®¤è¯†"><span>4.1.1 TCP åŸºæœ¬è®¤è¯†</span></a></h3><h4 id="tcp-å¤´æ ¼å¼æœ‰å“ªäº›" tabindex="-1"><a class="header-anchor" href="#tcp-å¤´æ ¼å¼æœ‰å“ªäº›"><span>- TCP å¤´æ ¼å¼æœ‰å“ªäº›ï¼Ÿ</span></a></h4><p>æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹ TCP å¤´çš„æ ¼å¼ï¼Œæ ‡æ³¨é¢œè‰²çš„è¡¨ç¤ºä¸æœ¬æ–‡å…³è”æ¯”è¾ƒå¤§çš„å­—æ®µï¼Œå…¶ä»–å­—æ®µä¸åšè¯¦ç»†é˜è¿°ã€‚</p><img src="'+Zo+'" alt="TCP å¤´æ ¼å¼" style="zoom:67%;"><p><strong>åºåˆ—å·</strong>ï¼šåœ¨å»ºç«‹è¿æ¥æ—¶ç”±è®¡ç®—æœºç”Ÿæˆçš„éšæœºæ•°ä½œä¸ºå…¶åˆå§‹å€¼ï¼Œé€šè¿‡ SYN åŒ…ä¼ ç»™æ¥æ”¶ç«¯ä¸»æœºï¼Œæ¯å‘é€ä¸€æ¬¡æ•°æ®ï¼Œå°±ã€Œç´¯åŠ ã€ä¸€æ¬¡è¯¥ã€Œæ•°æ®å­—èŠ‚æ•°ã€çš„å¤§å°ã€‚<strong>ç”¨æ¥è§£å†³ç½‘ç»œåŒ…ä¹±åºé—®é¢˜ã€‚</strong></p><p><strong>ç¡®è®¤åº”ç­”å·</strong>ï¼šæŒ‡<strong>ä¸‹ä¸€æ¬¡ã€ŒæœŸæœ›ã€æ”¶åˆ°çš„æ•°æ®</strong>çš„<strong>åºåˆ—å·</strong>ï¼Œå‘é€ç«¯æ”¶åˆ°è¿™ä¸ªç¡®è®¤åº”ç­”ä»¥åå¯ä»¥è®¤ä¸ºåœ¨è¿™ä¸ªåºå·ä»¥å‰çš„æ•°æ®éƒ½å·²ç»è¢«æ­£å¸¸æ¥æ”¶ã€‚<strong>ç”¨æ¥è§£å†³ä¸¢åŒ…çš„é—®é¢˜ã€‚</strong></p><p><strong>æ§åˆ¶ä½ï¼š</strong></p><ul><li><em>ACK</em>ï¼šè¯¥ä½ä¸º <code>1</code> æ—¶ï¼Œã€Œç¡®è®¤åº”ç­”ã€çš„å­—æ®µå˜ä¸ºæœ‰æ•ˆï¼ŒTCP è§„å®šé™¤äº†æœ€åˆå»ºç«‹è¿æ¥æ—¶çš„ <code>SYN</code> åŒ…ä¹‹å¤–è¯¥ä½å¿…é¡»è®¾ç½®ä¸º <code>1</code> ã€‚</li><li><em>RST</em>ï¼šè¯¥ä½ä¸º <code>1</code> æ—¶ï¼Œè¡¨ç¤º TCP è¿æ¥ä¸­å‡ºç°<strong>å¼‚å¸¸</strong>å¿…é¡»å¼ºåˆ¶æ–­å¼€è¿æ¥ã€‚</li><li><em>SYN</em>ï¼šè¯¥ä½ä¸º <code>1</code> æ—¶ï¼Œè¡¨ç¤ºå¸Œæœ›å»ºç«‹è¿æ¥ï¼Œå¹¶åœ¨å…¶ã€Œåºåˆ—å·ã€çš„å­—æ®µè¿›è¡Œåºåˆ—å·åˆå§‹å€¼çš„è®¾å®šã€‚</li><li><em>FIN</em>ï¼šè¯¥ä½ä¸º <code>1</code> æ—¶ï¼Œè¡¨ç¤ºä»Šåä¸ä¼šå†æœ‰æ•°æ®å‘é€ï¼Œå¸Œæœ›æ–­å¼€è¿æ¥ã€‚å½“é€šä¿¡ç»“æŸå¸Œæœ›æ–­å¼€è¿æ¥æ—¶ï¼Œé€šä¿¡åŒæ–¹çš„ä¸»æœºä¹‹é—´å°±å¯ä»¥ç›¸äº’äº¤æ¢ <code>FIN</code> ä½ä¸º 1 çš„ TCP æ®µã€‚</li></ul><h4 id="ä¸ºä»€ä¹ˆéœ€è¦-tcp-åè®®-tcp-å·¥ä½œåœ¨å“ªä¸€å±‚" tabindex="-1"><a class="header-anchor" href="#ä¸ºä»€ä¹ˆéœ€è¦-tcp-åè®®-tcp-å·¥ä½œåœ¨å“ªä¸€å±‚"><span>- ä¸ºä»€ä¹ˆéœ€è¦ TCP åè®®ï¼Ÿ TCP å·¥ä½œåœ¨å“ªä¸€å±‚ï¼Ÿ</span></a></h4><p><code>IP</code> å±‚æ˜¯**ã€Œä¸å¯é ã€<strong>çš„ï¼Œå®ƒ</strong>ä¸ä¿è¯ç½‘ç»œåŒ…çš„äº¤ä»˜**ã€<strong>ä¸ä¿è¯ç½‘ç»œåŒ…çš„æŒ‰åºäº¤ä»˜</strong>ã€ä¹Ÿ<strong>ä¸ä¿è¯ç½‘ç»œåŒ…ä¸­çš„æ•°æ®çš„å®Œæ•´æ€§</strong>ã€‚</p><figure><img src="'+Jo+'" alt="OSI å‚è€ƒæ¨¡å‹ä¸ TCP/IP çš„å…³ç³»" tabindex="0" loading="lazy"><figcaption>OSI å‚è€ƒæ¨¡å‹ä¸ TCP/IP çš„å…³ç³»</figcaption></figure><p>å¦‚æœ<strong>éœ€è¦ä¿éšœç½‘ç»œæ•°æ®åŒ…çš„å¯é æ€§</strong>ï¼Œé‚£ä¹ˆå°±éœ€è¦ç”±ä¸Šå±‚ï¼ˆä¼ è¾“å±‚ï¼‰çš„ <code>TCP</code> åè®®<strong>æ¥è´Ÿè´£ã€‚</strong></p><p>å› ä¸º TCP æ˜¯ä¸€ä¸ªå·¥ä½œåœ¨<strong>ä¼ è¾“å±‚</strong>çš„<strong>å¯é </strong>æ•°æ®ä¼ è¾“çš„æœåŠ¡ï¼Œå®ƒèƒ½ç¡®ä¿æ¥æ”¶ç«¯æ¥æ”¶çš„ç½‘ç»œåŒ…æ˜¯<strong>æ— æŸåã€æ— é—´éš”ã€éå†—ä½™å’ŒæŒ‰åºçš„ã€‚</strong></p><h4 id="ä»€ä¹ˆæ˜¯-tcp" tabindex="-1"><a class="header-anchor" href="#ä»€ä¹ˆæ˜¯-tcp"><span>- ä»€ä¹ˆæ˜¯ TCP ï¼Ÿ</span></a></h4><p>TCP æ˜¯<strong>é¢å‘è¿æ¥çš„ã€å¯é çš„ã€åŸºäºå­—èŠ‚æµ</strong>çš„ä¼ è¾“å±‚é€šä¿¡åè®®ã€‚</p><figure><img src="'+$o+'" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><ul><li><strong>é¢å‘è¿æ¥</strong>ï¼šä¸€å®šæ˜¯ã€Œä¸€å¯¹ä¸€ã€æ‰èƒ½è¿æ¥ï¼Œä¸èƒ½åƒ UDP åè®®å¯ä»¥ä¸€ä¸ªä¸»æœºåŒæ—¶å‘å¤šä¸ªä¸»æœºå‘é€æ¶ˆæ¯ï¼Œä¹Ÿå°±æ˜¯ä¸€å¯¹å¤šæ˜¯æ— æ³•åšåˆ°çš„ï¼›</li><li><strong>å¯é çš„</strong>ï¼šæ— è®ºçš„ç½‘ç»œé“¾è·¯ä¸­å‡ºç°äº†æ€æ ·çš„é“¾è·¯å˜åŒ–ï¼ŒTCP éƒ½å¯ä»¥ä¿è¯ä¸€ä¸ªæŠ¥æ–‡ä¸€å®šèƒ½å¤Ÿåˆ°è¾¾æ¥æ”¶ç«¯ï¼›</li><li><strong>å­—èŠ‚æµ</strong>ï¼šç”¨æˆ·æ¶ˆæ¯é€šè¿‡ TCP åè®®ä¼ è¾“æ—¶ï¼Œæ¶ˆæ¯å¯èƒ½ä¼šè¢«æ“ä½œç³»ç»Ÿã€Œåˆ†ç»„ã€æˆå¤šä¸ªçš„ TCP æŠ¥æ–‡ï¼Œå¦‚æœæ¥æ”¶æ–¹çš„ç¨‹åºå¦‚æœä¸çŸ¥é“ã€Œæ¶ˆæ¯çš„è¾¹ç•Œã€ï¼Œæ˜¯æ— æ³•è¯»å‡ºä¸€ä¸ªæœ‰æ•ˆçš„ç”¨æˆ·æ¶ˆæ¯çš„ã€‚å¹¶ä¸” TCP æŠ¥æ–‡æ˜¯ã€Œæœ‰åºçš„ã€ï¼Œå½“ã€Œå‰ä¸€ä¸ªã€TCP æŠ¥æ–‡æ²¡æœ‰æ”¶åˆ°çš„æ—¶å€™ï¼Œå³ä½¿å®ƒå…ˆæ”¶åˆ°äº†åé¢çš„ TCP æŠ¥æ–‡ï¼Œé‚£ä¹ˆä¹Ÿä¸èƒ½æ‰”ç»™åº”ç”¨å±‚å»å¤„ç†ï¼ŒåŒæ—¶å¯¹ã€Œé‡å¤ã€çš„ TCP æŠ¥æ–‡ä¼šè‡ªåŠ¨ä¸¢å¼ƒã€‚</li></ul><h4 id="ä»€ä¹ˆæ˜¯-tcp-è¿æ¥" tabindex="-1"><a class="header-anchor" href="#ä»€ä¹ˆæ˜¯-tcp-è¿æ¥"><span>- ä»€ä¹ˆæ˜¯ TCP è¿æ¥ï¼Ÿ</span></a></h4><p>æˆ‘ä»¬æ¥çœ‹çœ‹ RFC 793 æ˜¯å¦‚ä½•å®šä¹‰ã€Œè¿æ¥ã€çš„ï¼š</p><p><em>Connections: The reliability and flow control mechanisms described above require that TCPs initialize and maintain certain status information for each data stream. The combination of this information, including sockets, sequence numbers, and window sizes, is called a connection.</em></p><p>ç®€å•æ¥è¯´å°±æ˜¯ï¼Œ<strong>ç”¨äºä¿è¯å¯é æ€§å’Œæµé‡æ§åˆ¶ç»´æŠ¤çš„æŸäº›çŠ¶æ€ä¿¡æ¯ï¼Œè¿™äº›ä¿¡æ¯çš„ç»„åˆï¼ŒåŒ…æ‹¬ Socketã€åºåˆ—å·å’Œçª—å£å¤§å°ç§°ä¸ºè¿æ¥ã€‚</strong></p><figure><img src="'+ot+'" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><p>æ‰€ä»¥æˆ‘ä»¬å¯ä»¥çŸ¥é“ï¼Œ<strong>å»ºç«‹ä¸€ä¸ª TCP è¿æ¥</strong>æ˜¯éœ€è¦<strong>å®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯</strong>è¾¾æˆä¸Šè¿°<strong>ä¸‰ä¸ªä¿¡æ¯çš„å…±è¯†ã€‚</strong></p><ul><li><strong>Socket</strong>ï¼šç”± IP åœ°å€å’Œç«¯å£å·ç»„æˆ</li><li><strong>åºåˆ—å·</strong>ï¼šç”¨æ¥è§£å†³ä¹±åºé—®é¢˜ç­‰</li><li><strong>çª—å£å¤§å°</strong>ï¼šç”¨æ¥åšæµé‡æ§åˆ¶</li></ul><h4 id="å¦‚ä½•å”¯ä¸€ç¡®å®šä¸€ä¸ª-tcp-è¿æ¥å‘¢" tabindex="-1"><a class="header-anchor" href="#å¦‚ä½•å”¯ä¸€ç¡®å®šä¸€ä¸ª-tcp-è¿æ¥å‘¢"><span>- å¦‚ä½•å”¯ä¸€ç¡®å®šä¸€ä¸ª TCP è¿æ¥å‘¢ï¼Ÿ</span></a></h4><blockquote><p>TCP <strong>å››å…ƒç»„</strong>å¯ä»¥å”¯ä¸€çš„ç¡®å®šä¸€ä¸ªè¿æ¥ï¼Œ<strong>å››å…ƒç»„</strong>åŒ…æ‹¬å¦‚ä¸‹ï¼š</p><ul><li><strong>æºåœ°å€</strong></li><li><strong>æºç«¯å£</strong></li><li><strong>ç›®çš„åœ°å€</strong></li><li><strong>ç›®çš„ç«¯å£</strong></li></ul></blockquote><img src="'+tt+'" alt="TCP å››å…ƒç»„" style="zoom:50%;"><p><strong>æºåœ°å€</strong>å’Œ<strong>ç›®çš„åœ°å€</strong>çš„å­—æ®µï¼ˆ32 ä½ï¼‰æ˜¯åœ¨ IP å¤´éƒ¨ä¸­ï¼Œä½œç”¨æ˜¯é€šè¿‡ IP åè®®<strong>å‘é€æŠ¥æ–‡ç»™å¯¹æ–¹ä¸»æœºã€‚</strong></p><p><strong>æºç«¯å£</strong>å’Œ<strong>ç›®çš„ç«¯å£</strong>çš„å­—æ®µï¼ˆ16 ä½ï¼‰æ˜¯åœ¨ TCP å¤´éƒ¨ä¸­ï¼Œä½œç”¨æ˜¯å‘Šè¯‰ TCP åè®®åº”è¯¥æŠŠæŠ¥æ–‡å‘ç»™<strong>å“ªä¸ªè¿›ç¨‹ã€‚</strong></p><blockquote><p>æœ‰ä¸€ä¸ª IP çš„æœåŠ¡ç«¯ç›‘å¬äº†ä¸€ä¸ªç«¯å£ï¼Œå®ƒçš„ TCP çš„<strong>æœ€å¤§è¿æ¥æ•°</strong>æ˜¯å¤šå°‘ï¼Ÿ</p></blockquote><p>æœåŠ¡ç«¯é€šå¸¸<strong>å›ºå®šåœ¨æŸä¸ªæœ¬åœ°ç«¯å£</strong>ä¸Š<strong>ç›‘å¬</strong>ï¼Œç­‰å¾…å®¢æˆ·ç«¯çš„<strong>è¿æ¥è¯·æ±‚</strong>ã€‚</p><p>å› æ­¤ï¼Œå®¢æˆ·ç«¯ IP å’Œç«¯å£æ˜¯å¯å˜çš„ï¼Œå…¶ç†è®ºå€¼è®¡ç®—å…¬å¼å¦‚ä¸‹:</p><figure><img src="'+st+'" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><p>å¯¹ IPv4ï¼Œå®¢æˆ·ç«¯çš„ IP æ•°æœ€å¤šä¸º <code>2</code> çš„ <code>32</code> æ¬¡æ–¹ï¼Œå®¢æˆ·ç«¯çš„ç«¯å£æ•°æœ€å¤šä¸º <code>2</code> çš„ <code>16</code> æ¬¡æ–¹ï¼Œä¹Ÿå°±æ˜¯æœåŠ¡ç«¯å•æœºæœ€å¤§ TCP è¿æ¥æ•°ï¼Œçº¦ä¸º <code>2</code> çš„ <code>48</code> æ¬¡æ–¹ã€‚</p><p>å½“ç„¶ï¼Œ<strong>æœåŠ¡ç«¯æœ€å¤§å¹¶å‘ TCP è¿æ¥æ•°</strong>è¿œä¸èƒ½è¾¾åˆ°ç†è®ºä¸Šé™ï¼Œä¼šå—ä»¥ä¸‹å› ç´ å½±å“ï¼š</p><ul><li><p><strong>æ–‡ä»¶æè¿°ç¬¦é™åˆ¶</strong></p><p>ï¼Œæ¯ä¸ª TCP è¿æ¥éƒ½æ˜¯ä¸€ä¸ªæ–‡ä»¶ï¼Œ<strong>å¦‚æœæ–‡ä»¶æè¿°ç¬¦è¢«å æ»¡äº†</strong>ï¼Œä¼šå‘ç”Ÿ Too many open filesã€‚Linux å¯¹å¯æ‰“å¼€çš„æ–‡ä»¶æè¿°ç¬¦çš„æ•°é‡åˆ†åˆ«ä½œäº†ä¸‰ä¸ªæ–¹é¢çš„é™åˆ¶ï¼š</p><ul><li><strong>ç³»ç»Ÿçº§</strong>ï¼šå½“å‰ç³»ç»Ÿå¯æ‰“å¼€çš„æœ€å¤§æ•°é‡ï¼Œé€šè¿‡ <code>cat /proc/sys/fs/file-max</code> æŸ¥çœ‹ï¼›</li><li><strong>ç”¨æˆ·çº§</strong>ï¼šæŒ‡å®šç”¨æˆ·å¯æ‰“å¼€çš„æœ€å¤§æ•°é‡ï¼Œé€šè¿‡ <code>cat /etc/security/limits.conf</code> æŸ¥çœ‹ï¼›</li><li><strong>è¿›ç¨‹çº§</strong>ï¼šå•ä¸ªè¿›ç¨‹å¯æ‰“å¼€çš„æœ€å¤§æ•°é‡ï¼Œé€šè¿‡ <code>cat /proc/sys/fs/nr_open</code> æŸ¥çœ‹ï¼›</li></ul></li><li><p><strong>å†…å­˜é™åˆ¶</strong>ï¼Œæ¯ä¸ª TCP è¿æ¥éƒ½è¦å ç”¨ä¸€å®šå†…å­˜ï¼Œæ“ä½œç³»ç»Ÿçš„å†…å­˜æ˜¯æœ‰é™çš„ï¼Œå¦‚æœå†…å­˜èµ„æºè¢«å æ»¡åï¼Œä¼šå‘ç”Ÿ OOMã€‚</p></li></ul><h4 id="udp-å’Œ-tcp-æœ‰ä»€ä¹ˆåŒºåˆ«å‘¢-åˆ†åˆ«çš„åº”ç”¨åœºæ™¯æ˜¯" tabindex="-1"><a class="header-anchor" href="#udp-å’Œ-tcp-æœ‰ä»€ä¹ˆåŒºåˆ«å‘¢-åˆ†åˆ«çš„åº”ç”¨åœºæ™¯æ˜¯"><span>- UDP å’Œ TCP æœ‰ä»€ä¹ˆåŒºåˆ«å‘¢ï¼Ÿåˆ†åˆ«çš„åº”ç”¨åœºæ™¯æ˜¯ï¼Ÿ</span></a></h4><p>UDP ä¸æä¾›å¤æ‚çš„æ§åˆ¶æœºåˆ¶ï¼Œåˆ©ç”¨ IP æä¾›<strong>é¢å‘ã€Œæ— è¿æ¥ã€çš„é€šä¿¡æœåŠ¡ã€‚</strong></p><p>UDP åè®®çœŸçš„éå¸¸ç®€å•ï¼Œ<strong>å¤´éƒ¨</strong>åªæœ‰ <code>8</code> ä¸ªå­—èŠ‚ï¼ˆ64 ä½ï¼‰ï¼ŒUDP çš„å¤´éƒ¨æ ¼å¼å¦‚ä¸‹ï¼š</p><img src="'+et+'" alt="UDP å¤´éƒ¨æ ¼å¼" style="zoom:67%;"><ul><li>ç›®æ ‡å’Œæºç«¯å£ï¼šä¸»è¦æ˜¯å‘Šè¯‰ UDP åè®®åº”è¯¥æŠŠæŠ¥æ–‡å‘ç»™å“ªä¸ªè¿›ç¨‹ã€‚</li><li>åŒ…é•¿åº¦ï¼šè¯¥å­—æ®µä¿å­˜äº† UDP é¦–éƒ¨çš„é•¿åº¦è·Ÿæ•°æ®çš„é•¿åº¦ä¹‹å’Œã€‚</li><li>æ ¡éªŒå’Œï¼šæ ¡éªŒå’Œæ˜¯ä¸ºäº†æä¾›å¯é çš„ UDP é¦–éƒ¨å’Œæ•°æ®<strong>è€Œè®¾è®¡</strong>ï¼Œé˜²æ­¢æ”¶åˆ°åœ¨ç½‘ç»œä¼ è¾“ä¸­å—æŸçš„ UDP åŒ…ã€‚</li></ul><p><strong>TCP å’Œ UDP åŒºåˆ«ï¼š</strong></p><p><em>1. è¿æ¥</em></p><ul><li>TCP æ˜¯é¢å‘è¿æ¥çš„ä¼ è¾“å±‚åè®®ï¼Œä¼ è¾“æ•°æ®å‰å…ˆè¦å»ºç«‹è¿æ¥ã€‚</li><li>UDP <strong>æ˜¯ä¸éœ€è¦è¿æ¥ï¼Œå³åˆ»ä¼ è¾“æ•°æ®ã€‚</strong></li></ul><p><em>2. æœåŠ¡å¯¹è±¡</em></p><ul><li>TCP æ˜¯ä¸€å¯¹ä¸€çš„ä¸¤ç‚¹æœåŠ¡ï¼Œå³ä¸€æ¡è¿æ¥åªæœ‰ä¸¤ä¸ªç«¯ç‚¹ã€‚</li><li>UDP æ”¯æŒä¸€å¯¹ä¸€ã€ä¸€å¯¹å¤šã€å¤šå¯¹å¤šçš„äº¤äº’é€šä¿¡</li></ul><p><em>3. å¯é æ€§</em></p>',68),si=o("li",null,"TCP æ˜¯å¯é äº¤ä»˜æ•°æ®çš„ï¼Œæ•°æ®å¯ä»¥æ— å·®é”™ã€ä¸ä¸¢å¤±ã€ä¸é‡å¤ã€æŒ‰åºåˆ°è¾¾ã€‚",-1),ei=o("strong",null,"å°½æœ€å¤§åŠªåŠ›äº¤ä»˜ï¼Œä¸ä¿è¯å¯é äº¤ä»˜æ•°æ®",-1),ni={href:"https://xiaolincoding.com/network/3_tcp/quic.html",target:"_blank",rel:"noopener noreferrer"},pi=n('<p><em>4. æ‹¥å¡æ§åˆ¶ã€æµé‡æ§åˆ¶</em></p><ul><li>TCP æœ‰æ‹¥å¡æ§åˆ¶å’Œæµé‡æ§åˆ¶æœºåˆ¶ï¼Œä¿è¯æ•°æ®ä¼ è¾“çš„å®‰å…¨æ€§ã€‚</li><li>UDP åˆ™<strong>æ²¡æœ‰</strong>ï¼Œå³ä½¿ç½‘ç»œéå¸¸æ‹¥å µäº†ï¼Œä¹Ÿ<strong>ä¸ä¼šå½±å“ UDP çš„å‘é€é€Ÿç‡ã€‚</strong></li></ul><p><em>5. é¦–éƒ¨å¼€é”€</em></p><ul><li>TCP é¦–éƒ¨é•¿åº¦è¾ƒé•¿ï¼Œä¼šæœ‰ä¸€å®šçš„å¼€é”€ï¼Œé¦–éƒ¨åœ¨æ²¡æœ‰ä½¿ç”¨ã€Œé€‰é¡¹ã€å­—æ®µæ—¶æ˜¯ <code>20</code> ä¸ªå­—èŠ‚ï¼Œå¦‚æœä½¿ç”¨äº†ã€Œé€‰é¡¹ã€å­—æ®µåˆ™ä¼šå˜é•¿çš„ã€‚</li><li>UDP é¦–éƒ¨åªæœ‰ 8 ä¸ªå­—èŠ‚ï¼Œå¹¶ä¸”æ˜¯å›ºå®šä¸å˜çš„ï¼Œ<strong>å¼€é”€è¾ƒå°</strong>ã€‚</li></ul><p><em>6. ä¼ è¾“æ–¹å¼</em></p><ul><li>TCP æ˜¯æµå¼ä¼ è¾“ï¼Œ<strong>æ²¡æœ‰è¾¹ç•Œ</strong>ï¼Œä½†ä¿è¯é¡ºåºå’Œå¯é ã€‚</li><li>UDP æ˜¯ä¸€ä¸ªåŒ…ä¸€ä¸ªåŒ…çš„å‘é€ï¼Œæ˜¯<strong>æœ‰è¾¹ç•Œçš„</strong>ï¼Œä½†å¯èƒ½ä¼šä¸¢åŒ…å’Œä¹±åºã€‚</li></ul><p><em>7. åˆ†ç‰‡ä¸åŒ</em></p><ul><li>TCP çš„æ•°æ®å¤§å°å¦‚æœå¤§äº MSS å¤§å°ï¼Œåˆ™ä¼š<strong>åœ¨ä¼ è¾“å±‚è¿›è¡Œåˆ†ç‰‡</strong>ï¼Œç›®æ ‡ä¸»æœºæ”¶åˆ°åï¼Œä¹ŸåŒæ ·<strong>åœ¨ä¼ è¾“å±‚ç»„è£… TCP æ•°æ®åŒ…</strong>ï¼Œå¦‚æœä¸­é€”ä¸¢å¤±äº†ä¸€ä¸ªåˆ†ç‰‡ï¼Œåªéœ€è¦ä¼ è¾“ä¸¢å¤±çš„è¿™ä¸ªåˆ†ç‰‡ã€‚</li><li>UDP çš„æ•°æ®å¤§å°å¦‚æœå¤§äº MTU å¤§å°ï¼Œåˆ™ä¼š<strong>åœ¨ IP å±‚è¿›è¡Œåˆ†ç‰‡</strong>ï¼Œç›®æ ‡ä¸»æœºæ”¶åˆ°åï¼Œåœ¨ <strong>IP å±‚ç»„è£…å®Œæ•°æ®</strong>ï¼Œæ¥ç€å†ä¼ ç»™ä¼ è¾“å±‚ã€‚</li></ul><p><strong>TCP å’Œ UDP åº”ç”¨åœºæ™¯ï¼š</strong></p><p>ç”±äº TCP æ˜¯é¢å‘è¿æ¥ï¼Œèƒ½ä¿è¯æ•°æ®çš„å¯é æ€§äº¤ä»˜ï¼Œå› æ­¤ç»å¸¸ç”¨äºï¼š</p><ul><li><code>FTP</code> æ–‡ä»¶ä¼ è¾“ï¼›</li><li>HTTP / HTTPSï¼›</li></ul><p>ç”±äº UDP é¢å‘æ— è¿æ¥ï¼Œå®ƒå¯ä»¥éšæ—¶å‘é€æ•°æ®ï¼Œå†åŠ ä¸Š UDP æœ¬èº«çš„å¤„ç†<strong>æ—¢ç®€å•åˆé«˜æ•ˆ</strong>ï¼Œå› æ­¤ç»å¸¸ç”¨äºï¼š</p><ul><li>åŒ…æ€»é‡è¾ƒå°‘çš„é€šä¿¡ï¼Œå¦‚ <code>DNS</code> ã€<code>SNMP</code> ç­‰ï¼›</li><li>è§†é¢‘ã€éŸ³é¢‘ç­‰å¤šåª’ä½“é€šä¿¡ï¼›</li><li>å¹¿æ’­é€šä¿¡ï¼›</li></ul><blockquote><p>ä¸ºä»€ä¹ˆ UDP å¤´éƒ¨æ²¡æœ‰ã€Œé¦–éƒ¨é•¿åº¦ã€å­—æ®µï¼Œè€Œ TCP å¤´éƒ¨æœ‰ã€Œé¦–éƒ¨é•¿åº¦ã€å­—æ®µå‘¢ï¼Ÿ</p></blockquote><p>åŸå› æ˜¯ TCP æœ‰<strong>å¯å˜é•¿</strong>çš„ã€Œé€‰é¡¹ã€å­—æ®µï¼Œè€Œ UDP å¤´éƒ¨é•¿åº¦åˆ™æ˜¯<strong>ä¸ä¼šå˜åŒ–</strong>çš„ï¼Œæ— éœ€å¤šä¸€ä¸ªå­—æ®µå»è®°å½• UDP çš„é¦–éƒ¨é•¿åº¦ã€‚</p><blockquote><p>ä¸ºä»€ä¹ˆ UDP å¤´éƒ¨æœ‰ã€ŒåŒ…é•¿åº¦ã€å­—æ®µï¼Œè€Œ <strong>TCP å¤´éƒ¨åˆ™æ²¡æœ‰ã€ŒåŒ…é•¿åº¦ã€å­—æ®µå‘¢ï¼Ÿ</strong></p></blockquote><p>å…ˆè¯´è¯´ TCP æ˜¯å¦‚ä½•<strong>è®¡ç®—è´Ÿè½½æ•°æ®é•¿åº¦</strong>ï¼š</p><img src="'+nt+'" alt="img" style="zoom:67%;"><p>å…¶ä¸­ IP æ€»é•¿åº¦ å’Œ IP é¦–éƒ¨é•¿åº¦ï¼Œåœ¨ IP é¦–éƒ¨æ ¼å¼æ˜¯å·²çŸ¥çš„ã€‚TCP é¦–éƒ¨é•¿åº¦ï¼Œåˆ™æ˜¯åœ¨ TCP é¦–éƒ¨æ ¼å¼å·²çŸ¥çš„ï¼Œæ‰€ä»¥å°±å¯ä»¥æ±‚å¾— TCP æ•°æ®çš„é•¿åº¦ã€‚</p><p>å¤§å®¶è¿™æ—¶å°±å¥‡æ€ªäº†é—®ï¼šâ€œUDP ä¹Ÿæ˜¯åŸºäº IP å±‚çš„å‘€ï¼Œé‚£ UDP çš„æ•°æ®é•¿åº¦ä¹Ÿå¯ä»¥é€šè¿‡è¿™ä¸ª<strong>å…¬å¼è®¡ç®—</strong>å‘€ï¼Ÿ ä¸ºä½•è¿˜è¦æœ‰ã€ŒåŒ…é•¿åº¦ã€å‘¢ï¼Ÿâ€</p><p>è¿™ä¹ˆä¸€é—®ï¼Œç¡®å®æ„Ÿè§‰ **UDP çš„ã€ŒåŒ…é•¿åº¦ã€**æ˜¯å†—ä½™çš„ã€‚</p><p>æˆ‘æŸ¥é˜…äº†å¾ˆå¤šèµ„æ–™ï¼Œæˆ‘è§‰å¾—æœ‰ä¸¤ä¸ªæ¯”è¾ƒé è°±çš„è¯´æ³•ï¼š</p><ul><li>ç¬¬ä¸€ç§è¯´æ³•ï¼šå› ä¸ºä¸ºäº†ç½‘ç»œè®¾å¤‡ç¡¬ä»¶è®¾è®¡å’Œå¤„ç†æ–¹ä¾¿ï¼Œé¦–éƒ¨é•¿åº¦éœ€è¦æ˜¯ <code>4</code> å­—èŠ‚çš„æ•´æ•°å€ã€‚å¦‚æœå»æ‰ UDP çš„ã€ŒåŒ…é•¿åº¦ã€å­—æ®µï¼Œé‚£ UDP é¦–éƒ¨é•¿åº¦å°±ä¸æ˜¯ <code>4</code> å­—èŠ‚çš„æ•´æ•°å€äº†ï¼Œæ‰€ä»¥æˆ‘è§‰å¾—è¿™å¯èƒ½æ˜¯ä¸ºäº†è¡¥å…¨ UDP é¦–éƒ¨é•¿åº¦æ˜¯ <code>4</code> å­—èŠ‚çš„æ•´æ•°å€ï¼Œæ‰è¡¥å……äº†ã€ŒåŒ…é•¿åº¦ã€å­—æ®µã€‚</li><li>ç¬¬äºŒç§è¯´æ³•ï¼šå¦‚ä»Šçš„ UDP åè®®æ˜¯åŸºäº IP åè®®å‘å±•çš„ï¼Œè€Œå½“å¹´å¯èƒ½å¹¶éå¦‚æ­¤ï¼Œä¾èµ–çš„å¯èƒ½æ˜¯åˆ«çš„ä¸æä¾›è‡ªèº«æŠ¥æ–‡é•¿åº¦æˆ–é¦–éƒ¨é•¿åº¦çš„ç½‘ç»œå±‚åè®®ï¼Œå› æ­¤ UDP æŠ¥æ–‡é¦–éƒ¨éœ€è¦æœ‰é•¿åº¦å­—æ®µä»¥ä¾›è®¡ç®—ã€‚</li></ul><h4 id="tcp-å’Œ-udp-å¯ä»¥ä½¿ç”¨åŒä¸€ä¸ªç«¯å£å—" tabindex="-1"><a class="header-anchor" href="#tcp-å’Œ-udp-å¯ä»¥ä½¿ç”¨åŒä¸€ä¸ªç«¯å£å—"><span>- TCP å’Œ UDP å¯ä»¥ä½¿ç”¨åŒä¸€ä¸ªç«¯å£å—ï¼Ÿ</span></a></h4><blockquote><p>ç­”æ¡ˆï¼š<strong>å¯ä»¥çš„</strong>ã€‚</p></blockquote><p>åœ¨æ•°æ®é“¾è·¯å±‚ä¸­ï¼Œé€šè¿‡ MAC åœ°å€æ¥å¯»æ‰¾<strong>å±€åŸŸç½‘ä¸­çš„</strong>ä¸»æœºã€‚</p><p>åœ¨ç½‘é™…å±‚ä¸­ï¼Œé€šè¿‡ IP åœ°å€æ¥å¯»æ‰¾<strong>ç½‘ç»œä¸­äº’è¿çš„</strong>ä¸»æœºæˆ–è·¯ç”±å™¨ã€‚</p><p>åœ¨ä¼ è¾“å±‚ä¸­ï¼Œéœ€è¦<strong>é€šè¿‡ç«¯å£</strong>è¿›è¡Œå¯»å€ï¼Œæ¥è¯†åˆ«åŒä¸€è®¡ç®—æœºä¸­åŒæ—¶é€šä¿¡çš„ä¸åŒåº”ç”¨ç¨‹åºã€‚</p><p>æ‰€ä»¥ï¼Œä¼ è¾“å±‚çš„ã€Œç«¯å£å·ã€çš„ä½œç”¨ï¼Œæ˜¯ä¸ºäº†<strong>åŒºåˆ†åŒä¸€ä¸ªä¸»æœºä¸Šä¸åŒåº”ç”¨ç¨‹åºçš„æ•°æ®åŒ…</strong>ã€‚</p><p>ä¼ è¾“å±‚æœ‰ä¸¤ä¸ªä¼ è¾“åè®®åˆ†åˆ«æ˜¯ TCP å’Œ UDPï¼Œåœ¨å†…æ ¸ä¸­æ˜¯ä¸¤ä¸ªå®Œå…¨ç‹¬ç«‹çš„è½¯ä»¶æ¨¡å—ã€‚</p><p>å½“ä¸»æœºæ”¶åˆ°æ•°æ®åŒ…åï¼Œå¯ä»¥åœ¨ IP åŒ…å¤´çš„ã€Œåè®®å·ã€å­—æ®µçŸ¥é“è¯¥æ•°æ®åŒ…æ˜¯ TCP/UDPï¼Œæ‰€ä»¥å¯ä»¥æ ¹æ®è¿™ä¸ªä¿¡æ¯ç¡®å®šé€ç»™å“ªä¸ªæ¨¡å—ï¼ˆTCP/UDPï¼‰å¤„ç†ï¼Œé€ç»™ TCP/UDP æ¨¡å—çš„æŠ¥æ–‡æ ¹æ®ã€Œç«¯å£å·ã€ç¡®å®šé€ç»™å“ªä¸ªåº”ç”¨ç¨‹åºå¤„ç†ã€‚</p><img src="'+pt+'" alt="img" style="zoom:67%;"><p>å› æ­¤ï¼ŒTCP/UDP å„è‡ªçš„ç«¯å£å·ä¹Ÿç›¸äº’ç‹¬ç«‹ï¼Œå¦‚ TCP æœ‰ä¸€ä¸ª 80 å·ç«¯å£ï¼ŒUDP ä¹Ÿå¯ä»¥æœ‰ä¸€ä¸ª 80 å·ç«¯å£ï¼ŒäºŒè€…å¹¶ä¸å†²çªã€‚</p><p>å…³äºç«¯å£çš„çŸ¥è¯†ç‚¹ï¼Œè¿˜æ˜¯æŒºå¤šå¯ä»¥è®²çš„ï¼Œæ¯”å¦‚è¿˜å¯ä»¥ç‰µæ‰¯åˆ°è¿™å‡ ä¸ªé—®é¢˜ï¼š</p><ul><li>å¤šä¸ª TCP æœåŠ¡è¿›ç¨‹å¯ä»¥åŒæ—¶ç»‘å®šåŒä¸€ä¸ªç«¯å£å—ï¼Ÿ</li><li>é‡å¯ TCP æœåŠ¡è¿›ç¨‹æ—¶ï¼Œä¸ºä»€ä¹ˆä¼šå‡ºç°â€œAddress in useâ€çš„æŠ¥é”™ä¿¡æ¯ï¼Ÿåˆè¯¥æ€ä¹ˆé¿å…ï¼Ÿ</li><li>å®¢æˆ·ç«¯çš„ç«¯å£å¯ä»¥é‡å¤ä½¿ç”¨å—ï¼Ÿ</li><li>å®¢æˆ·ç«¯ TCP è¿æ¥ TIME_WAIT çŠ¶æ€è¿‡å¤šï¼Œä¼šå¯¼è‡´ç«¯å£èµ„æºè€—å°½è€Œæ— æ³•å»ºç«‹æ–°çš„è¿æ¥å—ï¼Ÿ</li></ul>',35),ri={href:"https://xiaolincoding.com/network/3_tcp/port.html",target:"_blank",rel:"noopener noreferrer"},ii=n('<h3 id="_4-1-2-tcp-è¿æ¥å»ºç«‹" tabindex="-1"><a class="header-anchor" href="#_4-1-2-tcp-è¿æ¥å»ºç«‹"><span>4.1.2 TCP è¿æ¥å»ºç«‹</span></a></h3><h4 id="tcp-ä¸‰æ¬¡æ¡æ‰‹è¿‡ç¨‹æ˜¯æ€æ ·çš„" tabindex="-1"><a class="header-anchor" href="#tcp-ä¸‰æ¬¡æ¡æ‰‹è¿‡ç¨‹æ˜¯æ€æ ·çš„"><span>- TCP ä¸‰æ¬¡æ¡æ‰‹è¿‡ç¨‹æ˜¯æ€æ ·çš„ï¼Ÿ</span></a></h4><p>TCP æ˜¯é¢å‘è¿æ¥çš„åè®®ï¼Œæ‰€ä»¥ä½¿ç”¨ TCP å‰å¿…é¡»å…ˆå»ºç«‹è¿æ¥ï¼Œè€Œ<strong>å»ºç«‹è¿æ¥æ˜¯é€šè¿‡ä¸‰æ¬¡æ¡æ‰‹æ¥è¿›è¡Œçš„</strong>ã€‚ä¸‰æ¬¡æ¡æ‰‹çš„è¿‡ç¨‹å¦‚ä¸‹å›¾ï¼š</p><img src="'+rt+'" alt="TCP ä¸‰æ¬¡æ¡æ‰‹" style="zoom:50%;"><ul><li>ä¸€å¼€å§‹ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯éƒ½å¤„äº <code>CLOSE</code> çŠ¶æ€ã€‚å…ˆæ˜¯æœåŠ¡ç«¯<strong>ä¸»åŠ¨ç›‘å¬æŸä¸ªç«¯å£</strong>ï¼Œå¤„äº <code>LISTEN</code> çŠ¶æ€ã€‚</li></ul><img src="'+it+'" alt="ç¬¬ä¸€ä¸ªæŠ¥æ–‡ â€”â€” SYN æŠ¥æ–‡" style="zoom:80%;"><ul><li>å®¢æˆ·ç«¯ä¼šéšæœºåˆå§‹åŒ–åºå·ï¼ˆ<code>client_isn</code>ï¼‰ï¼Œå°†æ­¤åºå·ç½®äº TCP é¦–éƒ¨çš„ã€Œåºå·ã€å­—æ®µä¸­ï¼ŒåŒæ—¶æŠŠ <code>SYN</code> æ ‡å¿—ä½ç½®ä¸º <code>1</code>ï¼Œè¡¨ç¤º <code>SYN</code> æŠ¥æ–‡ã€‚æ¥ç€æŠŠç¬¬ä¸€ä¸ª SYN æŠ¥æ–‡å‘é€ç»™æœåŠ¡ç«¯ï¼Œè¡¨ç¤ºå‘æœåŠ¡ç«¯å‘èµ·è¿æ¥ï¼Œè¯¥æŠ¥æ–‡ä¸åŒ…å«åº”ç”¨å±‚æ•°æ®ï¼Œä¹‹åå®¢æˆ·ç«¯å¤„äº <code>SYN-SENT</code> çŠ¶æ€ã€‚</li></ul><img src="'+gt+'" alt="ç¬¬äºŒä¸ªæŠ¥æ–‡ â€”â€” SYN + ACK æŠ¥æ–‡" style="zoom:80%;"><ul><li>æœåŠ¡ç«¯æ”¶åˆ°å®¢æˆ·ç«¯çš„ <code>SYN</code> æŠ¥æ–‡åï¼Œé¦–å…ˆæœåŠ¡ç«¯ä¹Ÿéšæœºåˆå§‹åŒ–è‡ªå·±çš„åºå·ï¼ˆ<code>server_isn</code>ï¼‰ï¼Œå°†æ­¤åºå·å¡«å…¥ TCP é¦–éƒ¨çš„ã€Œåºå·ã€å­—æ®µä¸­ï¼Œå…¶æ¬¡æŠŠ TCP é¦–éƒ¨çš„ã€Œç¡®è®¤åº”ç­”å·ã€å­—æ®µå¡«å…¥ <code>client_isn + 1</code>, æ¥ç€æŠŠ <code>SYN</code> å’Œ <code>ACK</code> æ ‡å¿—ä½ç½®ä¸º <code>1</code>ã€‚æœ€åæŠŠè¯¥æŠ¥æ–‡å‘ç»™å®¢æˆ·ç«¯ï¼Œè¯¥æŠ¥æ–‡ä¹Ÿä¸åŒ…å«åº”ç”¨å±‚æ•°æ®ï¼Œä¹‹åæœåŠ¡ç«¯å¤„äº <code>SYN-RCVD</code> çŠ¶æ€ã€‚</li></ul><img src="'+at+'" alt="ç¬¬ä¸‰ä¸ªæŠ¥æ–‡ â€”â€” ACK æŠ¥æ–‡" style="zoom:80%;"><ul><li>å®¢æˆ·ç«¯æ”¶åˆ°æœåŠ¡ç«¯æŠ¥æ–‡åï¼Œè¿˜è¦å‘æœåŠ¡ç«¯å›åº”æœ€åä¸€ä¸ª<strong>åº”ç­”æŠ¥æ–‡</strong>ï¼Œé¦–å…ˆè¯¥åº”ç­”æŠ¥æ–‡ TCP é¦–éƒ¨ <code>ACK</code> æ ‡å¿—ä½ç½®ä¸º <code>1</code> ï¼Œå…¶æ¬¡ã€Œç¡®è®¤åº”ç­”å·ã€å­—æ®µå¡«å…¥ <code>server_isn + 1</code> ï¼Œæœ€åæŠŠæŠ¥æ–‡å‘é€ç»™æœåŠ¡ç«¯ï¼Œè¿™æ¬¡æŠ¥æ–‡å¯ä»¥æºå¸¦å®¢æˆ·åˆ°æœåŠ¡ç«¯çš„æ•°æ®ï¼Œä¹‹åå®¢æˆ·ç«¯å¤„äº <code>ESTABLISHED</code> çŠ¶æ€ã€‚</li><li>æœåŠ¡ç«¯æ”¶åˆ°å®¢æˆ·ç«¯çš„åº”ç­”æŠ¥æ–‡åï¼Œä¹Ÿè¿›å…¥ <code>ESTABLISHED</code> çŠ¶æ€ã€‚</li></ul><blockquote><p>ä»ä¸Šé¢çš„è¿‡ç¨‹å¯ä»¥å‘ç°<strong>ç¬¬ä¸‰æ¬¡æ¡æ‰‹æ˜¯å¯ä»¥æºå¸¦æ•°æ®çš„ï¼Œå‰ä¸¤æ¬¡æ¡æ‰‹æ˜¯ä¸å¯ä»¥æºå¸¦æ•°æ®çš„</strong>ï¼Œè¿™ä¹Ÿæ˜¯<strong>é¢è¯•å¸¸é—®çš„é¢˜ã€‚</strong></p></blockquote><p>ä¸€æ—¦å®Œæˆä¸‰æ¬¡æ¡æ‰‹ï¼ŒåŒæ–¹éƒ½å¤„äº <code>ESTABLISHED</code> çŠ¶æ€ï¼Œæ­¤æ—¶è¿æ¥å°±å·²å»ºç«‹å®Œæˆï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯å°±å¯ä»¥<strong>ç›¸äº’å‘é€æ•°æ®äº†ã€‚</strong></p><ul><li><h3 id="å¦‚ä½•åœ¨-linux-ç³»ç»Ÿä¸­æŸ¥çœ‹-tcp-çŠ¶æ€" tabindex="-1"><a class="header-anchor" href="#å¦‚ä½•åœ¨-linux-ç³»ç»Ÿä¸­æŸ¥çœ‹-tcp-çŠ¶æ€"><span>å¦‚ä½•åœ¨ Linux ç³»ç»Ÿä¸­æŸ¥çœ‹ TCP çŠ¶æ€ï¼Ÿ</span></a></h3></li></ul><p>TCP çš„è¿æ¥çŠ¶æ€æŸ¥çœ‹ï¼Œåœ¨ Linux å¯ä»¥é€šè¿‡ <code>netstat -napt</code> å‘½ä»¤æŸ¥çœ‹ã€‚</p><img src="'+lt+'" alt="TCP è¿æ¥çŠ¶æ€æŸ¥çœ‹" style="zoom:80%;"><h4 id="ä¸ºä»€ä¹ˆæ˜¯ä¸‰æ¬¡æ¡æ‰‹-ä¸æ˜¯ä¸¤æ¬¡ã€å››æ¬¡" tabindex="-1"><a class="header-anchor" href="#ä¸ºä»€ä¹ˆæ˜¯ä¸‰æ¬¡æ¡æ‰‹-ä¸æ˜¯ä¸¤æ¬¡ã€å››æ¬¡"><span>-- <mark>ä¸ºä»€ä¹ˆæ˜¯ä¸‰æ¬¡æ¡æ‰‹ï¼Ÿä¸æ˜¯ä¸¤æ¬¡ã€å››æ¬¡ï¼Ÿ</mark></span></a></h4><p>ç›¸ä¿¡å¤§å®¶æ¯”è¾ƒå¸¸å›ç­”çš„æ˜¯ï¼šâ€œå› ä¸ºä¸‰æ¬¡æ¡æ‰‹æ‰èƒ½ä¿è¯åŒæ–¹å…·æœ‰æ¥æ”¶å’Œå‘é€çš„èƒ½åŠ›ã€‚â€</p><p>è¿™å›ç­”æ˜¯æ²¡é—®é¢˜ï¼Œä½†è¿™å›ç­”æ˜¯ç‰‡é¢çš„ï¼Œ<strong>å¹¶æ²¡æœ‰è¯´å‡ºä¸»è¦çš„åŸå› </strong>ã€‚</p><p>åœ¨å‰é¢æˆ‘ä»¬çŸ¥é“äº†ä»€ä¹ˆæ˜¯ <strong>TCP è¿æ¥</strong>ï¼š</p><ul><li>ç”¨äºä¿è¯å¯é æ€§å’Œæµé‡æ§åˆ¶ç»´æŠ¤çš„æŸäº›çŠ¶æ€ä¿¡æ¯ï¼Œè¿™äº›ä¿¡æ¯çš„ç»„åˆï¼ŒåŒ…æ‹¬ <strong>Socketã€åºåˆ—å·å’Œçª—å£å¤§å°</strong>ç§°ä¸ºè¿æ¥ã€‚</li></ul><blockquote><p>æ‰€ä»¥ï¼Œé‡è¦çš„æ˜¯<strong>ä¸ºä»€ä¹ˆä¸‰æ¬¡æ¡æ‰‹æ‰å¯ä»¥åˆå§‹åŒ– Socketã€åºåˆ—å·å’Œçª—å£å¤§å°å¹¶å»ºç«‹ TCP è¿æ¥ã€‚</strong></p></blockquote><blockquote><p>æ¥ä¸‹æ¥ï¼Œä»¥ä¸‰ä¸ªæ–¹é¢åˆ†æä¸‰æ¬¡æ¡æ‰‹çš„åŸå› ï¼š</p><ul><li>ä¸‰æ¬¡æ¡æ‰‹æ‰å¯ä»¥<strong>é˜»æ­¢é‡å¤å†å²è¿æ¥çš„åˆå§‹åŒ–</strong>ï¼ˆä¸»è¦åŸå› ï¼‰</li><li>ä¸‰æ¬¡æ¡æ‰‹æ‰å¯ä»¥<strong>åŒæ­¥åŒæ–¹çš„åˆå§‹åºåˆ—å·</strong></li><li>ä¸‰æ¬¡æ¡æ‰‹æ‰å¯ä»¥<strong>é¿å…èµ„æºæµªè´¹</strong></li></ul></blockquote><p><mark><em>åŸå› ä¸€ï¼šé¿å…å†å²è¿æ¥</em></mark></p><p>æˆ‘ä»¬æ¥çœ‹çœ‹ RFC 793 æŒ‡å‡ºçš„ TCP è¿æ¥ä½¿ç”¨ä¸‰æ¬¡æ¡æ‰‹çš„<strong>é¦–è¦åŸå› </strong>ï¼š</p><p><em>The principle reason for the three-way handshake is to prevent old duplicate connection initiations from causing confusion.</em></p><blockquote><p>ç®€å•æ¥è¯´ï¼Œä¸‰æ¬¡æ¡æ‰‹çš„<strong>é¦–è¦åŸå› æ˜¯ä¸ºäº†é˜²æ­¢æ—§çš„é‡å¤è¿æ¥åˆå§‹åŒ–é€ æˆæ··ä¹±ã€‚</strong></p></blockquote><p>æˆ‘ä»¬è€ƒè™‘ä¸€ä¸ªåœºæ™¯ï¼Œå®¢æˆ·ç«¯å…ˆå‘é€äº† SYNï¼ˆseq = 90ï¼‰æŠ¥æ–‡ï¼Œç„¶åå®¢æˆ·ç«¯å®•æœºäº†ï¼Œè€Œä¸”è¿™ä¸ª SYN æŠ¥æ–‡è¿˜è¢«ç½‘ç»œé˜»å¡äº†ï¼ŒæœåŠ¡ç«¯å¹¶æ²¡æœ‰æ”¶åˆ°ï¼Œæ¥ç€å®¢æˆ·ç«¯é‡å¯åï¼Œåˆé‡æ–°å‘æœåŠ¡ç«¯<strong>å»ºç«‹è¿æ¥</strong>ï¼Œå‘é€äº† SYNï¼ˆseq = 100ï¼‰æŠ¥æ–‡ï¼ˆ<em>æ³¨æ„ï¼<strong>ä¸æ˜¯é‡ä¼  SYN</strong>ï¼Œé‡ä¼ çš„ SYN çš„åºåˆ—å·æ˜¯ä¸€æ ·çš„</em>ï¼‰ã€‚</p><p>çœ‹çœ‹ä¸‰æ¬¡æ¡æ‰‹æ˜¯å¦‚ä½•<strong>é˜»æ­¢å†å²è¿æ¥çš„ï¼š</strong></p><img src="'+ct+'" alt="ä¸‰æ¬¡æ¡æ‰‹é¿å…å†å²è¿æ¥" style="zoom:67%;"><p>å®¢æˆ·ç«¯<strong>è¿ç»­å‘é€å¤šæ¬¡ SYNï¼ˆéƒ½æ˜¯åŒä¸€ä¸ªå››å…ƒç»„ï¼‰å»ºç«‹è¿æ¥çš„æŠ¥æ–‡</strong>ï¼Œåœ¨<strong>ç½‘ç»œæ‹¥å µ</strong>æƒ…å†µä¸‹ï¼š</p><ul><li>ä¸€ä¸ªã€Œæ—§ SYN æŠ¥æ–‡ã€æ¯”ã€Œæœ€æ–°çš„ SYNã€ æŠ¥æ–‡æ—©åˆ°è¾¾äº†æœåŠ¡ç«¯ï¼Œé‚£ä¹ˆæ­¤æ—¶æœåŠ¡ç«¯å°±ä¼šå›ä¸€ä¸ª <code>SYN + ACK</code> æŠ¥æ–‡ç»™å®¢æˆ·ç«¯ï¼Œæ­¤æŠ¥æ–‡ä¸­çš„ç¡®è®¤å·æ˜¯ 91ï¼ˆ90+1ï¼‰ã€‚</li><li>å®¢æˆ·ç«¯æ”¶åˆ°åï¼Œå‘ç°<strong>è‡ªå·±æœŸæœ›æ”¶åˆ°çš„ç¡®è®¤å·</strong>åº”è¯¥æ˜¯ 100 + 1ï¼Œè€Œä¸æ˜¯ 90 + 1ï¼Œäºæ˜¯å°±ä¼šå› RST æŠ¥æ–‡ã€‚</li><li>æœåŠ¡ç«¯æ”¶åˆ° RST æŠ¥æ–‡åï¼Œå°±ä¼šé‡Šæ”¾è¿æ¥ã€‚</li><li>åç»­æœ€æ–°çš„ SYN æŠµè¾¾äº†æœåŠ¡ç«¯åï¼Œå®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯<strong>å°±å¯ä»¥æ­£å¸¸çš„å®Œæˆä¸‰æ¬¡æ¡æ‰‹äº†ã€‚</strong></li></ul><p>ä¸Šè¿°ä¸­çš„ã€Œæ—§ SYN æŠ¥æ–‡ã€ç§°ä¸º<strong>å†å²è¿æ¥</strong>ï¼ŒTCP ä½¿ç”¨ä¸‰æ¬¡æ¡æ‰‹å»ºç«‹è¿æ¥çš„<strong>æœ€ä¸»è¦åŸå› å°±æ˜¯é˜²æ­¢ã€Œå†å²è¿æ¥ã€åˆå§‹åŒ–äº†è¿æ¥</strong>ã€‚</p>',33),gi=o("p",null,[o("strong",null,"TIP")],-1),ai=o("p",null,"æœ‰å¾ˆå¤šäººé—®ï¼Œå¦‚æœæœåŠ¡ç«¯åœ¨æ”¶åˆ° RST æŠ¥æ–‡ä¹‹å‰ï¼Œå…ˆæ”¶åˆ°äº†ã€Œæ–° SYN æŠ¥æ–‡ã€ï¼Œä¹Ÿå°±æ˜¯æœåŠ¡ç«¯æ”¶åˆ°å®¢æˆ·ç«¯æŠ¥æ–‡çš„é¡ºåºæ˜¯ï¼šã€Œæ—§ SYN æŠ¥æ–‡ã€->ã€Œæ–° SYN æŠ¥æ–‡ã€ï¼Œæ­¤æ—¶ä¼šå‘ç”Ÿä»€ä¹ˆ?",-1),li=o("p",null,[t("å½“æœåŠ¡ç«¯ç¬¬ä¸€æ¬¡æ”¶åˆ° SYN æŠ¥æ–‡ï¼Œä¹Ÿå°±æ˜¯æ”¶åˆ° ã€Œæ—§ SYN æŠ¥æ–‡ã€æ—¶ï¼Œå°±ä¼šå›å¤ "),o("code",null,"SYN + ACK"),t(" æŠ¥æ–‡ç»™å®¢æˆ·ç«¯ï¼Œæ­¤æŠ¥æ–‡ä¸­çš„ç¡®è®¤å·æ˜¯ 91ï¼ˆ90+1ï¼‰ã€‚")],-1),ci={href:"https://xiaolincoding.com/network/3_tcp/challenge_ack.html",target:"_blank",rel:"noopener noreferrer"},di=o("strong",null,"Ack",-1),mi=o("strong",null,"è¿™ä¸ª ack æŠ¥æ–‡å¹¶ä¸æ˜¯ç¡®è®¤æ”¶åˆ°ã€Œæ–° SYN æŠ¥æ–‡ã€çš„ï¼Œè€Œæ˜¯ä¸Šä¸€æ¬¡çš„ ack ç¡®è®¤å·",-1),Ti=o("strong",null,"å› RST æŠ¥æ–‡ã€‚",-1),hi=n('<blockquote><p><strong>å¦‚æœæ˜¯ä¸¤æ¬¡æ¡æ‰‹è¿æ¥ï¼Œå°±æ— æ³•é˜»æ­¢å†å²è¿æ¥</strong>ï¼Œé‚£ä¸ºä»€ä¹ˆ TCP ä¸¤æ¬¡æ¡æ‰‹ä¸ºä»€ä¹ˆæ— æ³•é˜»æ­¢å†å²è¿æ¥å‘¢ï¼Ÿ</p><p>æˆ‘å…ˆç›´æ¥è¯´ç»“è®ºï¼Œä¸»è¦æ˜¯å› ä¸º**<code>åœ¨ä¸¤æ¬¡æ¡æ‰‹çš„æƒ…å†µä¸‹ï¼ŒæœåŠ¡ç«¯æ²¡æœ‰ä¸­é—´çŠ¶æ€ç»™å®¢æˆ·ç«¯æ¥é˜»æ­¢å†å²è¿æ¥</code>ï¼Œå¯¼è‡´æœåŠ¡ç«¯<code>å¯èƒ½å»ºç«‹ä¸€ä¸ªå†å²è¿æ¥ï¼Œé€ æˆèµ„æºæµªè´¹</code>**ã€‚</p></blockquote><p>ä½ æƒ³æƒ³ï¼Œåœ¨ä¸¤æ¬¡æ¡æ‰‹çš„æƒ…å†µä¸‹ï¼ŒæœåŠ¡ç«¯åœ¨æ”¶åˆ° SYN æŠ¥æ–‡åï¼Œå°±è¿›å…¥ ESTABLISHED çŠ¶æ€ï¼Œæ„å‘³ç€è¿™æ—¶å¯ä»¥ç»™å¯¹æ–¹å‘é€æ•°æ®ï¼Œä½†æ˜¯å®¢æˆ·ç«¯æ­¤æ—¶è¿˜æ²¡æœ‰è¿›å…¥ ESTABLISHED çŠ¶æ€ï¼Œå‡è®¾è¿™æ¬¡æ˜¯å†å²è¿æ¥ï¼Œå®¢æˆ·ç«¯åˆ¤æ–­åˆ°æ­¤æ¬¡è¿æ¥ä¸ºå†å²è¿æ¥ï¼Œé‚£ä¹ˆå°±ä¼šå› RST æŠ¥æ–‡æ¥æ–­å¼€è¿æ¥ï¼Œè€ŒæœåŠ¡ç«¯åœ¨ç¬¬ä¸€æ¬¡æ¡æ‰‹çš„æ—¶å€™å°±è¿›å…¥ ESTABLISHED çŠ¶æ€**ï¼Œæ‰€ä»¥å®ƒå¯ä»¥å‘é€æ•°æ®çš„ï¼Œä½†æ˜¯å®ƒå¹¶ä¸çŸ¥é“è¿™ä¸ªæ˜¯å†å²è¿æ¥**ï¼Œå®ƒåªæœ‰åœ¨æ”¶åˆ° RST æŠ¥æ–‡åï¼Œæ‰ä¼šæ–­å¼€è¿æ¥ã€‚</p><figure><img src="'+dt+'" alt="ä¸¤æ¬¡æ¡æ‰‹æ— æ³•é˜»æ­¢å†å²è¿æ¥" tabindex="0" loading="lazy"><figcaption>ä¸¤æ¬¡æ¡æ‰‹æ— æ³•é˜»æ­¢å†å²è¿æ¥</figcaption></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œå¦‚æœé‡‡ç”¨ä¸¤æ¬¡æ¡æ‰‹å»ºç«‹ TCP è¿æ¥çš„åœºæ™¯ä¸‹ï¼ŒæœåŠ¡ç«¯åœ¨å‘å®¢æˆ·ç«¯å‘é€æ•°æ®å‰ï¼Œ<strong>å¹¶æ²¡æœ‰é˜»æ­¢æ‰å†å²è¿æ¥</strong>ï¼Œ<strong>å¯¼è‡´æœåŠ¡ç«¯å»ºç«‹äº†ä¸€ä¸ªå†å²è¿æ¥ï¼Œåˆç™½ç™½å‘é€äº†æ•°æ®ï¼Œå¦¥å¦¥åœ°æµªè´¹äº†æœåŠ¡ç«¯çš„èµ„æº</strong>ã€‚</p><p>å› æ­¤ï¼Œ<strong>è¦è§£å†³è¿™ç§ç°è±¡ï¼Œæœ€å¥½å°±æ˜¯åœ¨æœåŠ¡ç«¯å‘é€æ•°æ®å‰ï¼Œä¹Ÿå°±æ˜¯å»ºç«‹è¿æ¥ä¹‹å‰ï¼Œè¦é˜»æ­¢æ‰å†å²è¿æ¥ï¼Œè¿™æ ·å°±ä¸ä¼šé€ æˆèµ„æºæµªè´¹ï¼Œè€Œè¦å®ç°è¿™ä¸ªåŠŸèƒ½ï¼Œå°±éœ€è¦ä¸‰æ¬¡æ¡æ‰‹</strong>ã€‚</p><p>æ‰€ä»¥ï¼Œ<strong><code>TCP ä½¿ç”¨ä¸‰æ¬¡æ¡æ‰‹å»ºç«‹è¿æ¥çš„æœ€ä¸»è¦åŸå› æ˜¯é˜²æ­¢ã€Œå†å²è¿æ¥ã€åˆå§‹åŒ–äº†è¿æ¥</code>ã€‚</strong></p><blockquote><p>TIP</p><p>æœ‰äººé—®ï¼šå®¢æˆ·ç«¯å‘é€ä¸‰æ¬¡æ¡æ‰‹ï¼ˆack æŠ¥æ–‡ï¼‰åå°±å¯ä»¥å‘é€æ•°æ®äº†ï¼Œè€Œè¢«åŠ¨æ–¹æ­¤æ—¶è¿˜æ˜¯ syn_received çŠ¶æ€ï¼Œå¦‚æœ ack ä¸¢äº†ï¼Œé‚£å®¢æˆ·ç«¯å‘çš„æ•°æ®æ˜¯ä¸æ˜¯ä¹Ÿç™½ç™½æµªè´¹äº†ï¼Ÿ</p><p>ä¸æ˜¯çš„ï¼Œå³ä½¿æœåŠ¡ç«¯è¿˜æ˜¯åœ¨ syn_received çŠ¶æ€ï¼Œæ”¶åˆ°äº†å®¢æˆ·ç«¯å‘é€çš„æ•°æ®ï¼Œè¿˜æ˜¯å¯ä»¥å»ºç«‹è¿æ¥çš„ï¼Œå¹¶ä¸”è¿˜å¯ä»¥æ­£å¸¸æ”¶åˆ°è¿™ä¸ªæ•°æ®åŒ…ã€‚è¿™æ˜¯å› ä¸ºæ•°æ®æŠ¥æ–‡ä¸­æ˜¯æœ‰ ack æ ‡è¯†ä½ï¼Œä¹Ÿæœ‰ç¡®è®¤å·ï¼Œ<strong>è¿™ä¸ªç¡®è®¤å·å°±æ˜¯ç¡®è®¤æ”¶åˆ°äº†ç¬¬äºŒæ¬¡æ¡æ‰‹</strong>ã€‚å¦‚ä¸‹å›¾ï¼š</p><figure><img src="'+mt+'" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><p>æ‰€ä»¥ï¼Œ<strong>æœåŠ¡ç«¯æ”¶åˆ°è¿™ä¸ªæ•°æ®æŠ¥æ–‡</strong>ï¼Œæ˜¯<strong>å¯ä»¥æ­£å¸¸å»ºç«‹è¿æ¥çš„</strong>ï¼Œç„¶åå°±å¯ä»¥æ­£å¸¸æ¥æ”¶è¿™ä¸ªæ•°æ®åŒ…äº†ã€‚</p></blockquote><p><mark><em>åŸå› äºŒï¼šåŒæ­¥åŒæ–¹åˆå§‹åºåˆ—å·</em></mark></p><p><strong>TCP åè®®çš„é€šä¿¡åŒæ–¹</strong>ï¼Œ éƒ½å¿…é¡»ç»´æŠ¤ä¸€ä¸ª**ã€Œåºåˆ—å·ã€**ï¼Œ <strong>åºåˆ—å·æ˜¯å¯é ä¼ è¾“çš„ä¸€ä¸ªå…³é”®å› ç´ </strong>ï¼Œå®ƒçš„ä½œç”¨ï¼š</p><ul><li>æ¥æ”¶æ–¹å¯ä»¥<strong>å»é™¤é‡å¤çš„æ•°æ®</strong>ï¼›</li><li>æ¥æ”¶æ–¹å¯ä»¥<strong>æ ¹æ®æ•°æ®åŒ…çš„åºåˆ—å·æŒ‰åºæ¥æ”¶</strong>ï¼›</li><li>å¯ä»¥<strong>æ ‡è¯†</strong>å‘é€å‡ºå»çš„æ•°æ®åŒ…ä¸­ï¼Œ å“ªäº›æ˜¯<strong>å·²ç»è¢«å¯¹æ–¹æ”¶åˆ°çš„</strong>ï¼ˆé€šè¿‡ ACK æŠ¥æ–‡ä¸­çš„åºåˆ—å·çŸ¥é“ï¼‰ï¼›</li></ul><p>å¯è§ï¼Œåºåˆ—å·åœ¨ TCP è¿æ¥ä¸­å æ®ç€éå¸¸é‡è¦çš„ä½œç”¨ï¼Œæ‰€ä»¥å½“å®¢æˆ·ç«¯å‘é€æºå¸¦**ã€Œåˆå§‹åºåˆ—å·ã€<strong>çš„ <code>SYN</code> æŠ¥æ–‡çš„æ—¶å€™ï¼Œéœ€è¦æœåŠ¡ç«¯å›ä¸€ä¸ª <code>ACK</code> åº”ç­”æŠ¥æ–‡ï¼Œè¡¨ç¤ºå®¢æˆ·ç«¯çš„ SYN æŠ¥æ–‡å·²è¢«æœåŠ¡ç«¯æˆåŠŸæ¥æ”¶ï¼Œé‚£å½“æœåŠ¡ç«¯å‘é€</strong>ã€Œåˆå§‹åºåˆ—å·ã€**ç»™å®¢æˆ·ç«¯çš„æ—¶å€™ï¼Œä¾ç„¶ä¹Ÿè¦å¾—åˆ°å®¢æˆ·ç«¯çš„åº”ç­”å›åº”ï¼Œ<strong>è¿™æ ·ä¸€æ¥ä¸€å›ï¼Œæ‰èƒ½ç¡®ä¿åŒæ–¹çš„åˆå§‹åºåˆ—å·èƒ½è¢«å¯é çš„åŒæ­¥ã€‚</strong></p><figure><img src="'+Tt+'" alt="å››æ¬¡æ¡æ‰‹ä¸ä¸‰æ¬¡æ¡æ‰‹" tabindex="0" loading="lazy"><figcaption>å››æ¬¡æ¡æ‰‹ä¸ä¸‰æ¬¡æ¡æ‰‹</figcaption></figure><p>å››æ¬¡æ¡æ‰‹å…¶å®ä¹Ÿèƒ½å¤Ÿå¯é çš„åŒæ­¥åŒæ–¹çš„åˆå§‹åŒ–åºå·ï¼Œä½†ç”±äº<strong>ç¬¬äºŒæ­¥å’Œç¬¬ä¸‰æ­¥å¯ä»¥ä¼˜åŒ–æˆä¸€æ­¥</strong>ï¼Œæ‰€ä»¥å°±æˆäº†ã€Œä¸‰æ¬¡æ¡æ‰‹ã€ã€‚</p><p>è€Œä¸¤æ¬¡æ¡æ‰‹**<code>åªä¿è¯äº†ä¸€æ–¹çš„åˆå§‹åºåˆ—å·èƒ½è¢«å¯¹æ–¹æˆåŠŸæ¥æ”¶ï¼Œæ²¡åŠæ³•ä¿è¯åŒæ–¹çš„åˆå§‹åºåˆ—å·éƒ½èƒ½è¢«ç¡®è®¤æ¥æ”¶ã€‚</code>**</p><p><mark><em>åŸå› ä¸‰ï¼šé¿å…èµ„æºæµªè´¹</em></mark></p><p>å¦‚æœåªæœ‰ã€Œä¸¤æ¬¡æ¡æ‰‹ã€ï¼Œå½“å®¢æˆ·ç«¯å‘ç”Ÿçš„ <code>SYN</code> æŠ¥æ–‡åœ¨ç½‘ç»œä¸­é˜»å¡ï¼Œå®¢æˆ·ç«¯æ²¡æœ‰æ¥æ”¶åˆ° <code>ACK</code> æŠ¥æ–‡ï¼Œå°±ä¼šé‡æ–°å‘é€ <code>SYN</code> ï¼Œ<strong>ç”±äºæ²¡æœ‰ç¬¬ä¸‰æ¬¡æ¡æ‰‹ï¼ŒæœåŠ¡ç«¯ä¸æ¸…æ¥šå®¢æˆ·ç«¯æ˜¯å¦æ”¶åˆ°äº†è‡ªå·±å›å¤çš„ <code>ACK</code> æŠ¥æ–‡ï¼Œæ‰€ä»¥æœåŠ¡ç«¯æ¯æ”¶åˆ°ä¸€ä¸ª <code>SYN</code> å°±åªèƒ½å…ˆä¸»åŠ¨å»ºç«‹ä¸€ä¸ªè¿æ¥</strong>ï¼Œè¿™ä¼šé€ æˆä»€ä¹ˆæƒ…å†µå‘¢ï¼Ÿ</p><p>å¦‚æœå®¢æˆ·ç«¯å‘é€çš„ <code>SYN</code> æŠ¥æ–‡åœ¨ç½‘ç»œä¸­é˜»å¡äº†ï¼Œé‡å¤å‘é€å¤šæ¬¡ <code>SYN</code> æŠ¥æ–‡ï¼Œé‚£ä¹ˆæœåŠ¡ç«¯åœ¨æ”¶åˆ°è¯·æ±‚åå°±ä¼š<strong>å»ºç«‹å¤šä¸ªå†—ä½™çš„æ— æ•ˆé“¾æ¥ï¼Œé€ æˆä¸å¿…è¦çš„èµ„æºæµªè´¹ã€‚</strong></p><figure><img src="'+ht+'" alt="ä¸¤æ¬¡æ¡æ‰‹ä¼šé€ æˆèµ„æºæµªè´¹" tabindex="0" loading="lazy"><figcaption>ä¸¤æ¬¡æ¡æ‰‹ä¼šé€ æˆèµ„æºæµªè´¹</figcaption></figure><p>å³<strong>ä¸¤æ¬¡æ¡æ‰‹ä¼šé€ æˆæ¶ˆæ¯æ»ç•™æƒ…å†µä¸‹</strong>ï¼ŒæœåŠ¡<strong>ç«¯é‡å¤æ¥å—æ— ç”¨çš„è¿æ¥è¯·æ±‚</strong> <code>SYN</code> æŠ¥æ–‡ï¼Œè€Œé€ æˆ<strong>é‡å¤åˆ†é…èµ„æºã€‚</strong></p><blockquote><p>TIP</p><p>å¾ˆå¤šäººé—®ï¼Œä¸¤æ¬¡æ¡æ‰‹ä¸æ˜¯ä¹Ÿå¯ä»¥æ ¹æ®ä¸Šä¸‹æ–‡ä¿¡æ¯ä¸¢å¼ƒ syn å†å²æŠ¥æ–‡å—ï¼Ÿ</p><p>æˆ‘è¿™é‡Œä¸¤æ¬¡æ¡æ‰‹æ˜¯å‡è®¾ã€Œç”±äºæ²¡æœ‰ç¬¬ä¸‰æ¬¡æ¡æ‰‹ï¼ŒæœåŠ¡ç«¯ä¸æ¸…æ¥šå®¢æˆ·ç«¯æ˜¯å¦æ”¶åˆ°äº†è‡ªå·±å‘é€çš„å»ºç«‹è¿æ¥çš„ <code>ACK</code> ç¡®è®¤æŠ¥æ–‡ï¼Œæ‰€ä»¥æ¯æ”¶åˆ°ä¸€ä¸ª <code>SYN</code> å°±åªèƒ½å…ˆä¸»åŠ¨å»ºç«‹ä¸€ä¸ªè¿æ¥ã€è¿™ä¸ªåœºæ™¯ã€‚</p><p>å½“ç„¶ä½ è¦å®ç°æˆç±»ä¼¼ä¸‰æ¬¡æ¡æ‰‹é‚£æ ·ï¼Œæ ¹æ®ä¸Šä¸‹æ–‡ä¸¢å¼ƒ syn å†å²æŠ¥æ–‡ä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œä¸¤æ¬¡æ¡æ‰‹æ²¡æœ‰å…·ä½“çš„å®ç°ï¼Œæ€ä¹ˆå‡è®¾éƒ½è¡Œã€‚</p></blockquote><blockquote><h2 id="å°ç»“" tabindex="-1"><a class="header-anchor" href="#å°ç»“"><span><em><code>å°ç»“</code></em></span></a></h2><p>TCP å»ºç«‹è¿æ¥æ—¶ï¼Œé€šè¿‡ä¸‰æ¬¡æ¡æ‰‹<strong>èƒ½é˜²æ­¢å†å²è¿æ¥çš„å»ºç«‹ï¼Œèƒ½å‡å°‘åŒæ–¹ä¸å¿…è¦çš„èµ„æºå¼€é”€ï¼Œèƒ½å¸®åŠ©åŒæ–¹åŒæ­¥åˆå§‹åŒ–åºåˆ—å·</strong>ã€‚åºåˆ—å·èƒ½å¤Ÿä¿è¯æ•°æ®åŒ…ä¸é‡å¤ã€ä¸ä¸¢å¼ƒå’ŒæŒ‰åºä¼ è¾“ã€‚</p><p><strong>ä¸ä½¿ç”¨ã€Œä¸¤æ¬¡æ¡æ‰‹ã€å’Œã€Œå››æ¬¡æ¡æ‰‹ã€çš„åŸå› ï¼š</strong></p><ul><li><strong>ã€Œä¸¤æ¬¡æ¡æ‰‹ã€</strong>ï¼š<strong><code>æ— æ³•é˜²æ­¢å†å²è¿æ¥çš„å»ºç«‹</code></strong>ï¼Œä¼š**<code>é€ æˆåŒæ–¹èµ„æºçš„æµªè´¹</code><strong>ï¼Œ ä¹Ÿ</strong><code>æ— æ³•å¯é çš„åŒæ­¥åŒæ–¹åºåˆ—å·</code>**ï¼›</li><li><strong>ã€Œå››æ¬¡æ¡æ‰‹ã€</strong>ï¼š<strong>ä¸‰æ¬¡æ¡æ‰‹å°±å·²ç»ç†è®ºä¸Šæœ€å°‘å¯é è¿æ¥å»ºç«‹</strong>ï¼Œæ‰€ä»¥ä¸éœ€è¦ä½¿ç”¨æ›´å¤šçš„é€šä¿¡æ¬¡æ•°ã€‚</li></ul></blockquote><h4 id="ä¸ºä»€ä¹ˆæ¯æ¬¡å»ºç«‹-tcp-è¿æ¥æ—¶-åˆå§‹åŒ–çš„åºåˆ—å·éƒ½è¦æ±‚ä¸ä¸€æ ·å‘¢" tabindex="-1"><a class="header-anchor" href="#ä¸ºä»€ä¹ˆæ¯æ¬¡å»ºç«‹-tcp-è¿æ¥æ—¶-åˆå§‹åŒ–çš„åºåˆ—å·éƒ½è¦æ±‚ä¸ä¸€æ ·å‘¢"><span>-- ä¸ºä»€ä¹ˆæ¯æ¬¡å»ºç«‹ TCP è¿æ¥æ—¶ï¼Œåˆå§‹åŒ–çš„åºåˆ—å·éƒ½è¦æ±‚ä¸ä¸€æ ·å‘¢ï¼Ÿ</span></a></h4><p>ä¸»è¦åŸå› æœ‰ä¸¤ä¸ªæ–¹é¢ï¼š</p><ul><li>ä¸ºäº†<strong>é˜²æ­¢å†å²æŠ¥æ–‡è¢«ä¸‹ä¸€ä¸ªç›¸åŒå››å…ƒç»„çš„è¿æ¥æ¥æ”¶ï¼ˆä¸»è¦æ–¹é¢ï¼‰ï¼›</strong></li><li>ä¸ºäº†<strong>å®‰å…¨æ€§</strong>ï¼Œé˜²æ­¢é»‘å®¢<strong>ä¼ªé€ çš„ç›¸åŒåºåˆ—å·çš„ TCP æŠ¥æ–‡è¢«å¯¹æ–¹æ¥æ”¶ï¼›</strong></li></ul><p>æ¥ä¸‹æ¥ï¼Œè¯¦ç»†è¯´è¯´ç¬¬ä¸€ç‚¹ã€‚</p><p>å‡è®¾æ¯æ¬¡å»ºç«‹è¿æ¥ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯çš„åˆå§‹åŒ–åºåˆ—å·éƒ½æ˜¯ä» 0 å¼€å§‹ï¼š</p><figure><img src="'+ut+'" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><p>è¿‡ç¨‹å¦‚ä¸‹ï¼š</p><ul><li>å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯å»ºç«‹ä¸€ä¸ª TCP è¿æ¥ï¼Œåœ¨å®¢æˆ·ç«¯å‘é€æ•°æ®åŒ…è¢«ç½‘ç»œé˜»å¡äº†ï¼Œç„¶å<strong>è¶…æ—¶é‡ä¼ </strong>äº†è¿™ä¸ªæ•°æ®åŒ…ï¼Œè€Œæ­¤æ—¶æœåŠ¡ç«¯è®¾å¤‡æ–­ç”µé‡å¯äº†ï¼Œä¹‹å‰ä¸å®¢æˆ·ç«¯å»ºç«‹çš„è¿æ¥å°±æ¶ˆå¤±äº†ï¼Œäºæ˜¯åœ¨æ”¶åˆ°å®¢æˆ·ç«¯çš„æ•°æ®åŒ…çš„æ—¶å€™å°±ä¼š<strong>å‘é€ RST æŠ¥æ–‡ã€‚</strong></li><li>ç´§æ¥ç€ï¼Œå®¢æˆ·ç«¯åˆä¸æœåŠ¡ç«¯å»ºç«‹äº†ä¸ä¸Šä¸€ä¸ªè¿æ¥ç›¸åŒå››å…ƒç»„çš„è¿æ¥ï¼›</li><li>åœ¨æ–°è¿æ¥å»ºç«‹å®Œæˆåï¼Œä¸Šä¸€ä¸ªè¿æ¥ä¸­<strong>è¢«ç½‘ç»œé˜»å¡çš„æ•°æ®åŒ…</strong>æ­£å¥½æŠµè¾¾äº†æœåŠ¡ç«¯ï¼Œåˆšå¥½è¯¥æ•°æ®åŒ…çš„<strong>åºåˆ—å·æ­£å¥½æ˜¯</strong>åœ¨æœåŠ¡ç«¯çš„æ¥æ”¶çª—å£å†…ï¼Œæ‰€ä»¥è¯¥æ•°æ®åŒ…ä¼šè¢«æœåŠ¡ç«¯æ­£å¸¸æ¥æ”¶ï¼Œå°±ä¼š<strong>é€ æˆæ•°æ®é”™ä¹±</strong>ã€‚</li></ul><p>å¯ä»¥çœ‹åˆ°ï¼Œ<strong>å¦‚æœæ¯æ¬¡å»ºç«‹è¿æ¥ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯çš„åˆå§‹åŒ–åºåˆ—å·éƒ½æ˜¯ä¸€æ ·çš„è¯ï¼Œ<code>å¾ˆå®¹æ˜“å‡ºç°å†å²æŠ¥æ–‡è¢«ä¸‹ä¸€ä¸ªç›¸åŒå››å…ƒç»„çš„è¿æ¥æ¥æ”¶çš„é—®é¢˜</code></strong>ã€‚</p><p>å¦‚æœæ¯æ¬¡å»ºç«‹è¿æ¥å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯çš„åˆå§‹åŒ–åºåˆ—å·éƒ½ã€Œä¸ä¸€æ ·ã€ï¼Œå°±æœ‰å¤§æ¦‚ç‡å› ä¸º<strong>å†å²æŠ¥æ–‡çš„åºåˆ—å·ã€Œä¸åœ¨ã€å¯¹æ–¹æ¥æ”¶çª—å£</strong>ï¼Œä»è€Œ<strong>å¾ˆå¤§ç¨‹åº¦ä¸Šé¿å…äº†å†å²æŠ¥æ–‡</strong>ï¼Œæ¯”å¦‚ä¸‹å›¾ï¼š</p><figure><img src="'+_t+'" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><p>ç›¸åï¼Œå¦‚æœæ¯æ¬¡å»ºç«‹è¿æ¥å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯çš„åˆå§‹åŒ–åºåˆ—å·éƒ½ã€Œä¸€æ ·ã€ï¼Œå°±æœ‰å¤§æ¦‚ç‡é‡åˆ°å†å²æŠ¥æ–‡çš„åºåˆ—å·åˆšã€Œå¥½åœ¨ã€å¯¹æ–¹çš„æ¥æ”¶çª—å£å†…ï¼Œä»è€Œå¯¼è‡´å†å²æŠ¥æ–‡è¢«æ–°è¿æ¥æˆåŠŸæ¥æ”¶ã€‚</p>',33),ui={href:"https://xiaolincoding.com/network/3_tcp/isn_deff.html",target:"_blank",rel:"noopener noreferrer"},_i=n('<h4 id="åˆå§‹åºåˆ—å·-isn-æ˜¯å¦‚ä½•éšæœºäº§ç”Ÿçš„" tabindex="-1"><a class="header-anchor" href="#åˆå§‹åºåˆ—å·-isn-æ˜¯å¦‚ä½•éšæœºäº§ç”Ÿçš„"><span>- åˆå§‹åºåˆ—å· ISN æ˜¯å¦‚ä½•éšæœºäº§ç”Ÿçš„ï¼Ÿ</span></a></h4><p>èµ·å§‹ <code>ISN</code> æ˜¯<strong>åŸºäºæ—¶é’Ÿçš„</strong>ï¼Œæ¯ 4 å¾®ç§’ + 1ï¼Œè½¬ä¸€åœˆè¦ 4.55 ä¸ªå°æ—¶ã€‚</p><p>RFC793 æåˆ°åˆå§‹åŒ–åºåˆ—å· ISN éšæœºç”Ÿæˆç®—æ³•ï¼šISN = M + F(localhost, localport, remotehost, remoteport)ã€‚</p><ul><li><code>M</code> æ˜¯ä¸€ä¸ªè®¡æ—¶å™¨ï¼Œè¿™ä¸ªè®¡æ—¶å™¨æ¯éš” 4 å¾®ç§’åŠ  1ã€‚</li><li><code>F</code> æ˜¯ä¸€ä¸ª Hash ç®—æ³•ï¼Œæ ¹æ®æº IPã€ç›®çš„ IPã€æºç«¯å£ã€ç›®çš„ç«¯å£ç”Ÿæˆä¸€ä¸ªéšæœºæ•°å€¼ã€‚è¦ä¿è¯ Hash ç®—æ³•ä¸èƒ½è¢«å¤–éƒ¨è½»æ˜“æ¨ç®—å¾—å‡ºï¼Œç”¨ MD5 ç®—æ³•æ˜¯ä¸€ä¸ªæ¯”è¾ƒå¥½çš„é€‰æ‹©ã€‚</li></ul><p>å¯ä»¥çœ‹åˆ°ï¼Œ<strong>éšæœºæ•°æ˜¯ä¼šåŸºäºæ—¶é’Ÿè®¡æ—¶å™¨é€’å¢çš„</strong>ï¼Œ<strong>åŸºæœ¬ä¸å¯èƒ½ä¼šéšæœºæˆä¸€æ ·çš„åˆå§‹åŒ–åºåˆ—å·</strong>ã€‚</p><h4 id="æ—¢ç„¶-ip-å±‚ä¼šåˆ†ç‰‡-ä¸ºä»€ä¹ˆ-tcp-å±‚è¿˜éœ€è¦-mss-å‘¢" tabindex="-1"><a class="header-anchor" href="#æ—¢ç„¶-ip-å±‚ä¼šåˆ†ç‰‡-ä¸ºä»€ä¹ˆ-tcp-å±‚è¿˜éœ€è¦-mss-å‘¢"><span>- æ—¢ç„¶ IP å±‚ä¼šåˆ†ç‰‡ï¼Œä¸ºä»€ä¹ˆ TCP å±‚è¿˜éœ€è¦ MSS å‘¢ï¼Ÿ</span></a></h4><p>æˆ‘ä»¬å…ˆæ¥è®¤è¯†ä¸‹ MTU å’Œ MSS</p><img src="'+Pt+'" alt="MTU ä¸ MSS" style="zoom:67%;"><blockquote><ul><li><code>MTU</code>ï¼š<strong>ä¸€ä¸ªç½‘ç»œåŒ…çš„æœ€å¤§é•¿åº¦</strong>ï¼Œä»¥å¤ªç½‘ä¸­ä¸€èˆ¬ä¸º <code>1500</code> å­—èŠ‚ï¼›</li><li><code>MSS</code>ï¼šé™¤å» IP å’Œ TCP å¤´éƒ¨<strong>ä¹‹å</strong>ï¼Œ<strong>ä¸€ä¸ªç½‘ç»œåŒ…æ‰€èƒ½å®¹çº³çš„ TCP æ•°æ®çš„æœ€å¤§é•¿åº¦ï¼›</strong></li></ul></blockquote><blockquote><p>å¦‚æœåœ¨ TCP çš„**æ•´ä¸ªæŠ¥æ–‡ï¼ˆå¤´éƒ¨ + æ•°æ®ï¼‰**äº¤ç»™ IP å±‚è¿›è¡Œåˆ†ç‰‡ï¼Œä¼šæœ‰ä»€ä¹ˆå¼‚å¸¸å‘¢ï¼Ÿ</p></blockquote><p>å½“ IP å±‚æœ‰ä¸€ä¸ªè¶…è¿‡ <code>MTU</code> å¤§å°çš„æ•°æ®ï¼ˆTCP å¤´éƒ¨ + TCP æ•°æ®ï¼‰è¦å‘é€ï¼Œé‚£ä¹ˆ <strong>IP å±‚å°±è¦è¿›è¡Œåˆ†ç‰‡</strong>ï¼ŒæŠŠæ•°æ®åˆ†ç‰‡æˆè‹¥å¹²ç‰‡ï¼Œä¿è¯æ¯ä¸€ä¸ªåˆ†ç‰‡éƒ½å°äº MTUã€‚æŠŠä¸€ä»½ IP æ•°æ®æŠ¥è¿›è¡Œåˆ†ç‰‡ä»¥åï¼Œç”±ç›®æ ‡ä¸»æœºçš„ IP å±‚æ¥è¿›è¡Œé‡æ–°ç»„è£…åï¼Œå†äº¤ç»™ä¸Šä¸€å±‚ TCP ä¼ è¾“å±‚ã€‚</p><p>è¿™çœ‹èµ·æ¥äº•ç„¶æœ‰åºï¼Œä½†è¿™å­˜åœ¨éšæ‚£çš„ï¼Œ<strong>é‚£ä¹ˆå½“å¦‚æœä¸€ä¸ª IP åˆ†ç‰‡ä¸¢å¤±ï¼Œæ•´ä¸ª IP æŠ¥æ–‡çš„æ‰€æœ‰åˆ†ç‰‡éƒ½å¾—é‡ä¼ </strong>ã€‚</p><blockquote><p>å› ä¸º <strong>IP å±‚æœ¬èº«æ²¡æœ‰è¶…æ—¶é‡ä¼ æœºåˆ¶</strong>ï¼Œå®ƒ<strong>ç”±ä¼ è¾“å±‚çš„ TCP</strong> æ¥è´Ÿè´£<strong>è¶…æ—¶</strong>å’Œ<strong>é‡ä¼ </strong>ã€‚</p></blockquote><p>å½“æŸä¸€ä¸ª IP åˆ†ç‰‡ä¸¢å¤±åï¼Œæ¥æ”¶æ–¹çš„ IP å±‚å°±<strong>æ— æ³•ç»„è£…æˆä¸€ä¸ªå®Œæ•´çš„ TCP æŠ¥æ–‡ï¼ˆå¤´éƒ¨ + æ•°æ®ï¼‰</strong>ï¼Œä¹Ÿå°±æ— æ³•å°†æ•°æ®æŠ¥æ–‡é€åˆ° TCP å±‚ï¼Œæ‰€ä»¥<strong>æ¥æ”¶æ–¹ä¸ä¼šå“åº” ACK ç»™å‘é€æ–¹</strong>ï¼Œå› ä¸ºå‘é€æ–¹<strong>è¿Ÿè¿Ÿæ”¶ä¸åˆ°</strong> ACK ç¡®è®¤æŠ¥æ–‡ï¼Œæ‰€ä»¥ä¼š<strong>è§¦å‘è¶…æ—¶é‡ä¼ </strong>ï¼Œå°±ä¼š<strong>é‡å‘ã€Œæ•´ä¸ª TCP æŠ¥æ–‡ï¼ˆå¤´éƒ¨ + æ•°æ®ï¼‰ã€ã€‚</strong></p><p>å› æ­¤ï¼Œå¯ä»¥å¾—çŸ¥<strong>ç”± IP å±‚è¿›è¡Œåˆ†ç‰‡ä¼ è¾“ï¼Œæ˜¯éå¸¸æ²¡æœ‰æ•ˆç‡çš„ã€‚</strong></p><p>æ‰€ä»¥ï¼Œ<strong><code>ä¸ºäº†è¾¾åˆ°æœ€ä½³çš„ä¼ è¾“æ•ˆèƒ½</code></strong> TCP åè®®åœ¨<strong>å»ºç«‹è¿æ¥çš„æ—¶å€™é€šå¸¸è¦åå•†åŒæ–¹çš„ MSS å€¼</strong>ï¼Œå½“ TCP å±‚å‘ç°æ•°æ®<strong>è¶…è¿‡ MSS æ—¶</strong>ï¼Œåˆ™å°±<strong>å…ˆä¼šè¿›è¡Œåˆ†ç‰‡</strong>ï¼Œå½“ç„¶ç”±å®ƒå½¢æˆçš„ IP åŒ…çš„é•¿åº¦ä¹Ÿå°±<strong>ä¸ä¼šå¤§äº MTU</strong> ï¼Œ<strong>è‡ªç„¶ä¹Ÿå°±ä¸ç”¨ IP åˆ†ç‰‡äº†</strong>ã€‚</p><figure><img src="'+Ct+`" alt="æ¡æ‰‹é˜¶æ®µåå•† MSS" tabindex="0" loading="lazy"><figcaption>æ¡æ‰‹é˜¶æ®µåå•† MSS</figcaption></figure><p>ç»è¿‡ TCP å±‚åˆ†ç‰‡åï¼Œå¦‚æœä¸€ä¸ª TCP åˆ†ç‰‡ä¸¢å¤±åï¼Œ<strong>è¿›è¡Œé‡å‘æ—¶ä¹Ÿæ˜¯ä»¥ MSS ä¸ºå•ä½</strong>ï¼Œè€Œ<strong>ä¸ç”¨é‡ä¼ æ‰€æœ‰çš„åˆ†ç‰‡</strong>ï¼Œå¤§å¤§<strong>å¢åŠ äº†é‡ä¼ çš„æ•ˆç‡</strong>ã€‚</p><h4 id="ç¬¬ä¸€æ¬¡æ¡æ‰‹ä¸¢å¤±äº†-ä¼šå‘ç”Ÿä»€ä¹ˆ" tabindex="-1"><a class="header-anchor" href="#ç¬¬ä¸€æ¬¡æ¡æ‰‹ä¸¢å¤±äº†-ä¼šå‘ç”Ÿä»€ä¹ˆ"><span>-- ç¬¬ä¸€æ¬¡æ¡æ‰‹ä¸¢å¤±äº†ï¼Œä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ</span></a></h4><p>å½“å®¢æˆ·ç«¯æƒ³å’ŒæœåŠ¡ç«¯å»ºç«‹ TCP è¿æ¥çš„æ—¶å€™ï¼Œé¦–å…ˆ<strong>ç¬¬ä¸€ä¸ª</strong>å‘çš„å°±æ˜¯ <strong>SYN æŠ¥æ–‡</strong>ï¼Œç„¶åè¿›å…¥åˆ° <code>SYN_SENT</code> çŠ¶æ€ã€‚</p><p>åœ¨è¿™ä¹‹åï¼Œå¦‚æœå®¢æˆ·ç«¯è¿Ÿè¿Ÿæ”¶ä¸åˆ°æœåŠ¡ç«¯çš„ SYN-ACK æŠ¥æ–‡ï¼ˆç¬¬äºŒæ¬¡æ¡æ‰‹ï¼‰ï¼Œå°±ä¼šè§¦å‘**ã€Œè¶…æ—¶é‡ä¼ ã€<strong>æœºåˆ¶ï¼Œé‡ä¼  SYN æŠ¥æ–‡ï¼Œè€Œä¸”</strong>é‡ä¼ çš„ SYN æŠ¥æ–‡çš„åºåˆ—å·éƒ½æ˜¯ä¸€æ ·çš„**ã€‚</p><p>ä¸åŒç‰ˆæœ¬çš„æ“ä½œç³»ç»Ÿå¯èƒ½è¶…æ—¶æ—¶é—´ä¸åŒï¼Œæœ‰çš„ 1 ç§’çš„ï¼Œä¹Ÿæœ‰ 3 ç§’çš„ï¼Œè¿™ä¸ª<strong>è¶…æ—¶æ—¶é—´æ˜¯å†™æ­»åœ¨å†…æ ¸é‡Œçš„</strong>ï¼Œå¦‚æœæƒ³è¦æ›´æ”¹åˆ™éœ€è¦é‡æ–°ç¼–è¯‘å†…æ ¸ï¼Œæ¯”è¾ƒéº»çƒ¦ã€‚</p><p>å½“å®¢æˆ·ç«¯åœ¨ 1 ç§’åæ²¡æ”¶åˆ°æœåŠ¡ç«¯çš„ SYN-ACK æŠ¥æ–‡åï¼Œå®¢æˆ·ç«¯å°±ä¼š<strong>é‡å‘ SYN æŠ¥æ–‡</strong>ï¼Œ<strong>é‚£åˆ°åº•é‡å‘å‡ æ¬¡å‘¢</strong>ï¼Ÿ</p><p>åœ¨ Linux é‡Œï¼Œå®¢æˆ·ç«¯çš„ SYN æŠ¥æ–‡æœ€å¤§é‡ä¼ æ¬¡æ•°ç”± <code>tcp_syn_retries</code><strong>å†…æ ¸å‚æ•°æ§åˆ¶</strong>ï¼Œè¿™ä¸ª<strong>å‚æ•°æ˜¯å¯ä»¥è‡ªå®šä¹‰çš„</strong>ï¼Œé»˜è®¤å€¼ä¸€èˆ¬æ˜¯ 5ã€‚</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token comment"># cat /proc/sys/net/ipv4/tcp_syn_retries</span>
<span class="token number">5</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>é€šå¸¸ï¼Œç¬¬ä¸€æ¬¡è¶…æ—¶é‡ä¼ æ˜¯åœ¨ <strong>1 ç§’å</strong>ï¼Œç¬¬äºŒæ¬¡è¶…æ—¶é‡ä¼ æ˜¯åœ¨ 2 ç§’ï¼Œç¬¬ä¸‰æ¬¡è¶…æ—¶é‡ä¼ æ˜¯åœ¨ 4 ç§’åï¼Œç¬¬å››æ¬¡è¶…æ—¶é‡ä¼ æ˜¯åœ¨ 8 ç§’åï¼Œç¬¬äº”æ¬¡æ˜¯åœ¨è¶…æ—¶é‡ä¼  16 ç§’åã€‚æ²¡é”™ï¼Œ<strong>æ¯æ¬¡è¶…æ—¶çš„æ—¶é—´æ˜¯ä¸Šä¸€æ¬¡çš„ 2 å€</strong>ã€‚</p><p>å½“ç¬¬äº”æ¬¡è¶…æ—¶é‡ä¼ åï¼Œ<strong>ä¼šç»§ç»­ç­‰å¾… 32 ç§’</strong>ï¼Œå¦‚æœæœåŠ¡ç«¯ä»ç„¶æ²¡æœ‰å›åº” ACKï¼Œå®¢æˆ·ç«¯å°±<strong>ä¸å†å‘é€ SYN åŒ…</strong>ï¼Œç„¶å<strong>æ–­å¼€ TCP è¿æ¥</strong>ã€‚</p><p>æ‰€ä»¥ï¼Œæ€»è€—æ—¶æ˜¯ 1+2+4+8+16+32=63 ç§’ï¼Œ<strong>å¤§çº¦ 1 åˆ†é’Ÿå·¦å³</strong>ã€‚</p><p>ä¸¾ä¸ªä¾‹å­ï¼Œå‡è®¾ tcp_syn_retries å‚æ•°å€¼ä¸º 3ï¼Œé‚£ä¹ˆå½“<strong>å®¢æˆ·ç«¯çš„ SYN æŠ¥æ–‡ä¸€ç›´åœ¨ç½‘ç»œä¸­ä¸¢å¤±æ—¶</strong>ï¼Œä¼šå‘ç”Ÿä¸‹å›¾çš„è¿‡ç¨‹ï¼š</p><img src="`+bt+`" alt="img" style="zoom:67%;"><p>å…·ä½“è¿‡ç¨‹ï¼š</p><ul><li>å½“å®¢æˆ·ç«¯è¶…æ—¶é‡ä¼  3 æ¬¡ SYN æŠ¥æ–‡åï¼Œç”±äº tcp_syn_retries ä¸º 3ï¼Œå·²è¾¾åˆ°<strong>æœ€å¤§é‡ä¼ æ¬¡æ•°</strong>ï¼Œäºæ˜¯å†ç­‰å¾…ä¸€æ®µæ—¶é—´ï¼ˆæ—¶é—´ä¸ºä¸Šä¸€æ¬¡è¶…æ—¶æ—¶é—´çš„ 2 å€ï¼‰ï¼Œå¦‚æœè¿˜æ˜¯æ²¡èƒ½æ”¶åˆ°æœåŠ¡ç«¯çš„ç¬¬äºŒæ¬¡æ¡æ‰‹ï¼ˆSYN-ACK æŠ¥æ–‡ï¼‰ï¼Œé‚£ä¹ˆå®¢æˆ·ç«¯å°±ä¼š<strong>æ–­å¼€è¿æ¥</strong>ã€‚</li></ul><h4 id="ç¬¬äºŒæ¬¡æ¡æ‰‹ä¸¢å¤±äº†-ä¼šå‘ç”Ÿä»€ä¹ˆ" tabindex="-1"><a class="header-anchor" href="#ç¬¬äºŒæ¬¡æ¡æ‰‹ä¸¢å¤±äº†-ä¼šå‘ç”Ÿä»€ä¹ˆ"><span>-- ç¬¬äºŒæ¬¡æ¡æ‰‹ä¸¢å¤±äº†ï¼Œä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ</span></a></h4><p>å½“æœåŠ¡ç«¯æ”¶åˆ°å®¢æˆ·ç«¯çš„ç¬¬ä¸€æ¬¡æ¡æ‰‹åï¼Œå°±ä¼š<strong>å› SYN-ACK æŠ¥æ–‡ç»™å®¢æˆ·ç«¯</strong>ï¼Œè¿™ä¸ªå°±æ˜¯ç¬¬äºŒæ¬¡æ¡æ‰‹ï¼Œæ­¤æ—¶æœåŠ¡ç«¯ä¼šè¿›å…¥ <code>SYN_RCVD</code> çŠ¶æ€ã€‚</p><p>ç¬¬äºŒæ¬¡æ¡æ‰‹çš„ <code>SYN-ACK</code> æŠ¥æ–‡å…¶å®æœ‰ä¸¤ä¸ªç›®çš„ ï¼š</p><ul><li>ç¬¬äºŒæ¬¡æ¡æ‰‹é‡Œçš„ ACKï¼Œ æ˜¯å¯¹<strong>ç¬¬ä¸€æ¬¡æ¡æ‰‹çš„ç¡®è®¤æŠ¥æ–‡</strong>ï¼›</li><li>ç¬¬äºŒæ¬¡æ¡æ‰‹é‡Œçš„ SYNï¼Œæ˜¯<strong>æœåŠ¡ç«¯å‘èµ·å»ºç«‹ TCP è¿æ¥çš„æŠ¥æ–‡</strong>ï¼›</li></ul><blockquote><p>æ‰€ä»¥ï¼Œå¦‚æœç¬¬äºŒæ¬¡æ¡æ‰‹ä¸¢äº†ï¼Œå°±ä¼š<strong>å‘ç”Ÿæ¯”è¾ƒæœ‰æ„æ€çš„äº‹æƒ…</strong>ï¼Œå…·ä½“ä¼šæ€ä¹ˆæ ·å‘¢ï¼Ÿ</p></blockquote><p>å› ä¸ºç¬¬äºŒæ¬¡æ¡æ‰‹æŠ¥æ–‡é‡Œæ˜¯åŒ…å«å¯¹å®¢æˆ·ç«¯çš„ç¬¬ä¸€æ¬¡æ¡æ‰‹çš„ ACK ç¡®è®¤æŠ¥æ–‡ï¼Œæ‰€ä»¥ï¼Œå¦‚æœå®¢æˆ·ç«¯è¿Ÿè¿Ÿæ²¡æœ‰æ”¶åˆ°ç¬¬äºŒæ¬¡æ¡æ‰‹ï¼Œé‚£ä¹ˆ<strong>å®¢æˆ·ç«¯</strong>å°±è§‰å¾—<strong>å¯èƒ½è‡ªå·±çš„ SYN æŠ¥æ–‡ï¼ˆç¬¬ä¸€æ¬¡æ¡æ‰‹ï¼‰ä¸¢å¤±äº†</strong>ï¼Œäºæ˜¯<strong>å®¢æˆ·ç«¯å°±ä¼šè§¦å‘è¶…æ—¶é‡ä¼ æœºåˆ¶ï¼Œé‡ä¼  SYN æŠ¥æ–‡</strong>ã€‚</p><p>ç„¶åï¼Œå› ä¸ºç¬¬äºŒæ¬¡æ¡æ‰‹ä¸­åŒ…å«æœåŠ¡ç«¯çš„ SYN æŠ¥æ–‡ï¼Œæ‰€ä»¥å½“å®¢æˆ·ç«¯æ”¶åˆ°åï¼Œ<strong>éœ€è¦ç»™æœåŠ¡ç«¯å‘é€ ACK ç¡®è®¤æŠ¥æ–‡ï¼ˆç¬¬ä¸‰æ¬¡æ¡æ‰‹ï¼‰</strong>ï¼ŒæœåŠ¡ç«¯æ‰ä¼šè®¤ä¸ºè¯¥ SYN æŠ¥æ–‡è¢«å®¢æˆ·ç«¯æ”¶åˆ°äº†ã€‚</p><p>é‚£ä¹ˆï¼Œå¦‚æœç¬¬äºŒæ¬¡æ¡æ‰‹ä¸¢å¤±äº†ï¼Œ<strong>æœåŠ¡ç«¯ å°±æ”¶ä¸åˆ°ç¬¬ä¸‰æ¬¡æ¡æ‰‹</strong>ï¼Œäºæ˜¯<strong>æœåŠ¡ç«¯ è¿™è¾¹ä¼šè§¦å‘è¶…æ—¶ é‡ä¼ æœºåˆ¶ï¼Œé‡ä¼  SYN-ACK æŠ¥æ–‡</strong>ã€‚</p><p>åœ¨ Linux ä¸‹ï¼ŒSYN-ACK æŠ¥æ–‡çš„æœ€å¤§é‡ä¼ æ¬¡æ•°ç”± <code>tcp_synack_retries</code>å†…æ ¸å‚æ•°å†³å®šï¼Œé»˜è®¤å€¼æ˜¯ 5ã€‚</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token comment"># cat /proc/sys/net/ipv4/tcp_synack_retries</span>
<span class="token number">5</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>å› æ­¤ï¼Œå½“ç¬¬äºŒæ¬¡æ¡æ‰‹ä¸¢å¤±äº†ï¼Œ<strong>å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯éƒ½ä¼šé‡ä¼ ï¼š</strong></p><ul><li>å®¢æˆ·ç«¯ä¼šé‡ä¼  SYN æŠ¥æ–‡ï¼Œä¹Ÿå°±æ˜¯ç¬¬ä¸€æ¬¡æ¡æ‰‹ï¼Œæœ€å¤§é‡ä¼ æ¬¡æ•°ç”± <code>tcp_syn_retries</code>å†…æ ¸å‚æ•°å†³å®šï¼›</li><li>æœåŠ¡ç«¯ä¼šé‡ä¼  SYN-ACK æŠ¥æ–‡ï¼Œä¹Ÿå°±æ˜¯ç¬¬äºŒæ¬¡æ¡æ‰‹ï¼Œæœ€å¤§é‡ä¼ æ¬¡æ•°ç”± <code>tcp_synack_retries</code> å†…æ ¸å‚æ•°å†³å®šã€‚</li></ul></blockquote><p>ä¸¾ä¸ªä¾‹å­ï¼Œå‡è®¾ tcp_syn_retries å‚æ•°å€¼ä¸º 1ï¼Œtcp_synack_retries å‚æ•°å€¼ä¸º 2ï¼Œé‚£ä¹ˆ<strong>å½“ç¬¬äºŒæ¬¡æ¡æ‰‹ä¸€ç›´ä¸¢å¤±æ—¶</strong>ï¼Œå‘ç”Ÿçš„è¿‡ç¨‹å¦‚ä¸‹å›¾ï¼š</p><img src="`+kt+'" alt="img" style="zoom:67%;"><p>å…·ä½“è¿‡ç¨‹ï¼š</p><ul><li>å½“å®¢æˆ·ç«¯è¶…æ—¶é‡ä¼  1 æ¬¡ SYN æŠ¥æ–‡åï¼Œç”±äº tcp_syn_retries ä¸º 1ï¼Œå·²è¾¾åˆ°æœ€å¤§é‡ä¼ æ¬¡æ•°ï¼Œäºæ˜¯<strong>å†ç­‰å¾…ä¸€æ®µæ—¶é—´</strong>ï¼ˆæ—¶é—´ä¸ºä¸Šä¸€æ¬¡è¶…æ—¶æ—¶é—´çš„ 2 å€ï¼‰ï¼Œå¦‚æœè¿˜æ˜¯æ²¡èƒ½æ”¶åˆ°æœåŠ¡ç«¯çš„ç¬¬äºŒæ¬¡æ¡æ‰‹ï¼ˆSYN-ACK æŠ¥æ–‡ï¼‰ï¼Œé‚£ä¹ˆ<strong>å®¢æˆ·ç«¯å°±ä¼šæ–­å¼€è¿æ¥ã€‚</strong></li><li>å½“æœåŠ¡ç«¯è¶…æ—¶é‡ä¼  2 æ¬¡ SYN-ACK æŠ¥æ–‡åï¼Œç”±äº tcp_synack_retries ä¸º 2ï¼Œå·²è¾¾åˆ°æœ€å¤§é‡ä¼ æ¬¡æ•°ï¼Œäºæ˜¯å†ç­‰å¾…ä¸€æ®µæ—¶é—´ï¼ˆæ—¶é—´ä¸ºä¸Šä¸€æ¬¡è¶…æ—¶æ—¶é—´çš„ 2 å€ï¼‰ï¼Œå¦‚æœè¿˜æ˜¯æ²¡èƒ½æ”¶åˆ°å®¢æˆ·ç«¯çš„ç¬¬ä¸‰æ¬¡æ¡æ‰‹ï¼ˆACK æŠ¥æ–‡ï¼‰ï¼Œé‚£ä¹ˆ<strong>æœåŠ¡ç«¯å°±ä¼šæ–­å¼€è¿æ¥ã€‚</strong></li></ul><h4 id="ç¬¬ä¸‰æ¬¡æ¡æ‰‹ä¸¢å¤±äº†-ä¼šå‘ç”Ÿä»€ä¹ˆ" tabindex="-1"><a class="header-anchor" href="#ç¬¬ä¸‰æ¬¡æ¡æ‰‹ä¸¢å¤±äº†-ä¼šå‘ç”Ÿä»€ä¹ˆ"><span>-- ç¬¬ä¸‰æ¬¡æ¡æ‰‹ä¸¢å¤±äº†ï¼Œä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ</span></a></h4><p>å®¢æˆ·ç«¯æ”¶åˆ°æœåŠ¡ç«¯çš„ SYN-ACK æŠ¥æ–‡åï¼Œå°±ä¼šç»™æœåŠ¡ç«¯å›ä¸€ä¸ª ACK æŠ¥æ–‡ï¼Œä¹Ÿå°±æ˜¯<strong>ç¬¬ä¸‰æ¬¡æ¡æ‰‹</strong>ï¼Œæ­¤æ—¶å®¢æˆ·ç«¯çŠ¶æ€è¿›å…¥åˆ° <code>ESTABLISH</code> çŠ¶æ€ã€‚</p><p>å› ä¸ºè¿™ä¸ªç¬¬ä¸‰æ¬¡æ¡æ‰‹çš„ ACK æ˜¯<strong>å¯¹ç¬¬äºŒæ¬¡æ¡æ‰‹çš„ SYN çš„ç¡®è®¤æŠ¥æ–‡</strong>ï¼Œæ‰€ä»¥å½“ç¬¬ä¸‰æ¬¡æ¡æ‰‹ä¸¢å¤±äº†ï¼Œå¦‚æœæœåŠ¡ç«¯é‚£ä¸€æ–¹è¿Ÿè¿Ÿæ”¶ä¸åˆ°è¿™ä¸ªç¡®è®¤æŠ¥æ–‡ï¼Œå°±ä¼šè§¦å‘<strong>è¶…æ—¶é‡ä¼ æœºåˆ¶</strong>ï¼Œé‡ä¼  SYN-ACK æŠ¥æ–‡ï¼Œç›´åˆ°æ”¶åˆ°ç¬¬ä¸‰æ¬¡æ¡æ‰‹ï¼Œæˆ–è€…è¾¾åˆ°æœ€å¤§é‡ä¼ æ¬¡æ•°ã€‚</p><blockquote><p>æ³¨æ„ï¼Œ<strong><code>ACK æŠ¥æ–‡æ˜¯ä¸ä¼šæœ‰é‡ä¼ çš„</code>ï¼Œå½“ ACK ä¸¢å¤±äº†ï¼Œå°±ç”±å¯¹æ–¹é‡ä¼ å¯¹åº”çš„æŠ¥æ–‡</strong>ã€‚</p></blockquote><p>ä¸¾ä¸ªä¾‹å­ï¼Œå‡è®¾ tcp_synack_retries å‚æ•°å€¼ä¸º 2ï¼Œé‚£ä¹ˆ<strong>å½“ç¬¬ä¸‰æ¬¡æ¡æ‰‹ä¸€ç›´ä¸¢å¤±æ—¶</strong>ï¼Œå‘ç”Ÿçš„è¿‡ç¨‹å¦‚ä¸‹å›¾ï¼š</p><img src="'+ft+'" alt="img" style="zoom:67%;"><p>å…·ä½“è¿‡ç¨‹ï¼š</p><ul><li>å½“æœåŠ¡ç«¯è¶…æ—¶é‡ä¼  2 æ¬¡ SYN-ACK æŠ¥æ–‡åï¼Œç”±äº tcp_synack_retries ä¸º 2ï¼Œå·²è¾¾åˆ°æœ€å¤§é‡ä¼ æ¬¡æ•°ï¼Œäºæ˜¯å†ç­‰å¾…ä¸€æ®µæ—¶é—´ï¼ˆæ—¶é—´ä¸ºä¸Šä¸€æ¬¡è¶…æ—¶æ—¶é—´çš„ 2 å€ï¼‰ï¼Œå¦‚æœè¿˜æ˜¯æ²¡èƒ½æ”¶åˆ°å®¢æˆ·ç«¯çš„ç¬¬ä¸‰æ¬¡æ¡æ‰‹ï¼ˆACK æŠ¥æ–‡ï¼‰ï¼Œé‚£ä¹ˆ<strong>æœåŠ¡ç«¯å°±ä¼šæ–­å¼€è¿æ¥ã€‚</strong></li></ul><h4 id="ä»€ä¹ˆæ˜¯-syn-æ”»å‡»-å¦‚ä½•é¿å…-syn-æ”»å‡»" tabindex="-1"><a class="header-anchor" href="#ä»€ä¹ˆæ˜¯-syn-æ”»å‡»-å¦‚ä½•é¿å…-syn-æ”»å‡»"><span>-- ä»€ä¹ˆæ˜¯ SYN æ”»å‡»ï¼Ÿå¦‚ä½•é¿å… SYN æ”»å‡»ï¼Ÿ</span></a></h4><p>æˆ‘ä»¬éƒ½çŸ¥é“ TCP è¿æ¥å»ºç«‹æ˜¯éœ€è¦ä¸‰æ¬¡æ¡æ‰‹ï¼Œå‡è®¾æ”»å‡»è€…çŸ­æ—¶é—´ä¼ªé€ ä¸åŒ IP åœ°å€çš„ <code>SYN</code> æŠ¥æ–‡ï¼ŒæœåŠ¡ç«¯æ¯æ¥æ”¶åˆ°ä¸€ä¸ª <code>SYN</code> æŠ¥æ–‡ï¼Œå°±è¿›å…¥<code>SYN_RCVD</code> çŠ¶æ€ï¼Œä½†æœåŠ¡ç«¯å‘é€å‡ºå»çš„ <code>ACK + SYN</code> æŠ¥æ–‡ï¼Œæ— æ³•å¾—åˆ°æœªçŸ¥ IP ä¸»æœºçš„ <code>ACK</code> åº”ç­”ï¼Œä¹…è€Œä¹…ä¹‹å°±ä¼š<strong>å æ»¡æœåŠ¡ç«¯çš„åŠè¿æ¥é˜Ÿåˆ—</strong>ï¼Œä½¿å¾—<strong>æœåŠ¡ç«¯ä¸èƒ½ä¸ºæ­£å¸¸ç”¨æˆ·æœåŠ¡ã€‚</strong></p><figure><img src="'+St+'" alt="SYN æ”»å‡»" tabindex="0" loading="lazy"><figcaption>SYN æ”»å‡»</figcaption></figure><p>å…ˆè·Ÿå¤§å®¶è¯´ä¸€ä¸‹ï¼Œä»€ä¹ˆæ˜¯ TCP åŠè¿æ¥å’Œå…¨è¿æ¥é˜Ÿåˆ—ã€‚</p><p>åœ¨ TCP ä¸‰æ¬¡æ¡æ‰‹çš„æ—¶å€™ï¼Œ<strong>Linux å†…æ ¸ä¼šç»´æŠ¤ä¸¤ä¸ªé˜Ÿåˆ—</strong>ï¼Œåˆ†åˆ«æ˜¯ï¼š</p><ul><li>åŠè¿æ¥é˜Ÿåˆ—ï¼Œä¹Ÿç§° SYN é˜Ÿåˆ—ï¼›</li><li>å…¨è¿æ¥é˜Ÿåˆ—ï¼Œä¹Ÿç§° accept é˜Ÿåˆ—ï¼›</li></ul><p>æˆ‘ä»¬å…ˆæ¥çœ‹ä¸‹ Linux å†…æ ¸çš„ <code>SYN</code> é˜Ÿåˆ—ï¼ˆåŠè¿æ¥é˜Ÿåˆ—ï¼‰ä¸ <code>Accpet</code> é˜Ÿåˆ—ï¼ˆå…¨è¿æ¥é˜Ÿåˆ—ï¼‰æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿ</p><figure><img src="'+At+`" alt="æ­£å¸¸æµç¨‹" tabindex="0" loading="lazy"><figcaption>æ­£å¸¸æµç¨‹</figcaption></figure><p>æ­£å¸¸æµç¨‹ï¼š</p><ul><li>å½“æœåŠ¡ç«¯æ¥æ”¶åˆ°å®¢æˆ·ç«¯çš„ SYN æŠ¥æ–‡æ—¶ï¼Œä¼šåˆ›å»ºä¸€ä¸ª<strong>åŠè¿æ¥çš„å¯¹è±¡</strong>ï¼Œç„¶åå°†å…¶åŠ å…¥åˆ°å†…æ ¸çš„ã€Œ SYN é˜Ÿåˆ—ã€ï¼›</li><li>æ¥ç€å‘é€ SYN + ACK ç»™å®¢æˆ·ç«¯ï¼Œç­‰å¾…å®¢æˆ·ç«¯å›åº” ACK æŠ¥æ–‡ï¼›</li><li>æœåŠ¡ç«¯æ¥æ”¶åˆ° ACK æŠ¥æ–‡åï¼Œä»ã€Œ SYN é˜Ÿåˆ—ã€<strong>å–å‡ºä¸€ä¸ªåŠè¿æ¥å¯¹è±¡</strong>ï¼Œç„¶ååˆ›å»ºä¸€ä¸ª<strong>æ–°çš„è¿æ¥å¯¹è±¡</strong>æ”¾å…¥åˆ°**ã€Œ Accept é˜Ÿåˆ—ã€**ï¼›</li><li>åº”ç”¨é€šè¿‡è°ƒç”¨ <code>accpet()</code> socket <strong>æ¥å£</strong>ï¼Œ<strong>ä»ã€Œ Accept é˜Ÿåˆ—ã€å–å‡ºè¿æ¥å¯¹è±¡ã€‚</strong></li><li></li></ul><p>ä¸ç®¡æ˜¯åŠè¿æ¥é˜Ÿåˆ—è¿˜æ˜¯å…¨è¿æ¥é˜Ÿåˆ—ï¼Œéƒ½æœ‰æœ€å¤§é•¿åº¦é™åˆ¶ï¼Œè¶…è¿‡é™åˆ¶æ—¶ï¼Œé»˜è®¤æƒ…å†µéƒ½ä¼šä¸¢å¼ƒæŠ¥æ–‡ã€‚</p><p>SYN æ”»å‡»æ–¹å¼æœ€ç›´æ¥çš„è¡¨ç°å°±ä¼šæŠŠ TCP åŠè¿æ¥é˜Ÿåˆ—æ‰“æ»¡ï¼Œè¿™æ ·<strong>å½“ TCP åŠè¿æ¥é˜Ÿåˆ—æ»¡äº†ï¼Œåç»­å†åœ¨æ”¶åˆ° SYN æŠ¥æ–‡å°±ä¼šä¸¢å¼ƒ</strong>ï¼Œå¯¼è‡´å®¢æˆ·ç«¯æ— æ³•å’ŒæœåŠ¡ç«¯å»ºç«‹è¿æ¥ã€‚</p><p><strong>é¿å… SYN æ”»å‡»æ–¹å¼ï¼Œå¯ä»¥æœ‰ä»¥ä¸‹å››ç§æ–¹æ³•ï¼š</strong></p><ul><li>è°ƒå¤§ netdev_max_backlogï¼›</li><li>å¢å¤§ TCP åŠè¿æ¥é˜Ÿåˆ—ï¼›</li><li>å¼€å¯ tcp_syncookiesï¼›</li><li>å‡å°‘ SYN+ACK é‡ä¼ æ¬¡æ•°</li></ul><blockquote><p>æ–¹å¼ä¸€ï¼šè°ƒå¤§ netdev_max_backlog</p></blockquote><p>å½“ç½‘å¡æ¥æ”¶æ•°æ®åŒ…çš„é€Ÿåº¦å¤§äºå†…æ ¸å¤„ç†çš„é€Ÿåº¦æ—¶ï¼Œä¼šæœ‰ä¸€ä¸ª<strong>é˜Ÿåˆ—ä¿å­˜è¿™äº›æ•°æ®åŒ…</strong>ã€‚æ§åˆ¶è¯¥é˜Ÿåˆ—çš„æœ€å¤§å€¼å¦‚ä¸‹å‚æ•°ï¼Œé»˜è®¤å€¼æ˜¯ 1000ï¼Œæˆ‘ä»¬è¦é€‚å½“è°ƒå¤§è¯¥å‚æ•°çš„å€¼ï¼Œæ¯”å¦‚è®¾ç½®ä¸º 10000ï¼š</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>net.core.netdev_max_backlog <span class="token operator">=</span> <span class="token number">10000</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><blockquote><p>æ–¹å¼äºŒï¼šå¢å¤§ TCP åŠè¿æ¥é˜Ÿåˆ—</p></blockquote><p>å¢å¤§ TCP åŠè¿æ¥é˜Ÿåˆ—ï¼Œè¦åŒæ—¶å¢å¤§ä¸‹é¢è¿™ä¸‰ä¸ªå‚æ•°ï¼š</p><ul><li>å¢å¤§ net.ipv4.tcp_max_syn_backlog</li><li>å¢å¤§ listen() å‡½æ•°ä¸­çš„ backlog</li><li>å¢å¤§ net.core.somaxconn</li></ul>`,75),Pi={href:"https://xiaolincoding.com/network/3_tcp/tcp_queue.html",target:"_blank",rel:"noopener noreferrer"},Ci=n('<blockquote><p>æ–¹å¼ä¸‰ï¼šå¼€å¯ net.ipv4.tcp_syncookies</p></blockquote><p>å¼€å¯ syncookies åŠŸèƒ½å°±å¯ä»¥åœ¨<strong>ä¸ä½¿ç”¨ SYN åŠè¿æ¥é˜Ÿåˆ—çš„æƒ…å†µä¸‹æˆåŠŸå»ºç«‹è¿æ¥</strong>ï¼Œç›¸å½“äºç»•è¿‡äº† SYN åŠè¿æ¥æ¥å»ºç«‹è¿æ¥ã€‚</p><figure><img src="'+It+`" alt="tcp_syncookies åº”å¯¹ SYN æ”»å‡»" tabindex="0" loading="lazy"><figcaption>tcp_syncookies åº”å¯¹ SYN æ”»å‡»</figcaption></figure><p>å…·ä½“è¿‡ç¨‹ï¼š</p><ul><li>å½“ ã€Œ SYN é˜Ÿåˆ—ã€æ»¡ä¹‹åï¼Œåç»­æœåŠ¡ç«¯æ”¶åˆ° SYN åŒ…ï¼Œä¸ä¼šä¸¢å¼ƒï¼Œè€Œæ˜¯æ ¹æ®ç®—æ³•ï¼Œè®¡ç®—å‡ºä¸€ä¸ª <code>cookie</code> å€¼ï¼›</li><li>å°† cookie å€¼æ”¾åˆ°ç¬¬äºŒæ¬¡æ¡æ‰‹æŠ¥æ–‡çš„ã€Œåºåˆ—å·ã€é‡Œï¼Œç„¶åæœåŠ¡ç«¯å›ç¬¬äºŒæ¬¡æ¡æ‰‹ç»™å®¢æˆ·ç«¯ï¼›</li><li>æœåŠ¡ç«¯æ¥æ”¶åˆ°å®¢æˆ·ç«¯çš„åº”ç­”æŠ¥æ–‡æ—¶ï¼ŒæœåŠ¡ç«¯ä¼šæ£€æŸ¥è¿™ä¸ª ACK åŒ…çš„åˆæ³•æ€§ã€‚å¦‚æœåˆæ³•ï¼Œå°†è¯¥è¿æ¥å¯¹è±¡æ”¾å…¥åˆ°ã€Œ Accept é˜Ÿåˆ—ã€ã€‚</li><li>æœ€ååº”ç”¨ç¨‹åºé€šè¿‡è°ƒç”¨ <code>accpet()</code> æ¥å£ï¼Œä»ã€Œ Accept é˜Ÿåˆ—ã€å–å‡ºçš„è¿æ¥ã€‚</li></ul><p>å¯ä»¥çœ‹åˆ°ï¼Œå½“å¼€å¯äº† tcp_syncookies äº†ï¼Œå³ä½¿å—åˆ° SYN æ”»å‡»è€Œå¯¼è‡´ SYN é˜Ÿåˆ—æ»¡æ—¶ï¼Œä¹Ÿèƒ½ä¿è¯æ­£å¸¸çš„è¿æ¥æˆåŠŸå»ºç«‹ã€‚</p><p>net.ipv4.tcp_syncookies å‚æ•°ä¸»è¦æœ‰ä»¥ä¸‹ä¸‰ä¸ªå€¼ï¼š</p><ul><li>0 å€¼ï¼Œè¡¨ç¤ºå…³é—­è¯¥åŠŸèƒ½ï¼›</li><li>1 å€¼ï¼Œè¡¨ç¤ºä»…å½“ SYN åŠè¿æ¥é˜Ÿåˆ—æ”¾ä¸ä¸‹æ—¶ï¼Œå†å¯ç”¨å®ƒï¼›</li><li>2 å€¼ï¼Œè¡¨ç¤ºæ— æ¡ä»¶å¼€å¯åŠŸèƒ½ï¼›</li></ul><p>é‚£ä¹ˆåœ¨åº”å¯¹ SYN æ”»å‡»æ—¶ï¼Œåªéœ€è¦è®¾ç½®ä¸º 1 å³å¯ã€‚</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>$ <span class="token builtin class-name">echo</span> <span class="token number">1</span> <span class="token operator">&gt;</span> /proc/sys/net/ipv4/tcp_syncookies
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><blockquote><p>æ–¹å¼å››ï¼šå‡å°‘ SYN+ACK é‡ä¼ æ¬¡æ•°</p></blockquote><p>å½“æœåŠ¡ç«¯å—åˆ° SYN æ”»å‡»æ—¶ï¼Œå°±ä¼šæœ‰å¤§é‡å¤„äº SYN_REVC çŠ¶æ€çš„ TCP è¿æ¥ï¼Œå¤„äºè¿™ä¸ªçŠ¶æ€çš„ TCP ä¼šé‡ä¼  SYN+ACK ï¼Œå½“é‡ä¼ è¶…è¿‡æ¬¡æ•°è¾¾åˆ°ä¸Šé™åï¼Œå°±ä¼šæ–­å¼€è¿æ¥ã€‚</p><p>é‚£ä¹ˆé’ˆå¯¹ SYN æ”»å‡»çš„åœºæ™¯ï¼Œæˆ‘ä»¬å¯ä»¥å‡å°‘ SYN-ACK çš„é‡ä¼ æ¬¡æ•°ï¼Œä»¥åŠ å¿«å¤„äº SYN_REVC çŠ¶æ€çš„ TCP è¿æ¥æ–­å¼€ã€‚</p><p>SYN-ACK æŠ¥æ–‡çš„æœ€å¤§é‡ä¼ æ¬¡æ•°ç”± <code>tcp_synack_retries</code>å†…æ ¸å‚æ•°å†³å®šï¼ˆé»˜è®¤å€¼æ˜¯ 5 æ¬¡ï¼‰ï¼Œæ¯”å¦‚å°† tcp_synack_retries å‡å°‘åˆ° 2 æ¬¡ï¼š</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>$ <span class="token builtin class-name">echo</span> <span class="token number">2</span> <span class="token operator">&gt;</span> /proc/sys/net/ipv4/tcp_synack_retries
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="_4-1-3-tcp-è¿æ¥æ–­å¼€" tabindex="-1"><a class="header-anchor" href="#_4-1-3-tcp-è¿æ¥æ–­å¼€"><span>4.1.3 TCP è¿æ¥æ–­å¼€</span></a></h3><h4 id="tcp-å››æ¬¡æŒ¥æ‰‹è¿‡ç¨‹æ˜¯æ€æ ·çš„" tabindex="-1"><a class="header-anchor" href="#tcp-å››æ¬¡æŒ¥æ‰‹è¿‡ç¨‹æ˜¯æ€æ ·çš„"><span>- TCP å››æ¬¡æŒ¥æ‰‹è¿‡ç¨‹æ˜¯æ€æ ·çš„ï¼Ÿ</span></a></h4><p>å¤©ä¸‹æ²¡æœ‰ä¸æ•£çš„å®´å¸­ï¼Œå¯¹äº TCP è¿æ¥ä¹Ÿæ˜¯è¿™æ ·ï¼Œ TCP æ–­å¼€è¿æ¥æ˜¯é€šè¿‡<strong>å››æ¬¡æŒ¥æ‰‹</strong>æ–¹å¼ã€‚</p><p>åŒæ–¹<strong>éƒ½å¯ä»¥ä¸»åŠ¨æ–­å¼€è¿æ¥</strong>ï¼Œæ–­å¼€è¿æ¥å<strong>ä¸»æœºä¸­çš„ã€Œèµ„æºã€å°†è¢«é‡Šæ”¾</strong>ï¼Œå››æ¬¡æŒ¥æ‰‹çš„è¿‡ç¨‹å¦‚ä¸‹å›¾ï¼š</p><img src="`+xt+'" alt="å®¢æˆ·ç«¯ä¸»åŠ¨å…³é—­è¿æ¥ â€”â€” TCP å››æ¬¡æŒ¥æ‰‹" style="zoom:67%;"><ul><li><p>å®¢æˆ·ç«¯æ‰“ç®—å…³é—­è¿æ¥ï¼Œæ­¤æ—¶ä¼šå‘é€ä¸€ä¸ª TCP é¦–éƒ¨ <code>FIN</code> æ ‡å¿—ä½è¢«ç½®ä¸º <code>1</code> çš„æŠ¥æ–‡ï¼Œä¹Ÿå³ <code>FIN</code> æŠ¥æ–‡ï¼Œä¹‹åå®¢æˆ·ç«¯è¿›å…¥ <code>FIN_WAIT_1</code> çŠ¶æ€ã€‚</p></li><li><p>æœåŠ¡ç«¯æ”¶åˆ°è¯¥æŠ¥æ–‡åï¼Œå°±å‘å®¢æˆ·ç«¯å‘é€ <code>ACK</code> åº”ç­”æŠ¥æ–‡ï¼Œæ¥ç€æœåŠ¡ç«¯è¿›å…¥ <code>CLOSE_WAIT</code> çŠ¶æ€ã€‚</p></li><li><p>å®¢æˆ·ç«¯æ”¶åˆ°æœåŠ¡ç«¯çš„ <code>ACK</code> åº”ç­”æŠ¥æ–‡åï¼Œä¹‹åè¿›å…¥ <code>FIN_WAIT_2</code> çŠ¶æ€ã€‚</p></li><li><p>ç­‰å¾…æœåŠ¡ç«¯<strong>å¤„ç†å®Œæ•°æ®å</strong>ï¼Œä¹Ÿå‘å®¢æˆ·ç«¯å‘é€ <code>FIN</code> æŠ¥æ–‡ï¼Œä¹‹åæœåŠ¡ç«¯è¿›å…¥ <code>LAST_ACK</code> çŠ¶æ€ã€‚</p></li><li><p>å®¢æˆ·ç«¯æ”¶åˆ°æœåŠ¡ç«¯çš„ <code>FIN</code> æŠ¥æ–‡åï¼Œå›ä¸€ä¸ª <code>ACK</code> åº”ç­”æŠ¥æ–‡ï¼Œä¹‹åè¿›å…¥ <code>TIME_WAIT</code> çŠ¶æ€</p></li><li><p>æœåŠ¡ç«¯æ”¶åˆ°äº† <code>ACK</code> åº”ç­”æŠ¥æ–‡åï¼Œå°±è¿›å…¥äº† <code>CLOSE</code> çŠ¶æ€ï¼Œè‡³æ­¤æœåŠ¡ç«¯å·²ç»å®Œæˆè¿æ¥çš„å…³é—­ã€‚</p></li><li><p>å®¢æˆ·ç«¯åœ¨<strong>ç»è¿‡ <code>2MSL</code> ä¸€æ®µæ—¶é—´å</strong>ï¼Œ<strong>è‡ªåŠ¨è¿›å…¥</strong> <code>CLOSE</code> çŠ¶æ€ï¼Œè‡³æ­¤å®¢æˆ·ç«¯ä¹Ÿå®Œæˆè¿æ¥çš„å…³é—­ã€‚</p></li></ul><p>ä½ å¯ä»¥çœ‹åˆ°ï¼Œæ¯ä¸ªæ–¹å‘éƒ½éœ€è¦<strong>ä¸€ä¸ª FIN å’Œä¸€ä¸ª ACK</strong>ï¼Œå› æ­¤é€šå¸¸è¢«ç§°ä¸º<strong>å››æ¬¡æŒ¥æ‰‹</strong>ã€‚</p><blockquote><p>è¿™é‡Œä¸€ç‚¹éœ€è¦æ³¨æ„æ˜¯ï¼š<strong><code>ä¸»åŠ¨å…³é—­è¿æ¥çš„ï¼Œæ‰æœ‰ TIME_WAIT çŠ¶æ€ã€‚</code></strong></p></blockquote><h4 id="ä¸ºä»€ä¹ˆæŒ¥æ‰‹éœ€è¦å››æ¬¡" tabindex="-1"><a class="header-anchor" href="#ä¸ºä»€ä¹ˆæŒ¥æ‰‹éœ€è¦å››æ¬¡"><span>-- ä¸ºä»€ä¹ˆæŒ¥æ‰‹éœ€è¦å››æ¬¡ï¼Ÿ</span></a></h4><p>å†æ¥å›é¡¾ä¸‹å››æ¬¡æŒ¥æ‰‹åŒæ–¹å‘ <code>FIN</code> åŒ…çš„è¿‡ç¨‹ï¼Œå°±èƒ½ç†è§£<strong>ä¸ºä»€ä¹ˆéœ€è¦å››æ¬¡äº†ã€‚</strong></p><ul><li>å…³é—­è¿æ¥æ—¶ï¼Œå®¢æˆ·ç«¯å‘æœåŠ¡ç«¯å‘é€ <code>FIN</code> æ—¶ï¼Œä»…ä»…<strong>è¡¨ç¤ºå®¢æˆ·ç«¯ä¸å†å‘é€æ•°æ®äº†ä½†æ˜¯è¿˜èƒ½æ¥æ”¶æ•°æ®ã€‚</strong></li><li>æœåŠ¡ç«¯æ”¶åˆ°å®¢æˆ·ç«¯çš„ <code>FIN</code> æŠ¥æ–‡æ—¶ï¼Œå…ˆå›ä¸€ä¸ª <code>ACK</code> åº”ç­”æŠ¥æ–‡ï¼Œ<strong>è€ŒæœåŠ¡ç«¯å¯èƒ½è¿˜æœ‰æ•°æ®éœ€è¦å¤„ç†å’Œå‘é€</strong>ï¼Œç­‰æœåŠ¡ç«¯ä¸å†å‘é€æ•°æ®æ—¶ï¼Œæ‰å‘é€ <code>FIN</code> æŠ¥æ–‡ç»™å®¢æˆ·ç«¯æ¥è¡¨ç¤ºåŒæ„ç°åœ¨å…³é—­è¿æ¥ã€‚</li></ul><p>ä»ä¸Šé¢è¿‡ç¨‹å¯çŸ¥ï¼ŒæœåŠ¡ç«¯é€šå¸¸éœ€è¦ç­‰å¾…å®Œæˆæ•°æ®çš„å‘é€å’Œå¤„ç†ï¼Œæ‰€ä»¥æœåŠ¡ç«¯çš„ <code>ACK</code> å’Œ <code>FIN</code> <strong>åˆ†å¼€å‘é€</strong>ï¼Œå› æ­¤æ˜¯å››æ¬¡æŒ¥æ‰‹ã€‚</p>',27),bi=o("strong",null,"åœ¨ç‰¹å®šæƒ…å†µä¸‹ï¼Œå››æ¬¡æŒ¥æ‰‹æ˜¯å¯ä»¥å˜æˆä¸‰æ¬¡æŒ¥æ‰‹çš„",-1),ki={href:"https://xiaolincoding.com/network/3_tcp/tcp_three_fin.html",target:"_blank",rel:"noopener noreferrer"},fi=n('<h4 id="ç¬¬ä¸€æ¬¡æŒ¥æ‰‹ä¸¢å¤±äº†-ä¼šå‘ç”Ÿä»€ä¹ˆ" tabindex="-1"><a class="header-anchor" href="#ç¬¬ä¸€æ¬¡æŒ¥æ‰‹ä¸¢å¤±äº†-ä¼šå‘ç”Ÿä»€ä¹ˆ"><span>-- ç¬¬ä¸€æ¬¡æŒ¥æ‰‹ä¸¢å¤±äº†ï¼Œä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ</span></a></h4><p>å½“å®¢æˆ·ç«¯ï¼ˆä¸»åŠ¨å…³é—­æ–¹ï¼‰è°ƒç”¨ close å‡½æ•°åï¼Œå°±ä¼šå‘æœåŠ¡ç«¯å‘é€ FIN æŠ¥æ–‡ï¼Œè¯•å›¾ä¸æœåŠ¡ç«¯æ–­å¼€è¿æ¥ï¼Œæ­¤æ—¶å®¢æˆ·ç«¯çš„è¿æ¥è¿›å…¥åˆ° <code>FIN_WAIT_1</code> çŠ¶æ€ã€‚</p><p>æ­£å¸¸æƒ…å†µä¸‹ï¼Œå¦‚æœèƒ½<strong>åŠæ—¶æ”¶åˆ°æœåŠ¡ç«¯ï¼ˆè¢«åŠ¨å…³é—­æ–¹ï¼‰çš„ ACK</strong>ï¼Œåˆ™ä¼šå¾ˆå¿«å˜ä¸º <code>FIN_WAIT2</code>çŠ¶æ€ã€‚</p><p>å¦‚æœç¬¬ä¸€æ¬¡æŒ¥æ‰‹ä¸¢å¤±äº†ï¼Œé‚£ä¹ˆå®¢æˆ·ç«¯è¿Ÿè¿Ÿæ”¶ä¸åˆ°è¢«åŠ¨æ–¹çš„ ACK çš„è¯ï¼Œä¹Ÿå°±ä¼šè§¦å‘<strong>è¶…æ—¶é‡ä¼ æœºåˆ¶</strong>ï¼Œé‡ä¼  FIN æŠ¥æ–‡ï¼Œé‡å‘æ¬¡æ•°ç”± <code>tcp_orphan_retries</code> å‚æ•°æ§åˆ¶ã€‚</p><p>å½“å®¢æˆ·ç«¯é‡ä¼  FIN æŠ¥æ–‡çš„æ¬¡æ•°è¶…è¿‡ <code>tcp_orphan_retries</code> åï¼Œå°±<strong>ä¸å†å‘é€ FIN æŠ¥æ–‡</strong>ï¼Œåˆ™ä¼šåœ¨ç­‰å¾…ä¸€æ®µæ—¶é—´ï¼ˆæ—¶é—´ä¸ºä¸Šä¸€æ¬¡è¶…æ—¶æ—¶é—´çš„ 2 å€ï¼‰ï¼Œ<strong>å¦‚æœè¿˜æ˜¯æ²¡èƒ½æ”¶åˆ°ç¬¬äºŒæ¬¡æŒ¥æ‰‹</strong>ï¼Œé‚£ä¹ˆ<strong>ç›´æ¥è¿›å…¥åˆ° <code>close</code> çŠ¶æ€ã€‚</strong></p><p>ä¸¾ä¸ªä¾‹å­ï¼Œå‡è®¾ tcp_orphan_retries å‚æ•°å€¼ä¸º 3ï¼Œ<strong>å½“ç¬¬ä¸€æ¬¡æŒ¥æ‰‹ä¸€ç›´ä¸¢å¤±æ—¶</strong>ï¼Œå‘ç”Ÿçš„è¿‡ç¨‹å¦‚ä¸‹å›¾ï¼š</p><img src="'+Nt+'" alt="img" style="zoom:67%;"><p>å…·ä½“è¿‡ç¨‹ï¼š</p><ul><li>å½“å®¢æˆ·ç«¯è¶…æ—¶é‡ä¼  3 æ¬¡ FIN æŠ¥æ–‡åï¼Œç”±äº tcp_orphan_retries ä¸º 3ï¼Œå·²è¾¾åˆ°æœ€å¤§é‡ä¼ æ¬¡æ•°ï¼Œäºæ˜¯å†ç­‰å¾…ä¸€æ®µæ—¶é—´ï¼ˆæ—¶é—´ä¸ºä¸Šä¸€æ¬¡è¶…æ—¶æ—¶é—´çš„ 2 å€ï¼‰ï¼Œå¦‚æœè¿˜æ˜¯æ²¡èƒ½æ”¶åˆ°æœåŠ¡ç«¯çš„ç¬¬äºŒæ¬¡æŒ¥æ‰‹ï¼ˆACKæŠ¥æ–‡ï¼‰ï¼Œé‚£ä¹ˆå®¢æˆ·ç«¯å°±ä¼šæ–­å¼€è¿æ¥ã€‚</li></ul><h4 id="ç¬¬äºŒæ¬¡æŒ¥æ‰‹ä¸¢å¤±äº†-ä¼šå‘ç”Ÿä»€ä¹ˆ" tabindex="-1"><a class="header-anchor" href="#ç¬¬äºŒæ¬¡æŒ¥æ‰‹ä¸¢å¤±äº†-ä¼šå‘ç”Ÿä»€ä¹ˆ"><span>-- ç¬¬äºŒæ¬¡æŒ¥æ‰‹ä¸¢å¤±äº†ï¼Œä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ</span></a></h4><p>å½“æœåŠ¡ç«¯æ”¶åˆ°å®¢æˆ·ç«¯çš„ç¬¬ä¸€æ¬¡æŒ¥æ‰‹åï¼Œå°±ä¼š<strong>å…ˆå›ä¸€ä¸ª ACK ç¡®è®¤æŠ¥æ–‡</strong>ï¼Œæ­¤æ—¶æœåŠ¡ç«¯çš„è¿æ¥è¿›å…¥åˆ° <code>CLOSE_WAIT</code> çŠ¶æ€ã€‚</p><p>åœ¨å‰é¢æˆ‘ä»¬ä¹Ÿæäº†ï¼Œ<strong>ACK æŠ¥æ–‡æ˜¯ä¸ä¼šé‡ä¼ çš„</strong>ï¼Œæ‰€ä»¥å¦‚æœæœåŠ¡ç«¯çš„ç¬¬äºŒæ¬¡æŒ¥æ‰‹ä¸¢å¤±äº†ï¼Œ<strong>å®¢æˆ·ç«¯å°±ä¼šè§¦å‘è¶…æ—¶é‡ä¼ æœºåˆ¶</strong>ï¼Œé‡ä¼  FIN æŠ¥æ–‡ï¼Œç›´åˆ°æ”¶åˆ°æœåŠ¡ç«¯çš„ç¬¬äºŒæ¬¡æŒ¥æ‰‹ï¼Œæˆ–è€…è¾¾åˆ°æœ€å¤§çš„é‡ä¼ æ¬¡æ•°ã€‚</p><p>ä¸¾ä¸ªä¾‹å­ï¼Œå‡è®¾ tcp_orphan_retries å‚æ•°å€¼ä¸º 2ï¼Œå½“ç¬¬äºŒæ¬¡æŒ¥æ‰‹ä¸€ç›´ä¸¢å¤±æ—¶ï¼Œå‘ç”Ÿçš„è¿‡ç¨‹å¦‚ä¸‹å›¾ï¼š</p><img src="'+qt+'" alt="img" style="zoom:67%;"><p>å…·ä½“è¿‡ç¨‹ï¼š</p><ul><li>å½“å®¢æˆ·ç«¯è¶…æ—¶é‡ä¼  2 æ¬¡ FIN æŠ¥æ–‡åï¼Œç”±äº tcp_orphan_retries ä¸º 2ï¼Œå·²è¾¾åˆ°<strong>æœ€å¤§é‡ä¼ æ¬¡æ•°</strong>ï¼Œäºæ˜¯<strong>å†ç­‰å¾…ä¸€æ®µæ—¶é—´</strong>ï¼ˆæ—¶é—´ä¸ºä¸Šä¸€æ¬¡è¶…æ—¶æ—¶é—´çš„ 2 å€ï¼‰ï¼Œå¦‚æœè¿˜æ˜¯æ²¡èƒ½æ”¶åˆ°æœåŠ¡ç«¯çš„ç¬¬äºŒæ¬¡æŒ¥æ‰‹ï¼ˆACK æŠ¥æ–‡ï¼‰ï¼Œé‚£ä¹ˆ<strong>å®¢æˆ·ç«¯å°±ä¼šæ–­å¼€è¿æ¥ã€‚</strong></li></ul><p>è¿™é‡Œæä¸€ä¸‹ï¼Œå½“å®¢æˆ·ç«¯<strong>æ”¶åˆ°ç¬¬äºŒæ¬¡æŒ¥æ‰‹</strong>ï¼Œä¹Ÿå°±æ˜¯æ”¶åˆ°æœåŠ¡ç«¯å‘é€çš„ ACK æŠ¥æ–‡åï¼Œå®¢æˆ·ç«¯å°±ä¼šå¤„äº <code>FIN_WAIT2</code> çŠ¶æ€ï¼Œåœ¨è¿™ä¸ªçŠ¶æ€éœ€è¦<strong>ç­‰æœåŠ¡ç«¯å‘é€ç¬¬ä¸‰æ¬¡æŒ¥æ‰‹</strong>ï¼Œä¹Ÿå°±æ˜¯æœåŠ¡ç«¯çš„ FIN æŠ¥æ–‡ã€‚</p><p>å¯¹äº <strong>close å‡½æ•°å…³é—­çš„è¿æ¥</strong>ï¼Œç”±äº<strong>æ— æ³•å†å‘é€å’Œæ¥æ”¶æ•°æ®</strong>ï¼Œæ‰€ä»¥<code>FIN_WAIT2</code> çŠ¶æ€ä¸å¯ä»¥æŒç»­å¤ªä¹…ï¼Œè€Œ <code>tcp_fin_timeout</code> æ§åˆ¶äº†è¿™ä¸ªçŠ¶æ€ä¸‹è¿æ¥çš„æŒç»­æ—¶é•¿ï¼Œé»˜è®¤å€¼æ˜¯ 60 ç§’ã€‚</p><p>è¿™æ„å‘³ç€å¯¹äºè°ƒç”¨ close å…³é—­çš„è¿æ¥ï¼Œå¦‚æœåœ¨ 60 ç§’åè¿˜æ²¡æœ‰æ”¶åˆ° FIN æŠ¥æ–‡ï¼Œ<strong>å®¢æˆ·ç«¯ï¼ˆä¸»åŠ¨å…³é—­æ–¹ï¼‰çš„è¿æ¥å°±ä¼šç›´æ¥å…³é—­</strong>ï¼Œå¦‚ä¸‹å›¾ï¼š</p><img src="'+yt+'" alt="img" style="zoom:67%;"><p>ä½†æ˜¯æ³¨æ„ï¼Œå¦‚æœä¸»åŠ¨å…³é—­æ–¹ä½¿ç”¨ <strong>shutdown</strong> å‡½æ•°<strong>å…³é—­è¿æ¥ï¼ŒæŒ‡å®šäº†åªå…³é—­å‘é€æ–¹å‘</strong>ï¼Œè€Œæ¥æ”¶æ–¹å‘å¹¶æ²¡æœ‰å…³é—­ï¼Œé‚£ä¹ˆæ„å‘³ç€ä¸»åŠ¨å…³é—­æ–¹è¿˜æ˜¯å¯ä»¥æ¥æ”¶æ•°æ®çš„ã€‚</p><p>æ­¤æ—¶ï¼Œå¦‚æœä¸»åŠ¨å…³é—­æ–¹<strong>ä¸€ç›´æ²¡æ”¶åˆ°ç¬¬ä¸‰æ¬¡æŒ¥æ‰‹</strong>ï¼Œé‚£ä¹ˆä¸»åŠ¨å…³é—­æ–¹çš„è¿æ¥å°†ä¼š<strong>ä¸€ç›´å¤„äº</strong> <code>FIN_WAIT2</code> çŠ¶æ€ï¼ˆ<code>tcp_fin_timeout</code> æ— æ³•æ§åˆ¶ shutdown å…³é—­çš„è¿æ¥ï¼‰ã€‚å¦‚ä¸‹å›¾ï¼š</p><img src="'+Ht+'" alt="img" style="zoom:67%;"><h4 id="ç¬¬ä¸‰æ¬¡æŒ¥æ‰‹ä¸¢å¤±äº†-ä¼šå‘ç”Ÿä»€ä¹ˆ" tabindex="-1"><a class="header-anchor" href="#ç¬¬ä¸‰æ¬¡æŒ¥æ‰‹ä¸¢å¤±äº†-ä¼šå‘ç”Ÿä»€ä¹ˆ"><span>-- ç¬¬ä¸‰æ¬¡æŒ¥æ‰‹ä¸¢å¤±äº†ï¼Œä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ</span></a></h4><p>å½“æœåŠ¡ç«¯ï¼ˆè¢«åŠ¨å…³é—­æ–¹ï¼‰æ”¶åˆ°å®¢æˆ·ç«¯ï¼ˆä¸»åŠ¨å…³é—­æ–¹ï¼‰çš„ FIN æŠ¥æ–‡åï¼Œå†…æ ¸ä¼š<strong>è‡ªåŠ¨å›å¤ ACK</strong>ï¼ŒåŒæ—¶è¿æ¥å¤„äº <code>CLOSE_WAIT</code> çŠ¶æ€ï¼Œé¡¾åæ€ä¹‰ï¼Œå®ƒè¡¨ç¤º<strong>ç­‰å¾…åº”ç”¨è¿›ç¨‹è°ƒç”¨ close å‡½æ•°å…³é—­è¿æ¥ã€‚</strong></p><p>æ­¤æ—¶ï¼Œå†…æ ¸æ˜¯æ²¡æœ‰æƒåˆ©æ›¿ä»£è¿›ç¨‹å…³é—­è¿æ¥ï¼Œå¿…é¡»ç”±<strong>è¿›ç¨‹ä¸»åŠ¨è°ƒç”¨ close å‡½æ•°</strong>æ¥è§¦å‘æœåŠ¡ç«¯å‘é€ FIN æŠ¥æ–‡ã€‚</p><p>æœåŠ¡ç«¯å¤„äº CLOSE_WAIT çŠ¶æ€æ—¶ï¼Œ<strong>è°ƒç”¨äº† close å‡½æ•°</strong>ï¼Œå†…æ ¸å°±ä¼šå‘å‡º FIN æŠ¥æ–‡ï¼ŒåŒæ—¶è¿<strong>æ¥è¿›å…¥ LAST_ACK çŠ¶æ€</strong>ï¼Œç­‰å¾…å®¢æˆ·ç«¯è¿”å› ACK æ¥ç¡®è®¤è¿æ¥å…³é—­ã€‚</p><p>å¦‚æœè¿Ÿè¿Ÿæ”¶ä¸åˆ°è¿™ä¸ª ACKï¼ŒæœåŠ¡ç«¯å°±ä¼šé‡å‘ FIN æŠ¥æ–‡ï¼Œé‡å‘æ¬¡æ•°ä»ç„¶ç”± <code>tcp_orphan_retrie</code>s å‚æ•°æ§åˆ¶ï¼Œè¿™ä¸å®¢æˆ·ç«¯é‡å‘ FIN æŠ¥æ–‡çš„é‡ä¼ æ¬¡æ•°æ§åˆ¶æ–¹å¼æ˜¯ä¸€æ ·çš„ã€‚</p><p>ä¸¾ä¸ªä¾‹å­ï¼Œå‡è®¾ <code>tcp_orphan_retrie</code>s = 3ï¼Œå½“ç¬¬ä¸‰æ¬¡æŒ¥æ‰‹ä¸€ç›´ä¸¢å¤±æ—¶ï¼Œå‘ç”Ÿçš„è¿‡ç¨‹å¦‚ä¸‹å›¾ï¼š</p><img src="'+vt+'" alt="img" style="zoom:67%;"><p>å…·ä½“è¿‡ç¨‹ï¼š</p><ul><li>å½“æœåŠ¡ç«¯é‡ä¼ ç¬¬ä¸‰æ¬¡æŒ¥æ‰‹æŠ¥æ–‡çš„æ¬¡æ•°è¾¾åˆ°äº† 3 æ¬¡åï¼Œç”±äº tcp_orphan_retries ä¸º 3ï¼Œè¾¾åˆ°äº†é‡ä¼ æœ€å¤§æ¬¡æ•°ï¼Œäºæ˜¯å†ç­‰å¾…ä¸€æ®µæ—¶é—´ï¼ˆæ—¶é—´ä¸ºä¸Šä¸€æ¬¡è¶…æ—¶æ—¶é—´çš„ 2 å€ï¼‰ï¼Œå¦‚æœè¿˜æ˜¯æ²¡èƒ½æ”¶åˆ°å®¢æˆ·ç«¯çš„ç¬¬å››æ¬¡æŒ¥æ‰‹ï¼ˆACKæŠ¥æ–‡ï¼‰ï¼Œé‚£ä¹ˆæœåŠ¡ç«¯å°±ä¼šæ–­å¼€è¿æ¥ã€‚</li><li>å®¢æˆ·ç«¯å› ä¸ºæ˜¯<strong>é€šè¿‡ close å‡½æ•°å…³é—­è¿æ¥çš„</strong>ï¼Œ<strong>å¤„äº FIN_WAIT_2 çŠ¶æ€æ˜¯æœ‰æ—¶é•¿é™åˆ¶çš„</strong>ï¼Œå¦‚æœ tcp_fin_timeout æ—¶é—´å†…<strong>è¿˜æ˜¯æ²¡èƒ½æ”¶åˆ°æœåŠ¡ç«¯çš„</strong>ç¬¬ä¸‰æ¬¡æŒ¥æ‰‹ï¼ˆFIN æŠ¥æ–‡ï¼‰ï¼Œé‚£ä¹ˆ<strong>å®¢æˆ·ç«¯å°±ä¼šæ–­å¼€è¿æ¥ã€‚</strong></li></ul><h4 id="ç¬¬å››æ¬¡æŒ¥æ‰‹ä¸¢å¤±äº†-ä¼šå‘ç”Ÿä»€ä¹ˆ" tabindex="-1"><a class="header-anchor" href="#ç¬¬å››æ¬¡æŒ¥æ‰‹ä¸¢å¤±äº†-ä¼šå‘ç”Ÿä»€ä¹ˆ"><span>-- ç¬¬å››æ¬¡æŒ¥æ‰‹ä¸¢å¤±äº†ï¼Œä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ</span></a></h4><p>å½“å®¢æˆ·ç«¯æ”¶åˆ°æœåŠ¡ç«¯çš„ç¬¬ä¸‰æ¬¡æŒ¥æ‰‹çš„ FIN æŠ¥æ–‡åï¼Œå°±ä¼š<strong>å› ACK æŠ¥æ–‡</strong>ï¼Œä¹Ÿå°±æ˜¯ç¬¬å››æ¬¡æŒ¥æ‰‹ï¼Œæ­¤æ—¶å®¢æˆ·ç«¯è¿æ¥è¿›å…¥ <code>TIME_WAIT</code> çŠ¶æ€ã€‚</p><blockquote><p>åœ¨ Linux ç³»ç»Ÿï¼ŒTIME_WAIT çŠ¶æ€ä¼šæŒç»­ <strong>2MSL</strong> åæ‰ä¼šè¿›å…¥å…³é—­çŠ¶æ€ã€‚</p></blockquote><p>ç„¶åï¼ŒæœåŠ¡ç«¯ï¼ˆè¢«åŠ¨å…³é—­æ–¹ï¼‰æ²¡æœ‰æ”¶åˆ° ACK æŠ¥æ–‡å‰ï¼Œè¿˜æ˜¯å¤„äº LAST_ACK çŠ¶æ€ã€‚</p><p>å¦‚æœç¬¬å››æ¬¡æŒ¥æ‰‹çš„ ACK æŠ¥æ–‡æ²¡æœ‰åˆ°è¾¾æœåŠ¡ç«¯ï¼Œ<strong>æœåŠ¡ç«¯å°±ä¼šé‡å‘ FIN æŠ¥æ–‡</strong>ï¼Œé‡å‘æ¬¡æ•°ä»ç„¶ç”±å‰é¢ä»‹ç»è¿‡çš„ <code>tcp_orphan_retries</code> å‚æ•°æ§åˆ¶ã€‚</p><p>ä¸¾ä¸ªä¾‹å­ï¼Œå‡è®¾ tcp_orphan_retries ä¸º 2ï¼Œå½“ç¬¬å››æ¬¡æŒ¥æ‰‹ä¸€ç›´ä¸¢å¤±æ—¶ï¼Œå‘ç”Ÿçš„è¿‡ç¨‹å¦‚ä¸‹ï¼š</p><figure><img src="'+zt+`" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><p>å…·ä½“è¿‡ç¨‹ï¼š</p><ul><li>å½“æœåŠ¡ç«¯é‡ä¼ ç¬¬ä¸‰æ¬¡æŒ¥æ‰‹æŠ¥æ–‡è¾¾åˆ° 2 æ—¶ï¼Œç”±äº tcp_orphan_retries ä¸º 2ï¼Œ è¾¾åˆ°äº†<strong>æœ€å¤§é‡ä¼ æ¬¡æ•°</strong>ï¼Œäºæ˜¯å†ç­‰å¾…ä¸€æ®µæ—¶é—´ï¼ˆæ—¶é—´ä¸ºä¸Šä¸€æ¬¡è¶…æ—¶æ—¶é—´çš„ 2 å€ï¼‰ï¼Œå¦‚æœè¿˜æ˜¯æ²¡èƒ½æ”¶åˆ°å®¢æˆ·ç«¯çš„ç¬¬å››æ¬¡æŒ¥æ‰‹ï¼ˆACK æŠ¥æ–‡ï¼‰ï¼Œé‚£ä¹ˆ<strong>æœåŠ¡ç«¯å°±ä¼šæ–­å¼€è¿æ¥ã€‚</strong></li><li>å®¢æˆ·ç«¯åœ¨æ”¶åˆ°ç¬¬ä¸‰æ¬¡æŒ¥æ‰‹åï¼Œå°±ä¼šè¿›å…¥ TIME_WAIT çŠ¶æ€ï¼Œ<strong>å¼€å¯æ—¶é•¿ä¸º 2MSL çš„å®šæ—¶å™¨</strong>ï¼Œå¦‚æœé€”ä¸­å†æ¬¡æ”¶åˆ°ç¬¬ä¸‰æ¬¡æŒ¥æ‰‹ï¼ˆFIN æŠ¥æ–‡ï¼‰åï¼Œå°±ä¼š<strong>é‡ç½®å®šæ—¶å™¨</strong>ï¼Œå½“ç­‰å¾… 2MSL æ—¶é•¿åï¼Œ<strong>å®¢æˆ·ç«¯å°±ä¼šæ–­å¼€è¿æ¥ã€‚</strong></li></ul><h4 id="ä¸ºä»€ä¹ˆ-time-wait-ç­‰å¾…çš„æ—¶é—´æ˜¯-2msl" tabindex="-1"><a class="header-anchor" href="#ä¸ºä»€ä¹ˆ-time-wait-ç­‰å¾…çš„æ—¶é—´æ˜¯-2msl"><span>- ä¸ºä»€ä¹ˆ TIME_WAIT ç­‰å¾…çš„æ—¶é—´æ˜¯ 2MSLï¼Ÿ</span></a></h4><p><code>MSL</code> æ˜¯ Maximum Segment Lifetimeï¼Œ<strong>æŠ¥æ–‡æœ€å¤§ç”Ÿå­˜æ—¶é—´</strong>ï¼Œå®ƒæ˜¯ä»»ä½•æŠ¥æ–‡åœ¨ç½‘ç»œä¸Šå­˜åœ¨çš„æœ€é•¿æ—¶é—´ï¼Œè¶…è¿‡è¿™ä¸ªæ—¶é—´æŠ¥æ–‡å°†è¢«ä¸¢å¼ƒã€‚å› ä¸º TCP æŠ¥æ–‡åŸºäºæ˜¯ IP åè®®çš„ï¼Œè€Œ IP å¤´ä¸­æœ‰ä¸€ä¸ª <code>TTL</code> å­—æ®µï¼Œæ˜¯ IP æ•°æ®æŠ¥å¯ä»¥ç»è¿‡çš„æœ€å¤§è·¯ç”±æ•°ï¼Œæ¯ç»è¿‡ä¸€ä¸ªå¤„ç†ä»–çš„è·¯ç”±å™¨æ­¤å€¼å°±å‡ 1ï¼Œå½“æ­¤å€¼ä¸º 0 åˆ™æ•°æ®æŠ¥å°†è¢«ä¸¢å¼ƒï¼ŒåŒæ—¶å‘é€ ICMP æŠ¥æ–‡é€šçŸ¥æºä¸»æœºã€‚</p><p>MSL ä¸ TTL çš„åŒºåˆ«ï¼š MSL çš„å•ä½æ˜¯æ—¶é—´ï¼Œè€Œ TTL æ˜¯ç»è¿‡è·¯ç”±è·³æ•°ã€‚æ‰€ä»¥ <strong>MSL åº”è¯¥è¦å¤§äºç­‰äº TTL æ¶ˆè€—ä¸º 0 çš„æ—¶é—´</strong>ï¼Œä»¥ç¡®ä¿æŠ¥æ–‡å·²è¢«è‡ªç„¶æ¶ˆäº¡ã€‚</p><p><strong>TTL çš„å€¼ä¸€èˆ¬æ˜¯ 64ï¼ŒLinux å°† MSL è®¾ç½®ä¸º 30 ç§’ï¼Œæ„å‘³ç€ Linux è®¤ä¸ºæ•°æ®æŠ¥æ–‡ç»è¿‡ 64 ä¸ªè·¯ç”±å™¨çš„æ—¶é—´ä¸ä¼šè¶…è¿‡ 30 ç§’ï¼Œå¦‚æœè¶…è¿‡äº†ï¼Œå°±è®¤ä¸ºæŠ¥æ–‡å·²ç»æ¶ˆå¤±åœ¨ç½‘ç»œä¸­äº†</strong>ã€‚</p><blockquote><p>TIME_WAIT ç­‰å¾… 2 å€çš„ MSLï¼Œæ¯”è¾ƒåˆç†çš„è§£é‡Šæ˜¯ï¼š ç½‘ç»œä¸­å¯èƒ½å­˜åœ¨æ¥è‡ªå‘é€æ–¹çš„æ•°æ®åŒ…ï¼Œå½“è¿™äº›å‘é€æ–¹çš„æ•°æ®åŒ…è¢«æ¥æ”¶æ–¹å¤„ç†ååˆä¼šå‘å¯¹æ–¹å‘é€å“åº”ï¼Œæ‰€ä»¥<strong>ä¸€æ¥ä¸€å›éœ€è¦ç­‰å¾… 2 å€çš„æ—¶é—´</strong>ã€‚</p></blockquote><p>æ¯”å¦‚ï¼Œå¦‚æœè¢«åŠ¨å…³é—­æ–¹æ²¡æœ‰æ”¶åˆ°æ–­å¼€è¿æ¥çš„æœ€åçš„ ACK æŠ¥æ–‡ï¼Œå°±ä¼šè§¦å‘è¶…æ—¶é‡å‘ <code>FIN</code> æŠ¥æ–‡ï¼Œå¦ä¸€æ–¹æ¥æ”¶åˆ° FIN åï¼Œä¼šé‡å‘ ACK ç»™è¢«åŠ¨å…³é—­æ–¹ï¼Œ ä¸€æ¥ä¸€å»æ­£å¥½ 2 ä¸ª MSLã€‚</p><p>å¯ä»¥çœ‹åˆ° <strong>2 MSLæ—¶é•¿</strong> è¿™å…¶å®æ˜¯ç›¸å½“äº<strong>è‡³å°‘å…è®¸æŠ¥æ–‡ä¸¢å¤±ä¸€æ¬¡</strong>ã€‚æ¯”å¦‚ï¼Œè‹¥ ACK åœ¨ä¸€ä¸ª MSL å†…ä¸¢å¤±ï¼Œè¿™æ ·è¢«åŠ¨æ–¹é‡å‘çš„ FIN ä¼šåœ¨ç¬¬ 2 ä¸ª MSL å†…åˆ°è¾¾ï¼ŒTIME_WAIT çŠ¶æ€çš„è¿æ¥å¯ä»¥åº”å¯¹ã€‚</p><p>ä¸ºä»€ä¹ˆä¸æ˜¯ 4 æˆ–è€… 8 MSL çš„æ—¶é•¿å‘¢ï¼Ÿä½ å¯ä»¥æƒ³è±¡ä¸€ä¸ªä¸¢åŒ…ç‡è¾¾åˆ°ç™¾åˆ†ä¹‹ä¸€çš„ç³Ÿç³•ç½‘ç»œï¼Œè¿ç»­ä¸¤æ¬¡ä¸¢åŒ…çš„æ¦‚ç‡åªæœ‰ä¸‡åˆ†ä¹‹ä¸€ï¼Œè¿™ä¸ªæ¦‚ç‡å®åœ¨æ˜¯å¤ªå°äº†ï¼Œå¿½ç•¥å®ƒæ¯”è§£å†³å®ƒæ›´å…·æ€§ä»·æ¯”ã€‚</p><p><code>2MSL</code> çš„æ—¶é—´æ˜¯ä»<strong>å®¢æˆ·ç«¯æ¥æ”¶åˆ° FIN åå‘é€ ACK å¼€å§‹è®¡æ—¶çš„</strong>ã€‚å¦‚æœåœ¨ TIME-WAIT æ—¶é—´å†…ï¼Œå› ä¸ºå®¢æˆ·ç«¯çš„ ACK æ²¡æœ‰ä¼ è¾“åˆ°æœåŠ¡ç«¯ï¼Œå®¢æˆ·ç«¯åˆæ¥æ”¶åˆ°äº†æœåŠ¡ç«¯é‡å‘çš„ FIN æŠ¥æ–‡ï¼Œé‚£ä¹ˆ <strong>2MSL æ—¶é—´å°†é‡æ–°è®¡æ—¶</strong>ã€‚</p><p>åœ¨ Linux ç³»ç»Ÿé‡Œ <code>2MSL</code> é»˜è®¤æ˜¯ <code>60</code> ç§’ï¼Œé‚£ä¹ˆä¸€ä¸ª <code>MSL</code> ä¹Ÿå°±æ˜¯ <code>30</code> ç§’ã€‚<strong>Linux ç³»ç»Ÿåœç•™åœ¨ TIME_WAIT çš„æ—¶é—´ä¸ºå›ºå®šçš„ 60 ç§’</strong>ã€‚</p><p>å…¶å®šä¹‰åœ¨ Linux å†…æ ¸ä»£ç é‡Œçš„åç§°ä¸º TCP_TIMEWAIT_LENï¼š</p><div class="language-c line-numbers-mode" data-ext="c" data-title="c"><pre class="language-c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">TCP_TIMEWAIT_LEN</span> <span class="token expression"><span class="token punctuation">(</span><span class="token number">60</span><span class="token operator">*</span>HZ<span class="token punctuation">)</span> </span><span class="token comment">/* how long to wait to destroy TIME-WAIT 
                                    state, about 60 seconds  */</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>å¦‚æœè¦ä¿®æ”¹ TIME_WAIT çš„æ—¶é—´é•¿åº¦ï¼Œåªèƒ½ä¿®æ”¹ Linux å†…æ ¸ä»£ç é‡Œ TCP_TIMEWAIT_LEN çš„å€¼ï¼Œå¹¶é‡æ–°ç¼–è¯‘ Linux å†…æ ¸ã€‚</p><h4 id="ä¸ºä»€ä¹ˆéœ€è¦-time-wait-çŠ¶æ€" tabindex="-1"><a class="header-anchor" href="#ä¸ºä»€ä¹ˆéœ€è¦-time-wait-çŠ¶æ€"><span>- ä¸ºä»€ä¹ˆéœ€è¦ TIME_WAIT çŠ¶æ€ï¼Ÿ</span></a></h4><blockquote><p><strong>ä¸»åŠ¨å‘èµ·å…³é—­è¿æ¥çš„ä¸€æ–¹</strong>ï¼Œæ‰ä¼šæœ‰ <code>TIME-WAIT</code> çŠ¶æ€ã€‚</p></blockquote><p>éœ€è¦ TIME-WAIT çŠ¶æ€ï¼Œ<strong>ä¸»è¦æ˜¯ä¸¤ä¸ªåŸå› ï¼š</strong></p><ul><li>é˜²æ­¢å†å²è¿æ¥ä¸­çš„æ•°æ®ï¼Œè¢«åé¢ç›¸åŒå››å…ƒç»„çš„è¿æ¥é”™è¯¯çš„æ¥æ”¶ï¼›</li><li>ä¿è¯ã€Œè¢«åŠ¨å…³é—­è¿æ¥ã€çš„ä¸€æ–¹ï¼Œèƒ½è¢«æ­£ç¡®çš„å…³é—­ï¼›</li></ul><p><mark><em>åŸå› ä¸€ï¼šé˜²æ­¢å†å²è¿æ¥ä¸­çš„æ•°æ®ï¼Œè¢«åé¢ç›¸åŒå››å…ƒç»„çš„è¿æ¥é”™è¯¯çš„æ¥æ”¶</em></mark></p><p>ä¸ºäº†èƒ½æ›´å¥½çš„ç†è§£è¿™ä¸ªåŸå› ï¼Œæˆ‘ä»¬å…ˆæ¥äº†è§£åºåˆ—å·ï¼ˆSEQï¼‰å’Œåˆå§‹åºåˆ—å·ï¼ˆISNï¼‰ã€‚</p><ul><li><strong>åºåˆ—å·</strong>ï¼Œæ˜¯ TCP ä¸€ä¸ª<strong>å¤´éƒ¨å­—æ®µ</strong>ï¼Œæ ‡è¯†äº† TCP å‘é€ç«¯åˆ° TCP æ¥æ”¶ç«¯çš„æ•°æ®æµçš„ä¸€ä¸ªå­—èŠ‚ï¼Œå› ä¸º TCP æ˜¯é¢å‘å­—èŠ‚æµçš„å¯é åè®®ï¼Œä¸ºäº†ä¿è¯æ¶ˆæ¯çš„é¡ºåºæ€§å’Œå¯é æ€§ï¼ŒTCP ä¸ºæ¯ä¸ªä¼ è¾“æ–¹å‘ä¸Šçš„æ¯ä¸ªå­—èŠ‚éƒ½èµ‹äºˆäº†ä¸€ä¸ªç¼–å·ï¼Œä»¥ä¾¿äºä¼ è¾“æˆåŠŸåç¡®è®¤ã€ä¸¢å¤±åé‡ä¼ ä»¥åŠåœ¨æ¥æ”¶ç«¯ä¿è¯ä¸ä¼šä¹±åºã€‚<strong>åºåˆ—å·æ˜¯ä¸€ä¸ª 32 ä½çš„æ— ç¬¦å·æ•°ï¼Œå› æ­¤åœ¨åˆ°è¾¾ 4G ä¹‹åå†å¾ªç¯å›åˆ° 0</strong>ã€‚</li><li><strong>åˆå§‹åºåˆ—å·</strong>ï¼Œåœ¨ TCP å»ºç«‹è¿æ¥çš„æ—¶å€™ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯éƒ½ä¼š<strong>å„è‡ªç”Ÿæˆä¸€ä¸ªåˆå§‹åºåˆ—å·</strong>ï¼Œå®ƒæ˜¯<strong>åŸºäºæ—¶é’Ÿç”Ÿæˆçš„ä¸€ä¸ªéšæœºæ•°</strong>ï¼Œæ¥<strong>ä¿è¯æ¯ä¸ªè¿æ¥éƒ½æ‹¥æœ‰ä¸åŒçš„åˆå§‹åºåˆ—å·</strong>ã€‚<strong>åˆå§‹åŒ–åºåˆ—å·å¯è¢«è§†ä¸ºä¸€ä¸ª 32 ä½çš„è®¡æ•°å™¨ï¼Œè¯¥è®¡æ•°å™¨çš„æ•°å€¼æ¯ 4 å¾®ç§’åŠ  1ï¼Œå¾ªç¯ä¸€æ¬¡éœ€è¦ 4.55 å°æ—¶</strong>ã€‚</li></ul><p>ç»™å¤§å®¶æŠ“äº†ä¸€ä¸ªåŒ…ï¼Œä¸‹å›¾ä¸­çš„ <strong>Seq å°±æ˜¯åºåˆ—å·</strong>ï¼Œå…¶ä¸­çº¢è‰²æ¡†ä½çš„åˆ†åˆ«æ˜¯<strong>å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯å„è‡ªç”Ÿæˆçš„åˆå§‹åºåˆ—å·ã€‚</strong></p><img src="`+Et+'" alt="TCP æŠ“åŒ…å›¾" style="zoom:67%;"><p>é€šè¿‡å‰é¢æˆ‘ä»¬çŸ¥é“ï¼Œ<strong>åºåˆ—å·å’Œåˆå§‹åŒ–åºåˆ—å·å¹¶ä¸æ˜¯æ— é™é€’å¢çš„ï¼Œä¼šå‘ç”Ÿå›ç»•ä¸ºåˆå§‹å€¼çš„æƒ…å†µï¼Œè¿™æ„å‘³ç€æ— æ³•æ ¹æ®åºåˆ—å·æ¥åˆ¤æ–­æ–°è€æ•°æ®</strong>ã€‚</p><blockquote><p>å‡è®¾ TIME-WAIT æ²¡æœ‰ç­‰å¾…æ—¶é—´æˆ–æ—¶é—´è¿‡çŸ­ï¼Œ<strong>è¢«å»¶è¿Ÿçš„æ•°æ®åŒ…æŠµè¾¾å</strong>ä¼šå‘ç”Ÿä»€ä¹ˆå‘¢ï¼Ÿ</p></blockquote><img src="'+wt+'" alt="TIME-WAIT æ—¶é—´è¿‡çŸ­ï¼Œæ”¶åˆ°æ—§è¿æ¥çš„æ•°æ®æŠ¥æ–‡" style="zoom:67%;"><p>å¦‚ä¸Šå›¾ï¼š</p><ul><li>æœåŠ¡ç«¯åœ¨å…³é—­è¿æ¥ä¹‹å‰å‘é€çš„ <code>SEQ = 301</code> æŠ¥æ–‡ï¼Œ<strong>è¢«ç½‘ç»œå»¶è¿Ÿäº†ã€‚</strong></li><li>æ¥ç€ï¼ŒæœåŠ¡ç«¯<strong>ä»¥ç›¸åŒçš„å››å…ƒç»„é‡æ–°æ‰“å¼€äº†æ–°è¿æ¥</strong>ï¼Œå‰é¢è¢«å»¶è¿Ÿçš„ <code>SEQ = 301</code> è¿™æ—¶æŠµè¾¾äº†å®¢æˆ·ç«¯ï¼Œè€Œä¸”è¯¥æ•°æ®æŠ¥æ–‡çš„<strong>åºåˆ—å·åˆšå¥½åœ¨å®¢æˆ·ç«¯æ¥æ”¶çª—å£å†…</strong>ï¼Œå› æ­¤<strong>å®¢æˆ·ç«¯ä¼šæ­£å¸¸æ¥æ”¶è¿™ä¸ªæ•°æ®æŠ¥æ–‡</strong>ï¼Œä½†æ˜¯è¿™ä¸ªæ•°æ®æŠ¥æ–‡<strong>æ˜¯ä¸Šä¸€ä¸ªè¿æ¥æ®‹ç•™ä¸‹æ¥çš„</strong>ï¼Œè¿™æ ·å°±äº§ç”Ÿ<strong>æ•°æ®é”™ä¹±</strong>ç­‰ä¸¥é‡çš„é—®é¢˜ã€‚</li></ul><p>ä¸ºäº†é˜²æ­¢å†å²è¿æ¥ä¸­çš„æ•°æ®ï¼Œè¢«åé¢ç›¸åŒå››å…ƒç»„çš„è¿æ¥é”™è¯¯çš„æ¥æ”¶ï¼Œå› æ­¤ TCP è®¾è®¡äº† TIME_WAIT çŠ¶æ€ï¼ŒçŠ¶æ€ä¼šæŒç»­ <code>2MSL</code> æ—¶é•¿ï¼Œè¿™ä¸ªæ—¶é—´<strong>è¶³ä»¥è®©ä¸¤ä¸ªæ–¹å‘ä¸Šçš„æ•°æ®åŒ…éƒ½è¢«ä¸¢å¼ƒï¼Œä½¿å¾—åŸæ¥è¿æ¥çš„æ•°æ®åŒ…åœ¨ç½‘ç»œä¸­éƒ½è‡ªç„¶æ¶ˆå¤±ï¼Œå†å‡ºç°çš„æ•°æ®åŒ…ä¸€å®šéƒ½æ˜¯æ–°å»ºç«‹è¿æ¥æ‰€äº§ç”Ÿçš„ã€‚</strong></p><p><mark><em>åŸå› äºŒï¼šä¿è¯ã€Œè¢«åŠ¨å…³é—­è¿æ¥ã€çš„ä¸€æ–¹ï¼Œèƒ½è¢«æ­£ç¡®çš„å…³é—­</em></mark></p><p>åœ¨ RFC 793 æŒ‡å‡º TIME-WAIT å¦ä¸€ä¸ªé‡è¦çš„ä½œç”¨æ˜¯ï¼š</p><p><em>TIME-WAIT - represents waiting for enough time to pass to be sure the remote TCP received the acknowledgment of its connection termination request.</em></p><p>ä¹Ÿå°±æ˜¯è¯´ï¼ŒTIME-WAIT ä½œç”¨æ˜¯<strong>ç­‰å¾…è¶³å¤Ÿçš„æ—¶é—´ä»¥ç¡®ä¿æœ€åçš„ ACK èƒ½è®©è¢«åŠ¨å…³é—­æ–¹æ¥æ”¶ï¼Œä»è€Œå¸®åŠ©å…¶æ­£å¸¸å…³é—­ã€‚</strong></p><p>å¦‚æœå®¢æˆ·ç«¯ï¼ˆä¸»åŠ¨å…³é—­æ–¹ï¼‰æœ€åä¸€æ¬¡ ACK æŠ¥æ–‡ï¼ˆç¬¬å››æ¬¡æŒ¥æ‰‹ï¼‰åœ¨ç½‘ç»œä¸­ä¸¢å¤±äº†ï¼Œé‚£ä¹ˆæŒ‰ç…§ TCP å¯é æ€§åŸåˆ™ï¼ŒæœåŠ¡ç«¯ï¼ˆè¢«åŠ¨å…³é—­æ–¹ï¼‰ä¼š<strong>é‡å‘ FIN æŠ¥æ–‡ã€‚</strong></p><p>å‡è®¾å®¢æˆ·ç«¯æ²¡æœ‰ TIME_WAIT çŠ¶æ€ï¼Œè€Œæ˜¯åœ¨å‘å®Œæœ€åä¸€æ¬¡å› ACK æŠ¥æ–‡å°±ç›´æ¥è¿›å…¥ CLOSE çŠ¶æ€ï¼Œå¦‚æœè¯¥ ACK æŠ¥æ–‡ä¸¢å¤±äº†ï¼ŒæœåŠ¡ç«¯åˆ™é‡ä¼ çš„ FIN æŠ¥æ–‡ï¼Œè€Œè¿™æ—¶å®¢æˆ·ç«¯å·²ç»è¿›å…¥åˆ°å…³é—­çŠ¶æ€äº†ï¼Œåœ¨æ”¶åˆ°æœåŠ¡ç«¯é‡ä¼ çš„ FIN æŠ¥æ–‡åï¼Œå°±ä¼š<strong>å› RST æŠ¥æ–‡ã€‚</strong></p><img src="'+Kt+'" alt="TIME-WAIT æ—¶é—´è¿‡çŸ­ï¼Œæ²¡æœ‰ç¡®ä¿è¿æ¥æ­£å¸¸å…³é—­" style="zoom:67%;"><p>æœåŠ¡ç«¯æ”¶åˆ°è¿™ä¸ª RST å¹¶å°†å…¶è§£é‡Šä¸ºä¸€ä¸ª<strong>é”™è¯¯</strong>ï¼ˆConnection reset by peerï¼‰ï¼Œ<strong>è¿™å¯¹äºä¸€ä¸ªå¯é çš„åè®®æ¥è¯´ä¸æ˜¯ä¸€ä¸ªä¼˜é›…çš„ç»ˆæ­¢æ–¹å¼ã€‚</strong></p><blockquote><p>ä¸ºäº†é˜²æ­¢è¿™ç§æƒ…å†µå‡ºç°ï¼Œå®¢æˆ·ç«¯<strong>å¿…é¡»ç­‰å¾…è¶³å¤Ÿé•¿çš„æ—¶é—´</strong>ï¼Œç¡®ä¿æœåŠ¡ç«¯èƒ½å¤Ÿæ”¶åˆ° ACKï¼Œ<strong>å¦‚æœæœåŠ¡ç«¯æ²¡æœ‰æ”¶åˆ° ACK</strong>ï¼Œé‚£ä¹ˆå°±ä¼šè§¦å‘ TCP é‡ä¼ æœºåˆ¶ï¼ŒæœåŠ¡ç«¯ä¼šé‡æ–°å‘é€ä¸€ä¸ª FINï¼Œè¿™æ ·<strong>ä¸€å»ä¸€æ¥åˆšå¥½ä¸¤ä¸ª MSL çš„æ—¶é—´ã€‚</strong></p></blockquote><img src="'+Dt+'" alt="TIME-WAIT æ—¶é—´æ­£å¸¸ï¼Œç¡®ä¿äº†è¿æ¥æ­£å¸¸å…³é—­" style="zoom:67%;"><p>å®¢æˆ·ç«¯åœ¨æ”¶åˆ°æœåŠ¡ç«¯é‡ä¼ çš„ FIN æŠ¥æ–‡æ—¶ï¼ŒTIME_WAIT çŠ¶æ€çš„ç­‰å¾…æ—¶é—´ï¼Œä¼š<strong>é‡ç½®</strong>å› 2MSLã€‚</p><h4 id="time-wait-è¿‡å¤šæœ‰ä»€ä¹ˆå±å®³" tabindex="-1"><a class="header-anchor" href="#time-wait-è¿‡å¤šæœ‰ä»€ä¹ˆå±å®³"><span>- TIME_WAIT è¿‡å¤šæœ‰ä»€ä¹ˆå±å®³ï¼Ÿ</span></a></h4><blockquote><p>è¿‡å¤šçš„ TIME-WAIT çŠ¶æ€ä¸»è¦çš„å±å®³æœ‰ä¸¤ç§ï¼š</p><ul><li>ç¬¬ä¸€æ˜¯å ç”¨ç³»ç»Ÿèµ„æºï¼Œæ¯”å¦‚æ–‡ä»¶æè¿°ç¬¦ã€å†…å­˜èµ„æºã€CPU èµ„æºã€çº¿ç¨‹èµ„æºç­‰ï¼›</li><li>ç¬¬äºŒæ˜¯å ç”¨ç«¯å£èµ„æºï¼Œ<strong>ç«¯å£èµ„æºä¹Ÿæ˜¯æœ‰é™çš„</strong>ï¼Œä¸€èˆ¬å¯ä»¥å¼€å¯çš„ç«¯å£ä¸º <code>32768ï½61000</code>ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ <code>net.ipv4.ip_local_port_range</code>å‚æ•°æŒ‡å®šèŒƒå›´ã€‚</li></ul></blockquote><p><strong>å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯</strong> TIME_WAIT è¿‡å¤šï¼Œé€ æˆçš„å½±å“æ˜¯<strong>ä¸åŒçš„</strong>ã€‚</p>',83),Si=o("strong",null,"å¦‚æœå®¢æˆ·ç«¯ï¼ˆä¸»åŠ¨å‘èµ·å…³é—­è¿æ¥æ–¹ï¼‰çš„ TIME_WAIT çŠ¶æ€è¿‡å¤š",-1),Ai={href:"https://xiaolincoding.com/network/3_tcp/port.html#%E5%AE%A2%E6%88%B7%E7%AB%AF%E7%9A%84%E7%AB%AF%E5%8F%A3%E5%8F%AF%E4%BB%A5%E9%87%8D%E5%A4%8D%E4%BD%BF%E7%94%A8%E5%90%97",target:"_blank",rel:"noopener noreferrer"},Ii=n(`<p>å› æ­¤ï¼Œå®¢æˆ·ç«¯ï¼ˆå‘èµ·è¿æ¥æ–¹ï¼‰éƒ½æ˜¯å’Œã€Œç›®çš„ IP+ ç›®çš„ PORT ã€éƒ½ä¸€æ ·çš„æœåŠ¡ç«¯å»ºç«‹è¿æ¥çš„è¯ï¼Œå½“å®¢æˆ·ç«¯çš„ TIME_WAIT çŠ¶æ€è¿æ¥è¿‡å¤šçš„è¯ï¼Œå°±ä¼šå—ç«¯å£èµ„æºé™åˆ¶ï¼Œå¦‚æœå æ»¡äº†æ‰€æœ‰ç«¯å£èµ„æºï¼Œé‚£ä¹ˆå°±æ— æ³•å†è·Ÿã€Œç›®çš„ IP+ ç›®çš„ PORTã€éƒ½ä¸€æ ·çš„æœåŠ¡ç«¯å»ºç«‹è¿æ¥äº†ã€‚</p><p>ä¸è¿‡ï¼Œå³ä½¿æ˜¯åœ¨è¿™ç§åœºæ™¯ä¸‹ï¼Œåªè¦è¿æ¥çš„æ˜¯ä¸åŒçš„æœåŠ¡ç«¯ï¼Œç«¯å£æ˜¯å¯ä»¥é‡å¤ä½¿ç”¨çš„ï¼Œæ‰€ä»¥å®¢æˆ·ç«¯è¿˜æ˜¯å¯ä»¥å‘å…¶ä»–æœåŠ¡ç«¯å‘èµ·è¿æ¥çš„ï¼Œè¿™æ˜¯å› ä¸ºå†…æ ¸åœ¨å®šä½ä¸€ä¸ªè¿æ¥çš„æ—¶å€™ï¼Œæ˜¯é€šè¿‡å››å…ƒç»„ï¼ˆæºIPã€æºç«¯å£ã€ç›®çš„IPã€ç›®çš„ç«¯å£ï¼‰ä¿¡æ¯æ¥å®šä½çš„ï¼Œå¹¶ä¸ä¼šå› ä¸ºå®¢æˆ·ç«¯çš„ç«¯å£ä¸€æ ·ï¼Œè€Œå¯¼è‡´è¿æ¥å†²çªã€‚</p><p><strong>å¦‚æœæœåŠ¡ç«¯ï¼ˆä¸»åŠ¨å‘èµ·å…³é—­è¿æ¥æ–¹ï¼‰çš„ TIME_WAIT çŠ¶æ€è¿‡å¤š</strong>ï¼Œå¹¶ä¸ä¼šå¯¼è‡´ç«¯å£èµ„æºå—é™ï¼Œå› ä¸ºæœåŠ¡ç«¯åªç›‘å¬ä¸€ä¸ªç«¯å£ï¼Œè€Œä¸”ç”±äºä¸€ä¸ªå››å…ƒç»„å”¯ä¸€ç¡®å®šä¸€ä¸ª TCP è¿æ¥ï¼Œå› æ­¤ç†è®ºä¸ŠæœåŠ¡ç«¯å¯ä»¥å»ºç«‹å¾ˆå¤šè¿æ¥ï¼Œä½†æ˜¯ TCP è¿æ¥è¿‡å¤šï¼Œä¼šå ç”¨ç³»ç»Ÿèµ„æºï¼Œæ¯”å¦‚æ–‡ä»¶æè¿°ç¬¦ã€å†…å­˜èµ„æºã€CPU èµ„æºã€çº¿ç¨‹èµ„æºç­‰ã€‚</p><h4 id="å¦‚ä½•ä¼˜åŒ–-time-wait" tabindex="-1"><a class="header-anchor" href="#å¦‚ä½•ä¼˜åŒ–-time-wait"><span>- å¦‚ä½•ä¼˜åŒ– TIME_WAITï¼Ÿ</span></a></h4><p>è¿™é‡Œç»™å‡ºä¼˜åŒ– TIME-WAIT çš„å‡ ä¸ªæ–¹å¼ï¼Œéƒ½æ˜¯æœ‰åˆ©æœ‰å¼Šï¼š</p><ul><li>æ‰“å¼€ net.ipv4.tcp_tw_reuse å’Œ net.ipv4.tcp_timestamps é€‰é¡¹ï¼›</li><li>net.ipv4.tcp_max_tw_buckets</li><li>ç¨‹åºä¸­ä½¿ç”¨ SO_LINGER ï¼Œåº”ç”¨å¼ºåˆ¶ä½¿ç”¨ RST å…³é—­ã€‚</li></ul><p><em>æ–¹å¼ä¸€ï¼šnet.ipv4.tcp_tw_reuse å’Œ tcp_timestamps</em></p><p>å¦‚ä¸‹çš„ Linux å†…æ ¸å‚æ•°å¼€å¯åï¼Œåˆ™å¯ä»¥<strong>å¤ç”¨å¤„äº TIME_WAIT çš„ socket ä¸ºæ–°çš„è¿æ¥æ‰€ç”¨</strong>ã€‚</p><p>æœ‰ä¸€ç‚¹éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ<strong>tcp_tw_reuse åŠŸèƒ½åªèƒ½ç”¨å®¢æˆ·ç«¯ï¼ˆè¿æ¥å‘èµ·æ–¹ï¼‰ï¼Œå› ä¸ºå¼€å¯äº†è¯¥åŠŸèƒ½ï¼Œåœ¨è°ƒç”¨ connect() å‡½æ•°æ—¶ï¼Œå†…æ ¸ä¼šéšæœºæ‰¾ä¸€ä¸ª time_wait çŠ¶æ€è¶…è¿‡ 1 ç§’çš„è¿æ¥ç»™æ–°çš„è¿æ¥å¤ç”¨ã€‚</strong></p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>net.ipv4.tcp_tw_reuse <span class="token operator">=</span> <span class="token number">1</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>ä½¿ç”¨è¿™ä¸ªé€‰é¡¹ï¼Œè¿˜æœ‰ä¸€ä¸ªå‰æï¼Œéœ€è¦æ‰“å¼€å¯¹ TCP æ—¶é—´æˆ³çš„æ”¯æŒï¼Œå³</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>net.ipv4.tcp_timestamps=1ï¼ˆé»˜è®¤å³ä¸º 1ï¼‰
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>è¿™ä¸ª<strong>æ—¶é—´æˆ³</strong>çš„å­—æ®µæ˜¯åœ¨ TCP å¤´éƒ¨çš„ã€Œé€‰é¡¹ã€é‡Œï¼Œå®ƒç”±ä¸€å…± 8 ä¸ªå­—èŠ‚è¡¨ç¤ºæ—¶é—´æˆ³ï¼Œå…¶ä¸­ç¬¬ä¸€ä¸ª 4 å­—èŠ‚å­—æ®µç”¨æ¥<strong>ä¿å­˜å‘é€è¯¥æ•°æ®åŒ…çš„æ—¶é—´</strong>ï¼Œç¬¬äºŒä¸ª 4 å­—èŠ‚å­—æ®µç”¨æ¥ä¿å­˜æœ€è¿‘ä¸€æ¬¡æ¥æ”¶å¯¹æ–¹å‘é€åˆ°è¾¾æ•°æ®çš„æ—¶é—´ã€‚</p><p>ç”±äºå¼•å…¥äº†æ—¶é—´æˆ³ï¼Œæˆ‘ä»¬åœ¨å‰é¢æåˆ°çš„ <code>2MSL</code> é—®é¢˜å°±ä¸å¤å­˜åœ¨äº†ï¼Œå› ä¸º<strong>é‡å¤çš„æ•°æ®åŒ…ä¼šå› ä¸ºæ—¶é—´æˆ³è¿‡æœŸè¢«è‡ªç„¶ä¸¢å¼ƒ</strong>ã€‚</p><p><em>æ–¹å¼äºŒï¼šnet.ipv4.tcp_max_tw_buckets</em></p><p>è¿™ä¸ªå€¼é»˜è®¤ä¸º 18000ï¼Œ<strong>å½“ç³»ç»Ÿä¸­å¤„äº TIME_WAIT çš„è¿æ¥ä¸€æ—¦è¶…è¿‡è¿™ä¸ªå€¼æ—¶ï¼Œç³»ç»Ÿå°±ä¼šå°†åé¢çš„ TIME_WAIT è¿æ¥çŠ¶æ€é‡ç½®</strong>ï¼Œè¿™ä¸ªæ–¹æ³•æ¯”è¾ƒæš´åŠ›ã€‚</p><p><em>æ–¹å¼ä¸‰ï¼šç¨‹åºä¸­ä½¿ç”¨ SO_LINGER</em></p><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡è®¾ç½® socket é€‰é¡¹ï¼Œæ¥è®¾ç½®è°ƒç”¨ close å…³é—­è¿æ¥è¡Œä¸ºã€‚</p><div class="language-c line-numbers-mode" data-ext="c" data-title="c"><pre class="language-c"><code><span class="token keyword">struct</span> <span class="token class-name">linger</span> so_linger<span class="token punctuation">;</span>
so_linger<span class="token punctuation">.</span>l_onoff <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
so_linger<span class="token punctuation">.</span>l_linger <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token function">setsockopt</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> SOL_SOCKET<span class="token punctuation">,</span> SO_LINGER<span class="token punctuation">,</span> <span class="token operator">&amp;</span>so_linger<span class="token punctuation">,</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>so_linger<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¦‚æœ<code>l_onoff</code>ä¸ºé 0ï¼Œ ä¸”<code>l_linger</code>å€¼ä¸º 0ï¼Œé‚£ä¹ˆè°ƒç”¨<code>close</code>åï¼Œä¼šç«‹è¯¥å‘é€ä¸€ä¸ª<code>RST</code>æ ‡å¿—ç»™å¯¹ç«¯ï¼Œè¯¥ TCP è¿æ¥å°†è·³è¿‡å››æ¬¡æŒ¥æ‰‹ï¼Œä¹Ÿå°±è·³è¿‡äº†<code>TIME_WAIT</code>çŠ¶æ€ï¼Œç›´æ¥å…³é—­ã€‚</p><p>ä½†è¿™ä¸ºè·¨è¶Š<code>TIME_WAIT</code>çŠ¶æ€æä¾›äº†ä¸€ä¸ªå¯èƒ½ï¼Œä¸è¿‡æ˜¯ä¸€ä¸ªéå¸¸å±é™©çš„è¡Œä¸ºï¼Œä¸å€¼å¾—æå€¡ã€‚</p><blockquote><p>å‰é¢ä»‹ç»çš„æ–¹æ³•éƒ½æ˜¯<strong>è¯•å›¾è¶Šè¿‡</strong> <code>TIME_WAIT</code>çŠ¶æ€çš„ï¼Œè¿™æ ·å…¶å®ä¸å¤ªå¥½ã€‚è™½ç„¶ TIME_WAIT çŠ¶æ€æŒç»­çš„æ—¶é—´<strong>æ˜¯æœ‰ä¸€ç‚¹é•¿</strong>ï¼Œæ˜¾å¾—å¾ˆä¸å‹å¥½ï¼Œä½†æ˜¯å®ƒè¢«è®¾è®¡æ¥å°±æ˜¯<strong>ç”¨æ¥é¿å…å‘ç”Ÿä¹±ä¸ƒå…«ç³Ÿçš„äº‹æƒ…ã€‚</strong></p><p>ã€ŠUNIXç½‘ç»œç¼–ç¨‹ã€‹ä¸€ä¹¦ä¸­å´è¯´é“ï¼š<strong>TIME_WAIT æ˜¯æˆ‘ä»¬çš„æœ‹å‹ï¼Œå®ƒæ˜¯æœ‰åŠ©äºæˆ‘ä»¬çš„ï¼Œä¸è¦è¯•å›¾é¿å…è¿™ä¸ªçŠ¶æ€ï¼Œè€Œæ˜¯åº”è¯¥å¼„æ¸…æ¥šå®ƒ</strong>ã€‚</p><p><strong>å¦‚æœ<code>æœåŠ¡ç«¯</code>è¦é¿å…è¿‡å¤šçš„ TIME_WAIT çŠ¶æ€çš„è¿æ¥ï¼Œå°±<code>æ°¸è¿œä¸è¦ä¸»åŠ¨æ–­å¼€è¿æ¥</code>ï¼Œè®©<code>å®¢æˆ·ç«¯å»æ–­å¼€</code>ï¼Œç”±åˆ†å¸ƒåœ¨å„å¤„çš„<code>å®¢æˆ·ç«¯å»æ‰¿å— TIME_WAIT</code></strong>ã€‚</p></blockquote><h4 id="æœåŠ¡å™¨å‡ºç°å¤§é‡-time-wait-çŠ¶æ€çš„åŸå› æœ‰å“ªäº›" tabindex="-1"><a class="header-anchor" href="#æœåŠ¡å™¨å‡ºç°å¤§é‡-time-wait-çŠ¶æ€çš„åŸå› æœ‰å“ªäº›"><span>- æœåŠ¡å™¨å‡ºç°å¤§é‡ TIME_WAIT çŠ¶æ€çš„åŸå› æœ‰å“ªäº›ï¼Ÿ</span></a></h4><p>é¦–å…ˆè¦çŸ¥é“ TIME_WAIT çŠ¶æ€æ˜¯<strong>ä¸»åŠ¨å…³é—­è¿æ¥æ–¹æ‰ä¼šå‡ºç°çš„çŠ¶æ€</strong>ï¼Œæ‰€ä»¥å¦‚æœæœåŠ¡å™¨å‡ºç°å¤§é‡çš„ TIME_WAIT çŠ¶æ€çš„ TCP è¿æ¥ï¼Œå°±æ˜¯è¯´æ˜<strong>æœåŠ¡å™¨ä¸»åŠ¨æ–­å¼€äº†å¾ˆå¤š TCP è¿æ¥ã€‚</strong></p><blockquote><p>é—®é¢˜æ¥äº†ï¼Œ<strong>ä»€ä¹ˆåœºæ™¯ä¸‹æœåŠ¡ç«¯ä¼šä¸»åŠ¨æ–­å¼€è¿æ¥å‘¢ï¼Ÿ</strong></p><ul><li>ç¬¬ä¸€ä¸ªåœºæ™¯ï¼šHTTP <strong>æ²¡æœ‰ä½¿ç”¨é•¿è¿æ¥</strong></li><li>ç¬¬äºŒä¸ªåœºæ™¯ï¼šHTTP <strong>é•¿è¿æ¥è¶…æ—¶</strong></li><li>ç¬¬ä¸‰ä¸ªåœºæ™¯ï¼šHTTP <strong>é•¿è¿æ¥çš„è¯·æ±‚æ•°é‡è¾¾åˆ°ä¸Šé™</strong></li></ul></blockquote><p>æ¥ä¸‹æ¥ï¼Œåˆ†åˆ«ä»‹ç»ä¸‹ã€‚</p><p><mark><em>ç¬¬ä¸€ä¸ªåœºæ™¯ï¼šHTTP æ²¡æœ‰ä½¿ç”¨é•¿è¿æ¥</em></mark></p><p>æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹ HTTP é•¿è¿æ¥ï¼ˆKeep-Aliveï¼‰æœºåˆ¶æ˜¯æ€ä¹ˆå¼€å¯çš„ã€‚</p><p>åœ¨ <strong>HTTP/1.0 ä¸­é»˜è®¤æ˜¯å…³é—­çš„</strong>ï¼Œå¦‚æœæµè§ˆå™¨è¦å¼€å¯ Keep-Aliveï¼Œå®ƒå¿…é¡»åœ¨è¯·æ±‚çš„ header ä¸­æ·»åŠ ï¼š</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>Connection: Keep-Alive
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>ç„¶åå½“æœåŠ¡å™¨æ”¶åˆ°è¯·æ±‚ï¼Œä½œå‡ºå›åº”çš„æ—¶å€™ï¼Œå®ƒä¹Ÿè¢«æ·»åŠ åˆ°å“åº”ä¸­ header é‡Œï¼š</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>Connection: Keep-Alive
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>è¿™æ ·åšï¼ŒTCP è¿æ¥å°±ä¸ä¼šä¸­æ–­ï¼Œè€Œæ˜¯ä¿æŒè¿æ¥ã€‚å½“å®¢æˆ·ç«¯å‘é€å¦ä¸€ä¸ªè¯·æ±‚æ—¶ï¼Œå®ƒä¼šä½¿ç”¨åŒä¸€ä¸ª TCP è¿æ¥ã€‚è¿™ä¸€ç›´ç»§ç»­åˆ°å®¢æˆ·ç«¯æˆ–æœåŠ¡å™¨ç«¯æå‡ºæ–­å¼€è¿æ¥ã€‚</p><p><strong>ä» HTTP/1.1 å¼€å§‹ï¼Œ å°±é»˜è®¤æ˜¯å¼€å¯äº† Keep-Alive</strong>ï¼Œç°åœ¨å¤§å¤šæ•°æµè§ˆå™¨éƒ½é»˜è®¤æ˜¯ä½¿ç”¨ HTTP/1.1ï¼Œæ‰€ä»¥ Keep-Alive éƒ½æ˜¯é»˜è®¤æ‰“å¼€çš„ã€‚<strong>ä¸€æ—¦å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯è¾¾æˆåè®®</strong>ï¼Œé‚£ä¹ˆ<strong>é•¿è¿æ¥å°±å»ºç«‹å¥½äº†</strong>ã€‚</p><p>å¦‚æœè¦å…³é—­ HTTP Keep-Aliveï¼Œéœ€è¦åœ¨ HTTP è¯·æ±‚æˆ–è€…å“åº”çš„ header é‡Œæ·»åŠ  <code>Connection:close</code> ä¿¡æ¯ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œ<strong>åªè¦å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ä»»æ„ä¸€æ–¹çš„ HTTP header ä¸­æœ‰ <code>Connection:close</code> ä¿¡æ¯ï¼Œé‚£ä¹ˆå°±æ— æ³•ä½¿ç”¨ HTTP é•¿è¿æ¥çš„æœºåˆ¶</strong>ã€‚</p><p>å…³é—­ HTTP é•¿è¿æ¥æœºåˆ¶åï¼Œ<strong>æ¯æ¬¡è¯·æ±‚</strong>éƒ½è¦ç»å†è¿™æ ·çš„è¿‡ç¨‹ï¼š<strong>å»ºç«‹ TCP -&gt; è¯·æ±‚èµ„æº -&gt; å“åº”èµ„æº -&gt; é‡Šæ”¾è¿æ¥</strong>ï¼Œé‚£ä¹ˆæ­¤æ–¹å¼å°±æ˜¯ <strong>HTTP çŸ­è¿æ¥</strong>ï¼Œå¦‚ä¸‹å›¾ï¼š</p><figure><img src="`+Mt+'" alt="HTTP çŸ­è¿æ¥" tabindex="0" loading="lazy"><figcaption>HTTP çŸ­è¿æ¥</figcaption></figure><p>åœ¨å‰é¢æˆ‘ä»¬çŸ¥é“ï¼Œåªè¦ä»»æ„ä¸€æ–¹çš„ HTTP header ä¸­æœ‰ <code>Connection:close</code> ä¿¡æ¯ï¼Œå°±æ— æ³•ä½¿ç”¨ HTTP é•¿è¿æ¥æœºåˆ¶ï¼Œè¿™æ ·åœ¨å®Œæˆä¸€æ¬¡ HTTP è¯·æ±‚/å¤„ç†åï¼Œå°±ä¼šå…³é—­è¿æ¥ã€‚</p><p>é—®é¢˜æ¥äº†ï¼Œ<strong>è¿™æ—¶å€™æ˜¯å®¢æˆ·ç«¯è¿˜æ˜¯æœåŠ¡ç«¯ä¸»åŠ¨å…³é—­è¿æ¥å‘¢ï¼Ÿ</strong></p><p>åœ¨ RFC æ–‡æ¡£ä¸­ï¼Œå¹¶æ²¡æœ‰æ˜ç¡®ç”±è°æ¥å…³é—­è¿æ¥ï¼Œ<strong>è¯·æ±‚å’Œå“åº”çš„åŒæ–¹éƒ½å¯ä»¥ä¸»åŠ¨å…³é—­ TCP è¿æ¥ã€‚</strong></p><p>ä¸è¿‡ï¼Œ<strong>æ ¹æ®å¤§å¤šæ•° Web æœåŠ¡çš„å®ç°ï¼Œä¸ç®¡å“ªä¸€æ–¹ç¦ç”¨äº† HTTP Keep-Aliveï¼Œéƒ½æ˜¯ç”±æœåŠ¡ç«¯ä¸»åŠ¨å…³é—­è¿æ¥</strong>ï¼Œé‚£ä¹ˆæ­¤æ—¶æœåŠ¡ç«¯ä¸Šå°±ä¼šå‡ºç° TIME_WAIT çŠ¶æ€çš„è¿æ¥ã€‚</p><blockquote><p>å®¢æˆ·ç«¯ç¦ç”¨äº† HTTP Keep-Aliveï¼ŒæœåŠ¡ç«¯å¼€å¯ HTTP Keep-Aliveï¼Œè°æ˜¯ä¸»åŠ¨å…³é—­æ–¹ï¼Ÿ</p></blockquote><p>å½“å®¢æˆ·ç«¯ç¦ç”¨äº† HTTP Keep-Aliveï¼Œè¿™æ—¶å€™ HTTP è¯·æ±‚çš„ header å°±ä¼šæœ‰ <code>Connection:close</code> ä¿¡æ¯ï¼Œè¿™æ—¶æœåŠ¡ç«¯åœ¨å‘å®Œ HTTP å“åº”åï¼Œå°±ä¼šä¸»åŠ¨å…³é—­è¿æ¥ã€‚</p><p>ä¸ºä»€ä¹ˆè¦è¿™ä¹ˆè®¾è®¡å‘¢ï¼Ÿ<strong>HTTP æ˜¯è¯·æ±‚-å“åº”æ¨¡å‹</strong>ï¼Œå‘èµ·æ–¹ä¸€ç›´æ˜¯å®¢æˆ·ç«¯ï¼ŒHTTP Keep-Alive çš„åˆè¡·æ˜¯<strong>ä¸ºå®¢æˆ·ç«¯åç»­çš„è¯·æ±‚é‡ç”¨è¿æ¥</strong>ï¼Œå¦‚æœæˆ‘ä»¬<strong>åœ¨æŸæ¬¡ HTTP è¯·æ±‚-å“åº”æ¨¡å‹ä¸­ï¼Œè¯·æ±‚çš„ header å®šä¹‰äº† <code>connectionï¼šclose</code> ä¿¡æ¯ï¼Œé‚£ä¸å†é‡ç”¨è¿™ä¸ªè¿æ¥çš„æ—¶æœºå°±åªæœ‰åœ¨æœåŠ¡ç«¯äº†</strong>ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨ HTTP è¯·æ±‚-å“åº”è¿™ä¸ªå‘¨æœŸçš„ã€Œæœ«ç«¯ã€å…³é—­è¿æ¥æ˜¯åˆç†çš„ã€‚</p><blockquote><p>å®¢æˆ·ç«¯å¼€å¯äº† HTTP Keep-Aliveï¼ŒæœåŠ¡ç«¯ç¦ç”¨äº† HTTP Keep-Aliveï¼Œè°æ˜¯ä¸»åŠ¨å…³é—­æ–¹ï¼Ÿ</p></blockquote><p>å½“å®¢æˆ·ç«¯å¼€å¯äº† HTTP Keep-Aliveï¼Œè€ŒæœåŠ¡ç«¯ç¦ç”¨äº† HTTP Keep-Aliveï¼Œè¿™æ—¶æœåŠ¡ç«¯åœ¨å‘å®Œ HTTP å“åº”åï¼ŒæœåŠ¡ç«¯ä¹Ÿä¼šä¸»åŠ¨å…³é—­è¿æ¥ã€‚</p><p>ä¸ºä»€ä¹ˆè¦è¿™ä¹ˆè®¾è®¡å‘¢ï¼Ÿåœ¨æœåŠ¡ç«¯ä¸»åŠ¨å…³é—­è¿æ¥çš„æƒ…å†µä¸‹ï¼Œåªè¦è°ƒç”¨ä¸€æ¬¡ close() å°±å¯ä»¥é‡Šæ”¾è¿æ¥ï¼Œå‰©ä¸‹çš„å·¥ä½œç”±å†…æ ¸ TCP æ ˆç›´æ¥è¿›è¡Œäº†å¤„ç†ï¼Œæ•´ä¸ªè¿‡ç¨‹åªæœ‰ä¸€æ¬¡ syscallï¼›å¦‚æœæ˜¯è¦æ±‚ å®¢æˆ·ç«¯å…³é—­ï¼Œåˆ™æœåŠ¡ç«¯åœ¨å†™å®Œæœ€åä¸€ä¸ª response ä¹‹åéœ€è¦æŠŠè¿™ä¸ª socket æ”¾å…¥ readable é˜Ÿåˆ—ï¼Œè°ƒç”¨ select / epoll å»ç­‰å¾…äº‹ä»¶ï¼›ç„¶åè°ƒç”¨ä¸€æ¬¡ read() æ‰èƒ½çŸ¥é“è¿æ¥å·²ç»è¢«å…³é—­ï¼Œè¿™å…¶ä¸­æ˜¯ä¸¤æ¬¡ syscallï¼Œå¤šä¸€æ¬¡ç”¨æˆ·æ€ç¨‹åºè¢«æ¿€æ´»æ‰§è¡Œï¼Œè€Œä¸” socket ä¿æŒæ—¶é—´ä¹Ÿä¼šæ›´é•¿ã€‚</p><blockquote><p>å› æ­¤ï¼Œ<strong>å½“æœåŠ¡ç«¯å‡ºç°å¤§é‡çš„ TIME_WAIT çŠ¶æ€è¿æ¥çš„æ—¶å€™ï¼Œå¯ä»¥æ’æŸ¥ä¸‹æ˜¯å¦å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯éƒ½å¼€å¯äº† HTTP Keep-Alive</strong>ï¼Œå› ä¸º<strong>ä»»æ„ä¸€æ–¹</strong>æ²¡æœ‰å¼€å¯ HTTP Keep-Aliveï¼Œéƒ½ä¼šå¯¼è‡´æœåŠ¡ç«¯åœ¨å¤„ç†å®Œä¸€ä¸ª HTTP è¯·æ±‚åï¼Œå°±ä¸»åŠ¨å…³é—­è¿æ¥ï¼Œæ­¤æ—¶æœåŠ¡ç«¯ä¸Šå°±ä¼šå‡ºç°å¤§é‡çš„ TIME_WAIT çŠ¶æ€çš„è¿æ¥ã€‚</p><p>é’ˆå¯¹è¿™ä¸ªåœºæ™¯ä¸‹ï¼Œè§£å†³çš„æ–¹å¼ä¹Ÿå¾ˆç®€å•ï¼Œè®©å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯éƒ½å¼€å¯ HTTP Keep-Alive æœºåˆ¶ã€‚</p></blockquote><p><mark><em>ç¬¬äºŒä¸ªåœºæ™¯ï¼šHTTP é•¿è¿æ¥è¶…æ—¶</em></mark></p><p>HTTP é•¿è¿æ¥çš„ç‰¹ç‚¹æ˜¯ï¼Œ<strong>åªè¦ä»»æ„ä¸€ç«¯æ²¡æœ‰æ˜ç¡®æå‡ºæ–­å¼€è¿æ¥</strong>ï¼Œåˆ™<strong>ä¿æŒ TCP è¿æ¥çŠ¶æ€ã€‚</strong></p><p>HTTP é•¿è¿æ¥å¯ä»¥åœ¨<strong>åŒä¸€ä¸ª TCP è¿æ¥ä¸Š</strong>æ¥æ”¶å’Œå‘é€<strong>å¤šä¸ª HTTP è¯·æ±‚/åº”ç­”</strong>ï¼Œ<strong>é¿å…äº†è¿æ¥å»ºç«‹å’Œé‡Šæ”¾çš„å¼€é”€ã€‚</strong></p><img src="'+Lt+'" alt="img" style="zoom:67%;"><p>å¯èƒ½æœ‰çš„åŒå­¦ä¼šé—®ï¼Œå¦‚æœä½¿ç”¨äº† HTTP é•¿è¿æ¥ï¼Œå¦‚æœå®¢æˆ·ç«¯å®Œæˆä¸€ä¸ª HTTP è¯·æ±‚åï¼Œå°±ä¸å†å‘èµ·æ–°çš„è¯·æ±‚ï¼Œæ­¤æ—¶è¿™ä¸ª TCP è¿æ¥ä¸€ç›´å ç”¨ç€ä¸æ˜¯æŒºæµªè´¹èµ„æºçš„å—ï¼Ÿ</p><p><strong>å¯¹æ²¡é”™</strong>ï¼Œæ‰€ä»¥<strong>ä¸ºäº†é¿å…èµ„æºæµªè´¹çš„æƒ…å†µ</strong>ï¼Œweb æœåŠ¡è½¯ä»¶ä¸€èˆ¬éƒ½ä¼šæä¾›ä¸€ä¸ªå‚æ•°ï¼Œç”¨æ¥æŒ‡å®š <strong>HTTP é•¿è¿æ¥çš„è¶…æ—¶æ—¶é—´</strong>ï¼Œæ¯”å¦‚ nginx æä¾›çš„ keepalive_timeout å‚æ•°ã€‚</p><p>å‡è®¾è®¾ç½®äº† HTTP é•¿è¿æ¥çš„è¶…æ—¶æ—¶é—´æ˜¯ 60 ç§’ï¼Œnginx å°±ä¼šå¯åŠ¨ä¸€ä¸ª**ã€Œå®šæ—¶å™¨ã€**ï¼Œ<strong>å¦‚æœå®¢æˆ·ç«¯åœ¨å®Œåä¸€ä¸ª HTTP è¯·æ±‚åï¼Œåœ¨ 60 ç§’å†…éƒ½æ²¡æœ‰å†å‘èµ·æ–°çš„è¯·æ±‚ï¼Œå®šæ—¶å™¨çš„æ—¶é—´ä¸€åˆ°ï¼Œnginx å°±ä¼šè§¦å‘å›è°ƒå‡½æ•°æ¥å…³é—­è¯¥è¿æ¥ï¼Œé‚£ä¹ˆæ­¤æ—¶æœåŠ¡ç«¯ä¸Šå°±ä¼šå‡ºç° TIME_WAIT çŠ¶æ€çš„è¿æ¥</strong>ã€‚</p><img src="'+Rt+'" alt="HTTP é•¿è¿æ¥è¶…æ—¶" style="zoom:67%;"><p>å½“æœåŠ¡ç«¯å‡ºç°å¤§é‡ TIME_WAIT çŠ¶æ€çš„è¿æ¥æ—¶ï¼Œå¦‚æœç°è±¡æ˜¯æœ‰å¤§é‡çš„å®¢æˆ·ç«¯å»ºç«‹å®Œ TCP è¿æ¥åï¼Œå¾ˆé•¿ä¸€æ®µæ—¶é—´æ²¡æœ‰å‘é€æ•°æ®ï¼Œé‚£ä¹ˆå¤§æ¦‚ç‡å°±æ˜¯å› ä¸º HTTP é•¿è¿æ¥è¶…æ—¶ï¼Œå¯¼è‡´æœåŠ¡ç«¯ä¸»åŠ¨å…³é—­è¿æ¥ï¼Œäº§ç”Ÿå¤§é‡å¤„äº TIME_WAIT çŠ¶æ€çš„è¿æ¥ã€‚</p><p>å¯ä»¥å¾€ç½‘ç»œé—®é¢˜çš„æ–¹å‘æ’æŸ¥ï¼Œæ¯”å¦‚<strong>æ˜¯å¦æ˜¯å› ä¸ºç½‘ç»œé—®é¢˜ï¼Œå¯¼è‡´å®¢æˆ·ç«¯å‘é€çš„æ•°æ®ä¸€ç›´æ²¡æœ‰è¢«æœåŠ¡ç«¯æ¥æ”¶åˆ°</strong>ï¼Œä»¥è‡³äº <strong>HTTP é•¿è¿æ¥è¶…æ—¶</strong>ã€‚</p><p><mark><em>ç¬¬ä¸‰ä¸ªåœºæ™¯ï¼šHTTP é•¿è¿æ¥çš„è¯·æ±‚æ•°é‡è¾¾åˆ°ä¸Šé™</em></mark></p><p><strong>Web æœåŠ¡ç«¯</strong>é€šå¸¸ä¼šæœ‰ä¸ªå‚æ•°ï¼Œæ¥å®šä¹‰<strong>ä¸€æ¡ HTTP é•¿è¿æ¥ä¸Šæœ€å¤§èƒ½å¤„ç†çš„è¯·æ±‚æ•°é‡</strong>ï¼Œå½“<strong>è¶…è¿‡æœ€å¤§é™åˆ¶æ—¶</strong>ï¼Œå°±ä¼š<strong>ä¸»åŠ¨å…³é—­è¿æ¥</strong>ã€‚</p><p>æ¯”å¦‚ nginx çš„ keepalive_requests è¿™ä¸ªå‚æ•°ï¼Œè¿™ä¸ªå‚æ•°æ˜¯<strong>æŒ‡ä¸€ä¸ª HTTP é•¿è¿æ¥å»ºç«‹ä¹‹å</strong>ï¼Œnginx å°±ä¼šä¸ºè¿™ä¸ªè¿æ¥è®¾ç½®ä¸€ä¸ª<strong>è®¡æ•°å™¨</strong>ï¼Œè®°å½•è¿™ä¸ª HTTP <strong>é•¿è¿æ¥ä¸Šå·²ç»æ¥æ”¶å¹¶å¤„ç†çš„å®¢æˆ·ç«¯è¯·æ±‚çš„æ•°é‡</strong>ã€‚<strong>å¦‚æœè¾¾åˆ°è¿™ä¸ªå‚æ•°è®¾ç½®çš„æœ€å¤§å€¼æ—¶ï¼Œåˆ™ nginx ä¼šä¸»åŠ¨å…³é—­è¿™ä¸ªé•¿è¿æ¥</strong>ï¼Œé‚£ä¹ˆæ­¤æ—¶æœåŠ¡ç«¯ä¸Šå°±ä¼šå‡ºç° TIME_WAIT çŠ¶æ€çš„è¿æ¥ã€‚</p><p>keepalive_requests å‚æ•°çš„é»˜è®¤å€¼æ˜¯ 100 ï¼Œæ„å‘³ç€<strong>æ¯ä¸ª HTTP é•¿è¿æ¥æœ€å¤šåªèƒ½è·‘ 100 æ¬¡è¯·æ±‚</strong>ï¼Œè¿™ä¸ªå‚æ•°å¾€å¾€è¢«å¤§å¤šæ•°äººå¿½ç•¥ï¼Œå› ä¸ºå½“ QPS (æ¯ç§’è¯·æ±‚æ•°) ä¸æ˜¯å¾ˆé«˜æ—¶ï¼Œé»˜è®¤å€¼ 100 å‡‘åˆå¤Ÿç”¨ã€‚</p><p>ä½†æ˜¯ï¼Œ<strong>å¯¹äºä¸€äº› QPS æ¯”è¾ƒé«˜çš„åœºæ™¯ï¼Œæ¯”å¦‚è¶…è¿‡ 10000 QPSï¼Œç”šè‡³è¾¾åˆ° 30000 , 50000 ç”šè‡³æ›´é«˜ï¼Œå¦‚æœ keepalive_requests å‚æ•°å€¼æ˜¯ 100ï¼Œè¿™æ—¶å€™å°± nginx å°±ä¼šå¾ˆé¢‘ç¹åœ°å…³é—­è¿æ¥ï¼Œé‚£ä¹ˆæ­¤æ—¶æœåŠ¡ç«¯ä¸Šå°±ä¼šå‡ºå¤§é‡çš„ TIME_WAIT çŠ¶æ€</strong>ã€‚</p><p>é’ˆå¯¹è¿™ä¸ªåœºæ™¯ä¸‹ï¼Œè§£å†³çš„æ–¹å¼ä¹Ÿå¾ˆç®€å•ï¼Œ<strong>è°ƒå¤§</strong> nginx çš„ keepalive_requests å‚æ•°å°±è¡Œã€‚</p><h4 id="æœåŠ¡å™¨å‡ºç°å¤§é‡-close-wait-çŠ¶æ€çš„åŸå› æœ‰å“ªäº›" tabindex="-1"><a class="header-anchor" href="#æœåŠ¡å™¨å‡ºç°å¤§é‡-close-wait-çŠ¶æ€çš„åŸå› æœ‰å“ªäº›"><span>- æœåŠ¡å™¨å‡ºç°å¤§é‡ CLOSE_WAIT çŠ¶æ€çš„åŸå› æœ‰å“ªäº›ï¼Ÿ</span></a></h4><p>CLOSE_WAIT çŠ¶æ€æ˜¯**ã€Œè¢«åŠ¨å…³é—­æ–¹ã€<strong>æ‰ä¼šæœ‰çš„çŠ¶æ€ï¼Œè€Œä¸”å¦‚æœ</strong>ã€Œè¢«åŠ¨å…³é—­æ–¹ã€æ²¡æœ‰è°ƒç”¨ close å‡½æ•°**å…³é—­è¿æ¥ï¼Œé‚£ä¹ˆå°±æ— æ³•å‘å‡º FIN æŠ¥æ–‡ï¼Œä»è€Œæ— æ³•ä½¿å¾— CLOSE_WAIT çŠ¶æ€çš„è¿æ¥è½¬å˜ä¸º LAST_ACK çŠ¶æ€ã€‚</p><blockquote><p>æ‰€ä»¥ï¼Œ<strong>å½“æœåŠ¡ç«¯å‡ºç°å¤§é‡ CLOSE_WAIT çŠ¶æ€çš„è¿æ¥çš„æ—¶å€™ï¼Œè¯´æ˜æœåŠ¡ç«¯çš„ç¨‹åºæ²¡æœ‰è°ƒç”¨ close å‡½æ•°å…³é—­è¿æ¥</strong>ã€‚</p></blockquote><p>é‚£ä»€ä¹ˆæƒ…å†µä¼šå¯¼è‡´æœåŠ¡ç«¯çš„ç¨‹åºæ²¡æœ‰è°ƒç”¨ close å‡½æ•°å…³é—­è¿æ¥ï¼Ÿè¿™æ—¶å€™<strong>é€šå¸¸éœ€è¦æ’æŸ¥ä»£ç </strong>ã€‚</p><p>æˆ‘ä»¬å…ˆæ¥åˆ†æä¸€ä¸ªæ™®é€šçš„ TCP æœåŠ¡ç«¯çš„æµç¨‹ï¼š</p><ol><li>åˆ›å»ºæœåŠ¡ç«¯ socketï¼Œbind ç»‘å®šç«¯å£ã€listen ç›‘å¬ç«¯å£</li><li>å°†æœåŠ¡ç«¯ socket æ³¨å†Œåˆ° epoll</li><li>epoll_wait ç­‰å¾…è¿æ¥åˆ°æ¥ï¼Œè¿æ¥åˆ°æ¥æ—¶ï¼Œè°ƒç”¨ accpet è·å–å·²è¿æ¥çš„ socket</li><li>å°†å·²è¿æ¥çš„ socket æ³¨å†Œåˆ° epoll</li><li>epoll_wait ç­‰å¾…äº‹ä»¶å‘ç”Ÿ</li><li>å¯¹æ–¹è¿æ¥å…³é—­æ—¶ï¼Œæˆ‘æ–¹è°ƒç”¨ close</li></ol><p>å¯èƒ½å¯¼è‡´æœåŠ¡ç«¯æ²¡æœ‰è°ƒç”¨ close å‡½æ•°çš„åŸå› ï¼Œå¦‚ä¸‹ã€‚</p><p><strong>ç¬¬ä¸€ä¸ªåŸå› </strong>ï¼šç¬¬ 2 æ­¥æ²¡æœ‰åšï¼Œæ²¡æœ‰å°†æœåŠ¡ç«¯ socket æ³¨å†Œåˆ° epollï¼Œè¿™æ ·æœ‰æ–°è¿æ¥åˆ°æ¥æ—¶ï¼ŒæœåŠ¡ç«¯æ²¡åŠæ³•æ„ŸçŸ¥è¿™ä¸ªäº‹ä»¶ï¼Œä¹Ÿå°±æ— æ³•è·å–åˆ°å·²è¿æ¥çš„ socketï¼Œé‚£æœåŠ¡ç«¯è‡ªç„¶å°±æ²¡æœºä¼šå¯¹ socket è°ƒç”¨ close å‡½æ•°äº†ã€‚</p><p>ä¸è¿‡è¿™ç§åŸå› å‘ç”Ÿçš„æ¦‚ç‡æ¯”è¾ƒå°ï¼Œè¿™ç§å±äºæ˜æ˜¾çš„ä»£ç é€»è¾‘ bugï¼Œåœ¨å‰æœŸ read view é˜¶æ®µå°±èƒ½å‘ç°çš„äº†ã€‚</p><p><strong>ç¬¬äºŒä¸ªåŸå› </strong>ï¼š ç¬¬ 3 æ­¥æ²¡æœ‰åšï¼Œæœ‰æ–°è¿æ¥åˆ°æ¥æ—¶æ²¡æœ‰è°ƒç”¨ accpet è·å–è¯¥è¿æ¥çš„ socketï¼Œå¯¼è‡´å½“æœ‰å¤§é‡çš„å®¢æˆ·ç«¯ä¸»åŠ¨æ–­å¼€äº†è¿æ¥ï¼Œè€ŒæœåŠ¡ç«¯æ²¡æœºä¼šå¯¹è¿™äº› socket è°ƒç”¨ close å‡½æ•°ï¼Œä»è€Œå¯¼è‡´æœåŠ¡ç«¯å‡ºç°å¤§é‡ CLOSE_WAIT çŠ¶æ€çš„è¿æ¥ã€‚</p><p>å‘ç”Ÿè¿™ç§æƒ…å†µå¯èƒ½æ˜¯å› ä¸ºæœåŠ¡ç«¯åœ¨æ‰§è¡Œ accpet å‡½æ•°ä¹‹å‰ï¼Œä»£ç å¡åœ¨æŸä¸€ä¸ªé€»è¾‘æˆ–è€…æå‰æŠ›å‡ºäº†å¼‚å¸¸ã€‚</p><p><strong>ç¬¬ä¸‰ä¸ªåŸå› </strong>ï¼šç¬¬ 4 æ­¥æ²¡æœ‰åšï¼Œé€šè¿‡ accpet è·å–å·²è¿æ¥çš„ socket åï¼Œæ²¡æœ‰å°†å…¶æ³¨å†Œåˆ° epollï¼Œå¯¼è‡´åç»­æ”¶åˆ° FIN æŠ¥æ–‡çš„æ—¶å€™ï¼ŒæœåŠ¡ç«¯æ²¡åŠæ³•æ„ŸçŸ¥è¿™ä¸ªäº‹ä»¶ï¼Œé‚£æœåŠ¡ç«¯å°±æ²¡æœºä¼šè°ƒç”¨ close å‡½æ•°äº†ã€‚</p>',76),xi={href:"https://mp.weixin.qq.com/s?__biz=MzU3Njk0MTc3Ng==&mid=2247486020&idx=1&sn=f7cf41aec28e2e10a46228a64b1c0a5c&scene=21#wechat_redirect",target:"_blank",rel:"noopener noreferrer"},Ni=n(`<p><strong>ç¬¬å››ä¸ªåŸå› </strong>ï¼šç¬¬ 6 æ­¥æ²¡æœ‰åšï¼Œå½“å‘ç°å®¢æˆ·ç«¯å…³é—­è¿æ¥åï¼ŒæœåŠ¡ç«¯æ²¡æœ‰æ‰§è¡Œ close å‡½æ•°ï¼Œå¯èƒ½æ˜¯å› ä¸ºä»£ç æ¼å¤„ç†ï¼Œæˆ–è€…æ˜¯åœ¨æ‰§è¡Œ close å‡½æ•°ä¹‹å‰ï¼Œä»£ç å¡åœ¨æŸä¸€ä¸ªé€»è¾‘ï¼Œæ¯”å¦‚å‘ç”Ÿæ­»é”ç­‰ç­‰ã€‚</p><p>å¯ä»¥å‘ç°ï¼Œ<strong>å½“æœåŠ¡ç«¯å‡ºç°å¤§é‡ CLOSE_WAIT çŠ¶æ€çš„è¿æ¥çš„æ—¶å€™ï¼Œé€šå¸¸éƒ½æ˜¯ ä»£ç çš„é—®é¢˜ ï¼Œè¿™æ—¶å€™æˆ‘ä»¬éœ€è¦é’ˆå¯¹å…·ä½“çš„ä»£ç ä¸€æ­¥ä¸€æ­¥çš„è¿›è¡Œæ’æŸ¥å’Œå®šä½ï¼Œä¸»è¦åˆ†æçš„æ–¹å‘å°±æ˜¯æœåŠ¡ç«¯ä¸ºä»€ä¹ˆæ²¡æœ‰è°ƒç”¨ close</strong>ã€‚</p><h4 id="å¦‚æœå·²ç»å»ºç«‹äº†è¿æ¥-ä½†æ˜¯å®¢æˆ·ç«¯çªç„¶å‡ºç°æ•…éšœäº†æ€ä¹ˆåŠ" tabindex="-1"><a class="header-anchor" href="#å¦‚æœå·²ç»å»ºç«‹äº†è¿æ¥-ä½†æ˜¯å®¢æˆ·ç«¯çªç„¶å‡ºç°æ•…éšœäº†æ€ä¹ˆåŠ"><span>-- å¦‚æœå·²ç»å»ºç«‹äº†è¿æ¥ï¼Œä½†æ˜¯å®¢æˆ·ç«¯çªç„¶å‡ºç°æ•…éšœäº†æ€ä¹ˆåŠï¼Ÿ</span></a></h4><blockquote><p>å®¢æˆ·ç«¯å‡ºç°æ•…éšœæŒ‡çš„æ˜¯<strong>å®¢æˆ·ç«¯çš„ä¸»æœºå‘ç”Ÿäº†å®•æœº</strong>ï¼Œæˆ–è€…<strong>æ–­ç”µ</strong>çš„åœºæ™¯ã€‚å‘ç”Ÿè¿™ç§æƒ…å†µçš„æ—¶å€™ï¼Œå¦‚æœæœåŠ¡ç«¯ä¸€ç›´ä¸ä¼šå‘é€æ•°æ®ç»™å®¢æˆ·ç«¯ï¼Œé‚£ä¹ˆæœåŠ¡ç«¯æ˜¯æ°¸è¿œæ— æ³•æ„ŸçŸ¥åˆ°å®¢æˆ·ç«¯å®•æœºè¿™ä¸ªäº‹ä»¶çš„ï¼Œä¹Ÿå°±æ˜¯æœåŠ¡ç«¯çš„ TCP è¿æ¥å°†ä¸€ç›´å¤„äº <code>ESTABLISH</code> çŠ¶æ€ï¼Œå ç”¨ç€ç³»ç»Ÿèµ„æºã€‚</p><p>ä¸ºäº†é¿å…è¿™ç§æƒ…å†µï¼ŒTCP æäº†ä¸ª<strong>ä¿æ´»æœºåˆ¶</strong>ã€‚</p></blockquote><p>è¿™ä¸ªæœºåˆ¶çš„åŸç†æ˜¯è¿™æ ·çš„ï¼š</p><p>å®šä¹‰<strong>ä¸€ä¸ªæ—¶é—´æ®µ</strong>ï¼Œåœ¨è¿™ä¸ªæ—¶é—´æ®µå†…ï¼Œ<strong>å¦‚æœæ²¡æœ‰ä»»ä½•è¿æ¥ç›¸å…³çš„æ´»åŠ¨</strong>ï¼ŒTCP ä¿æ´»æœºåˆ¶ä¼šå¼€å§‹ä½œç”¨ï¼Œæ¯éš”ä¸€ä¸ªæ—¶é—´é—´éš”ï¼Œå‘é€ä¸€ä¸ªæ¢æµ‹æŠ¥æ–‡ï¼Œè¯¥æ¢æµ‹æŠ¥æ–‡åŒ…å«çš„æ•°æ®éå¸¸å°‘ï¼Œå¦‚æœ<strong>è¿ç»­å‡ ä¸ªæ¢æµ‹æŠ¥æ–‡éƒ½æ²¡æœ‰å¾—åˆ°å“åº”</strong>ï¼Œåˆ™è®¤ä¸ºå½“<strong>å‰çš„ TCP è¿æ¥å·²ç»æ­»äº¡</strong>ï¼Œç³»ç»Ÿå†…æ ¸å°†é”™è¯¯ä¿¡æ¯é€šçŸ¥ç»™ä¸Šå±‚åº”ç”¨ç¨‹åºã€‚</p><p>åœ¨ Linux å†…æ ¸å¯ä»¥æœ‰å¯¹åº”çš„å‚æ•°å¯ä»¥è®¾ç½®ä¿æ´»æ—¶é—´ã€ä¿æ´»æ¢æµ‹çš„æ¬¡æ•°ã€ä¿æ´»æ¢æµ‹çš„æ—¶é—´é—´éš”ï¼Œä»¥ä¸‹éƒ½ä¸ºé»˜è®¤å€¼ï¼š</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token assign-left variable">net.ipv4.tcp_keepalive_time</span><span class="token operator">=</span><span class="token number">7200</span>
<span class="token assign-left variable">net.ipv4.tcp_keepalive_intvl</span><span class="token operator">=</span><span class="token number">75</span>  
<span class="token assign-left variable">net.ipv4.tcp_keepalive_probes</span><span class="token operator">=</span><span class="token number">9</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>tcp_keepalive_time=7200ï¼šè¡¨ç¤ºä¿æ´»æ—¶é—´æ˜¯ 7200 ç§’ï¼ˆ2å°æ—¶ï¼‰ï¼Œä¹Ÿå°± 2 å°æ—¶å†…å¦‚æœæ²¡æœ‰ä»»ä½•è¿æ¥ç›¸å…³çš„æ´»åŠ¨ï¼Œåˆ™ä¼šå¯åŠ¨ä¿æ´»æœºåˆ¶</li><li>tcp_keepalive_intvl=75ï¼šè¡¨ç¤ºæ¯æ¬¡æ£€æµ‹é—´éš” 75 ç§’ï¼›</li><li>tcp_keepalive_probes=9ï¼šè¡¨ç¤ºæ£€æµ‹ 9 æ¬¡æ— å“åº”ï¼Œè®¤ä¸ºå¯¹æ–¹æ˜¯ä¸å¯è¾¾çš„ï¼Œä»è€Œä¸­æ–­æœ¬æ¬¡çš„è¿æ¥ã€‚</li></ul><p>ä¹Ÿå°±æ˜¯è¯´åœ¨ Linux ç³»ç»Ÿä¸­ï¼Œæœ€å°‘éœ€è¦ç»è¿‡ 2 å°æ—¶ 11 åˆ† 15 ç§’æ‰å¯ä»¥å‘ç°ä¸€ä¸ªã€Œæ­»äº¡ã€è¿æ¥ã€‚</p><img src="`+Yt+'" alt="img" style="zoom:67%;"><p>æ³¨æ„ï¼Œåº”ç”¨ç¨‹åºè‹¥æƒ³ä½¿ç”¨ TCP ä¿æ´»æœºåˆ¶éœ€è¦é€šè¿‡ socket æ¥å£è®¾ç½® <code>SO_KEEPALIVE</code> é€‰é¡¹æ‰èƒ½å¤Ÿç”Ÿæ•ˆï¼Œå¦‚æœæ²¡æœ‰è®¾ç½®ï¼Œé‚£ä¹ˆå°±æ— æ³•ä½¿ç”¨ TCP ä¿æ´»æœºåˆ¶ã€‚</p><p>å¦‚æœ<strong>å¼€å¯äº† TCP ä¿æ´»</strong>ï¼Œéœ€è¦è€ƒè™‘ä»¥ä¸‹å‡ ç§æƒ…å†µï¼š</p><ul><li>ç¬¬ä¸€ç§ï¼Œå¯¹ç«¯ç¨‹åºæ˜¯æ­£å¸¸å·¥ä½œçš„ã€‚å½“ TCP ä¿æ´»çš„æ¢æµ‹æŠ¥æ–‡å‘é€ç»™å¯¹ç«¯, å¯¹ç«¯ä¼š<strong>æ­£å¸¸å“åº”</strong>ï¼Œè¿™æ · <strong>TCP ä¿æ´»æ—¶é—´ä¼šè¢«é‡ç½®</strong>ï¼Œç­‰å¾…<strong>ä¸‹ä¸€ä¸ª TCP ä¿æ´»æ—¶é—´çš„åˆ°æ¥ã€‚</strong></li><li>ç¬¬äºŒç§ï¼Œå¯¹ç«¯ä¸»æœºå®•æœºå¹¶é‡å¯ã€‚å½“ TCP ä¿æ´»çš„æ¢æµ‹æŠ¥æ–‡å‘é€ç»™å¯¹ç«¯åï¼Œå¯¹ç«¯æ˜¯<strong>å¯ä»¥å“åº”çš„</strong>ï¼Œä½†ç”±äº<strong>æ²¡æœ‰è¯¥è¿æ¥çš„æœ‰æ•ˆä¿¡æ¯</strong>ï¼Œ<strong>ä¼šäº§ç”Ÿä¸€ä¸ª RST æŠ¥æ–‡</strong>ï¼Œè¿™æ ·å¾ˆå¿«å°±ä¼šå‘ç° TCP è¿æ¥å·²ç»è¢«é‡ç½®ã€‚</li><li>ç¬¬ä¸‰ç§ï¼Œæ˜¯å¯¹ç«¯ä¸»æœºå®•æœºï¼ˆ<em>æ³¨æ„ä¸æ˜¯è¿›ç¨‹å´©æºƒï¼Œè¿›ç¨‹å´©æºƒåæ“ä½œç³»ç»Ÿåœ¨å›æ”¶è¿›ç¨‹èµ„æºçš„æ—¶å€™ï¼Œä¼šå‘é€ FIN æŠ¥æ–‡ï¼Œè€Œ<strong>ä¸»æœºå®•æœºåˆ™æ˜¯æ— æ³•æ„ŸçŸ¥çš„</strong>ï¼Œæ‰€ä»¥éœ€è¦ TCP ä¿æ´»æœºåˆ¶æ¥æ¢æµ‹å¯¹æ–¹æ˜¯ä¸æ˜¯å‘ç”Ÿäº†ä¸»æœºå®•æœº</em>ï¼‰ï¼Œæˆ–å¯¹ç«¯ç”±äºå…¶ä»–åŸå› å¯¼è‡´æŠ¥æ–‡ä¸å¯è¾¾ã€‚å½“ TCP ä¿æ´»çš„æ¢æµ‹æŠ¥æ–‡å‘é€ç»™å¯¹ç«¯åï¼ŒçŸ³æ²‰å¤§æµ·ï¼Œæ²¡æœ‰å“åº”ï¼Œè¿ç»­å‡ æ¬¡ï¼Œè¾¾åˆ°ä¿æ´»æ¢æµ‹æ¬¡æ•°åï¼Œ<strong>TCP ä¼šæŠ¥å‘Šè¯¥ TCP è¿æ¥å·²ç»æ­»äº¡</strong>ã€‚</li></ul><blockquote><p>TCP ä¿æ´»çš„è¿™ä¸ªæœºåˆ¶æ£€æµ‹çš„æ—¶é—´æ˜¯æœ‰ç‚¹é•¿ï¼Œæˆ‘ä»¬<strong>å¯ä»¥è‡ªå·±åœ¨åº”ç”¨å±‚å®ç°ä¸€ä¸ªå¿ƒè·³æœºåˆ¶ã€‚</strong></p></blockquote><p>æ¯”å¦‚ï¼Œweb æœåŠ¡è½¯ä»¶ä¸€èˆ¬éƒ½ä¼šæä¾› <code>keepalive_timeout</code> å‚æ•°ï¼Œç”¨æ¥æŒ‡å®š HTTP é•¿è¿æ¥çš„è¶…æ—¶æ—¶é—´ã€‚å¦‚æœè®¾ç½®äº† HTTP é•¿è¿æ¥çš„è¶…æ—¶æ—¶é—´æ˜¯ 60 ç§’ï¼Œweb æœåŠ¡è½¯ä»¶å°±ä¼š<strong>å¯åŠ¨ä¸€ä¸ªå®šæ—¶å™¨</strong>ï¼Œå¦‚æœå®¢æˆ·ç«¯åœ¨å®Œæˆä¸€ä¸ª HTTP è¯·æ±‚åï¼Œåœ¨ 60 ç§’å†…éƒ½æ²¡æœ‰å†å‘èµ·æ–°çš„è¯·æ±‚ï¼Œ<strong>å®šæ—¶å™¨çš„æ—¶é—´ä¸€åˆ°ï¼Œå°±ä¼šè§¦å‘å›è°ƒå‡½æ•°æ¥é‡Šæ”¾è¯¥è¿æ¥ã€‚</strong></p><img src="'+Ut+'" alt="web æœåŠ¡çš„ å¿ƒè·³æœºåˆ¶" style="zoom:67%;"><h4 id="å¦‚æœå·²ç»å»ºç«‹äº†è¿æ¥-ä½†æ˜¯-æœåŠ¡ç«¯çš„è¿›ç¨‹å´©æºƒ-ä¼šå‘ç”Ÿä»€ä¹ˆ" tabindex="-1"><a class="header-anchor" href="#å¦‚æœå·²ç»å»ºç«‹äº†è¿æ¥-ä½†æ˜¯-æœåŠ¡ç«¯çš„è¿›ç¨‹å´©æºƒ-ä¼šå‘ç”Ÿä»€ä¹ˆ"><span>-- å¦‚æœå·²ç»å»ºç«‹äº†è¿æ¥ï¼Œä½†æ˜¯ æœåŠ¡ç«¯çš„è¿›ç¨‹å´©æºƒ ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ</span></a></h4><p>TCP çš„è¿æ¥ä¿¡æ¯æ˜¯ç”±<strong>å†…æ ¸ç»´æŠ¤çš„</strong>ï¼Œæ‰€ä»¥<strong>å½“æœåŠ¡ç«¯çš„è¿›ç¨‹å´©æºƒå</strong>ï¼Œå†…æ ¸éœ€è¦<strong>å›æ”¶è¯¥è¿›ç¨‹</strong>çš„æ‰€æœ‰ TCP è¿æ¥èµ„æºï¼Œäºæ˜¯<strong>å†…æ ¸ä¼šå‘é€</strong>ç¬¬ä¸€æ¬¡æŒ¥æ‰‹ FIN æŠ¥æ–‡ï¼Œåç»­çš„æŒ¥æ‰‹è¿‡ç¨‹ä¹Ÿéƒ½æ˜¯<strong>åœ¨å†…æ ¸å®Œæˆ</strong>ï¼Œå¹¶ä¸éœ€è¦è¿›ç¨‹çš„å‚ä¸ï¼Œæ‰€ä»¥<strong>å³ä½¿æœåŠ¡ç«¯çš„è¿›ç¨‹é€€å‡ºäº†</strong>ï¼Œè¿˜æ˜¯<strong>èƒ½ä¸å®¢æˆ·ç«¯å®Œæˆ TCP å››æ¬¡æŒ¥æ‰‹çš„è¿‡ç¨‹ã€‚</strong></p><p>æˆ‘è‡ªå·±åšäº†ä¸ªå®éªŒï¼Œä½¿ç”¨ kill -9 æ¥æ¨¡æ‹Ÿè¿›ç¨‹å´©æºƒçš„æƒ…å†µï¼Œå‘ç°<strong>åœ¨ kill æ‰è¿›ç¨‹åï¼ŒæœåŠ¡ç«¯ä¼šå‘é€ FIN æŠ¥æ–‡ï¼Œä¸å®¢æˆ·ç«¯è¿›è¡Œå››æ¬¡æŒ¥æ‰‹</strong>ã€‚</p>',20),qi=o("p",null,[o("strong",null,"TIP")],-1),yi={href:"https://xiaolincoding.com/network/3_tcp/tcp_down_and_crash.html",target:"_blank",rel:"noopener noreferrer"},Hi={href:"https://xiaolincoding.com/network/3_tcp/tcp_unplug_the_network_cable.html",target:"_blank",rel:"noopener noreferrer"},vi=n('<h2 id="-4" tabindex="-1"><a class="header-anchor" href="#-4"><span>--------------</span></a></h2><h2 id="_4-2-tcp-é‡ä¼ ã€æ»‘åŠ¨çª—å£ã€æµé‡æ§åˆ¶ã€æ‹¥å¡æ§åˆ¶" tabindex="-1"><a class="header-anchor" href="#_4-2-tcp-é‡ä¼ ã€æ»‘åŠ¨çª—å£ã€æµé‡æ§åˆ¶ã€æ‹¥å¡æ§åˆ¶"><span>4.2 TCP é‡ä¼ ã€æ»‘åŠ¨çª—å£ã€æµé‡æ§åˆ¶ã€æ‹¥å¡æ§åˆ¶</span></a></h2><p>TCP <strong>å·¨å¤æ‚</strong>ï¼Œå®ƒä¸ºäº†ä¿è¯å¯é æ€§ï¼Œç”¨äº†å·¨å¤šçš„æœºåˆ¶æ¥ä¿è¯ï¼ŒçœŸæ˜¯ä¸ªã€Œä¼Ÿå¤§ã€çš„åè®®ï¼Œå†™ç€å†™ç€å‘ç°è¿™æ°´å¤ªæ·±äº†ã€‚ã€‚ã€‚</p><p>æœ¬æ–‡çš„å…¨éƒ¨å›¾ç‰‡éƒ½æ˜¯å°æ—ç»˜ç”»çš„ï¼Œéå¸¸çš„è¾›è‹¦ä¸”ç´¯ï¼Œä¸åºŸè¯äº†ï¼Œç›´æ¥è¿›å…¥æ­£æ–‡ï¼ŒGoï¼</p><p>ç›¸ä¿¡å¤§å®¶éƒ½çŸ¥é“ TCP æ˜¯ä¸€ä¸ªå¯é ä¼ è¾“çš„åè®®ï¼Œé‚£å®ƒæ˜¯å¦‚ä½•ä¿è¯å¯é çš„å‘¢ï¼Ÿ</p><p>ä¸ºäº†å®ç°å¯é æ€§ä¼ è¾“ï¼Œéœ€è¦è€ƒè™‘å¾ˆå¤šäº‹æƒ…ï¼Œä¾‹å¦‚æ•°æ®çš„ç ´åã€ä¸¢åŒ…ã€é‡å¤ä»¥åŠåˆ†ç‰‡é¡ºåºæ··ä¹±ç­‰é—®é¢˜ã€‚å¦‚ä¸èƒ½è§£å†³è¿™äº›é—®é¢˜ï¼Œä¹Ÿå°±æ— ä»è°ˆèµ·å¯é ä¼ è¾“ã€‚</p><blockquote><p>é‚£ä¹ˆï¼ŒTCP æ˜¯é€šè¿‡<strong>åºåˆ—å·ã€ç¡®è®¤åº”ç­”ã€é‡å‘æ§åˆ¶ã€è¿æ¥ç®¡ç†ä»¥åŠçª—å£æ§åˆ¶</strong>ç­‰æœºåˆ¶å®ç°å¯é æ€§ä¼ è¾“çš„ã€‚</p></blockquote><p>ä»Šå¤©ï¼Œå°†é‡ç‚¹ä»‹ç» TCP çš„<strong>é‡ä¼ æœºåˆ¶ã€æ»‘åŠ¨çª—å£ã€æµé‡æ§åˆ¶ã€æ‹¥å¡æ§åˆ¶ã€‚</strong></p><img src="'+Ft+'" alt="img" style="zoom:67%;"><h3 id="_4-2-1-é‡ä¼ æœºåˆ¶" tabindex="-1"><a class="header-anchor" href="#_4-2-1-é‡ä¼ æœºåˆ¶"><span>4.2.1 é‡ä¼ æœºåˆ¶</span></a></h3><p>TCP å®ç°å¯é ä¼ è¾“çš„æ–¹å¼ä¹‹ä¸€ï¼Œæ˜¯<strong>é€šè¿‡åºåˆ—å·ä¸ç¡®è®¤åº”ç­”ã€‚</strong></p><p>åœ¨ TCP ä¸­ï¼Œå½“å‘é€ç«¯çš„æ•°æ®åˆ°è¾¾æ¥æ”¶ä¸»æœºæ—¶ï¼Œæ¥æ”¶ç«¯ä¸»æœºä¼š<strong>è¿”å›ä¸€ä¸ªç¡®è®¤åº”ç­”æ¶ˆæ¯</strong>ï¼Œè¡¨ç¤º<strong>å·²æ”¶åˆ°æ¶ˆæ¯ã€‚</strong></p><img src="'+jt+'" alt="æ­£å¸¸çš„æ•°æ®ä¼ è¾“" style="zoom:67%;"><p>ä½†åœ¨é”™ç»¼å¤æ‚çš„ç½‘ç»œï¼Œå¹¶ä¸ä¸€å®šèƒ½å¦‚ä¸Šå›¾é‚£ä¹ˆé¡ºåˆ©èƒ½æ­£å¸¸çš„æ•°æ®ä¼ è¾“ï¼Œä¸‡ä¸€æ•°æ®åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­ä¸¢å¤±äº†å‘¢ï¼Ÿ</p><blockquote><p>æ‰€ä»¥ TCP é’ˆå¯¹æ•°æ®åŒ…ä¸¢å¤±çš„æƒ…å†µï¼Œä¼šç”¨<strong>é‡ä¼ æœºåˆ¶</strong>è§£å†³ã€‚</p></blockquote><p>æ¥ä¸‹æ¥è¯´è¯´å¸¸è§çš„é‡ä¼ æœºåˆ¶ï¼š</p><ul><li>è¶…æ—¶é‡ä¼ </li><li>å¿«é€Ÿé‡ä¼ </li><li>SACK</li><li>D-SACK</li></ul><h4 id="è¶…æ—¶é‡ä¼ " tabindex="-1"><a class="header-anchor" href="#è¶…æ—¶é‡ä¼ "><span>- è¶…æ—¶é‡ä¼ </span></a></h4><p>é‡ä¼ æœºåˆ¶çš„å…¶ä¸­ä¸€ä¸ªæ–¹å¼ï¼Œå°±æ˜¯åœ¨<strong>å‘é€æ•°æ®æ—¶ï¼Œè®¾å®šä¸€ä¸ªå®šæ—¶å™¨</strong>ï¼Œå½“è¶…è¿‡æŒ‡å®šçš„æ—¶é—´å**ï¼Œæ²¡æœ‰æ”¶åˆ°å¯¹æ–¹çš„ <code>ACK</code> ç¡®è®¤åº”ç­”æŠ¥æ–‡**ï¼Œå°±ä¼šé‡å‘è¯¥æ•°æ®ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬å¸¸è¯´çš„<strong>è¶…æ—¶é‡ä¼ </strong>ã€‚</p><blockquote><p>TCP ä¼šåœ¨ä»¥ä¸‹ä¸¤ç§æƒ…å†µå‘ç”Ÿè¶…æ—¶é‡ä¼ ï¼š</p><ul><li>æ•°æ®åŒ…ä¸¢å¤±</li><li>ç¡®è®¤åº”ç­”ä¸¢å¤±</li></ul></blockquote><img src="'+Wt+'" alt="è¶…æ—¶é‡ä¼ çš„ä¸¤ç§æƒ…å†µ" style="zoom:67%;"><blockquote><p>è¶…æ—¶æ—¶é—´åº”è¯¥è®¾ç½®ä¸ºå¤šå°‘å‘¢ï¼Ÿ</p></blockquote><p>æˆ‘ä»¬å…ˆæ¥äº†è§£ä¸€ä¸‹ä»€ä¹ˆæ˜¯ <code>RTT</code>ï¼ˆRound-Trip Time å¾€è¿”æ—¶å»¶ï¼‰ï¼Œä»ä¸‹å›¾æˆ‘ä»¬å°±å¯ä»¥çŸ¥é“ï¼š</p><img src="'+Bt+'" alt="RTT" style="zoom:67%;"><p><code>RTT</code> æŒ‡çš„æ˜¯<strong>æ•°æ®å‘é€æ—¶åˆ»åˆ°æ¥æ”¶åˆ°ç¡®è®¤çš„æ—¶åˆ»çš„å·®å€¼</strong>ï¼Œä¹Ÿå°±æ˜¯<strong>åŒ…çš„å¾€è¿”æ—¶é—´ã€‚</strong></p><p>è¶…æ—¶é‡ä¼ æ—¶é—´æ˜¯ä»¥ <code>RTO</code> ï¼ˆRetransmission Timeout <strong>è¶…æ—¶é‡ä¼ æ—¶é—´</strong>ï¼‰è¡¨ç¤ºã€‚</p><p>å‡è®¾åœ¨é‡ä¼ çš„æƒ…å†µä¸‹ï¼Œè¶…æ—¶æ—¶é—´ <code>RTO</code> ã€Œè¾ƒé•¿æˆ–è¾ƒçŸ­ã€æ—¶ï¼Œä¼šå‘ç”Ÿä»€ä¹ˆäº‹æƒ…å‘¢ï¼Ÿ</p><img src="'+Ot+'" alt="è¶…æ—¶æ—¶é—´è¾ƒé•¿ä¸è¾ƒçŸ­" style="zoom:67%;"><p>ä¸Šå›¾ä¸­æœ‰ä¸¤ç§è¶…æ—¶æ—¶é—´ä¸åŒçš„æƒ…å†µï¼š</p><ul><li>å½“è¶…æ—¶æ—¶é—´ <strong>RTO è¾ƒå¤§</strong>æ—¶ï¼Œ<strong>é‡å‘å°±æ…¢</strong>ï¼Œä¸¢äº†è€åŠå¤©æ‰é‡å‘ï¼Œ<strong>æ²¡æœ‰æ•ˆç‡ï¼Œæ€§èƒ½å·®</strong>ï¼›</li><li>å½“è¶…æ—¶æ—¶é—´ <strong>RTO è¾ƒå°</strong>æ—¶ï¼Œä¼šå¯¼è‡´å¯èƒ½<strong>å¹¶æ²¡æœ‰ä¸¢å°±é‡å‘ï¼Œäºæ˜¯é‡å‘çš„å°±å¿«</strong>ï¼Œä¼š<strong>å¢åŠ ç½‘ç»œæ‹¥å¡</strong>ï¼Œ<strong>å¯¼è‡´æ›´å¤šçš„è¶…æ—¶</strong>ï¼Œæ›´å¤šçš„è¶…æ—¶å¯¼è‡´æ›´å¤šçš„é‡å‘ã€‚</li></ul><blockquote><p>ç²¾ç¡®çš„æµ‹é‡è¶…æ—¶æ—¶é—´ <code>RTO</code> çš„å€¼æ˜¯éå¸¸é‡è¦çš„ï¼Œè¿™å¯è®©æˆ‘ä»¬çš„é‡ä¼ æœºåˆ¶æ›´é«˜æ•ˆã€‚</p></blockquote><p>æ ¹æ®ä¸Šè¿°çš„ä¸¤ç§æƒ…å†µï¼Œæˆ‘ä»¬å¯ä»¥å¾—çŸ¥ï¼Œ<strong>è¶…æ—¶é‡ä¼ æ—¶é—´ RTO çš„å€¼åº”è¯¥<code>ç•¥å¤§äº</code>æŠ¥æ–‡å¾€è¿” RTT çš„å€¼</strong>ã€‚</p><img src="'+Qt+'" alt="RTO åº”ç•¥å¤§äº RTT" style="zoom:67%;"><p>è‡³æ­¤ï¼Œå¯èƒ½å¤§å®¶è§‰å¾—è¶…æ—¶é‡ä¼ æ—¶é—´ <code>RTO</code> çš„å€¼è®¡ç®—ï¼Œä¹Ÿä¸æ˜¯å¾ˆå¤æ‚å˜›ã€‚</p><p>å¥½åƒå°±æ˜¯åœ¨å‘é€ç«¯å‘åŒ…æ—¶è®°ä¸‹ <code>t0</code> ï¼Œç„¶åæ¥æ”¶ç«¯å†æŠŠè¿™ä¸ª <code>ack</code> å›æ¥æ—¶å†è®°ä¸€ä¸ª <code>t1</code>ï¼Œäºæ˜¯ <code>RTT = t1 â€“ t0</code>ã€‚æ²¡é‚£ä¹ˆç®€å•ï¼Œ<strong>è¿™åªæ˜¯ä¸€ä¸ªé‡‡æ ·ï¼Œä¸èƒ½ä»£è¡¨æ™®éæƒ…å†µ</strong>ã€‚</p><p>å®é™…ä¸Š**ã€ŒæŠ¥æ–‡å¾€è¿” RTT çš„å€¼ã€æ˜¯ç»å¸¸å˜åŒ–çš„**ï¼Œå› ä¸ºæˆ‘ä»¬çš„ç½‘ç»œä¹Ÿæ˜¯æ—¶å¸¸å˜åŒ–çš„ã€‚ä¹Ÿå°±å› ä¸ºã€ŒæŠ¥æ–‡å¾€è¿” RTT çš„å€¼ã€ æ˜¯ç»å¸¸æ³¢åŠ¨å˜åŒ–çš„ï¼Œæ‰€ä»¥ã€Œè¶…æ—¶é‡ä¼ æ—¶é—´ RTO çš„å€¼ã€åº”è¯¥æ˜¯ä¸€ä¸ª<strong>åŠ¨æ€å˜åŒ–çš„å€¼</strong>ã€‚</p><p>æˆ‘ä»¬æ¥çœ‹çœ‹ Linux æ˜¯å¦‚ä½•è®¡ç®— <code>RTO</code> çš„å‘¢ï¼Ÿ</p><p>ä¼°è®¡å¾€è¿”æ—¶é—´ï¼Œé€šå¸¸éœ€è¦é‡‡æ ·ä»¥ä¸‹ä¸¤ä¸ªï¼š</p><ul><li>éœ€è¦ TCP é€šè¿‡é‡‡æ · RTT çš„æ—¶é—´ï¼Œç„¶åè¿›è¡Œ<strong>åŠ æƒå¹³å‡</strong>ï¼Œç®—å‡ºä¸€ä¸ªå¹³æ»‘ RTT çš„å€¼ï¼Œè€Œä¸”è¿™ä¸ªå€¼è¿˜æ˜¯è¦ä¸æ–­å˜åŒ–çš„ï¼Œå› ä¸ºç½‘ç»œçŠ¶å†µä¸æ–­åœ°å˜åŒ–ã€‚</li><li>é™¤äº†é‡‡æ · RTTï¼Œè¿˜è¦é‡‡æ · RTT çš„<strong>æ³¢åŠ¨èŒƒå›´</strong>ï¼Œè¿™æ ·å°±é¿å…å¦‚æœ RTT æœ‰ä¸€ä¸ªå¤§çš„æ³¢åŠ¨çš„è¯ï¼Œå¾ˆéš¾è¢«å‘ç°çš„æƒ…å†µã€‚</li></ul><p>RFC6289 å»ºè®®ä½¿ç”¨ä»¥ä¸‹çš„å…¬å¼è®¡ç®— RTOï¼š</p><img src="'+Gt+'" alt="RFC6289 å»ºè®®çš„ RTO è®¡ç®— " style="zoom:67%;"><p>å…¶ä¸­ <code>SRTT</code> æ˜¯è®¡ç®—å¹³æ»‘çš„RTT ï¼Œ<code>DevRTR</code> æ˜¯è®¡ç®—å¹³æ»‘çš„RTT ä¸ æœ€æ–° RTT çš„å·®è·ã€‚</p><p>åœ¨ Linux ä¸‹ï¼Œ<strong>Î± = 0.125ï¼ŒÎ² = 0.25ï¼Œ Î¼ = 1ï¼Œâˆ‚ = 4</strong>ã€‚åˆ«é—®æ€ä¹ˆæ¥çš„ï¼Œé—®å°±æ˜¯å¤§é‡å®éªŒä¸­è°ƒå‡ºæ¥çš„ã€‚</p><p>å¦‚æœè¶…æ—¶é‡å‘çš„æ•°æ®ï¼Œ<strong>å†æ¬¡è¶…æ—¶</strong>çš„æ—¶å€™ï¼Œåˆéœ€è¦é‡ä¼ çš„æ—¶å€™ï¼ŒTCP çš„ç­–ç•¥æ˜¯<strong>è¶…æ—¶é—´éš”åŠ å€ã€‚</strong></p><p>ä¹Ÿå°±æ˜¯<strong>æ¯å½“é‡åˆ°ä¸€æ¬¡è¶…æ—¶é‡ä¼ çš„æ—¶å€™ï¼Œéƒ½ä¼šå°†ä¸‹ä¸€æ¬¡è¶…æ—¶æ—¶é—´é—´éš”è®¾ä¸ºå…ˆå‰å€¼çš„ä¸¤å€ã€‚ä¸¤æ¬¡è¶…æ—¶ï¼Œå°±è¯´æ˜ç½‘ç»œç¯å¢ƒå·®ï¼Œä¸å®œé¢‘ç¹åå¤å‘é€ã€‚</strong></p><p><strong>è¶…æ—¶è§¦å‘é‡ä¼ </strong>å­˜åœ¨çš„é—®é¢˜æ˜¯ï¼Œè¶…æ—¶å‘¨æœŸå¯èƒ½ç›¸å¯¹è¾ƒé•¿ã€‚é‚£æ˜¯ä¸æ˜¯å¯ä»¥æœ‰<strong>æ›´å¿«çš„æ–¹å¼å‘¢ï¼Ÿ</strong></p><p>äºæ˜¯å°±å¯ä»¥ç”¨ã€Œå¿«é€Ÿé‡ä¼ ã€æœºåˆ¶<strong>æ¥è§£å†³è¶…æ—¶é‡å‘çš„æ—¶é—´ç­‰å¾…ã€‚</strong></p><h4 id="å¿«é€Ÿé‡ä¼ " tabindex="-1"><a class="header-anchor" href="#å¿«é€Ÿé‡ä¼ "><span>- å¿«é€Ÿé‡ä¼ </span></a></h4><blockquote><p>TCP è¿˜æœ‰å¦å¤–ä¸€ç§<strong>å¿«é€Ÿé‡ä¼ ï¼ˆFast Retransmitï¼‰æœºåˆ¶</strong>ï¼Œå®ƒ<strong>ä¸ä»¥æ—¶é—´ä¸ºé©±åŠ¨ï¼Œè€Œæ˜¯ä»¥æ•°æ®é©±åŠ¨é‡ä¼ </strong>ã€‚</p></blockquote><p>å¿«é€Ÿé‡ä¼ æœºåˆ¶ï¼Œæ˜¯å¦‚ä½•å·¥ä½œçš„å‘¢ï¼Ÿå…¶å®å¾ˆç®€å•ï¼Œä¸€å›¾èƒœåƒè¨€ã€‚</p><img src="'+Vt+'" alt="å¿«é€Ÿé‡ä¼ æœºåˆ¶" style="zoom:80%;"><p>åœ¨ä¸Šå›¾ï¼Œå‘é€æ–¹å‘å‡ºäº† 1ï¼Œ2ï¼Œ3ï¼Œ4ï¼Œ5 ä»½æ•°æ®ï¼š</p><ul><li>ç¬¬ä¸€ä»½ Seq1 å…ˆé€åˆ°äº†ï¼Œäºæ˜¯å°± Ack å› 2ï¼›</li><li>ç»“æœ Seq2 å› ä¸ºæŸäº›åŸå› æ²¡æ”¶åˆ°ï¼ŒSeq3 åˆ°è¾¾äº†ï¼Œäºæ˜¯è¿˜æ˜¯ Ack å› 2ï¼›</li><li>åé¢çš„ Seq4 å’Œ Seq5 éƒ½åˆ°äº†ï¼Œä½†è¿˜æ˜¯ Ack å› 2ï¼Œå› ä¸º Seq2 è¿˜æ˜¯æ²¡æœ‰æ”¶åˆ°ï¼›</li><li><strong>å‘é€ç«¯æ”¶åˆ°äº†ä¸‰ä¸ª Ack = 2 çš„ç¡®è®¤ï¼ŒçŸ¥é“äº† Seq2 è¿˜æ²¡æœ‰æ”¶åˆ°ï¼Œå°±ä¼šåœ¨å®šæ—¶å™¨è¿‡æœŸä¹‹å‰ï¼Œé‡ä¼ ä¸¢å¤±çš„ Seq2ã€‚</strong></li><li>æœ€åï¼Œæ”¶åˆ°äº† Seq2ï¼Œæ­¤æ—¶å› ä¸º Seq3ï¼ŒSeq4ï¼ŒSeq5 éƒ½æ”¶åˆ°äº†ï¼Œäºæ˜¯ Ack å› 6 ã€‚</li></ul><blockquote><p>æ‰€ä»¥ï¼Œå¿«é€Ÿé‡ä¼ çš„å·¥ä½œæ–¹å¼æ˜¯å½“æ”¶åˆ°<strong>ä¸‰ä¸ªç›¸åŒçš„ ACK æŠ¥æ–‡æ—¶</strong>ï¼Œä¼šåœ¨å®šæ—¶å™¨è¿‡æœŸ<strong>ä¹‹å‰</strong>ï¼Œé‡ä¼ ä¸¢å¤±çš„æŠ¥æ–‡æ®µã€‚</p></blockquote><p>å¿«é€Ÿé‡ä¼ æœºåˆ¶åªè§£å†³äº†ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯è¶…æ—¶æ—¶é—´çš„é—®é¢˜ï¼Œä½†æ˜¯å®ƒä¾ç„¶é¢ä¸´ç€å¦å¤–ä¸€ä¸ªé—®é¢˜ã€‚å°±æ˜¯<strong>é‡ä¼ çš„æ—¶å€™ï¼Œæ˜¯é‡ä¼ ä¸€ä¸ªï¼Œè¿˜æ˜¯é‡ä¼ æ‰€æœ‰çš„é—®é¢˜ã€‚</strong></p><p>ä¸¾ä¸ªä¾‹å­ï¼Œå‡è®¾å‘é€æ–¹å‘äº† 6 ä¸ªæ•°æ®ï¼Œç¼–å·çš„é¡ºåºæ˜¯ Seq1 ~ Seq6 ï¼Œä½†æ˜¯ Seq2ã€Seq3 éƒ½ä¸¢å¤±äº†ï¼Œé‚£ä¹ˆæ¥æ”¶æ–¹åœ¨æ”¶åˆ° Seq4ã€Seq5ã€Seq6 æ—¶ï¼Œéƒ½æ˜¯å›å¤ ACK2 ç»™å‘é€æ–¹ï¼Œä½†æ˜¯å‘é€æ–¹å¹¶ä¸æ¸…æ¥šè¿™è¿ç»­çš„ ACK2 æ˜¯æ¥æ”¶æ–¹æ”¶åˆ°å“ªä¸ªæŠ¥æ–‡è€Œå›å¤çš„ï¼Œ é‚£æ˜¯é€‰æ‹©é‡ä¼  Seq2 ä¸€ä¸ªæŠ¥æ–‡ï¼Œè¿˜æ˜¯é‡ä¼  Seq2 ä¹‹åå·²å‘é€çš„æ‰€æœ‰æŠ¥æ–‡å‘¢ï¼ˆSeq2ã€Seq3ã€ Seq4ã€Seq5ã€ Seq6ï¼‰ å‘¢ï¼Ÿ</p><ul><li>å¦‚æœåªé€‰æ‹©é‡ä¼  Seq2 ä¸€ä¸ªæŠ¥æ–‡ï¼Œé‚£ä¹ˆ<strong>é‡ä¼ çš„æ•ˆç‡å¾ˆä½</strong>ã€‚å› ä¸ºå¯¹äºä¸¢å¤±çš„ Seq3 æŠ¥æ–‡ï¼Œè¿˜å¾—åœ¨åç»­æ”¶åˆ°ä¸‰ä¸ªé‡å¤çš„ ACK3 æ‰èƒ½è§¦å‘é‡ä¼ ã€‚</li><li>å¦‚æœé€‰æ‹©é‡ä¼  Seq2 ä¹‹åå·²å‘é€çš„æ‰€æœ‰æŠ¥æ–‡ï¼Œè™½ç„¶èƒ½åŒæ—¶é‡ä¼ å·²ä¸¢å¤±çš„ Seq2 å’Œ Seq3 æŠ¥æ–‡ï¼Œä½†æ˜¯ Seq4ã€Seq5ã€Seq6 çš„æŠ¥æ–‡æ˜¯å·²ç»è¢«æ¥æ”¶è¿‡äº†ï¼Œå¯¹äºé‡ä¼  Seq4 ï½Seq6 æŠ˜éƒ¨åˆ†æ•°æ®ç›¸å½“äºåšäº†ä¸€æ¬¡æ— ç”¨åŠŸï¼Œ<strong>æµªè´¹èµ„æº</strong>ã€‚</li></ul><p><strong>å¯ä»¥çœ‹åˆ°ï¼Œä¸ç®¡æ˜¯é‡ä¼ ä¸€ä¸ªæŠ¥æ–‡ï¼Œè¿˜æ˜¯é‡ä¼ å·²å‘é€çš„æŠ¥æ–‡ï¼Œéƒ½å­˜åœ¨é—®é¢˜ã€‚</strong></p><p><strong>ä¸ºäº†è§£å†³ä¸çŸ¥é“è¯¥é‡ä¼ å“ªäº› TCP æŠ¥æ–‡</strong>ï¼Œäºæ˜¯å°±æœ‰ <code>SACK</code> æ–¹æ³•ã€‚</p><h4 id="sack-æ–¹æ³•" tabindex="-1"><a class="header-anchor" href="#sack-æ–¹æ³•"><span>- SACK æ–¹æ³•</span></a></h4><p>è¿˜æœ‰ä¸€ç§å®ç°é‡ä¼ æœºåˆ¶çš„æ–¹å¼å«ï¼š<code>SACK</code>ï¼ˆ Selective Acknowledgmentï¼‰ï¼Œ <strong>é€‰æ‹©æ€§ç¡®è®¤</strong>ã€‚</p><p>è¿™ç§æ–¹å¼éœ€è¦<strong>åœ¨ TCP å¤´éƒ¨ã€Œé€‰é¡¹ã€å­—æ®µé‡Œ</strong>åŠ ä¸€ä¸ª <code>SACK</code> çš„ä¸œè¥¿ï¼Œå®ƒ<strong>å¯ä»¥å°†å·²æ”¶åˆ°çš„æ•°æ®çš„ä¿¡æ¯å‘é€ç»™ã€Œå‘é€æ–¹ã€</strong>ï¼Œè¿™æ ·å‘é€æ–¹å°±å¯ä»¥<strong>çŸ¥é“å“ªäº›æ•°æ®æ”¶åˆ°äº†ï¼Œå“ªäº›æ•°æ®æ²¡æ”¶åˆ°</strong>ï¼ŒçŸ¥é“äº†è¿™äº›ä¿¡æ¯ï¼Œå°±å¯ä»¥<strong>åªé‡ä¼ ä¸¢å¤±çš„æ•°æ®</strong>ã€‚</p><p>å¦‚ä¸‹å›¾ï¼Œå‘é€æ–¹æ”¶åˆ°äº†ä¸‰æ¬¡åŒæ ·çš„ ACK ç¡®è®¤æŠ¥æ–‡ï¼Œäºæ˜¯å°±ä¼š<strong>è§¦å‘å¿«é€Ÿé‡å‘æœºåˆ¶</strong>ï¼Œé€šè¿‡ <code>SACK</code> ä¿¡æ¯å‘ç°åªæœ‰ <code>200~299</code> è¿™æ®µæ•°æ®ä¸¢å¤±ï¼Œåˆ™é‡å‘æ—¶ï¼Œ<strong>å°±åªé€‰æ‹©äº†è¿™ä¸ª TCP æ®µè¿›è¡Œé‡å¤ã€‚</strong></p><img src="'+Xt+'" alt="é€‰æ‹©æ€§ç¡®è®¤" style="zoom:67%;"><p>å¦‚æœè¦æ”¯æŒ <code>SACK</code>ï¼Œ<strong>å¿…é¡»åŒæ–¹éƒ½è¦æ”¯æŒ</strong>ã€‚åœ¨ Linux ä¸‹ï¼Œå¯ä»¥é€šè¿‡ <code>net.ipv4.tcp_sack</code> å‚æ•°æ‰“å¼€è¿™ä¸ªåŠŸèƒ½ï¼ˆLinux 2.4 åé»˜è®¤æ‰“å¼€ï¼‰ã€‚</p><h4 id="duplicate-sack" tabindex="-1"><a class="header-anchor" href="#duplicate-sack"><span>- Duplicate SACK</span></a></h4><p>Duplicate SACK åˆç§° <code>D-SACK</code>ï¼Œå…¶ä¸»è¦<strong>ä½¿ç”¨äº† SACK æ¥å‘Šè¯‰ã€Œå‘é€æ–¹ã€æœ‰å“ªäº›æ•°æ®è¢«é‡å¤æ¥æ”¶äº†ã€‚</strong></p><p>ä¸‹é¢ä¸¾ä¾‹ä¸¤ä¸ªæ —å­ï¼Œæ¥è¯´æ˜ <code>D-SACK</code> çš„ä½œç”¨ã€‚</p><p><em>æ —å­ä¸€å·ï¼šACK ä¸¢åŒ…</em></p><figure><img src="'+Zt+'" alt="ACK ä¸¢åŒ…" tabindex="0" loading="lazy"><figcaption>ACK ä¸¢åŒ…</figcaption></figure><ul><li>ã€Œæ¥æ”¶æ–¹ã€å‘ç»™ã€Œå‘é€æ–¹ã€çš„<strong>ä¸¤ä¸ª ACK ç¡®è®¤åº”ç­”éƒ½ä¸¢å¤±äº†</strong>ï¼Œæ‰€ä»¥å‘é€æ–¹è¶…æ—¶åï¼Œé‡ä¼ ç¬¬ä¸€ä¸ªæ•°æ®åŒ…ï¼ˆ3000 ~ 3499ï¼‰</li><li><strong>äºæ˜¯ã€Œæ¥æ”¶æ–¹ã€å‘ç°æ•°æ®æ˜¯é‡å¤æ”¶åˆ°çš„ï¼Œäºæ˜¯å›äº†ä¸€ä¸ª SACK = 3000~3500</strong>ï¼Œå‘Šè¯‰ã€Œå‘é€æ–¹ã€ 3000~3500 çš„æ•°æ®æ—©å·²è¢«æ¥æ”¶äº†ï¼Œå› ä¸º ACK éƒ½åˆ°äº† 4000 äº†ï¼Œå·²ç»æ„å‘³ç€ 4000 ä¹‹å‰çš„æ‰€æœ‰æ•°æ®éƒ½å·²æ”¶åˆ°ï¼Œæ‰€ä»¥è¿™ä¸ª SACK å°±ä»£è¡¨ç€ <code>D-SACK</code>ã€‚</li><li>è¿™æ ·ã€Œå‘é€æ–¹ã€å°±çŸ¥é“äº†ï¼Œ<strong>æ•°æ®æ²¡æœ‰ä¸¢ï¼Œæ˜¯ã€Œæ¥æ”¶æ–¹ã€çš„ ACK ç¡®è®¤æŠ¥æ–‡ä¸¢äº†ã€‚</strong></li></ul><p><em>æ —å­äºŒå·ï¼šç½‘ç»œå»¶æ—¶</em></p><figure><img src="'+Jt+'" alt="ç½‘ç»œå»¶æ—¶" tabindex="0" loading="lazy"><figcaption>ç½‘ç»œå»¶æ—¶</figcaption></figure><ul><li>æ•°æ®åŒ…ï¼ˆ1000~1499ï¼‰ è¢«ç½‘ç»œå»¶è¿Ÿäº†ï¼Œå¯¼è‡´ã€Œå‘é€æ–¹ã€æ²¡æœ‰æ”¶åˆ° Ack 1500 çš„ç¡®è®¤æŠ¥æ–‡ã€‚</li><li>è€Œåé¢æŠ¥æ–‡åˆ°è¾¾çš„ä¸‰ä¸ªç›¸åŒçš„ ACK ç¡®è®¤æŠ¥æ–‡ï¼Œå°±è§¦å‘äº†å¿«é€Ÿé‡ä¼ æœºåˆ¶ï¼Œä½†æ˜¯åœ¨é‡ä¼ åï¼Œè¢«å»¶è¿Ÿçš„æ•°æ®åŒ…ï¼ˆ1000~1499ï¼‰åˆåˆ°äº†ã€Œæ¥æ”¶æ–¹ã€ï¼›</li><li><strong>æ‰€ä»¥ã€Œæ¥æ”¶æ–¹ã€å›äº†ä¸€ä¸ª SACK=1000~1500ï¼Œå› ä¸º ACK å·²ç»åˆ°äº† 3000ï¼Œæ‰€ä»¥è¿™ä¸ª SACK æ˜¯ D-SACKï¼Œè¡¨ç¤ºæ”¶åˆ°äº†é‡å¤çš„åŒ…ã€‚</strong></li><li>è¿™æ ·å‘é€æ–¹å°±<strong>çŸ¥é“å¿«é€Ÿé‡ä¼ è§¦å‘çš„åŸå› </strong>ä¸æ˜¯å‘å‡ºå»çš„åŒ…ä¸¢äº†ï¼Œä¹Ÿä¸æ˜¯å› ä¸ºå›åº”çš„ ACK åŒ…ä¸¢äº†ï¼Œè€Œæ˜¯å› ä¸ºç½‘ç»œå»¶è¿Ÿäº†ã€‚</li></ul><blockquote><p>å¯è§ï¼Œ<code>D-SACK</code> æœ‰è¿™ä¹ˆå‡ ä¸ªå¥½å¤„ï¼š</p><ol><li>å¯ä»¥è®©ã€Œå‘é€æ–¹ã€çŸ¥é“ï¼Œ<strong>æ˜¯å‘å‡ºå»çš„åŒ…ä¸¢äº†</strong>ï¼Œ<strong>è¿˜æ˜¯æ¥æ”¶æ–¹å›åº”çš„ ACK åŒ…ä¸¢äº†;</strong></li><li>å¯ä»¥çŸ¥é“<strong>æ˜¯ä¸æ˜¯ã€Œå‘é€æ–¹ã€çš„æ•°æ®åŒ…è¢«ç½‘ç»œå»¶è¿Ÿäº†;</strong></li><li>å¯ä»¥çŸ¥é“ç½‘ç»œä¸­æ˜¯ä¸æ˜¯<strong>æŠŠã€Œå‘é€æ–¹ã€çš„æ•°æ®åŒ…ç»™å¤åˆ¶äº†;</strong></li></ol></blockquote><p>åœ¨ Linux ä¸‹å¯ä»¥é€šè¿‡ <code>net.ipv4.tcp_dsack</code> å‚æ•°å¼€å¯/å…³é—­è¿™ä¸ªåŠŸèƒ½ï¼ˆLinux 2.4 åé»˜è®¤æ‰“å¼€ï¼‰ã€‚</p><h3 id="_4-2-2-æ»‘åŠ¨çª—å£" tabindex="-1"><a class="header-anchor" href="#_4-2-2-æ»‘åŠ¨çª—å£"><span>4.2.2 æ»‘åŠ¨çª—å£</span></a></h3><blockquote><p>å¼•å…¥çª—å£æ¦‚å¿µçš„åŸå› :</p></blockquote><p><strong>æˆ‘ä»¬éƒ½çŸ¥é“ TCP æ˜¯æ¯å‘é€ä¸€ä¸ªæ•°æ®ï¼Œéƒ½è¦è¿›è¡Œä¸€æ¬¡ç¡®è®¤åº”ç­”ã€‚å½“ä¸Šä¸€ä¸ªæ•°æ®åŒ…æ”¶åˆ°äº†åº”ç­”äº†ï¼Œ å†å‘é€ä¸‹ä¸€ä¸ªã€‚</strong></p><p>è¿™ä¸ªæ¨¡å¼å°±æœ‰ç‚¹åƒæˆ‘å’Œä½ é¢å¯¹é¢èŠå¤©ï¼Œä½ ä¸€å¥æˆ‘ä¸€å¥ã€‚ä½†è¿™ç§æ–¹å¼çš„<strong>ç¼ºç‚¹æ˜¯æ•ˆç‡æ¯”è¾ƒä½çš„</strong>ã€‚</p><p>å¦‚æœä½ è¯´å®Œä¸€å¥è¯ï¼Œæˆ‘åœ¨å¤„ç†å…¶ä»–äº‹æƒ…ï¼Œæ²¡æœ‰åŠæ—¶å›å¤ä½ ï¼Œé‚£ä½ ä¸æ˜¯è¦å¹²ç­‰ç€æˆ‘åšå®Œå…¶ä»–äº‹æƒ…åï¼Œæˆ‘å›å¤ä½ ï¼Œä½ æ‰èƒ½è¯´ä¸‹ä¸€å¥è¯ï¼Œå¾ˆæ˜¾ç„¶è¿™ä¸ç°å®ã€‚</p><img src="'+$t+'" alt="æŒ‰æ•°æ®åŒ…è¿›è¡Œç¡®è®¤åº”ç­”" style="zoom:80%;"><p>æ‰€ä»¥ï¼Œè¿™æ ·çš„ä¼ è¾“æ–¹å¼æœ‰ä¸€ä¸ªç¼ºç‚¹ï¼šæ•°æ®åŒ…çš„<strong>å¾€è¿”æ—¶é—´è¶Šé•¿ï¼Œé€šä¿¡çš„æ•ˆç‡å°±è¶Šä½</strong>ã€‚</p><p>ä¸ºè§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒTCP å¼•å…¥äº†<strong>çª—å£</strong>è¿™ä¸ªæ¦‚å¿µã€‚<strong>å³ä½¿åœ¨å¾€è¿”æ—¶é—´è¾ƒé•¿çš„æƒ…å†µä¸‹ï¼Œå®ƒä¹Ÿä¸ä¼šé™ä½ç½‘ç»œé€šä¿¡çš„æ•ˆç‡ã€‚</strong></p><blockquote><p>é‚£ä¹ˆæœ‰äº†çª—å£ï¼Œå°±å¯ä»¥æŒ‡å®š<strong>çª—å£å¤§å°</strong>ï¼Œçª—å£å¤§å°å°±æ˜¯æŒ‡<strong>æ— éœ€ç­‰å¾…ç¡®è®¤åº”ç­”ï¼Œè€Œå¯ä»¥ç»§ç»­å‘é€æ•°æ®çš„æœ€å¤§å€¼</strong>ã€‚</p><p><strong>çª—å£çš„å®ç°å®é™…ä¸Šæ˜¯æ“ä½œç³»ç»Ÿå¼€è¾Ÿçš„ä¸€ä¸ª<code>ç¼“å­˜ç©ºé—´</code></strong>ï¼Œå‘é€æ–¹ä¸»æœº<strong>åœ¨ç­‰åˆ°ç¡®è®¤åº”ç­”è¿”å›ä¹‹å‰</strong>ï¼Œå¿…é¡»<strong>åœ¨ç¼“å†²åŒºä¸­ä¿ç•™å·²å‘é€çš„æ•°æ®</strong>ã€‚å¦‚æœæŒ‰æœŸæ”¶åˆ°ç¡®è®¤åº”ç­”ï¼Œ<strong>æ­¤æ—¶æ•°æ®å°±å¯ä»¥ä»ç¼“å­˜åŒºæ¸…é™¤ã€‚</strong></p></blockquote><p>å‡è®¾çª—å£å¤§å°ä¸º <code>3</code> ä¸ª TCP æ®µï¼Œé‚£ä¹ˆå‘é€æ–¹å°±å¯ä»¥**ã€Œè¿ç»­å‘é€ã€ <code>3</code> ä¸ª TCP æ®µ**ï¼Œå¹¶ä¸”<strong>ä¸­é€”è‹¥æœ‰ ACK ä¸¢å¤±</strong>ï¼Œå¯ä»¥é€šè¿‡**ã€Œä¸‹ä¸€ä¸ªç¡®è®¤åº”ç­”è¿›è¡Œç¡®è®¤ã€**ã€‚å¦‚ä¸‹å›¾ï¼š</p><img src="'+os+'" alt="ç”¨æ»‘åŠ¨çª—å£æ–¹å¼å¹¶è¡Œå¤„ç†" style="zoom:80%;"><blockquote><p>å›¾ä¸­çš„ <strong>ACK 600 ç¡®è®¤åº”ç­”æŠ¥æ–‡ä¸¢å¤±ï¼Œä¹Ÿæ²¡å…³ç³»</strong>ï¼Œå› ä¸º<strong>å¯ä»¥é€šè¿‡ä¸‹ä¸€ä¸ªç¡®è®¤åº”ç­”è¿›è¡Œç¡®è®¤</strong>ï¼Œ<strong>åªè¦å‘é€æ–¹æ”¶åˆ°äº† ACK 700 ç¡®è®¤åº”ç­”ï¼Œå°±æ„å‘³ç€ 700 ä¹‹å‰çš„æ‰€æœ‰æ•°æ®ã€Œæ¥æ”¶æ–¹ã€éƒ½æ”¶åˆ°äº†</strong>ã€‚è¿™ä¸ªæ¨¡å¼å°±å«**<code>ç´¯è®¡ç¡®è®¤</code><strong>æˆ–è€…</strong><code>ç´¯è®¡åº”ç­”</code>**ã€‚</p></blockquote><blockquote><p>çª—å£å¤§å°ç”±å“ªä¸€æ–¹å†³å®šï¼Ÿ</p></blockquote><p><strong>TCP å¤´</strong>é‡Œæœ‰ä¸€ä¸ªå­—æ®µå« <code>Window</code>ï¼Œä¹Ÿå°±æ˜¯<strong>çª—å£å¤§å°ã€‚</strong></p><p><strong>è¿™ä¸ªå­—æ®µæ˜¯æ¥æ”¶ç«¯å‘Šè¯‰å‘é€ç«¯è‡ªå·±è¿˜æœ‰å¤šå°‘ç¼“å†²åŒºå¯ä»¥æ¥æ”¶æ•°æ®ã€‚äºæ˜¯å‘é€ç«¯å°±å¯ä»¥æ ¹æ®è¿™ä¸ªæ¥æ”¶ç«¯çš„å¤„ç†èƒ½åŠ›æ¥å‘é€æ•°æ®ï¼Œè€Œä¸ä¼šå¯¼è‡´æ¥æ”¶ç«¯å¤„ç†ä¸è¿‡æ¥ã€‚</strong></p><p>æ‰€ä»¥ï¼Œé€šå¸¸<strong>çª—å£çš„å¤§å°æ˜¯ç”±æ¥æ”¶æ–¹çš„çª—å£å¤§å°æ¥å†³å®šçš„ã€‚</strong></p><p>å‘é€æ–¹å‘é€çš„æ•°æ®å¤§å°<strong>ä¸èƒ½è¶…è¿‡</strong>æ¥æ”¶æ–¹çš„çª—å£å¤§å°ï¼Œ<strong>å¦åˆ™æ¥æ”¶æ–¹å°±æ— æ³•æ­£å¸¸æ¥æ”¶åˆ°æ•°æ®ã€‚</strong></p><blockquote><p>å‘é€æ–¹çš„æ»‘åŠ¨çª—å£</p></blockquote><p>æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹<strong>å‘é€æ–¹çš„çª—å£</strong>ï¼Œä¸‹å›¾å°±æ˜¯å‘é€æ–¹ç¼“å­˜çš„æ•°æ®ï¼Œæ ¹æ®å¤„ç†çš„æƒ…å†µåˆ†æˆ<strong>å››ä¸ªéƒ¨åˆ†</strong>ï¼Œå…¶ä¸­æ·±è“è‰²æ–¹æ¡†æ˜¯å‘é€çª—å£ï¼Œç´«è‰²æ–¹æ¡†æ˜¯å¯ç”¨çª—å£ï¼š</p><img src="'+ts+'" alt="img" style="zoom:67%;"><ul><li>#1 æ˜¯å·²å‘é€å¹¶æ”¶åˆ° ACKç¡®è®¤çš„æ•°æ®ï¼š1~31 å­—èŠ‚</li><li>#2 æ˜¯å·²å‘é€<strong>ä½†æœªæ”¶åˆ° ACKç¡®è®¤</strong>çš„æ•°æ®ï¼š32~45 å­—èŠ‚</li><li>#3 æ˜¯<strong>æœªå‘é€ä½†æ€»å¤§å°åœ¨æ¥æ”¶æ–¹å¤„ç†èŒƒå›´å†…</strong>ï¼ˆæ¥æ”¶æ–¹è¿˜æœ‰ç©ºé—´ï¼‰ï¼š46~51å­—èŠ‚</li><li>#4 æ˜¯<strong>æœªå‘é€ä½†æ€»å¤§å°è¶…è¿‡æ¥æ”¶æ–¹å¤„ç†èŒƒå›´</strong>ï¼ˆæ¥æ”¶æ–¹æ²¡æœ‰ç©ºé—´ï¼‰ï¼š52å­—èŠ‚ä»¥å</li></ul><p>åœ¨ä¸‹å›¾ï¼Œå½“å‘é€æ–¹æŠŠæ•°æ®ã€Œå…¨éƒ¨ã€éƒ½ä¸€ä¸‹å‘é€å‡ºå»åï¼Œ<strong>å¯ç”¨çª—å£çš„å¤§å°å°±ä¸º 0 äº†</strong>ï¼Œè¡¨æ˜å¯ç”¨çª—å£è€—å°½ï¼Œåœ¨<strong>æ²¡æ”¶åˆ° ACK ç¡®è®¤ä¹‹å‰æ˜¯æ— æ³•ç»§ç»­å‘é€æ•°æ®äº†ã€‚</strong></p><img src="'+ss+'" alt="å¯ç”¨çª—å£è€—å°½" style="zoom:67%;"><p>åœ¨ä¸‹å›¾ï¼Œå½“æ”¶åˆ°ä¹‹å‰å‘é€çš„æ•°æ® <code>32~36</code> å­—èŠ‚çš„ ACK ç¡®è®¤åº”ç­”åï¼Œ<strong>å¦‚æœå‘é€çª—å£çš„å¤§å°æ²¡æœ‰å˜åŒ–</strong>ï¼Œåˆ™<strong>æ»‘åŠ¨çª—å£<code>å¾€å³è¾¹ç§»åŠ¨ 5 ä¸ªå­—èŠ‚</code>ï¼Œå› ä¸ºæœ‰ 5 ä¸ªå­—èŠ‚çš„æ•°æ®è¢«åº”ç­”ç¡®è®¤</strong>ï¼Œæ¥ä¸‹æ¥ <code>52~56</code> å­—èŠ‚åˆå˜æˆäº†å¯ç”¨çª—å£ï¼Œé‚£ä¹ˆåç»­ä¹Ÿå°±å¯ä»¥å‘é€ <code>52~56</code> è¿™ 5 ä¸ªå­—èŠ‚çš„æ•°æ®äº†ã€‚</p><img src="'+es+'" alt="32 ~ 36 å­—èŠ‚å·²ç¡®è®¤" style="zoom:67%;"><blockquote><p>ç¨‹åºæ˜¯å¦‚ä½•è¡¨ç¤ºå‘é€æ–¹çš„å››ä¸ªéƒ¨åˆ†çš„å‘¢ï¼Ÿ</p></blockquote><p>TCP æ»‘åŠ¨çª—å£æ–¹æ¡ˆä½¿ç”¨<strong>ä¸‰ä¸ªæŒ‡é’ˆ</strong>æ¥<strong>è·Ÿè¸ª</strong>åœ¨å››ä¸ªä¼ è¾“ç±»åˆ«ä¸­çš„æ¯ä¸€ä¸ªç±»åˆ«ä¸­çš„å­—èŠ‚ã€‚å…¶ä¸­ä¸¤ä¸ªæŒ‡é’ˆæ˜¯<strong>ç»å¯¹æŒ‡é’ˆ</strong>ï¼ˆæŒ‡ç‰¹å®šçš„åºåˆ—å·ï¼‰ï¼Œä¸€ä¸ªæ˜¯<strong>ç›¸å¯¹æŒ‡é’ˆ</strong>ï¼ˆéœ€è¦åšåç§»ï¼‰ã€‚</p><img src="'+ns+'" alt="SND.WNDã€SND.UNã€SND.NXT" style="zoom:67%;"><ul><li><code>SND.WND</code>ï¼šè¡¨ç¤º<strong>å‘é€çª—å£çš„å¤§å°</strong>ï¼ˆå¤§å°æ˜¯ç”±æ¥æ”¶æ–¹æŒ‡å®šçš„ï¼‰ï¼›</li><li><code>SND.UNA</code>ï¼ˆ<em>Send Unacknoleged</em>ï¼‰ï¼šæ˜¯ä¸€ä¸ªç»å¯¹æŒ‡é’ˆï¼Œå®ƒæŒ‡å‘çš„æ˜¯å·²å‘é€ä½†æœªæ”¶åˆ°ç¡®è®¤çš„ç¬¬ä¸€ä¸ªå­—èŠ‚çš„åºåˆ—å·ï¼Œä¹Ÿå°±æ˜¯ #2 çš„ç¬¬ä¸€ä¸ªå­—èŠ‚ã€‚</li><li><code>SND.NXT</code>ï¼šä¹Ÿæ˜¯ä¸€ä¸ªç»å¯¹æŒ‡é’ˆï¼Œå®ƒæŒ‡å‘æœªå‘é€ä½†å¯å‘é€èŒƒå›´çš„ç¬¬ä¸€ä¸ªå­—èŠ‚çš„åºåˆ—å·ï¼Œä¹Ÿå°±æ˜¯ #3 çš„ç¬¬ä¸€ä¸ªå­—èŠ‚ã€‚</li><li>æŒ‡å‘ #4 çš„ç¬¬ä¸€ä¸ªå­—èŠ‚æ˜¯ä¸ªç›¸å¯¹æŒ‡é’ˆï¼Œå®ƒéœ€è¦ <code>SND.UNA</code> æŒ‡é’ˆåŠ ä¸Š <code>SND.WND</code> å¤§å°çš„åç§»é‡ï¼Œå°±å¯ä»¥æŒ‡å‘ #4 çš„ç¬¬ä¸€ä¸ªå­—èŠ‚äº†ã€‚</li></ul><p>é‚£ä¹ˆå¯ç”¨çª—å£å¤§å°çš„è®¡ç®—å°±å¯ä»¥æ˜¯ï¼š</p><p><strong>å¯ç”¨çª—å£å¤§å° = SND.WND -ï¼ˆSND.NXT - SND.UNAï¼‰</strong></p><blockquote><p>æ¥æ”¶æ–¹çš„æ»‘åŠ¨çª—å£</p></blockquote><p>æ¥ä¸‹æ¥æˆ‘ä»¬çœ‹çœ‹æ¥æ”¶æ–¹çš„çª—å£ï¼Œæ¥æ”¶çª—å£ç›¸å¯¹ç®€å•ä¸€äº›ï¼Œæ ¹æ®å¤„ç†çš„æƒ…å†µåˆ’åˆ†æˆ<strong>ä¸‰ä¸ªéƒ¨åˆ†ï¼š</strong></p><ul><li>#1 + #2 æ˜¯<strong>å·²æˆåŠŸæ¥æ”¶å¹¶ç¡®è®¤çš„æ•°æ®</strong>ï¼ˆç­‰å¾…åº”ç”¨è¿›ç¨‹è¯»å–ï¼‰ï¼›</li><li>#3 æ˜¯<strong>æœªæ”¶åˆ°æ•°æ®ä½†å¯ä»¥æ¥æ”¶çš„æ•°æ®ï¼›</strong></li><li>#4 æœªæ”¶åˆ°æ•°æ®å¹¶ä¸å¯ä»¥æ¥æ”¶çš„æ•°æ®ï¼›</li></ul><img src="'+ps+'" alt="æ¥æ”¶çª—å£" style="zoom:67%;"><p>å…¶ä¸­ä¸‰ä¸ªæ¥æ”¶éƒ¨åˆ†ï¼Œä½¿ç”¨ä¸¤ä¸ªæŒ‡é’ˆè¿›è¡Œåˆ’åˆ†:</p><ul><li><code>RCV.WND</code>ï¼šè¡¨ç¤ºæ¥æ”¶çª—å£çš„å¤§å°ï¼Œå®ƒä¼šé€šå‘Šç»™å‘é€æ–¹ã€‚</li><li><code>RCV.NXT</code>ï¼šæ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼Œå®ƒæŒ‡å‘æœŸæœ›ä»å‘é€æ–¹å‘é€æ¥çš„ä¸‹ä¸€ä¸ªæ•°æ®å­—èŠ‚çš„åºåˆ—å·ï¼Œä¹Ÿå°±æ˜¯ #3 çš„ç¬¬ä¸€ä¸ªå­—èŠ‚ã€‚</li><li>æŒ‡å‘ #4 çš„ç¬¬ä¸€ä¸ªå­—èŠ‚æ˜¯ä¸ªç›¸å¯¹æŒ‡é’ˆï¼Œå®ƒéœ€è¦ <code>RCV.NXT</code> æŒ‡é’ˆåŠ ä¸Š <code>RCV.WND</code> å¤§å°çš„åç§»é‡ï¼Œå°±å¯ä»¥æŒ‡å‘ #4 çš„ç¬¬ä¸€ä¸ªå­—èŠ‚äº†ã€‚</li></ul><blockquote><p>æ¥æ”¶çª—å£å’Œå‘é€çª—å£çš„å¤§å°æ˜¯ç›¸ç­‰çš„å—ï¼Ÿ</p></blockquote><p><strong>å¹¶ä¸æ˜¯å®Œå…¨ç›¸ç­‰</strong>ï¼Œæ¥æ”¶çª—å£çš„å¤§å°æ˜¯<strong>çº¦ç­‰äº</strong>å‘é€çª—å£çš„å¤§å°çš„ã€‚</p><p>å› ä¸º<strong>æ»‘åŠ¨çª—å£å¹¶ä¸æ˜¯ä¸€æˆä¸å˜</strong>çš„ã€‚æ¯”å¦‚ï¼Œ<strong>å½“æ¥æ”¶æ–¹çš„åº”ç”¨è¿›ç¨‹è¯»å–æ•°æ®çš„é€Ÿåº¦éå¸¸å¿«çš„è¯</strong>ï¼Œè¿™æ ·çš„è¯æ¥æ”¶çª—å£å¯ä»¥å¾ˆå¿«çš„å°±ç©ºç¼ºå‡ºæ¥ã€‚é‚£ä¹ˆ<strong>æ–°çš„æ¥æ”¶çª—å£å¤§å°</strong>ï¼Œæ˜¯é€šè¿‡ TCP æŠ¥æ–‡ä¸­çš„ Windows å­—æ®µæ¥å‘Šè¯‰å‘é€æ–¹ã€‚é‚£ä¹ˆè¿™ä¸ªä¼ è¾“è¿‡ç¨‹æ˜¯<strong>å­˜åœ¨æ—¶å»¶çš„</strong>ï¼Œæ‰€ä»¥æ¥æ”¶çª—å£å’Œå‘é€çª—å£æ˜¯çº¦ç­‰äºçš„å…³ç³»ã€‚</p><h3 id="_4-2-3-æµé‡æ§åˆ¶" tabindex="-1"><a class="header-anchor" href="#_4-2-3-æµé‡æ§åˆ¶"><span>4.2.3 æµé‡æ§åˆ¶</span></a></h3><p>å‘é€æ–¹ä¸èƒ½æ— è„‘çš„å‘æ•°æ®ç»™æ¥æ”¶æ–¹ï¼Œ<strong>è¦è€ƒè™‘æ¥æ”¶æ–¹å¤„ç†èƒ½åŠ›ã€‚</strong></p><p>å¦‚æœä¸€ç›´æ— è„‘çš„å‘æ•°æ®ç»™å¯¹æ–¹ï¼Œä½†<strong>å¯¹æ–¹å¤„ç†ä¸è¿‡æ¥</strong>ï¼Œé‚£ä¹ˆå°±ä¼šå¯¼è‡´<strong>è§¦å‘é‡å‘æœºåˆ¶</strong>ï¼Œ<strong>ä»è€Œå¯¼è‡´ç½‘ç»œæµé‡çš„æ— ç«¯çš„æµªè´¹</strong>ã€‚</p><blockquote><p>ä¸ºäº†è§£å†³è¿™ç§ç°è±¡å‘ç”Ÿï¼Œ<strong>TCP æä¾›ä¸€ç§æœºåˆ¶å¯ä»¥<code>è®©ã€Œå‘é€æ–¹ã€æ ¹æ®ã€Œæ¥æ”¶æ–¹ã€çš„å®é™…æ¥æ”¶èƒ½åŠ›æ§åˆ¶å‘é€çš„æ•°æ®é‡</code>ï¼Œè¿™å°±æ˜¯æ‰€è°“çš„æµé‡æ§åˆ¶ã€‚</strong></p></blockquote><p>ä¸‹é¢ä¸¾ä¸ªæ —å­ï¼Œä¸ºäº†ç®€å•èµ·è§ï¼Œå‡è®¾ä»¥ä¸‹åœºæ™¯ï¼š</p><ul><li>å®¢æˆ·ç«¯æ˜¯æ¥æ”¶æ–¹ï¼Œ<strong>æœåŠ¡ç«¯æ˜¯å‘é€æ–¹</strong></li><li>å‡è®¾æ¥æ”¶çª—å£å’Œå‘é€çª—å£ç›¸åŒï¼Œéƒ½ä¸º <code>200</code></li><li><strong>å‡è®¾</strong>ä¸¤ä¸ªè®¾å¤‡åœ¨æ•´ä¸ªä¼ è¾“è¿‡ç¨‹ä¸­<strong>éƒ½ä¿æŒç›¸åŒçš„çª—å£å¤§å°</strong>ï¼Œä¸å—å¤–ç•Œå½±å“</li></ul><img src="'+rs+'" alt="æµé‡æ§åˆ¶" style="zoom:67%;"><p>æ ¹æ®ä¸Šå›¾çš„æµé‡æ§åˆ¶ï¼Œè¯´æ˜ä¸‹æ¯ä¸ªè¿‡ç¨‹ï¼š</p><ol><li>å®¢æˆ·ç«¯å‘æœåŠ¡ç«¯å‘é€è¯·æ±‚æ•°æ®æŠ¥æ–‡ã€‚è¿™é‡Œè¦è¯´æ˜ä¸‹ï¼Œæœ¬æ¬¡ä¾‹å­æ˜¯æŠŠæœåŠ¡ç«¯ä½œä¸ºå‘é€æ–¹ï¼Œæ‰€ä»¥æ²¡æœ‰ç”»å‡ºæœåŠ¡ç«¯çš„æ¥æ”¶çª—å£ã€‚</li><li>æœåŠ¡ç«¯æ”¶åˆ°è¯·æ±‚æŠ¥æ–‡åï¼Œå‘é€ç¡®è®¤æŠ¥æ–‡å’Œ 80 å­—èŠ‚çš„æ•°æ®ï¼Œäºæ˜¯å¯ç”¨çª—å£ <code>Usable</code> å‡å°‘ä¸º 120 å­—èŠ‚ï¼ŒåŒæ—¶ <code>SND.NXT</code> æŒ‡é’ˆä¹Ÿå‘å³åç§» 80 å­—èŠ‚åï¼ŒæŒ‡å‘ 321ï¼Œ<strong>è¿™æ„å‘³ç€ä¸‹æ¬¡å‘é€æ•°æ®çš„æ—¶å€™ï¼Œåºåˆ—å·æ˜¯ 321ã€‚</strong></li><li>å®¢æˆ·ç«¯æ”¶åˆ° 80 å­—èŠ‚æ•°æ®åï¼Œäºæ˜¯<strong>æ¥æ”¶çª—å£å¾€å³ç§»åŠ¨ 80 å­—èŠ‚</strong>ï¼Œ<code>RCV.NXT</code> ä¹Ÿå°±æŒ‡å‘ 321ï¼Œ<strong>è¿™æ„å‘³ç€å®¢æˆ·ç«¯æœŸæœ›çš„ä¸‹ä¸€ä¸ªæŠ¥æ–‡çš„åºåˆ—å·æ˜¯ 321</strong>ï¼Œæ¥ç€å‘é€ç¡®è®¤æŠ¥æ–‡ç»™æœåŠ¡ç«¯ã€‚</li><li>æœåŠ¡ç«¯å†æ¬¡å‘é€äº† 120 å­—èŠ‚æ•°æ®ï¼Œäºæ˜¯å¯ç”¨çª—å£è€—å°½ä¸º 0ï¼ŒæœåŠ¡ç«¯æ— æ³•å†ç»§ç»­å‘é€æ•°æ®ã€‚</li><li>å®¢æˆ·ç«¯æ”¶åˆ° 120 å­—èŠ‚çš„æ•°æ®åï¼Œäºæ˜¯æ¥æ”¶çª—å£å¾€å³ç§»åŠ¨ 120 å­—èŠ‚ï¼Œ<code>RCV.NXT</code> ä¹Ÿå°±æŒ‡å‘ 441ï¼Œæ¥ç€å‘é€<strong>ç¡®è®¤æŠ¥æ–‡ç»™æœåŠ¡ç«¯ã€‚</strong></li><li>æœåŠ¡ç«¯æ”¶åˆ°å¯¹ 80 å­—èŠ‚æ•°æ®çš„ç¡®è®¤æŠ¥æ–‡åï¼Œ<code>SND.UNA</code> æŒ‡é’ˆå¾€å³åç§»åæŒ‡å‘ 321ï¼Œäºæ˜¯å¯ç”¨çª—å£ <code>Usable</code> å¢å¤§åˆ° 80ã€‚</li><li>æœåŠ¡ç«¯æ”¶åˆ°å¯¹ 120 å­—èŠ‚æ•°æ®çš„ç¡®è®¤æŠ¥æ–‡åï¼Œ<code>SND.UNA</code> æŒ‡é’ˆå¾€å³åç§»åæŒ‡å‘ 441ï¼Œäºæ˜¯å¯ç”¨çª—å£ <code>Usable</code> å¢å¤§åˆ° 200ã€‚</li><li>æœåŠ¡ç«¯å¯ä»¥ç»§ç»­å‘é€äº†ï¼Œäºæ˜¯å‘é€äº† 160 å­—èŠ‚çš„æ•°æ®åï¼Œ<code>SND.NXT</code> æŒ‡å‘ 601ï¼Œäºæ˜¯å¯ç”¨çª—å£ <code>Usable</code> å‡å°‘åˆ° 40ã€‚</li><li>å®¢æˆ·ç«¯æ”¶åˆ° 160 å­—èŠ‚åï¼Œæ¥æ”¶çª—å£å¾€å³ç§»åŠ¨äº† 160 å­—èŠ‚ï¼Œ<code>RCV.NXT</code> ä¹Ÿå°±æ˜¯æŒ‡å‘äº† 601ï¼Œæ¥ç€å‘é€ç¡®è®¤æŠ¥æ–‡ç»™æœåŠ¡ç«¯ã€‚</li><li>æœåŠ¡ç«¯æ”¶åˆ°å¯¹ 160 å­—èŠ‚æ•°æ®çš„ç¡®è®¤æŠ¥æ–‡åï¼Œå‘é€çª—å£å¾€å³ç§»åŠ¨äº† 160 å­—èŠ‚ï¼Œäºæ˜¯ <code>SND.UNA</code> æŒ‡é’ˆåç§»äº† 160 åæŒ‡å‘ 601ï¼Œå¯ç”¨çª—å£ <code>Usable</code> ä¹Ÿå°±å¢å¤§è‡³äº† 200ã€‚</li></ol><h4 id="æ“ä½œç³»ç»Ÿç¼“å†²åŒºä¸æ»‘åŠ¨çª—å£çš„å…³ç³»" tabindex="-1"><a class="header-anchor" href="#æ“ä½œç³»ç»Ÿç¼“å†²åŒºä¸æ»‘åŠ¨çª—å£çš„å…³ç³»"><span>- æ“ä½œç³»ç»Ÿç¼“å†²åŒºä¸æ»‘åŠ¨çª—å£çš„å…³ç³»</span></a></h4><p>å‰é¢çš„æµé‡æ§åˆ¶ä¾‹å­ï¼Œæˆ‘ä»¬å‡å®šäº†å‘é€çª—å£å’Œæ¥æ”¶çª—å£æ˜¯ä¸å˜çš„ï¼Œä½†æ˜¯å®é™…ä¸Šï¼Œ<strong>å‘é€çª—å£å’Œæ¥æ”¶çª—å£ä¸­æ‰€å­˜æ”¾çš„å­—èŠ‚æ•°</strong>ï¼Œéƒ½æ˜¯æ”¾åœ¨æ“ä½œç³»ç»Ÿ<strong>å†…å­˜ç¼“å†²åŒº</strong>ä¸­çš„ï¼Œè€Œæ“ä½œç³»ç»Ÿçš„ç¼“å†²åŒºï¼Œä¼š<strong>è¢«æ“ä½œç³»ç»Ÿè°ƒæ•´</strong>ã€‚</p><p>å½“åº”ç”¨è¿›ç¨‹æ²¡åŠæ³•åŠæ—¶è¯»å–ç¼“å†²åŒºçš„å†…å®¹æ—¶ï¼Œä¹Ÿä¼šå¯¹æˆ‘ä»¬çš„ç¼“å†²åŒºé€ æˆå½±å“ã€‚</p><blockquote><p>é‚£æ“ä½œç³»ç»Ÿçš„ç¼“å†²åŒºï¼Œæ˜¯å¦‚ä½•å½±å“å‘é€çª—å£å’Œæ¥æ”¶çª—å£çš„å‘¢ï¼Ÿ</p></blockquote><p><em>æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹ç¬¬ä¸€ä¸ªä¾‹å­ã€‚</em></p><p>å½“åº”ç”¨ç¨‹åºæ²¡æœ‰åŠæ—¶è¯»å–ç¼“å­˜æ—¶ï¼Œå‘é€çª—å£å’Œæ¥æ”¶çª—å£çš„å˜åŒ–ã€‚</p><p>è€ƒè™‘ä»¥ä¸‹åœºæ™¯ï¼š</p><ul><li>å®¢æˆ·ç«¯ä½œä¸ºå‘é€æ–¹ï¼ŒæœåŠ¡ç«¯ä½œä¸ºæ¥æ”¶æ–¹ï¼Œå‘é€çª—å£å’Œæ¥æ”¶çª—å£åˆå§‹å¤§å°ä¸º <code>360</code>ï¼›</li><li>æœåŠ¡ç«¯éå¸¸çš„ç¹å¿™ï¼Œå½“æ”¶åˆ°å®¢æˆ·ç«¯çš„æ•°æ®æ—¶ï¼Œåº”ç”¨å±‚ä¸èƒ½åŠæ—¶è¯»å–æ•°æ®ã€‚</li></ul><img src="'+is+'" alt="img" style="zoom:67%;"><p>æ ¹æ®ä¸Šå›¾çš„æµé‡æ§åˆ¶ï¼Œè¯´æ˜ä¸‹æ¯ä¸ªè¿‡ç¨‹ï¼š</p><ol><li>å®¢æˆ·ç«¯å‘é€ 140 å­—èŠ‚æ•°æ®åï¼Œå¯ç”¨çª—å£å˜ä¸º 220 ï¼ˆ360 - 140ï¼‰ã€‚</li><li>æœåŠ¡ç«¯æ”¶åˆ° 140 å­—èŠ‚æ•°æ®ï¼Œ<strong>ä½†æ˜¯æœåŠ¡ç«¯éå¸¸ç¹å¿™ï¼Œåº”ç”¨è¿›ç¨‹åªè¯»å–äº† 40 ä¸ªå­—èŠ‚ï¼Œè¿˜æœ‰ 100 å­—èŠ‚å ç”¨ç€ç¼“å†²åŒºï¼Œäºæ˜¯æ¥æ”¶çª—å£æ”¶ç¼©åˆ°äº† 260 ï¼ˆ360 - 100ï¼‰</strong>ï¼Œæœ€å<strong>å‘é€ç¡®è®¤ä¿¡æ¯æ—¶</strong>ï¼Œå°†çª—å£å¤§å°é€šå‘Šç»™å®¢æˆ·ç«¯ã€‚</li><li>å®¢æˆ·ç«¯æ”¶åˆ°ç¡®è®¤å’Œçª—å£é€šå‘ŠæŠ¥æ–‡åï¼Œå‘é€çª—å£å‡å°‘ä¸º 260ã€‚</li><li>å®¢æˆ·ç«¯å‘é€ 180 å­—èŠ‚æ•°æ®ï¼Œæ­¤æ—¶å¯ç”¨çª—å£å‡å°‘åˆ° 80ã€‚</li><li>æœåŠ¡ç«¯æ”¶åˆ° 180 å­—èŠ‚æ•°æ®ï¼Œ<strong>ä½†æ˜¯åº”ç”¨ç¨‹åºæ²¡æœ‰è¯»å–ä»»ä½•æ•°æ®ï¼Œè¿™ 180 å­—èŠ‚ç›´æ¥å°±ç•™åœ¨äº†ç¼“å†²åŒºï¼Œäºæ˜¯æ¥æ”¶çª—å£æ”¶ç¼©åˆ°äº† 80 ï¼ˆ260 - 180ï¼‰</strong>ï¼Œå¹¶åœ¨å‘é€ç¡®è®¤ä¿¡æ¯æ—¶ï¼Œé€šè¿‡çª—å£å¤§å°ç»™å®¢æˆ·ç«¯ã€‚</li><li>å®¢æˆ·ç«¯æ”¶åˆ°ç¡®è®¤å’Œçª—å£é€šå‘ŠæŠ¥æ–‡åï¼Œå‘é€çª—å£å‡å°‘ä¸º 80ã€‚</li><li>å®¢æˆ·ç«¯å‘é€ 80 å­—èŠ‚æ•°æ®åï¼Œå¯ç”¨çª—å£è€—å°½ã€‚</li><li>æœåŠ¡ç«¯æ”¶åˆ° 80 å­—èŠ‚æ•°æ®ï¼Œ<strong>ä½†æ˜¯åº”ç”¨ç¨‹åºä¾ç„¶æ²¡æœ‰è¯»å–ä»»ä½•æ•°æ®ï¼Œè¿™ 80 å­—èŠ‚ç•™åœ¨äº†ç¼“å†²åŒºï¼Œäºæ˜¯æ¥æ”¶çª—å£æ”¶ç¼©åˆ°äº† 0</strong>ï¼Œå¹¶åœ¨å‘é€ç¡®è®¤ä¿¡æ¯æ—¶ï¼Œé€šè¿‡çª—å£å¤§å°ç»™å®¢æˆ·ç«¯ã€‚</li><li>å®¢æˆ·ç«¯æ”¶åˆ°ç¡®è®¤å’Œçª—å£é€šå‘ŠæŠ¥æ–‡åï¼Œå‘é€çª—å£å‡å°‘ä¸º 0ã€‚</li></ol><p>å¯è§æœ€åçª—å£éƒ½æ”¶ç¼©ä¸º 0 äº†ï¼Œä¹Ÿå°±æ˜¯å‘ç”Ÿäº†<strong>çª—å£å…³é—­</strong>ã€‚å½“å‘é€æ–¹å¯ç”¨çª—å£å˜ä¸º 0 æ—¶ï¼Œå‘é€æ–¹å®é™…ä¸Šä¼šå®šæ—¶å‘é€<strong>çª—å£æ¢æµ‹æŠ¥æ–‡</strong>ï¼Œä»¥ä¾¿çŸ¥é“æ¥æ”¶æ–¹çš„çª—å£æ˜¯å¦å‘ç”Ÿäº†æ”¹å˜ï¼Œè¿™ä¸ªå†…å®¹åé¢ä¼šè¯´ï¼Œè¿™é‡Œå…ˆç®€å•æä¸€ä¸‹ã€‚</p><p><em>æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹ç¬¬äºŒä¸ªä¾‹å­ã€‚</em></p><p>å½“æœåŠ¡ç«¯ç³»ç»Ÿèµ„æºéå¸¸ç´§å¼ çš„æ—¶å€™ï¼Œæ“ä½œç³»ç»Ÿå¯èƒ½<strong>ä¼šç›´æ¥å‡å°‘äº†æ¥æ”¶ç¼“å†²åŒºå¤§å°</strong>ï¼Œè¿™æ—¶åº”ç”¨ç¨‹åº<strong>åˆæ— æ³•åŠæ—¶è¯»å–ç¼“å­˜æ•°æ®</strong>ï¼Œé‚£ä¹ˆè¿™æ—¶å€™å°±æœ‰ä¸¥é‡çš„äº‹æƒ…å‘ç”Ÿäº†ï¼Œä¼šå‡ºç°<strong>æ•°æ®åŒ…ä¸¢å¤±</strong>çš„ç°è±¡ã€‚</p><img src="'+gs+'" alt="img" style="zoom:67%;"><p>è¯´æ˜ä¸‹æ¯ä¸ªè¿‡ç¨‹ï¼š</p><ol><li>å®¢æˆ·ç«¯å‘é€ 140 å­—èŠ‚çš„æ•°æ®ï¼Œäºæ˜¯å¯ç”¨çª—å£å‡å°‘åˆ°äº† 220ã€‚</li><li><strong>æœåŠ¡ç«¯å› ä¸ºç°åœ¨éå¸¸çš„ç¹å¿™ï¼Œæ“ä½œç³»ç»Ÿäºæ˜¯å°±æŠŠæ¥æ”¶ç¼“å­˜å‡å°‘äº† 120 å­—èŠ‚ï¼Œå½“æ”¶åˆ° 140 å­—èŠ‚æ•°æ®åï¼Œåˆå› ä¸ºåº”ç”¨ç¨‹åºæ²¡æœ‰è¯»å–ä»»ä½•æ•°æ®ï¼Œæ‰€ä»¥ 140 å­—èŠ‚ç•™åœ¨äº†ç¼“å†²åŒºä¸­ï¼Œäºæ˜¯æ¥æ”¶çª—å£å¤§å°ä» 360 æ”¶ç¼©æˆäº† 100</strong>ï¼Œæœ€åå‘é€ç¡®è®¤ä¿¡æ¯æ—¶ï¼Œé€šå‘Šçª—å£å¤§å°ç»™å¯¹æ–¹ã€‚</li><li>æ­¤æ—¶å®¢æˆ·ç«¯å› ä¸ºè¿˜æ²¡æœ‰æ”¶åˆ°æœåŠ¡ç«¯çš„é€šå‘Šçª—å£æŠ¥æ–‡ï¼Œæ‰€ä»¥ä¸çŸ¥é“æ­¤æ—¶æ¥æ”¶çª—å£æ”¶ç¼©æˆäº† 100ï¼Œå®¢æˆ·ç«¯åªä¼šçœ‹è‡ªå·±çš„å¯ç”¨çª—å£è¿˜æœ‰ 220ï¼Œæ‰€ä»¥å®¢æˆ·ç«¯å°±å‘é€äº† 180 å­—èŠ‚æ•°æ®ï¼Œäºæ˜¯å¯ç”¨çª—å£å‡å°‘åˆ° 40ã€‚</li><li>æœåŠ¡ç«¯æ”¶åˆ°äº† 180 å­—èŠ‚æ•°æ®æ—¶ï¼Œ<strong>å‘ç°æ•°æ®å¤§å°è¶…è¿‡äº†æ¥æ”¶çª—å£çš„å¤§å°ï¼Œäºæ˜¯å°±æŠŠæ•°æ®åŒ…ä¸¢å¤±äº†ã€‚</strong></li><li>å®¢æˆ·ç«¯æ”¶åˆ°ç¬¬ 2 æ­¥æ—¶ï¼ŒæœåŠ¡ç«¯å‘é€çš„ç¡®è®¤æŠ¥æ–‡å’Œé€šå‘Šçª—å£æŠ¥æ–‡ï¼Œå°è¯•å‡å°‘å‘é€çª—å£åˆ° 100ï¼ŒæŠŠçª—å£çš„å³ç«¯å‘å·¦æ”¶ç¼©äº† 80ï¼Œæ­¤æ—¶å¯ç”¨çª—å£çš„å¤§å°å°±ä¼šå‡ºç°è¯¡å¼‚çš„è´Ÿå€¼ã€‚</li></ol><p>æ‰€ä»¥ï¼Œå¦‚æœå‘ç”Ÿäº†å…ˆå‡å°‘ç¼“å­˜ï¼Œå†æ”¶ç¼©çª—å£ï¼Œå°±ä¼šå‡ºç°<strong>ä¸¢åŒ…çš„ç°è±¡</strong>ã€‚</p><blockquote><p><strong>ä¸ºäº†é˜²æ­¢è¿™ç§æƒ…å†µå‘ç”Ÿï¼ŒTCP è§„å®šæ˜¯ä¸å…è®¸åŒæ—¶å‡å°‘ç¼“å­˜åˆæ”¶ç¼©çª—å£çš„ï¼Œè€Œæ˜¯é‡‡ç”¨å…ˆæ”¶ç¼©çª—å£ï¼Œè¿‡æ®µæ—¶é—´å†å‡å°‘ç¼“å­˜ï¼Œè¿™æ ·å°±å¯ä»¥é¿å…äº†ä¸¢åŒ…æƒ…å†µã€‚</strong></p></blockquote><h4 id="çª—å£å…³é—­" tabindex="-1"><a class="header-anchor" href="#çª—å£å…³é—­"><span>- çª—å£å…³é—­</span></a></h4><p>åœ¨å‰é¢æˆ‘ä»¬éƒ½çœ‹åˆ°äº†ï¼ŒTCP é€šè¿‡<strong>è®©æ¥æ”¶æ–¹</strong>æŒ‡æ˜å¸Œæœ›ä»å‘é€æ–¹<strong>æ¥æ”¶çš„æ•°æ®å¤§å°</strong>ï¼ˆçª—å£å¤§å°ï¼‰æ¥è¿›è¡Œ<strong>æµé‡æ§åˆ¶</strong>ã€‚</p><p><strong>å¦‚æœçª—å£å¤§å°ä¸º 0 æ—¶ï¼Œå°±ä¼šé˜»æ­¢å‘é€æ–¹ç»™æ¥æ”¶æ–¹ä¼ é€’æ•°æ®ï¼Œç›´åˆ°çª—å£å˜ä¸ºé 0 ä¸ºæ­¢ï¼Œè¿™å°±æ˜¯çª—å£å…³é—­ã€‚</strong></p><blockquote><p>çª—å£å…³é—­<strong>æ½œåœ¨çš„å±é™©</strong></p></blockquote><p>æ¥æ”¶æ–¹å‘å‘é€æ–¹é€šå‘Šçª—å£å¤§å°æ—¶ï¼Œæ˜¯é€šè¿‡ <code>ACK</code> æŠ¥æ–‡æ¥é€šå‘Šçš„ã€‚</p><blockquote><p>é‚£ä¹ˆï¼Œ<strong>å½“å‘ç”Ÿçª—å£å…³é—­æ—¶</strong>ï¼Œæ¥æ”¶æ–¹<strong>å¤„ç†å®Œæ•°æ®å</strong>ï¼Œä¼šå‘å‘é€æ–¹é€šå‘Šä¸€ä¸ª<strong>çª—å£é 0 çš„ ACK æŠ¥æ–‡</strong>ï¼Œå¦‚æœè¿™ä¸ªé€šå‘Šçª—å£çš„ ACK æŠ¥æ–‡åœ¨ç½‘ç»œä¸­<strong>ä¸¢å¤±</strong>äº†ï¼Œé‚£éº»çƒ¦å°±å¤§äº†ã€‚</p></blockquote><img src="'+as+'" alt="çª—å£å…³é—­æ½œåœ¨çš„å±é™©" style="zoom:67%;"><p>è¿™ä¼šå¯¼è‡´å‘é€æ–¹ä¸€ç›´ç­‰å¾…æ¥æ”¶æ–¹çš„é 0 çª—å£é€šçŸ¥ï¼Œæ¥æ”¶æ–¹ä¹Ÿä¸€ç›´ç­‰å¾…å‘é€æ–¹çš„æ•°æ®ï¼Œå¦‚ä¸é‡‡å–æªæ–½ï¼Œè¿™ç§ç›¸äº’ç­‰å¾…çš„è¿‡ç¨‹ï¼Œä¼šé€ æˆäº†**<code>æ­»é”</code>**çš„ç°è±¡ã€‚</p><blockquote><p>TCP æ˜¯å¦‚ä½•è§£å†³çª—å£å…³é—­æ—¶ï¼Œæ½œåœ¨çš„æ­»é”ç°è±¡å‘¢ï¼Ÿ</p></blockquote><p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒTCP ä¸ºæ¯ä¸ªè¿æ¥è®¾æœ‰ä¸€ä¸ªæŒç»­å®šæ—¶å™¨ï¼Œ<strong>åªè¦ TCP è¿æ¥ä¸€æ–¹ æ”¶åˆ° å¯¹æ–¹çš„é›¶çª—å£é€šçŸ¥ ï¼Œå°±å¯åŠ¨æŒç»­è®¡æ—¶å™¨ã€‚</strong></p><p>å¦‚æœæŒç»­è®¡æ—¶å™¨è¶…æ—¶ï¼Œå°±ä¼šå‘é€<strong>çª—å£æ¢æµ‹ ( Window probe ) æŠ¥æ–‡</strong>ï¼Œè€Œå¯¹æ–¹åœ¨<strong>ç¡®è®¤è¿™ä¸ªæ¢æµ‹æŠ¥æ–‡æ—¶</strong>ï¼Œ<strong>ç»™å‡ºè‡ªå·±ç°åœ¨çš„æ¥æ”¶çª—å£å¤§å°</strong>ã€‚</p><img src="'+ls+'" alt="çª—å£æ¢æµ‹" style="zoom:67%;"><ul><li>å¦‚æœæ¥æ”¶çª—å£ä»ç„¶ä¸º 0ï¼Œé‚£ä¹ˆæ”¶åˆ°è¿™ä¸ªæŠ¥æ–‡çš„ä¸€æ–¹å°±ä¼šé‡æ–°å¯åŠ¨æŒç»­è®¡æ—¶å™¨ï¼›</li><li>å¦‚æœæ¥æ”¶çª—å£ä¸æ˜¯ 0ï¼Œé‚£ä¹ˆæ­»é”çš„å±€é¢å°±å¯ä»¥è¢«æ‰“ç ´äº†ã€‚</li></ul><p>çª—å£æ¢æµ‹çš„æ¬¡æ•°ä¸€èˆ¬ä¸º 3 æ¬¡ï¼Œæ¯æ¬¡å¤§çº¦ 30-60 ç§’ï¼ˆä¸åŒçš„å®ç°å¯èƒ½ä¼šä¸ä¸€æ ·ï¼‰ã€‚å¦‚æœ 3 æ¬¡è¿‡åæ¥æ”¶çª—å£è¿˜æ˜¯ 0 çš„è¯ï¼Œæœ‰çš„ TCP å®ç°å°±ä¼šå‘ <code>RST</code> æŠ¥æ–‡æ¥ä¸­æ–­è¿æ¥ã€‚</p><h4 id="ç³Šæ¶‚çª—å£ç»¼åˆç—‡" tabindex="-1"><a class="header-anchor" href="#ç³Šæ¶‚çª—å£ç»¼åˆç—‡"><span>- ç³Šæ¶‚çª—å£ç»¼åˆç—‡</span></a></h4><p>å¦‚æœæ¥æ”¶æ–¹å¤ªå¿™äº†ï¼Œæ¥ä¸åŠå–èµ°æ¥æ”¶çª—å£é‡Œçš„æ•°æ®ï¼Œé‚£ä¹ˆå°±ä¼šå¯¼è‡´<strong>å‘é€æ–¹çš„å‘é€çª—å£è¶Šæ¥è¶Šå°</strong>ã€‚</p><p>åˆ°æœ€åï¼Œ<strong>å¦‚æœæ¥æ”¶æ–¹ è…¾å‡ºå‡ ä¸ªå­—èŠ‚ å¹¶å‘Šè¯‰å‘é€æ–¹ç°åœ¨ æœ‰å‡ ä¸ªå­—èŠ‚çš„çª—å£ ï¼Œè€Œå‘é€æ–¹ä¼šä¹‰æ— åé¡¾åœ°å‘é€è¿™å‡ ä¸ªå­—èŠ‚ï¼Œè¿™å°±æ˜¯ç³Šæ¶‚çª—å£ç»¼åˆç—‡</strong>ã€‚</p><p>è¦çŸ¥é“ï¼Œæˆ‘ä»¬çš„ <code>TCP + IP</code> å¤´æœ‰ <code>40</code> ä¸ªå­—èŠ‚ï¼Œä¸ºäº†ä¼ è¾“é‚£å‡ ä¸ªå­—èŠ‚çš„æ•°æ®ï¼Œè¦æ­ä¸Š<strong>è¿™ä¹ˆå¤§çš„å¼€é”€</strong>ï¼Œè¿™å¤ªä¸ç»æµäº†ã€‚</p><p>å°±å¥½åƒä¸€ä¸ªå¯ä»¥æ‰¿è½½ 50 äººçš„å¤§å·´è½¦ï¼Œæ¯æ¬¡æ¥äº†ä¸€ä¸¤ä¸ªäººï¼Œå°±ç›´æ¥å‘è½¦ã€‚é™¤éå®¶é‡Œæœ‰çŸ¿çš„å¤§å·´å¸æœºï¼Œæ‰æ•¢è¿™æ ·ç©ï¼Œä¸ç„¶è¿Ÿæ—©ç ´äº§ã€‚è¦è§£å†³è¿™ä¸ªé—®é¢˜ä¹Ÿä¸éš¾ï¼Œå¤§å·´å¸æœºç­‰ä¹˜å®¢æ•°é‡è¶…è¿‡äº† 25 ä¸ªï¼Œæ‰è®¤å®šå¯ä»¥å‘è½¦ã€‚</p><p>ç°ä¸¾ä¸ªç³Šæ¶‚çª—å£ç»¼åˆç—‡çš„æ —å­ï¼Œè€ƒè™‘ä»¥ä¸‹åœºæ™¯ï¼š</p><p>æ¥æ”¶æ–¹çš„çª—å£å¤§å°æ˜¯ 360 å­—èŠ‚ï¼Œä½†æ¥æ”¶æ–¹ç”±äºæŸäº›åŸå› é™·å…¥å›°å¢ƒï¼Œå‡è®¾æ¥æ”¶æ–¹çš„åº”ç”¨å±‚è¯»å–çš„èƒ½åŠ›å¦‚ä¸‹ï¼š</p><ul><li>æ¥æ”¶æ–¹æ¯æ¥æ”¶ 3 ä¸ªå­—èŠ‚ï¼Œåº”ç”¨ç¨‹åºå°±åªèƒ½ä»ç¼“å†²åŒºä¸­è¯»å– 1 ä¸ªå­—èŠ‚çš„æ•°æ®ï¼›</li><li>åœ¨ä¸‹ä¸€ä¸ªå‘é€æ–¹çš„ TCP æ®µåˆ°è¾¾ä¹‹å‰ï¼Œåº”ç”¨ç¨‹åºè¿˜ä»ç¼“å†²åŒºä¸­è¯»å–äº† 40 ä¸ªé¢å¤–çš„å­—èŠ‚ï¼›</li></ul><img src="'+cs+`" alt="ç³Šæ¶‚çª—å£ç»¼åˆç—‡" style="zoom:67%;"><p>æ¯ä¸ªè¿‡ç¨‹çš„çª—å£å¤§å°çš„å˜åŒ–ï¼Œåœ¨å›¾ä¸­éƒ½æè¿°çš„å¾ˆæ¸…æ¥šäº†ï¼Œå¯ä»¥å‘ç°<strong>çª—å£ä¸æ–­å‡å°‘äº†</strong>ï¼Œå¹¶ä¸”å‘é€çš„æ•°æ®éƒ½æ˜¯æ¯”è¾ƒå°çš„äº†ã€‚</p><p>æ‰€ä»¥ï¼Œç³Šæ¶‚çª—å£ç»¼åˆç—‡çš„ç°è±¡æ˜¯å¯ä»¥å‘ç”Ÿåœ¨<strong>å‘é€æ–¹å’Œæ¥æ”¶æ–¹</strong>ï¼š</p><ul><li>æ¥æ”¶æ–¹å¯ä»¥é€šå‘Šä¸€ä¸ªå°çš„çª—å£</li><li>è€Œå‘é€æ–¹å¯ä»¥å‘é€å°æ•°æ®</li></ul><blockquote><p>äºæ˜¯ï¼Œè¦è§£å†³ç³Šæ¶‚çª—å£ç»¼åˆç—‡ï¼Œå°±è¦åŒæ—¶è§£å†³ä¸Šé¢ä¸¤ä¸ªé—®é¢˜å°±å¯ä»¥äº†ï¼š</p><ul><li>è®©æ¥æ”¶æ–¹ä¸é€šå‘Šå°çª—å£ç»™å‘é€æ–¹</li><li>è®©å‘é€æ–¹é¿å…å‘é€å°æ•°æ®</li></ul></blockquote><blockquote><p>æ€ä¹ˆè®©<strong>æ¥æ”¶æ–¹ä¸é€šå‘Šå°çª—å£</strong>å‘¢ï¼Ÿ</p></blockquote><p>æ¥æ”¶æ–¹é€šå¸¸çš„<strong>ç­–ç•¥</strong>å¦‚ä¸‹:</p><p>å½“ã€Œçª—å£å¤§å°ã€å°äº min( MSSï¼Œç¼“å­˜ç©ºé—´/2 ) ï¼Œä¹Ÿå°±æ˜¯å°äº MSS ä¸ 1/2 ç¼“å­˜å¤§å°ä¸­çš„æœ€å°å€¼æ—¶ï¼Œå°±ä¼šå‘å‘é€æ–¹é€šå‘Šçª—å£ä¸º <code>0</code>ï¼Œä¹Ÿå°±<strong>é˜»æ­¢äº†å‘é€æ–¹å†å‘æ•°æ®è¿‡æ¥</strong>ã€‚</p><p>ç­‰åˆ°æ¥æ”¶æ–¹å¤„ç†äº†ä¸€äº›æ•°æ®åï¼Œçª—å£å¤§å° &gt;= MSSï¼Œæˆ–è€…æ¥æ”¶æ–¹<strong>ç¼“å­˜ç©ºé—´æœ‰ä¸€åŠå¯ä»¥ä½¿ç”¨</strong>ï¼Œå°±å¯ä»¥æŠŠçª—å£æ‰“å¼€è®©å‘é€æ–¹å‘é€æ•°æ®è¿‡æ¥ã€‚</p><blockquote><p>æ€ä¹ˆè®©<strong>å‘é€æ–¹é¿å…å‘é€å°æ•°æ®</strong>å‘¢ï¼Ÿ</p></blockquote><p>å‘é€æ–¹é€šå¸¸çš„ç­–ç•¥å¦‚ä¸‹:</p><p>ä½¿ç”¨ Nagle ç®—æ³•ï¼Œè¯¥ç®—æ³•çš„æ€è·¯æ˜¯<strong>å»¶æ—¶å¤„ç†</strong>ï¼Œåªæœ‰æ»¡è¶³ä¸‹é¢ä¸¤ä¸ªæ¡ä»¶ä¸­çš„<strong>ä»»æ„ä¸€ä¸ªæ¡ä»¶</strong>ï¼Œ<strong>æ‰å¯ä»¥å‘é€æ•°æ®</strong>ï¼š</p><ul><li>æ¡ä»¶ä¸€ï¼šè¦ç­‰åˆ°çª—å£å¤§å° &gt;= <code>MSS</code> å¹¶ä¸” æ•°æ®å¤§å° &gt;= <code>MSS</code>ï¼›</li><li>æ¡ä»¶äºŒï¼šæ”¶åˆ°ä¹‹å‰å‘é€æ•°æ®çš„ <code>ack</code> å›åŒ…ï¼›</li></ul><p>åªè¦ä¸Šé¢ä¸¤ä¸ªæ¡ä»¶éƒ½ä¸æ»¡è¶³ï¼Œå‘é€æ–¹ä¸€ç›´åœ¨å›¤ç§¯æ•°æ®ï¼Œç›´åˆ°æ»¡è¶³ä¸Šé¢çš„å‘é€æ¡ä»¶ã€‚</p><p>Nagle ä¼ªä»£ç å¦‚ä¸‹ï¼š</p><div class="language-c line-numbers-mode" data-ext="c" data-title="c"><pre class="language-c"><code><span class="token keyword">if</span> æœ‰æ•°æ®è¦å‘é€ <span class="token punctuation">{</span>
    <span class="token keyword">if</span> å¯ç”¨çª—å£å¤§å° <span class="token operator">&gt;=</span> MSS and å¯å‘é€çš„æ•°æ® <span class="token operator">&gt;=</span> MSS <span class="token punctuation">{</span>
    	ç«‹åˆ»å‘é€MSSå¤§å°çš„æ•°æ®
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> æœ‰æœªç¡®è®¤çš„æ•°æ® <span class="token punctuation">{</span>
            å°†æ•°æ®æ”¾å…¥ç¼“å­˜ç­‰å¾…æ¥æ”¶ACK
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            ç«‹åˆ»å‘é€æ•°æ®
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ³¨æ„ï¼Œå¦‚æœæ¥æ”¶æ–¹ä¸èƒ½æ»¡è¶³ã€Œä¸é€šå‘Šå°çª—å£ç»™å‘é€æ–¹ã€ï¼Œé‚£ä¹ˆå³ä½¿å¼€äº† Nagle ç®—æ³•ï¼Œä¹Ÿæ— æ³•é¿å…ç³Šæ¶‚çª—å£ç»¼åˆç—‡ï¼Œå› ä¸ºå¦‚æœå¯¹ç«¯ ACK å›å¤å¾ˆå¿«çš„è¯ï¼ˆè¾¾åˆ° Nagle ç®—æ³•çš„æ¡ä»¶äºŒï¼‰ï¼ŒNagle ç®—æ³•å°±ä¸ä¼šæ‹¼æ¥å¤ªå¤šçš„æ•°æ®åŒ…ï¼Œè¿™ç§æƒ…å†µä¸‹ä¾ç„¶ä¼šæœ‰å°æ•°æ®åŒ…çš„ä¼ è¾“ï¼Œç½‘ç»œæ€»ä½“çš„åˆ©ç”¨ç‡ä¾ç„¶å¾ˆä½ã€‚</p><p>æ‰€ä»¥ï¼Œ<strong>æ¥æ”¶æ–¹å¾—æ»¡è¶³ã€Œä¸é€šå‘Šå°çª—å£ç»™å‘é€æ–¹ã€+ å‘é€æ–¹å¼€å¯ Nagle ç®—æ³•ï¼Œæ‰èƒ½é¿å…ç³Šæ¶‚çª—å£ç»¼åˆç—‡</strong>ã€‚</p><p>å¦å¤–ï¼ŒNagle ç®—æ³•é»˜è®¤æ˜¯æ‰“å¼€çš„ï¼Œå¦‚æœå¯¹äºä¸€äº›<strong>éœ€è¦å°æ•°æ®åŒ…äº¤äº’çš„åœºæ™¯</strong>çš„ç¨‹åºï¼Œæ¯”å¦‚ï¼Œtelnet æˆ– ssh è¿™æ ·çš„äº¤äº’æ€§æ¯”è¾ƒå¼ºçš„ç¨‹åºï¼Œåˆ™éœ€è¦<strong>å…³é—­ Nagle ç®—æ³•ã€‚</strong></p><p>å¯ä»¥åœ¨ Socket è®¾ç½® <code>TCP_NODELAY</code> é€‰é¡¹æ¥å…³é—­è¿™ä¸ªç®—æ³•ï¼ˆå…³é—­ Nagle ç®—æ³•æ²¡æœ‰å…¨å±€å‚æ•°ï¼Œéœ€è¦æ ¹æ®æ¯ä¸ªåº”ç”¨è‡ªå·±çš„ç‰¹ç‚¹æ¥å…³é—­ï¼‰</p><div class="language-c line-numbers-mode" data-ext="c" data-title="c"><pre class="language-c"><code><span class="token function">setsockopt</span><span class="token punctuation">(</span>sock_fd<span class="token punctuation">,</span> IPPROTO_TCP<span class="token punctuation">,</span> TCP_NODELAY<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>value<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="_4-2-4-æ‹¥å¡æ§åˆ¶" tabindex="-1"><a class="header-anchor" href="#_4-2-4-æ‹¥å¡æ§åˆ¶"><span>4.2.4 æ‹¥å¡æ§åˆ¶</span></a></h3><blockquote><p>ä¸ºä»€ä¹ˆè¦æœ‰æ‹¥å¡æ§åˆ¶å‘€ï¼Œä¸æ˜¯æœ‰æµé‡æ§åˆ¶äº†å—ï¼Ÿ</p></blockquote><p>å‰é¢çš„æµé‡æ§åˆ¶æ˜¯<strong>é¿å…ã€Œå‘é€æ–¹ã€çš„æ•°æ®å¡«æ»¡ã€Œæ¥æ”¶æ–¹ã€çš„ç¼“å­˜</strong>ï¼Œä½†æ˜¯<strong>å¹¶ä¸çŸ¥é“ç½‘ç»œçš„ä¸­å‘ç”Ÿäº†ä»€ä¹ˆ</strong>ã€‚</p><blockquote><p>ä¸€èˆ¬æ¥è¯´ï¼Œè®¡ç®—æœºç½‘ç»œéƒ½å¤„åœ¨ä¸€ä¸ª<strong>å…±äº«çš„ç¯å¢ƒ</strong>ã€‚å› æ­¤ä¹Ÿæœ‰å¯èƒ½ä¼šå› ä¸ºå…¶ä»–ä¸»æœºä¹‹é—´çš„é€šä¿¡ä½¿å¾—ç½‘ç»œæ‹¥å µã€‚</p><p><strong>åœ¨ç½‘ç»œå‡ºç°æ‹¥å µæ—¶ï¼Œå¦‚æœç»§ç»­å‘é€å¤§é‡æ•°æ®åŒ…ï¼Œå¯èƒ½ä¼šå¯¼è‡´æ•°æ®åŒ…æ—¶å»¶ã€ä¸¢å¤±ç­‰ï¼Œè¿™æ—¶ TCP å°±ä¼šé‡ä¼ æ•°æ®ï¼Œä½†æ˜¯ä¸€é‡ä¼ å°±ä¼šå¯¼è‡´ç½‘ç»œçš„è´Ÿæ‹…æ›´é‡ï¼Œäºæ˜¯ä¼šå¯¼è‡´æ›´å¤§çš„å»¶è¿Ÿä»¥åŠæ›´å¤šçš„ä¸¢åŒ…ï¼Œè¿™ä¸ªæƒ…å†µå°±ä¼šè¿›å…¥æ¶æ€§å¾ªç¯è¢«ä¸æ–­åœ°æ”¾å¤§....</strong></p><p>æ‰€ä»¥ï¼Œ<strong>TCP ä¸èƒ½å¿½ç•¥ç½‘ç»œä¸Šå‘ç”Ÿçš„äº‹</strong>ï¼Œå®ƒè¢«è®¾è®¡æˆä¸€ä¸ªæ— ç§çš„åè®®ï¼Œå½“ç½‘ç»œå‘é€<strong>æ‹¥å¡</strong>æ—¶ï¼ŒTCP ä¼šè‡ªæˆ‘ç‰ºç‰²ï¼Œé™ä½å‘é€çš„æ•°æ®é‡ã€‚</p><p>äºæ˜¯ï¼Œå°±æœ‰äº†<strong>æ‹¥å¡æ§åˆ¶</strong>ï¼Œæ§åˆ¶çš„ç›®çš„å°±æ˜¯<strong>é¿å…ã€Œå‘é€æ–¹ã€çš„æ•°æ®å¡«æ»¡æ•´ä¸ªç½‘ç»œã€‚</strong></p></blockquote><p>ä¸ºäº†**åœ¨ã€Œå‘é€æ–¹ã€**è°ƒèŠ‚æ‰€è¦å‘é€æ•°æ®çš„é‡ï¼Œå®šä¹‰äº†ä¸€ä¸ªå«åšã€Œ<strong>æ‹¥å¡çª—å£</strong>ã€çš„æ¦‚å¿µã€‚</p><blockquote><p>ä»€ä¹ˆæ˜¯æ‹¥å¡çª—å£ï¼Ÿå’Œå‘é€çª—å£æœ‰ä»€ä¹ˆå…³ç³»å‘¢ï¼Ÿ</p></blockquote><p><strong>æ‹¥å¡çª—å£ cwnd <strong>æ˜¯</strong>å‘é€æ–¹</strong>ç»´æŠ¤çš„ä¸€ä¸ªçš„çŠ¶æ€å˜é‡ï¼Œå®ƒä¼šæ ¹æ®<strong>ç½‘ç»œçš„æ‹¥å¡ç¨‹åº¦åŠ¨æ€å˜åŒ–çš„</strong>ã€‚</p><p>æˆ‘ä»¬åœ¨å‰é¢æåˆ°è¿‡å‘é€çª—å£ <code>swnd</code> å’Œæ¥æ”¶çª—å£ <code>rwnd</code> æ˜¯çº¦ç­‰äºçš„å…³ç³»ï¼Œé‚£ä¹ˆç”±äºåŠ å…¥äº†æ‹¥å¡çª—å£çš„æ¦‚å¿µåï¼Œæ­¤æ—¶å‘é€çª—å£çš„å€¼æ˜¯swnd = min(cwnd, rwnd)ï¼Œä¹Ÿå°±æ˜¯<strong>æ‹¥å¡çª—å£</strong>å’Œ<strong>æ¥æ”¶çª—å£</strong>ä¸­çš„<strong>æœ€å°å€¼</strong>ã€‚</p><blockquote><p>æ‹¥å¡çª—å£ <code>cwnd</code> å˜åŒ–çš„è§„åˆ™ï¼š</p><ul><li>åªè¦ç½‘ç»œä¸­æ²¡æœ‰å‡ºç°æ‹¥å¡ï¼Œ<code>cwnd</code> å°±ä¼šå¢å¤§ï¼›</li><li>ä½†ç½‘ç»œä¸­å‡ºç°äº†æ‹¥å¡ï¼Œ<code>cwnd</code> å°±å‡å°‘ï¼›</li></ul></blockquote><blockquote><p>é‚£ä¹ˆæ€ä¹ˆçŸ¥é“å½“å‰ç½‘ç»œæ˜¯å¦å‡ºç°äº†æ‹¥å¡å‘¢ï¼Ÿ</p></blockquote><p>å…¶å®åªè¦ã€Œå‘é€æ–¹ã€<strong>æ²¡æœ‰åœ¨è§„å®šæ—¶é—´å†…æ¥æ”¶åˆ° ACK åº”ç­”æŠ¥æ–‡</strong>ï¼Œä¹Ÿå°±æ˜¯<strong>å‘ç”Ÿäº†è¶…æ—¶é‡ä¼ ï¼Œå°±ä¼šè®¤ä¸ºç½‘ç»œå‡ºç°äº†æ‹¥å¡ã€‚</strong></p><blockquote><p>æ‹¥å¡æ§åˆ¶æœ‰å“ªäº›æ§åˆ¶ç®—æ³•ï¼Ÿ</p></blockquote><p><strong>æ‹¥å¡æ§åˆ¶ä¸»è¦æ˜¯å››ä¸ªç®—æ³•ï¼š</strong></p><ul><li><strong>æ…¢å¯åŠ¨</strong></li><li><strong>æ‹¥å¡é¿å…</strong></li><li><strong>æ‹¥å¡å‘ç”Ÿ</strong></li><li><strong>å¿«é€Ÿæ¢å¤</strong></li></ul><h4 id="æ…¢å¯åŠ¨" tabindex="-1"><a class="header-anchor" href="#æ…¢å¯åŠ¨"><span>- æ…¢å¯åŠ¨</span></a></h4><p>TCP åœ¨åˆšå»ºç«‹è¿æ¥å®Œæˆåï¼Œé¦–å…ˆæ˜¯æœ‰ä¸ªæ…¢å¯åŠ¨çš„è¿‡ç¨‹ï¼Œè¿™ä¸ªæ…¢å¯åŠ¨çš„æ„æ€å°±æ˜¯<strong>ä¸€ç‚¹ä¸€ç‚¹çš„æé«˜å‘é€æ•°æ®åŒ…çš„æ•°é‡</strong>ï¼Œå¦‚æœä¸€ä¸Šæ¥å°±å‘å¤§é‡çš„æ•°æ®ï¼Œè¿™ä¸æ˜¯ç»™ç½‘ç»œæ·»å µå—ï¼Ÿ</p><blockquote><p>æ…¢å¯åŠ¨çš„ç®—æ³•è®°ä½ä¸€ä¸ªè§„åˆ™å°±è¡Œï¼š<strong>å½“å‘é€æ–¹æ¯æ”¶åˆ°ä¸€ä¸ª ACKï¼Œæ‹¥å¡çª—å£ cwnd çš„å¤§å°å°±ä¼šåŠ  1ã€‚</strong></p></blockquote><p>è¿™é‡Œå‡å®šæ‹¥å¡çª—å£ <code>cwnd</code> å’Œå‘é€çª—å£ <code>swnd</code> ç›¸ç­‰ï¼Œä¸‹é¢ä¸¾ä¸ªæ —å­ï¼š</p><ul><li>è¿æ¥å»ºç«‹å®Œæˆåï¼Œä¸€å¼€å§‹<strong>åˆå§‹åŒ–</strong> <code>cwnd = 1</code>ï¼Œè¡¨ç¤ºå¯ä»¥ä¼ ä¸€ä¸ª <code>MSS</code> å¤§å°çš„æ•°æ®ã€‚</li><li>å½“æ”¶åˆ°ä¸€ä¸ª ACK ç¡®è®¤åº”ç­”åï¼Œcwnd <strong>å¢åŠ  1</strong>ï¼Œäºæ˜¯ä¸€æ¬¡èƒ½å¤Ÿå‘é€ 2 ä¸ª</li><li>å½“æ”¶åˆ° 2 ä¸ªçš„ ACK ç¡®è®¤åº”ç­”åï¼Œ cwnd å¢åŠ  2ï¼Œäºæ˜¯å°±å¯ä»¥æ¯”ä¹‹å‰å¤šå‘2 ä¸ªï¼Œæ‰€ä»¥è¿™ä¸€æ¬¡èƒ½å¤Ÿå‘é€ 4 ä¸ª</li><li>å½“è¿™ 4 ä¸ªçš„ ACK ç¡®è®¤åˆ°æ¥çš„æ—¶å€™ï¼Œæ¯ä¸ªç¡®è®¤ cwnd å¢åŠ  1ï¼Œ 4 ä¸ªç¡®è®¤ cwnd å¢åŠ  4ï¼Œäºæ˜¯å°±å¯ä»¥æ¯”ä¹‹å‰å¤šå‘ 4 ä¸ªï¼Œæ‰€ä»¥è¿™ä¸€æ¬¡èƒ½å¤Ÿå‘é€ 8 ä¸ªã€‚</li></ul><p><strong>æ…¢å¯åŠ¨ç®—æ³•çš„å˜åŒ–è¿‡ç¨‹</strong>å¦‚ä¸‹å›¾ï¼š</p><img src="`+ds+'" alt="æ…¢å¯åŠ¨ç®—æ³•" style="zoom:67%;"><p>å¯ä»¥çœ‹å‡ºæ…¢å¯åŠ¨ç®—æ³•ï¼Œå‘åŒ…çš„ä¸ªæ•°æ˜¯<strong>æŒ‡æ•°æ€§çš„å¢é•¿</strong>ã€‚</p><blockquote><p>é‚£æ…¢å¯åŠ¨æ¶¨åˆ°ä»€ä¹ˆæ—¶å€™æ˜¯ä¸ªå¤´å‘¢ï¼Ÿ</p></blockquote><p>æœ‰ä¸€ä¸ªå«<strong>æ…¢å¯åŠ¨é—¨é™</strong> <code>ssthresh</code> ï¼ˆslow start thresholdï¼‰çŠ¶æ€å˜é‡ã€‚</p><ul><li>å½“ <code>cwnd</code> &lt; <code>ssthresh</code> æ—¶ï¼Œä½¿ç”¨æ…¢å¯åŠ¨ç®—æ³•ã€‚</li><li>å½“ <code>cwnd</code> &gt;= <code>ssthresh</code> æ—¶ï¼Œå°±ä¼šä½¿ç”¨**ã€Œæ‹¥å¡é¿å…ç®—æ³•ã€**ã€‚</li></ul><h4 id="æ‹¥å¡é¿å…ç®—æ³•" tabindex="-1"><a class="header-anchor" href="#æ‹¥å¡é¿å…ç®—æ³•"><span>- æ‹¥å¡é¿å…ç®—æ³•</span></a></h4><p>å‰é¢è¯´é“ï¼Œå½“æ‹¥å¡çª—å£ <code>cwnd</code> ã€Œè¶…è¿‡ã€æ…¢å¯åŠ¨é—¨é™ <code>ssthresh</code> å°±ä¼šè¿›å…¥æ‹¥å¡é¿å…ç®—æ³•ã€‚</p><p>ä¸€èˆ¬æ¥è¯´ <code>ssthresh</code> çš„å¤§å°æ˜¯ <code>65535</code> å­—èŠ‚ã€‚</p><p>é‚£ä¹ˆè¿›å…¥æ‹¥å¡é¿å…ç®—æ³•åï¼Œå®ƒçš„è§„åˆ™æ˜¯ï¼š<strong>æ¯å½“æ”¶åˆ°ä¸€ä¸ª ACK æ—¶ï¼Œcwnd å¢åŠ  1/cwndã€‚</strong></p><p>æ¥ä¸Šå‰é¢çš„æ…¢å¯åŠ¨çš„æ —å­ï¼Œç°å‡å®š <code>ssthresh</code> ä¸º <code>8</code>ï¼š</p><ul><li>å½“ 8 ä¸ª ACK åº”ç­”ç¡®è®¤åˆ°æ¥æ—¶ï¼Œæ¯ä¸ªç¡®è®¤å¢åŠ  1/8ï¼Œ8 ä¸ª ACK ç¡®è®¤ cwnd ä¸€å…±å¢åŠ  1ï¼Œäºæ˜¯è¿™ä¸€æ¬¡èƒ½å¤Ÿå‘é€ 9 ä¸ª <code>MSS</code> å¤§å°çš„æ•°æ®ï¼Œå˜æˆäº†<strong>çº¿æ€§å¢é•¿ã€‚</strong></li></ul><p>æ‹¥å¡é¿å…ç®—æ³•çš„å˜åŒ–è¿‡ç¨‹å¦‚ä¸‹å›¾ï¼š</p><figure><img src="'+ms+'" alt="æ‹¥å¡é¿å…" tabindex="0" loading="lazy"><figcaption>æ‹¥å¡é¿å…</figcaption></figure><p>æ‰€ä»¥ï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œæ‹¥å¡é¿å…ç®—æ³•å°±æ˜¯å°†åŸæœ¬æ…¢å¯åŠ¨ç®—æ³•çš„æŒ‡æ•°å¢é•¿å˜æˆäº†<strong>çº¿æ€§å¢é•¿</strong>ï¼Œè¿˜æ˜¯å¢é•¿é˜¶æ®µï¼Œä½†æ˜¯<strong>å¢é•¿é€Ÿåº¦ç¼“æ…¢äº†ä¸€äº›</strong>ã€‚</p><p>å°±è¿™ä¹ˆä¸€ç›´å¢é•¿ç€åï¼Œç½‘ç»œå°±ä¼šæ…¢æ…¢è¿›å…¥äº†<strong>æ‹¥å¡</strong>çš„çŠ¶å†µäº†ï¼Œäºæ˜¯å°±ä¼šå‡ºç°<strong>ä¸¢åŒ…</strong>ç°è±¡ï¼Œè¿™æ—¶å°±éœ€è¦å¯¹ä¸¢å¤±çš„æ•°æ®åŒ…è¿›è¡Œ<strong>é‡ä¼ </strong>ã€‚</p><p>å½“è§¦å‘äº†é‡ä¼ æœºåˆ¶ï¼Œä¹Ÿå°±è¿›å…¥äº†ã€Œæ‹¥å¡å‘ç”Ÿç®—æ³•ã€ã€‚</p><h4 id="æ‹¥å¡å‘ç”Ÿ" tabindex="-1"><a class="header-anchor" href="#æ‹¥å¡å‘ç”Ÿ"><span>- æ‹¥å¡å‘ç”Ÿ</span></a></h4><p>å½“ç½‘ç»œå‡ºç°æ‹¥å¡ï¼Œä¹Ÿå°±æ˜¯ä¼šå‘ç”Ÿæ•°æ®åŒ…é‡ä¼ ï¼Œé‡ä¼ æœºåˆ¶ä¸»è¦æœ‰ä¸¤ç§ï¼š</p><ul><li><strong>è¶…æ—¶é‡ä¼ </strong></li><li><strong>å¿«é€Ÿé‡ä¼ </strong></li></ul><p>è¿™ä¸¤ç§<strong>ä½¿ç”¨çš„æ‹¥å¡å‘é€ç®—æ³•</strong>æ˜¯ä¸åŒçš„ï¼Œæ¥ä¸‹æ¥åˆ†åˆ«æ¥è¯´è¯´ã€‚</p><blockquote><p>å‘ç”Ÿè¶…æ—¶é‡ä¼ çš„æ‹¥å¡å‘ç”Ÿç®—æ³•</p></blockquote><p>å½“å‘ç”Ÿäº†ã€Œè¶…æ—¶é‡ä¼ ã€ï¼Œåˆ™å°±ä¼šä½¿ç”¨æ‹¥å¡å‘ç”Ÿç®—æ³•ã€‚</p><p>è¿™ä¸ªæ—¶å€™ï¼Œssthresh å’Œ cwnd çš„å€¼ä¼šå‘ç”Ÿå˜åŒ–ï¼š</p><ul><li><code>ssthresh</code> è®¾ä¸º <code>cwnd/2</code>ï¼Œ</li><li><code>cwnd</code> é‡ç½®ä¸º <code>1</code> ï¼ˆæ˜¯æ¢å¤ä¸º cwnd åˆå§‹åŒ–å€¼ï¼Œæˆ‘è¿™é‡Œå‡å®š cwnd åˆå§‹åŒ–å€¼ 1ï¼‰</li></ul><blockquote><p>æ€ä¹ˆæŸ¥çœ‹ç³»ç»Ÿçš„ cwnd åˆå§‹åŒ–å€¼ï¼Ÿ</p></blockquote><p>Linux é’ˆå¯¹æ¯ä¸€ä¸ª TCP è¿æ¥çš„ cwnd åˆå§‹åŒ–å€¼æ˜¯ 10ï¼Œä¹Ÿå°±æ˜¯ 10 ä¸ª MSSï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ ss -nli å‘½ä»¤æŸ¥çœ‹æ¯ä¸€ä¸ª TCP è¿æ¥çš„ cwnd åˆå§‹åŒ–å€¼ï¼Œå¦‚ä¸‹å›¾</p><figure><img src="'+Ts+'" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><p>æ‹¥å¡å‘ç”Ÿç®—æ³•çš„å˜åŒ–å¦‚ä¸‹å›¾ï¼š</p><img src="'+hs+'" alt="æ‹¥å¡å‘é€ â€”â€” è¶…æ—¶é‡ä¼ " style="zoom:67%;"><p>æ¥ç€ï¼Œå°±é‡æ–°å¼€å§‹æ…¢å¯åŠ¨ï¼Œ<strong>æ…¢å¯åŠ¨æ˜¯ä¼šçªç„¶å‡å°‘æ•°æ®æµçš„</strong>ã€‚è¿™çœŸæ˜¯ä¸€æ—¦ã€Œè¶…æ—¶é‡ä¼ ã€ï¼Œé©¬ä¸Šå›åˆ°è§£æ”¾å‰ã€‚ä½†æ˜¯è¿™ç§æ–¹å¼å¤ªæ¿€è¿›äº†ï¼Œååº”ä¹Ÿå¾ˆå¼ºçƒˆï¼Œä¼šé€ æˆ<strong>ç½‘ç»œå¡é¡¿</strong>ã€‚</p><p>å°±å¥½åƒæœ¬æ¥åœ¨ç§‹åå±±é«˜é€Ÿæ¼‚ç§»ç€ï¼Œçªç„¶æ¥ä¸ªç´§æ€¥åˆ¹è½¦ï¼Œè½®èƒå—å¾—äº†å—ã€‚ã€‚ã€‚</p><blockquote><p>å‘ç”Ÿå¿«é€Ÿé‡ä¼ çš„æ‹¥å¡å‘ç”Ÿç®—æ³•</p></blockquote><p>è¿˜æœ‰æ›´å¥½çš„æ–¹å¼ï¼Œå‰é¢æˆ‘ä»¬è®²è¿‡ã€Œå¿«é€Ÿé‡ä¼ ç®—æ³•ã€ã€‚å½“æ¥æ”¶æ–¹å‘ç°<strong>ä¸¢äº†ä¸€ä¸ªä¸­é—´åŒ…çš„æ—¶å€™</strong>ï¼Œ<strong>å‘é€ä¸‰æ¬¡å‰ä¸€ä¸ªåŒ…çš„ ACK</strong>ï¼Œäºæ˜¯å‘é€ç«¯å°±ä¼š<strong>å¿«é€Ÿåœ°é‡ä¼ ï¼Œä¸å¿…ç­‰å¾…è¶…æ—¶å†é‡ä¼ ã€‚</strong></p><p>TCP è®¤ä¸ºè¿™ç§æƒ…å†µä¸ä¸¥é‡ï¼Œå› ä¸ºå¤§éƒ¨åˆ†æ²¡ä¸¢ï¼Œåªä¸¢äº†ä¸€å°éƒ¨åˆ†ï¼Œåˆ™ <code>ssthresh</code> å’Œ <code>cwnd</code> å˜åŒ–å¦‚ä¸‹ï¼š</p><ul><li><code>cwnd = cwnd/2</code> ï¼Œä¹Ÿå°±æ˜¯è®¾ç½®ä¸ºåŸæ¥çš„ä¸€åŠ;</li><li><code>ssthresh = cwnd</code>;</li><li>è¿›å…¥å¿«é€Ÿæ¢å¤ç®—æ³•</li></ul><h4 id="å¿«é€Ÿæ¢å¤" tabindex="-1"><a class="header-anchor" href="#å¿«é€Ÿæ¢å¤"><span>- å¿«é€Ÿæ¢å¤</span></a></h4><p><strong>å¿«é€Ÿé‡ä¼ å’Œå¿«é€Ÿæ¢å¤ç®—æ³•ä¸€èˆ¬åŒæ—¶ä½¿ç”¨</strong>ï¼Œå¿«é€Ÿæ¢å¤ç®—æ³•æ˜¯è®¤ä¸ºï¼Œä½ è¿˜èƒ½æ”¶åˆ° 3 ä¸ªé‡å¤ ACK è¯´æ˜ç½‘ç»œä¹Ÿä¸é‚£ä¹ˆç³Ÿç³•ï¼Œæ‰€ä»¥æ²¡æœ‰å¿…è¦åƒ <code>RTO</code> è¶…æ—¶é‚£ä¹ˆå¼ºçƒˆã€‚</p><p>æ­£å¦‚å‰é¢æ‰€è¯´ï¼Œè¿›å…¥<strong>å¿«é€Ÿæ¢å¤ä¹‹å‰</strong>ï¼Œ<code>cwnd</code> å’Œ <code>ssthresh</code> å·²è¢«æ›´æ–°äº†ï¼š</p><ul><li><code>cwnd = cwnd/2</code> ï¼Œä¹Ÿå°±æ˜¯è®¾ç½®ä¸ºåŸæ¥çš„ä¸€åŠ;</li><li><code>ssthresh = cwnd</code>;</li></ul><p>ç„¶åï¼Œè¿›å…¥<strong>å¿«é€Ÿæ¢å¤ç®—æ³•</strong>å¦‚ä¸‹ï¼š</p><ul><li>æ‹¥å¡çª—å£ <code>cwnd = ssthresh + 3</code> ï¼ˆ 3 çš„æ„æ€æ˜¯ç¡®è®¤æœ‰ 3 ä¸ªæ•°æ®åŒ…è¢«æ”¶åˆ°äº†ï¼‰ï¼›</li><li>é‡ä¼ ä¸¢å¤±çš„æ•°æ®åŒ…ï¼›</li><li>å¦‚æœ<strong>å†æ”¶åˆ°é‡å¤çš„ ACKï¼Œé‚£ä¹ˆ cwnd å¢åŠ  1</strong>ï¼›</li><li>å¦‚æœæ”¶åˆ°æ–°æ•°æ®çš„ ACK åï¼ŒæŠŠ cwnd è®¾ç½®ä¸ºç¬¬ä¸€æ­¥ä¸­çš„ ssthresh çš„å€¼ï¼ŒåŸå› æ˜¯<strong>è¯¥ ACK ç¡®è®¤äº†æ–°çš„æ•°æ®</strong>ï¼Œè¯´æ˜ä» duplicated ACK æ—¶çš„æ•°æ®éƒ½å·²æ”¶åˆ°ï¼Œ<strong>è¯¥æ¢å¤è¿‡ç¨‹å·²ç»ç»“æŸ</strong>ï¼Œå¯ä»¥å›åˆ°æ¢å¤ä¹‹å‰çš„çŠ¶æ€äº†ï¼Œä¹Ÿå³å†æ¬¡è¿›å…¥æ‹¥å¡é¿å…çŠ¶æ€ï¼›</li></ul><p>å¿«é€Ÿæ¢å¤ç®—æ³•çš„å˜åŒ–è¿‡ç¨‹å¦‚ä¸‹å›¾ï¼š</p><img src="'+us+'" alt="å¿«é€Ÿé‡ä¼ å’Œå¿«é€Ÿæ¢å¤" style="zoom:67%;"><p>ä¹Ÿå°±æ˜¯æ²¡æœ‰åƒã€Œè¶…æ—¶é‡ä¼ ã€ä¸€å¤œå›åˆ°è§£æ”¾å‰ï¼Œè€Œæ˜¯è¿˜åœ¨æ¯”è¾ƒé«˜çš„å€¼ï¼Œåç»­å‘ˆçº¿æ€§å¢é•¿ã€‚</p><p><strong>TIP</strong></p><p>å¾ˆå¤šäººé—®é¢˜ï¼Œå¿«é€Ÿæ¢å¤ç®—æ³•è¿‡ç¨‹ä¸­ï¼Œä¸ºä»€ä¹ˆæ”¶åˆ°æ–°çš„æ•°æ®åï¼Œcwnd è®¾ç½®å›äº† ssthresh ï¼Ÿ</p>',253),zi={href:"https://github.com/muum641651",target:"_blank",rel:"noopener noreferrer"},Ei=n('<p>æˆ‘çš„ç†è§£æ˜¯ï¼š</p><ol><li>åœ¨å¿«é€Ÿæ¢å¤çš„è¿‡ç¨‹ä¸­ï¼Œé¦–å…ˆ ssthresh = cwnd/2ï¼Œç„¶å cwnd = ssthresh + 3ï¼Œè¡¨ç¤ºç½‘ç»œå¯èƒ½å‡ºç°äº†é˜»å¡ï¼Œæ‰€ä»¥éœ€è¦å‡å° cwnd ä»¥é¿å…ï¼ŒåŠ  3 ä»£è¡¨å¿«é€Ÿé‡ä¼ æ—¶å·²ç»ç¡®è®¤æ¥æ”¶åˆ°äº† 3 ä¸ªé‡å¤çš„æ•°æ®åŒ…ï¼›</li><li>éšåç»§ç»­é‡ä¼ ä¸¢å¤±çš„æ•°æ®åŒ…ï¼Œå¦‚æœå†æ”¶åˆ°é‡å¤çš„ ACKï¼Œé‚£ä¹ˆ cwnd å¢åŠ  1ã€‚åŠ  1 ä»£è¡¨æ¯ä¸ªæ”¶åˆ°çš„é‡å¤çš„ ACK åŒ…ï¼Œéƒ½å·²ç»ç¦»å¼€äº†ç½‘ç»œã€‚è¿™ä¸ªè¿‡ç¨‹çš„ç›®çš„æ˜¯å°½å¿«å°†ä¸¢å¤±çš„æ•°æ®åŒ…å‘ç»™ç›®æ ‡ã€‚</li><li>å¦‚æœæ”¶åˆ°æ–°æ•°æ®çš„ ACK åï¼ŒæŠŠ cwnd è®¾ç½®ä¸ºç¬¬ä¸€æ­¥ä¸­çš„ ssthresh çš„å€¼ï¼Œæ¢å¤è¿‡ç¨‹ç»“æŸã€‚</li></ol><blockquote><p><strong>é¦–å…ˆï¼Œå¿«é€Ÿæ¢å¤æ˜¯æ‹¥å¡å‘ç”Ÿåæ…¢å¯åŠ¨çš„ä¼˜åŒ–ï¼Œå…¶é¦–è¦ç›®çš„ä»ç„¶æ˜¯é™ä½ cwnd æ¥å‡ç¼“æ‹¥å¡ï¼Œæ‰€ä»¥å¿…ç„¶ä¼šå‡ºç° cwnd ä»å¤§åˆ°å°çš„æ”¹å˜ã€‚</strong></p><p><strong>å…¶æ¬¡ï¼Œè¿‡ç¨‹2ï¼ˆcwndé€æ¸åŠ 1ï¼‰çš„å­˜åœ¨æ˜¯ä¸ºäº†å°½å¿«å°†ä¸¢å¤±çš„æ•°æ®åŒ…å‘ç»™ç›®æ ‡ï¼Œä»è€Œè§£å†³æ‹¥å¡çš„æ ¹æœ¬é—®é¢˜ï¼ˆä¸‰æ¬¡ç›¸åŒçš„ ACK å¯¼è‡´çš„å¿«é€Ÿé‡ä¼ ï¼‰ï¼Œæ‰€ä»¥è¿™ä¸€è¿‡ç¨‹ä¸­ cwnd åè€Œæ˜¯é€æ¸å¢å¤§çš„ã€‚</strong></p></blockquote><h2 id="-5" tabindex="-1"><a class="header-anchor" href="#-5"><span>--------------</span></a></h2><h2 id="_4-3-tcp-å®æˆ˜æŠ“åŒ…åˆ†æ" tabindex="-1"><a class="header-anchor" href="#_4-3-tcp-å®æˆ˜æŠ“åŒ…åˆ†æ"><span>4.3 TCP å®æˆ˜æŠ“åŒ…åˆ†æ</span></a></h2><p>ä¸ºäº†è®©å¤§å®¶<strong>æ›´å®¹æ˜“ã€Œçœ‹å¾—è§ã€ TCP</strong>ï¼Œæˆ‘æ­å»ºä¸å°‘æµ‹è¯•ç¯å¢ƒï¼Œå¹¶ä¸”æ•°æ®åŒ…æŠ“å¾ˆå¤šæ¬¡ï¼ŒèŠ±è´¹äº†ä¸å°‘æ—¶é—´ï¼Œæ‰æŠ“åˆ°æ¯”è¾ƒå®¹æ˜“åˆ†æçš„æ•°æ®åŒ…ã€‚</p><p>æ¥ä¸‹æ¥<strong>ä¸¢åŒ…ã€ä¹±åºã€è¶…æ—¶é‡ä¼ ã€å¿«é€Ÿé‡ä¼ ã€é€‰æ‹©æ€§ç¡®è®¤ã€æµé‡æ§åˆ¶</strong>ç­‰ç­‰ TCP çš„ç‰¹æ€§ï¼Œéƒ½èƒ½ã€Œä¸€è§ˆæ— ä½™ã€ã€‚</p><p>æ²¡é”™ï¼Œæˆ‘æŠŠ TCP çš„&quot;è¡£æœæ‰’å…‰&quot;äº†ï¼Œå°±ä¸ºäº†ç»™å¤§å®¶çœ‹çš„æ¸…æ¥šï¼Œå˜»å˜»ã€‚</p><img src="'+_s+'" alt="æçº²" style="zoom:67%;"><h4 id="æ˜¾å½¢-ä¸å¯è§-çš„ç½‘ç»œåŒ…" tabindex="-1"><a class="header-anchor" href="#æ˜¾å½¢-ä¸å¯è§-çš„ç½‘ç»œåŒ…"><span>- æ˜¾å½¢â€œä¸å¯è§â€çš„ç½‘ç»œåŒ…</span></a></h4><p>ç½‘ç»œä¸–ç•Œä¸­çš„æ•°æ®åŒ…äº¤äº’æˆ‘ä»¬è‚‰çœ¼æ˜¯çœ‹ä¸è§çš„ï¼Œå®ƒä»¬å°±å¥½åƒéšå½¢äº†ä¸€æ ·ï¼Œæˆ‘ä»¬å¯¹ç€è¯¾æœ¬å­¦ä¹ è®¡ç®—æœºç½‘ç»œçš„æ—¶å€™å°±ä¼šè§‰å¾—éå¸¸çš„æŠ½è±¡ï¼ŒåŠ å¤§äº†å­¦ä¹ çš„éš¾åº¦ã€‚</p><p>è¿˜åˆ«è¯´ï¼Œæˆ‘è‡ªå·±åœ¨å¤§å­¦çš„æ—¶å€™ï¼Œä¹Ÿæ˜¯å¦‚æ­¤ã€‚</p><p>ç›´åˆ°å·¥ä½œåï¼Œè®¤è¯†äº†ä¸¤å¤§åˆ†æç½‘ç»œçš„åˆ©å™¨ï¼š<strong>tcpdump å’Œ Wireshark</strong>ï¼Œè¿™ä¸¤å¤§åˆ©å™¨æŠŠæˆ‘ä»¬â€œçœ‹ä¸è§â€çš„æ•°æ®åŒ…ï¼Œå‘ˆç°åœ¨æˆ‘ä»¬çœ¼å‰ï¼Œä¸€ç›®äº†ç„¶ã€‚</p><p>å”‰ï¼Œå½“åˆå¤§å­¦å­¦ä¹ è®¡ç½‘çš„æ—¶å€™ï¼Œè¦æ˜¯èƒ½çŸ¥é“è¿™ä¸¤ä¸ªå·¥å…·ï¼Œå°±ä¸ä¼šå­¦çš„ä¸€è„¸æ‡µé€¼ã€‚</p><blockquote><p>tcpdump å’Œ Wireshark æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</p></blockquote><p>tcpdump å’Œ <strong>Wireshark</strong> å°±æ˜¯æœ€å¸¸ç”¨çš„<strong>ç½‘ç»œæŠ“åŒ…å’Œåˆ†æå·¥å…·</strong>ï¼Œæ›´æ˜¯åˆ†æç½‘ç»œæ€§èƒ½å¿…ä¸å¯å°‘çš„åˆ©å™¨ã€‚</p><ul><li>tcpdump ä»…æ”¯æŒå‘½ä»¤è¡Œæ ¼å¼ä½¿ç”¨ï¼Œå¸¸ç”¨åœ¨ Linux æœåŠ¡å™¨ä¸­æŠ“å–å’Œåˆ†æç½‘ç»œåŒ…ã€‚</li><li>Wireshark é™¤äº†å¯ä»¥æŠ“åŒ…å¤–ï¼Œè¿˜æä¾›äº†å¯è§†åŒ–åˆ†æç½‘ç»œåŒ…çš„å›¾å½¢é¡µé¢ã€‚</li></ul><p>æ‰€ä»¥ï¼Œè¿™ä¸¤è€…å®é™…ä¸Šæ˜¯æ­é…ä½¿ç”¨çš„ï¼Œå…ˆç”¨ tcpdump å‘½ä»¤åœ¨ Linux æœåŠ¡å™¨ä¸ŠæŠ“åŒ…ï¼Œæ¥ç€æŠŠæŠ“åŒ…çš„æ–‡ä»¶æ‹–å‡ºåˆ° Windows ç”µè„‘åï¼Œç”¨ Wireshark å¯è§†åŒ–åˆ†æã€‚</p><p>å½“ç„¶ï¼Œå¦‚æœä½ æ˜¯åœ¨ Windows ä¸ŠæŠ“åŒ…ï¼Œåªéœ€è¦ç”¨ Wireshark å·¥å…·å°±å¯ä»¥ã€‚</p><blockquote><p>tcpdump åœ¨ Linux ä¸‹å¦‚ä½•æŠ“åŒ…ï¼Ÿ</p></blockquote><p>tcpdump æä¾›äº†å¤§é‡çš„é€‰é¡¹ä»¥åŠå„å¼å„æ ·çš„è¿‡æ»¤è¡¨è¾¾å¼ï¼Œæ¥å¸®åŠ©ä½ æŠ“å–æŒ‡å®šçš„æ•°æ®åŒ…ï¼Œä¸è¿‡ä¸è¦æ‹…å¿ƒï¼Œåªéœ€è¦æŒæ¡ä¸€äº›å¸¸ç”¨é€‰é¡¹å’Œè¿‡æ»¤è¡¨è¾¾å¼ï¼Œå°±å¯ä»¥æ»¡è¶³å¤§éƒ¨åˆ†åœºæ™¯çš„éœ€è¦äº†ã€‚</p><p>å‡è®¾æˆ‘ä»¬è¦æŠ“å–ä¸‹é¢çš„ ping çš„æ•°æ®åŒ…ï¼š</p><img src="'+Ps+'" alt="img" style="zoom:50%;"><p>è¦æŠ“å–ä¸Šé¢çš„ ping å‘½ä»¤æ•°æ®åŒ…ï¼Œé¦–å…ˆæˆ‘ä»¬è¦çŸ¥é“ ping çš„æ•°æ®åŒ…æ˜¯ <code>icmp</code> åè®®ï¼Œæ¥ç€åœ¨ä½¿ç”¨ tcpdump æŠ“åŒ…çš„æ—¶å€™ï¼Œå°±å¯ä»¥æŒ‡å®šåªæŠ“ icmp åè®®çš„æ•°æ®åŒ…ï¼š</p><figure><img src="'+Cs+'" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><p>é‚£ä¹ˆå½“ tcpdump æŠ“å–åˆ° icmp æ•°æ®åŒ…åï¼Œ è¾“å‡ºæ ¼å¼å¦‚ä¸‹ï¼š</p><img src="'+bs+'" alt="img" style="zoom:67%;"><img src="'+ks+'" alt="img" style="zoom:50%;"><p>ä» tcpdump æŠ“å–çš„ icmp æ•°æ®åŒ…ï¼Œæˆ‘ä»¬å¾ˆæ¸…æ¥šçš„çœ‹åˆ° <code>icmp echo</code> çš„äº¤äº’è¿‡ç¨‹äº†ï¼Œé¦–å…ˆå‘é€æ–¹å‘èµ·äº† <code>ICMP echo request</code> è¯·æ±‚æŠ¥æ–‡ï¼Œæ¥æ”¶æ–¹æ”¶åˆ°åå›äº†ä¸€ä¸ª <code>ICMP echo reply</code> å“åº”æŠ¥æ–‡ï¼Œä¹‹å <code>seq</code> æ˜¯é€’å¢çš„ã€‚</p><p>æˆ‘åœ¨è¿™é‡Œä¹Ÿå¸®ä½ æ•´ç†äº†ä¸€äº›æœ€å¸¸è§çš„ç”¨æ³•ï¼Œå¹¶ä¸”ç»˜åˆ¶æˆäº†è¡¨æ ¼ï¼Œä½ å¯ä»¥å‚è€ƒä½¿ç”¨ã€‚</p><p>é¦–å…ˆï¼Œå…ˆæ¥çœ‹çœ‹å¸¸ç”¨çš„é€‰é¡¹ç±»ï¼Œåœ¨ä¸Šé¢çš„ ping ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ç”¨è¿‡ <code>-i</code> é€‰é¡¹æŒ‡å®šç½‘å£ï¼Œç”¨è¿‡ <code>-nn</code> é€‰é¡¹ä¸å¯¹ IP åœ°å€å’Œç«¯å£åç§°è§£æã€‚å…¶ä»–å¸¸ç”¨çš„é€‰é¡¹ï¼Œå¦‚ä¸‹è¡¨æ ¼ï¼š</p><img src="'+fs+'" alt="tcpdump å¸¸ç”¨é€‰é¡¹ç±»" style="zoom:67%;"><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å†æ¥çœ‹çœ‹å¸¸ç”¨çš„è¿‡æ»¤è¡¨ç”¨æ³•ï¼Œåœ¨ä¸Šé¢çš„ ping ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ç”¨è¿‡çš„æ˜¯ <code>icmp and host 183.232.231.174</code>ï¼Œè¡¨ç¤ºæŠ“å– icmp åè®®çš„æ•°æ®åŒ…ï¼Œä»¥åŠæºåœ°å€æˆ–ç›®æ ‡åœ°å€ä¸º 183.232.231.174 çš„åŒ…ã€‚å…¶ä»–å¸¸ç”¨çš„è¿‡æ»¤é€‰é¡¹ï¼Œæˆ‘ä¹Ÿæ•´ç†æˆäº†ä¸‹é¢è¿™ä¸ªè¡¨æ ¼ã€‚</p><img src="'+Ss+'" alt="tcpdump å¸¸ç”¨è¿‡æ»¤è¡¨è¾¾å¼ç±»" style="zoom:67%;"><p>è¯´äº†è¿™ä¹ˆå¤šï¼Œä½ åº”è¯¥ä¹Ÿå‘ç°äº†ï¼Œtcpdump è™½ç„¶åŠŸèƒ½å¼ºå¤§ï¼Œä½†æ˜¯è¾“å‡ºçš„æ ¼å¼å¹¶ä¸ç›´è§‚ã€‚</p><p>æ‰€ä»¥ï¼Œåœ¨å·¥ä½œä¸­ tcpdump åªæ˜¯ç”¨æ¥æŠ“å–æ•°æ®åŒ…ï¼Œä¸ç”¨æ¥åˆ†ææ•°æ®åŒ…ï¼Œè€Œæ˜¯æŠŠ tcpdump æŠ“å–çš„æ•°æ®åŒ…ä¿å­˜æˆ pcap åç¼€çš„æ–‡ä»¶ï¼Œæ¥ç€ç”¨ Wireshark å·¥å…·è¿›è¡Œæ•°æ®åŒ…åˆ†æã€‚</p><blockquote><p>Wireshark å·¥å…·å¦‚ä½•åˆ†ææ•°æ®åŒ…ï¼Ÿ</p></blockquote><p>Wireshark é™¤äº†å¯ä»¥æŠ“åŒ…å¤–ï¼Œè¿˜æä¾›äº†<strong>å¯è§†åŒ–åˆ†æç½‘ç»œåŒ…çš„å›¾å½¢é¡µé¢</strong>ï¼ŒåŒæ—¶ï¼Œè¿˜å†…ç½®äº†ä¸€ç³»åˆ—çš„æ±‡æ€»åˆ†æå·¥å…·ã€‚</p><p>æ¯”å¦‚ï¼Œæ‹¿ä¸Šé¢çš„ ping ä¾‹å­æ¥è¯´ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤ï¼ŒæŠŠæŠ“å–çš„æ•°æ®åŒ…ä¿å­˜åˆ° ping.pcap æ–‡ä»¶</p><img src="'+As+'" alt="img" style="zoom:67%;"><p>æ¥ç€æŠŠ ping.pcap æ–‡ä»¶æ‹–åˆ°ç”µè„‘ï¼Œå†ç”¨ Wireshark æ‰“å¼€å®ƒã€‚æ‰“å¼€åï¼Œä½ å°±å¯ä»¥çœ‹åˆ°ä¸‹é¢è¿™ä¸ªç•Œé¢ï¼š</p><figure><img src="'+Is+'" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><p>æ˜¯å§ï¼Ÿåœ¨ Wireshark çš„é¡µé¢é‡Œï¼Œå¯ä»¥æ›´åŠ ç›´è§‚çš„åˆ†ææ•°æ®åŒ…ï¼Œä¸ä»…å±•ç¤ºå„ä¸ª<strong>ç½‘ç»œåŒ…çš„å¤´éƒ¨ä¿¡æ¯</strong>ï¼Œè¿˜ä¼šç”¨ä¸åŒçš„é¢œè‰²æ¥åŒºåˆ†ä¸åŒçš„åè®®ï¼Œç”±äºè¿™æ¬¡æŠ“åŒ…åªæœ‰ ICMP åè®®ï¼Œæ‰€ä»¥åªæœ‰ç´«è‰²çš„æ¡ç›®ã€‚</p><p>æ¥ç€ï¼Œåœ¨ç½‘ç»œåŒ…åˆ—è¡¨ä¸­é€‰æ‹©æŸä¸€ä¸ªç½‘ç»œåŒ…åï¼Œåœ¨å…¶ä¸‹é¢çš„ç½‘ç»œåŒ…è¯¦æƒ…ä¸­ï¼Œ<strong>å¯ä»¥æ›´æ¸…æ¥šçš„çœ‹åˆ°ï¼Œè¿™ä¸ªç½‘ç»œåŒ…åœ¨åè®®æ ˆå„å±‚çš„è¯¦ç»†ä¿¡æ¯</strong>ã€‚æ¯”å¦‚ï¼Œä»¥ç¼–å· 1 çš„ç½‘ç»œåŒ…ä¸ºä¾‹å­ï¼š</p><figure><img src="'+xs+'" alt="ping ç½‘ç»œåŒ…" tabindex="0" loading="lazy"><figcaption>ping ç½‘ç»œåŒ…</figcaption></figure><ul><li>å¯ä»¥åœ¨æ•°æ®é“¾è·¯å±‚ï¼Œçœ‹åˆ° MAC åŒ…å¤´ä¿¡æ¯ï¼Œå¦‚æº MAC åœ°å€å’Œç›®æ ‡ MAC åœ°å€ç­‰å­—æ®µï¼›</li><li>å¯ä»¥åœ¨ IP å±‚ï¼Œçœ‹åˆ° IP åŒ…å¤´ä¿¡æ¯ï¼Œå¦‚æº IP åœ°å€å’Œç›®æ ‡ IP åœ°å€ã€TTLã€IP åŒ…é•¿åº¦ã€åè®®ç­‰ IP åè®®å„ä¸ªå­—æ®µçš„æ•°å€¼å’Œå«ä¹‰ï¼›</li><li>å¯ä»¥åœ¨ ICMP å±‚ï¼Œçœ‹åˆ° ICMP åŒ…å¤´ä¿¡æ¯ï¼Œæ¯”å¦‚ Typeã€Code ç­‰ ICMP åè®®å„ä¸ªå­—æ®µçš„æ•°å€¼å’Œå«ä¹‰ï¼›</li></ul><p>Wireshark ç”¨äº†åˆ†å±‚çš„æ–¹å¼ï¼Œå±•ç¤ºäº†å„ä¸ªå±‚çš„åŒ…å¤´ä¿¡æ¯ï¼ŒæŠŠâ€œä¸å¯è§â€çš„æ•°æ®åŒ…ï¼Œæ¸…æ¸…æ¥šæ¥šçš„å±•ç¤ºäº†ç»™æˆ‘ä»¬ï¼Œè¿˜æœ‰ç†ç”±å­¦ä¸å¥½è®¡ç®—æœºç½‘ç»œå—ï¼Ÿæ˜¯ä¸æ˜¯<strong>ç›¸è§æ¨æ™š</strong>ï¼Ÿ</p><p>ä» ping çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°<strong>ç½‘ç»œåˆ†å±‚å°±åƒæœ‰åºçš„åˆ†å·¥</strong>ï¼Œæ¯ä¸€å±‚éƒ½æœ‰è‡ªå·±çš„è´£ä»»èŒƒå›´å’Œä¿¡æ¯ï¼Œä¸Šå±‚åè®®å®Œæˆå·¥ä½œåå°±äº¤ç»™ä¸‹ä¸€å±‚ï¼Œæœ€ç»ˆå½¢æˆä¸€ä¸ªå®Œæ•´çš„ç½‘ç»œåŒ…ã€‚</p><img src="'+Ns+'" alt="img" style="zoom:67%;"><h4 id="è§£å¯†-tcp-ä¸‰æ¬¡æ¡æ‰‹-å››æ¬¡æŒ¥æ‰‹" tabindex="-1"><a class="header-anchor" href="#è§£å¯†-tcp-ä¸‰æ¬¡æ¡æ‰‹-å››æ¬¡æŒ¥æ‰‹"><span>-- è§£å¯† TCP ä¸‰æ¬¡æ¡æ‰‹ å››æ¬¡æŒ¥æ‰‹</span></a></h4><p>æ—¢ç„¶å­¦ä¼šäº† tcpdump å’Œ Wireshark ä¸¤å¤§ç½‘ç»œåˆ†æåˆ©å™¨ï¼Œé‚£æˆ‘ä»¬å¿«é©¬åŠ é­ï¼Œæ¥ä¸‹æ¥ç”¨å®ƒä¿©æŠ“<strong>å–å’Œåˆ†æ HTTP åè®®ç½‘ç»œåŒ…</strong>ï¼Œå¹¶<strong>ç†è§£ TCP ä¸‰æ¬¡æ¡æ‰‹å’Œå››æ¬¡æŒ¥æ‰‹çš„å·¥ä½œåŸç†</strong>ã€‚</p><p>æœ¬æ¬¡ä¾‹å­ï¼Œæˆ‘ä»¬å°†è¦è®¿é—®çš„ http://192.168.3.200 æœåŠ¡ç«¯ã€‚åœ¨ç»ˆç«¯ä¸€ç”¨ tcpdump å‘½ä»¤æŠ“å–æ•°æ®åŒ…ï¼š</p><img src="'+qs+'" alt="img" style="zoom:67%;"><p>æ¥ç€ï¼Œåœ¨ç»ˆç«¯äºŒæ‰§è¡Œä¸‹é¢çš„ curl å‘½ä»¤ï¼š</p><img src="'+ys+'" alt="img" style="zoom:67%;"><p>æœ€åï¼Œå›åˆ°ç»ˆç«¯ä¸€ï¼ŒæŒ‰ä¸‹ Ctrl+C åœæ­¢ tcpdumpï¼Œå¹¶æŠŠå¾—åˆ°çš„ http.pcap å–å‡ºåˆ°ç”µè„‘ã€‚</p><p>ä½¿ç”¨ Wireshark æ‰“å¼€ http.pcap åï¼Œä½ å°±å¯ä»¥<strong>åœ¨ Wireshark ä¸­</strong>ï¼Œçœ‹åˆ°å¦‚ä¸‹çš„ç•Œé¢ï¼š</p><figure><img src="'+Hs+'" alt="HTTP ç½‘ç»œåŒ…" tabindex="0" loading="lazy"><figcaption>HTTP ç½‘ç»œåŒ…</figcaption></figure><blockquote><p>æˆ‘ä»¬éƒ½çŸ¥é“ HTTP æ˜¯åŸºäº TCP åè®®è¿›è¡Œä¼ è¾“çš„ï¼Œé‚£ä¹ˆï¼š</p><ul><li>æœ€å¼€å§‹çš„ 3 ä¸ªåŒ…å°±æ˜¯ TCP ä¸‰æ¬¡æ¡æ‰‹å»ºç«‹è¿æ¥çš„åŒ…</li><li>ä¸­é—´æ˜¯ HTTP è¯·æ±‚å’Œå“åº”çš„åŒ…</li><li>è€Œæœ€åçš„ 3 ä¸ªåŒ…åˆ™æ˜¯ TCP æ–­å¼€è¿æ¥çš„æŒ¥æ‰‹åŒ…</li></ul></blockquote><p>Wireshark å¯ä»¥ç”¨<strong>æ—¶åºå›¾</strong>çš„æ–¹å¼æ˜¾ç¤º<strong>æ•°æ®åŒ…äº¤äº’çš„è¿‡ç¨‹</strong>ï¼Œä»èœå•æ ä¸­ï¼Œç‚¹å‡» <strong>ç»Ÿè®¡ (Statistics) -&gt; æµé‡å›¾ (Flow Graph)</strong>ï¼Œç„¶åï¼Œåœ¨å¼¹å‡ºçš„ç•Œé¢ä¸­çš„ã€Œæµé‡ç±»å‹ã€é€‰æ‹© <strong>ã€ŒTCP Flowsã€</strong>ï¼Œä½ å¯ä»¥æ›´æ¸…æ™°çš„çœ‹åˆ°ï¼Œæ•´ä¸ªè¿‡ç¨‹ä¸­ <strong>TCP æµçš„æ‰§è¡Œè¿‡ç¨‹</strong>ï¼š</p><figure><img src="'+vs+'" alt="TCP æµé‡å›¾" tabindex="0" loading="lazy"><figcaption>TCP æµé‡å›¾</figcaption></figure><blockquote><p>ä½ å¯èƒ½ä¼šå¥½å¥‡ï¼Œä¸ºä»€ä¹ˆä¸‰æ¬¡æ¡æ‰‹è¿æ¥è¿‡ç¨‹çš„ Seq æ˜¯ 0 ï¼Ÿ</p></blockquote><p>å®é™…ä¸Šæ˜¯å› ä¸º Wireshark å·¥å…·å¸®æˆ‘ä»¬åšäº†ä¼˜åŒ–ï¼Œå®ƒé»˜è®¤æ˜¾ç¤ºçš„æ˜¯åºåˆ—å· seq æ˜¯<strong>ç›¸å¯¹å€¼</strong>ï¼Œè€Œä¸æ˜¯<strong>çœŸå®å€¼</strong>ã€‚</p><p>å¦‚æœä½ æƒ³çœ‹åˆ°å®é™…çš„åºåˆ—å·çš„å€¼ï¼Œå¯ä»¥å³é”®èœå•ï¼Œ ç„¶åæ‰¾åˆ°ã€Œåè®®é¦–é€‰é¡¹ã€ï¼Œæ¥ç€æ‰¾åˆ°ã€ŒRelative Seqã€åï¼ŒæŠŠå®ƒç»™å–æ¶ˆï¼Œæ“ä½œå¦‚ä¸‹ï¼š</p><figure><img src="'+zs+'" alt="å–æ¶ˆåºåˆ—å·ç›¸å¯¹å€¼æ˜¾ç¤º" tabindex="0" loading="lazy"><figcaption>å–æ¶ˆåºåˆ—å·ç›¸å¯¹å€¼æ˜¾ç¤º</figcaption></figure><p>å–æ¶ˆåï¼ŒSeq æ˜¾ç¤ºçš„å°±æ˜¯çœŸå®å€¼äº†ï¼š</p><figure><img src="'+Es+'" alt="TCP æµé‡å›¾" tabindex="0" loading="lazy"><figcaption>TCP æµé‡å›¾</figcaption></figure><p>å¯è§ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯çš„åºåˆ—å·å®é™…ä¸Šæ˜¯ä¸åŒçš„ï¼Œ<strong>åºåˆ—å·æ˜¯ä¸€ä¸ªéšæœºå€¼ã€‚</strong></p><p>è¿™å…¶å®è·Ÿæˆ‘ä»¬ä¹¦ä¸Šçœ‹åˆ°çš„ TCP ä¸‰æ¬¡æ¡æ‰‹å’Œå››æ¬¡æŒ¥æ‰‹å¾ˆç±»ä¼¼ï¼Œä½œä¸ºå¯¹æ¯”ï¼Œä½ é€šå¸¸çœ‹åˆ°çš„ TCP ä¸‰æ¬¡æ¡æ‰‹å’Œå››æ¬¡æŒ¥æ‰‹çš„æµç¨‹ï¼ŒåŸºæœ¬æ˜¯è¿™æ ·çš„ï¼š</p><img src="'+ws+'" alt="TCP ä¸‰æ¬¡æ¡æ‰‹å’Œå››æ¬¡æŒ¥æ‰‹çš„æµç¨‹" style="zoom:67%;"><blockquote><p>ä¸ºä»€ä¹ˆæŠ“åˆ°çš„ TCP æŒ¥æ‰‹æ˜¯<strong>ä¸‰æ¬¡</strong>ï¼Œè€Œä¸æ˜¯ä¹¦ä¸Šè¯´çš„å››æ¬¡ï¼Ÿ</p></blockquote><p>å½“è¢«åŠ¨å…³é—­æ–¹ï¼ˆä¸Šå›¾çš„æœåŠ¡ç«¯ï¼‰åœ¨ TCP æŒ¥æ‰‹è¿‡ç¨‹ä¸­ï¼Œã€Œ<strong>æ²¡æœ‰æ•°æ®è¦å‘é€ã€å¹¶ä¸”ã€Œå¼€å¯äº† TCP å»¶è¿Ÿç¡®è®¤æœºåˆ¶ã€ï¼Œé‚£ä¹ˆç¬¬äºŒå’Œç¬¬ä¸‰æ¬¡æŒ¥æ‰‹å°±ä¼šåˆå¹¶ä¼ è¾“ï¼Œè¿™æ ·å°±å‡ºç°äº†ä¸‰æ¬¡æŒ¥æ‰‹ã€‚</strong></p><p>è€Œé€šå¸¸æƒ…å†µä¸‹ï¼ŒæœåŠ¡å™¨ç«¯æ”¶åˆ°å®¢æˆ·ç«¯çš„ <code>FIN</code> åï¼Œ<strong>å¾ˆå¯èƒ½è¿˜æ²¡å‘é€å®Œæ•°æ®</strong>ï¼Œæ‰€ä»¥å°±ä¼šå…ˆå›å¤å®¢æˆ·ç«¯ä¸€ä¸ª <code>ACK</code> åŒ…ï¼Œç¨ç­‰ä¸€ä¼šå„¿ï¼Œ<strong>å®Œæˆæ‰€æœ‰æ•°æ®åŒ…çš„å‘é€å</strong>ï¼Œæ‰ä¼šå‘é€ <code>FIN</code> åŒ…ï¼Œè¿™ä¹Ÿå°±æ˜¯<strong>å››æ¬¡æŒ¥æ‰‹äº†</strong>ã€‚</p><h4 id="tcp-ä¸‰æ¬¡æ¡æ‰‹å¼‚å¸¸æƒ…å†µå®æˆ˜åˆ†æ" tabindex="-1"><a class="header-anchor" href="#tcp-ä¸‰æ¬¡æ¡æ‰‹å¼‚å¸¸æƒ…å†µå®æˆ˜åˆ†æ"><span>-- TCP ä¸‰æ¬¡æ¡æ‰‹å¼‚å¸¸æƒ…å†µå®æˆ˜åˆ†æ</span></a></h4><p>TCP ä¸‰æ¬¡æ¡æ‰‹çš„è¿‡ç¨‹ç›¸ä¿¡å¤§å®¶éƒ½èƒŒçš„æ»šç“œçƒ‚ç†Ÿï¼Œé‚£ä¹ˆä½ æœ‰æ²¡æœ‰æƒ³è¿‡è¿™ä¸‰ä¸ªå¼‚å¸¸æƒ…å†µï¼š</p><blockquote><ul><li><strong>TCP ç¬¬ä¸€æ¬¡æ¡æ‰‹çš„ SYN ä¸¢åŒ…äº†ï¼Œä¼šå‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ</strong></li><li><strong>TCP ç¬¬äºŒæ¬¡æ¡æ‰‹çš„ SYNã€ACK ä¸¢åŒ…äº†ï¼Œä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ</strong></li><li><strong>TCP ç¬¬ä¸‰æ¬¡æ¡æ‰‹çš„ ACK åŒ…ä¸¢äº†ï¼Œä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ</strong></li></ul></blockquote><p>æœ‰çš„å°ä¼™ä¼´å¯èƒ½è¯´ï¼šâ€œå¾ˆç®€å•å‘€ï¼ŒåŒ…ä¸¢äº†å°±ä¼š<strong>é‡ä¼ </strong>å˜›ã€‚â€</p><p>é‚£æˆ‘åœ¨ç»§ç»­é—®ä½ ï¼š</p><ul><li>é‚£ä¼šé‡ä¼ å‡ æ¬¡ï¼Ÿ</li><li>è¶…æ—¶é‡ä¼ çš„æ—¶é—´ RTO ä¼šå¦‚ä½•å˜åŒ–ï¼Ÿ</li><li>åœ¨ Linux ä¸‹å¦‚ä½•è®¾ç½®é‡ä¼ æ¬¡æ•°ï¼Ÿ</li><li>....</li></ul><p>æ˜¯ä¸æ˜¯å“‘å£æ— è¨€ï¼Œæ— æ³•å›ç­”ï¼Ÿ</p><p>ä¸çŸ¥é“æ²¡å…³ç³»ï¼Œæ¥ä¸‹é‡Œæˆ‘ç”¨ä¸‰ä¸ªå®éªŒæ¡ˆä¾‹ï¼Œå¸¦å¤§å®¶ä¸€èµ·æ¢ç©¶æ¢ç©¶è¿™ä¸‰ç§å¼‚å¸¸ã€‚</p><p><strong>å®éªŒåœºæ™¯</strong></p><p>æœ¬æ¬¡å®éªŒç”¨äº†ä¸¤å°è™šæ‹Ÿæœºï¼Œä¸€å°ä½œä¸ºæœåŠ¡ç«¯ï¼Œä¸€å°ä½œä¸ºå®¢æˆ·ç«¯ï¼Œå®ƒä»¬çš„å…³ç³»å¦‚ä¸‹ï¼š</p><figure><img src="'+Ks+'" alt="å®éªŒç¯å¢ƒ" tabindex="0" loading="lazy"><figcaption>å®éªŒç¯å¢ƒ</figcaption></figure><ul><li>å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯éƒ½æ˜¯ CentOs 6.5 Linuxï¼ŒLinux å†…æ ¸ç‰ˆæœ¬ 2.6.32</li><li>æœåŠ¡ç«¯ 192.168.12.36ï¼Œapache web æœåŠ¡</li><li>å®¢æˆ·ç«¯ 192.168.12.37</li></ul><h5 id="å®éªŒä¸€-tcp-ç¬¬ä¸€æ¬¡æ¡æ‰‹-syn-ä¸¢åŒ…" tabindex="-1"><a class="header-anchor" href="#å®éªŒä¸€-tcp-ç¬¬ä¸€æ¬¡æ¡æ‰‹-syn-ä¸¢åŒ…"><span>- å®éªŒä¸€ï¼šTCP ç¬¬ä¸€æ¬¡æ¡æ‰‹ SYN ä¸¢åŒ…</span></a></h5><p>ä¸ºäº†æ¨¡æ‹Ÿ TCP ç¬¬ä¸€æ¬¡æ¡æ‰‹ SYN ä¸¢åŒ…çš„æƒ…å†µï¼Œæˆ‘æ˜¯åœ¨æ‹”æ‰æœåŠ¡å™¨çš„ç½‘çº¿åï¼Œç«‹åˆ»åœ¨å®¢æˆ·ç«¯æ‰§è¡Œ curl å‘½ä»¤ï¼š</p><img src="'+Ds+'" alt="img" style="zoom:50%;"><p>å…¶é—´ tcpdump æŠ“åŒ…çš„å‘½ä»¤å¦‚ä¸‹ï¼š</p><img src="'+Ms+'" alt="img" style="zoom:67%;"><p>è¿‡äº†ä¸€ä¼šï¼Œ curl è¿”å›äº†è¶…æ—¶è¿æ¥çš„é”™è¯¯ï¼š</p><img src="'+Ls+'" alt="img" style="zoom:67%;"><p>ä» <code>date</code> è¿”å›çš„æ—¶é—´ï¼Œå¯ä»¥å‘ç°<strong>åœ¨è¶…æ—¶æ¥è¿‘ 1 åˆ†é’Ÿçš„æ—¶é—´å</strong>ï¼Œcurl è¿”å›äº†é”™è¯¯ã€‚</p><p>æ¥ç€ï¼ŒæŠŠ tcp_sys_timeout.pcap æ–‡ä»¶ç”¨ Wireshark æ‰“å¼€åˆ†æï¼Œæ˜¾ç¤ºå¦‚ä¸‹å›¾ï¼š</p><figure><img src="'+Rs+`" alt="SYN è¶…æ—¶é‡ä¼ äº”æ¬¡" tabindex="0" loading="lazy"><figcaption>SYN è¶…æ—¶é‡ä¼ äº”æ¬¡</figcaption></figure><p>ä»ä¸Šå›¾å¯ä»¥å‘ç°ï¼Œ å®¢æˆ·ç«¯å‘èµ·äº† SYN åŒ…åï¼Œä¸€ç›´æ²¡æœ‰æ”¶åˆ°æœåŠ¡ç«¯çš„ ACK ï¼Œæ‰€ä»¥ä¸€ç›´<strong>è¶…æ—¶é‡ä¼ äº† 5 æ¬¡ï¼Œ<strong>å¹¶ä¸”æ¯</strong>æ¬¡ RTO è¶…æ—¶æ—¶é—´æ˜¯ä¸åŒçš„ï¼š</strong></p><ul><li>ç¬¬ä¸€æ¬¡æ˜¯åœ¨ 1 ç§’è¶…æ—¶é‡ä¼ </li><li>ç¬¬äºŒæ¬¡æ˜¯åœ¨ 3 ç§’è¶…æ—¶é‡ä¼ </li><li>ç¬¬ä¸‰æ¬¡æ˜¯åœ¨ 7 ç§’è¶…æ—¶é‡ä¼ </li><li>ç¬¬å››æ¬¡æ˜¯åœ¨ 15 ç§’è¶…æ—¶é‡ä¼ </li><li>ç¬¬äº”æ¬¡æ˜¯åœ¨ 31 ç§’è¶…æ—¶é‡ä¼ </li></ul><p>å¯ä»¥å‘ç°ï¼Œæ¯æ¬¡è¶…æ—¶æ—¶é—´ RTO æ˜¯<strong>æŒ‡æ•°ï¼ˆç¿»å€ï¼‰ä¸Šæ¶¨çš„</strong>ï¼Œå½“<strong>è¶…è¿‡æœ€å¤§é‡ä¼ æ¬¡æ•°å</strong>ï¼Œå®¢æˆ·ç«¯ä¸å†å‘é€ SYN åŒ…ã€‚</p><p>åœ¨ Linux ä¸­ï¼Œç¬¬ä¸€æ¬¡æ¡æ‰‹çš„ <code>SYN</code> è¶…æ—¶é‡ä¼ æ¬¡æ•°ï¼Œæ˜¯å¦‚ä¸‹å†…æ ¸å‚æ•°æŒ‡å®šçš„ï¼š</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>$ <span class="token function">cat</span> /proc/sys/net/ipv4/tcp_syn_retries
<span class="token number">5</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p><code>tcp_syn_retries</code> é»˜è®¤å€¼ä¸º <strong>5</strong>ï¼Œä¹Ÿå°±æ˜¯ <strong>SYN æœ€å¤§é‡ä¼ æ¬¡æ•°æ˜¯ 5 æ¬¡ã€‚</strong></p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ç»§ç»­åšå®éªŒï¼ŒæŠŠ <code>tcp_syn_retries</code> è®¾ç½®ä¸º 2 æ¬¡ï¼š</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>$ <span class="token builtin class-name">echo</span> <span class="token number">2</span> <span class="token operator">&gt;</span> /proc/sys/net/ipv4/tcp_syn_retries
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>é‡ä¼ æŠ“åŒ…åï¼Œç”¨ Wireshark æ‰“å¼€åˆ†æï¼Œæ˜¾ç¤ºå¦‚ä¸‹å›¾ï¼š</p><figure><img src="`+Ys+'" alt="SYN è¶…æ—¶é‡ä¼ ä¸¤æ¬¡" tabindex="0" loading="lazy"><figcaption>SYN è¶…æ—¶é‡ä¼ ä¸¤æ¬¡</figcaption></figure><blockquote><p>å®éªŒä¸€çš„å®éªŒå°ç»“</p></blockquote><p>é€šè¿‡å®éªŒä¸€çš„å®éªŒç»“æœï¼Œæˆ‘ä»¬å¯ä»¥å¾—çŸ¥ï¼Œå½“å®¢æˆ·ç«¯å‘èµ·çš„ TCP ç¬¬ä¸€æ¬¡æ¡æ‰‹ SYN åŒ…ï¼Œ<strong>åœ¨è¶…æ—¶æ—¶é—´å†…æ²¡æ”¶åˆ°æœåŠ¡ç«¯çš„ ACK</strong>ï¼Œå°±ä¼šåœ¨è¶…æ—¶é‡ä¼  SYN æ•°æ®åŒ…ï¼Œæ¯æ¬¡<strong>è¶…æ—¶é‡ä¼ çš„ RTO æ˜¯ç¿»å€ä¸Šæ¶¨çš„</strong>ï¼Œç›´åˆ° SYN åŒ…çš„é‡ä¼ æ¬¡æ•°åˆ°è¾¾ <code>tcp_syn_retries</code> å€¼åï¼Œå®¢æˆ·ç«¯ä¸å†å‘é€ SYN åŒ…ã€‚</p><figure><img src="'+Us+'" alt="SYN è¶…æ—¶é‡ä¼ " tabindex="0" loading="lazy"><figcaption>SYN è¶…æ—¶é‡ä¼ </figcaption></figure><h5 id="å®éªŒäºŒ-tcp-ç¬¬äºŒæ¬¡æ¡æ‰‹-synã€ack-ä¸¢åŒ…" tabindex="-1"><a class="header-anchor" href="#å®éªŒäºŒ-tcp-ç¬¬äºŒæ¬¡æ¡æ‰‹-synã€ack-ä¸¢åŒ…"><span>- <strong>å®éªŒäºŒ</strong>ï¼šTCP ç¬¬äºŒæ¬¡æ¡æ‰‹ SYNã€ACK ä¸¢åŒ…</span></a></h5><p>ä¸ºäº†æ¨¡æ‹Ÿå®¢æˆ·ç«¯æ”¶ä¸åˆ°æœåŠ¡ç«¯ç¬¬äºŒæ¬¡æ¡æ‰‹ SYNã€ACK åŒ…ï¼Œæˆ‘çš„åšæ³•æ˜¯<strong>åœ¨å®¢æˆ·ç«¯åŠ ä¸Šé˜²ç«å¢™é™åˆ¶</strong>ï¼Œç›´æ¥ç²—æš´çš„æŠŠæ¥è‡ªæœåŠ¡ç«¯çš„æ•°æ®éƒ½ä¸¢å¼ƒï¼Œé˜²ç«å¢™çš„é…ç½®å¦‚ä¸‹ï¼š</p><img src="'+Fs+'" alt="img" style="zoom:67%;"><p>æ¥ç€ï¼Œåœ¨å®¢æˆ·ç«¯æ‰§è¡Œ curl å‘½ä»¤ï¼š</p><img src="'+js+'" alt="img" style="zoom:67%;"><p>ä» <code>date</code> è¿”å›çš„æ—¶é—´å‰åï¼Œå¯ä»¥ç®—å‡ºå¤§æ¦‚ <strong>1 åˆ†é’Ÿåï¼Œcurl æŠ¥é”™é€€å‡ºäº†</strong>ã€‚</p><p>å®¢æˆ·ç«¯åœ¨è¿™å…¶é—´æŠ“å–çš„æ•°æ®åŒ…ï¼Œç”¨ Wireshark æ‰“å¼€åˆ†æï¼Œæ˜¾ç¤ºçš„æ—¶åºå›¾å¦‚ä¸‹ï¼š</p><figure><img src="'+Ws+`" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><p>ä»å›¾ä¸­å¯ä»¥å‘ç°ï¼š</p><ul><li>å®¢æˆ·ç«¯å‘èµ· SYN åï¼Œç”±äºé˜²ç«å¢™å±è”½äº†æœåŠ¡ç«¯çš„æ‰€æœ‰æ•°æ®åŒ…ï¼Œæ‰€ä»¥ curl æ˜¯æ— æ³•æ”¶åˆ°æœåŠ¡ç«¯çš„ SYNã€ACK åŒ…ï¼Œå½“å‘ç”Ÿè¶…æ—¶åï¼Œå°±ä¼š<strong>é‡ä¼  SYN åŒ…</strong></li><li>æœåŠ¡ç«¯æ”¶åˆ°å®¢æˆ·çš„ SYN åŒ…åï¼Œå°±ä¼š<strong>å› SYNã€ACK åŒ…</strong>ï¼Œä½†æ˜¯å®¢æˆ·ç«¯ä¸€ç›´æ²¡æœ‰å› ACKï¼ŒæœåŠ¡ç«¯åœ¨è¶…æ—¶åï¼Œé‡ä¼ äº† SYNã€ACK åŒ…ï¼Œ<strong>æ¥ç€ä¸€ä¼šï¼Œå®¢æˆ·ç«¯è¶…æ—¶é‡ä¼ çš„ SYN åŒ…åˆæŠµè¾¾äº†æœåŠ¡ç«¯ï¼ŒæœåŠ¡ç«¯æ”¶åˆ°åï¼Œç„¶åå›äº† SYNã€ACK åŒ…ï¼Œä½†æ˜¯SYNã€ACKåŒ…çš„é‡ä¼ å®šæ—¶å™¨å¹¶æ²¡æœ‰é‡ç½®ï¼Œè¿˜æŒç»­åœ¨é‡ä¼ ï¼Œå› ä¸ºç¬¬äºŒæ¬¡æ¡æ‰‹åœ¨æ²¡æ”¶åˆ°ç¬¬ä¸‰æ¬¡æ¡æ‰‹çš„ ACK ç¡®è®¤æŠ¥æ–‡æ—¶ï¼Œä¼šç»§ç»­é‡ä¼ ï¼Œç›´åˆ°è¾¾åˆ°é‡ä¼ åˆ°æœ€å¤§æ¬¡æ•°ã€‚</strong></li><li>æœ€åï¼Œå®¢æˆ·ç«¯ SYN è¶…æ—¶é‡ä¼ æ¬¡æ•°è¾¾åˆ°äº† 5 æ¬¡ï¼ˆtcp_syn_retries é»˜è®¤å€¼ 5 æ¬¡ï¼‰ï¼Œå°±ä¸å†ç»§ç»­å‘é€ SYN åŒ…äº†ã€‚</li></ul><p>æ‰€ä»¥ï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œ<strong>å½“ç¬¬äºŒæ¬¡æ¡æ‰‹çš„ SYNã€ACK ä¸¢åŒ…æ—¶ï¼Œå®¢æˆ·ç«¯ä¼šè¶…æ—¶é‡å‘ SYN åŒ…ï¼ŒæœåŠ¡ç«¯ä¹Ÿä¼šè¶…æ—¶é‡ä¼  SYNã€ACK åŒ…ã€‚</strong></p><blockquote><p>å’¦ï¼Ÿå®¢æˆ·ç«¯è®¾ç½®äº†é˜²ç«å¢™ï¼Œå±è”½äº†æœåŠ¡ç«¯çš„ç½‘ç»œåŒ…ï¼Œä¸ºä»€ä¹ˆ tcpdump è¿˜èƒ½æŠ“åˆ°æœåŠ¡ç«¯çš„ç½‘ç»œåŒ…ï¼Ÿ</p></blockquote><p>æ·»åŠ  iptables é™åˆ¶åï¼Œ tcpdump æ˜¯å¦èƒ½æŠ“åˆ°åŒ… ï¼Œè¿™è¦çœ‹æ·»åŠ çš„ iptables é™åˆ¶æ¡ä»¶ï¼š</p><ul><li>å¦‚æœæ·»åŠ çš„æ˜¯ <code>INPUT</code> è§„åˆ™ï¼Œåˆ™å¯ä»¥æŠ“å¾—åˆ°åŒ…</li><li>å¦‚æœæ·»åŠ çš„æ˜¯ <code>OUTPUT</code> è§„åˆ™ï¼Œåˆ™æŠ“ä¸åˆ°åŒ…</li></ul><p>ç½‘ç»œåŒ…è¿›å…¥ä¸»æœºåçš„é¡ºåºå¦‚ä¸‹ï¼š</p><ul><li>è¿›æ¥çš„é¡ºåº Wire -&gt; NIC -&gt; <strong>tcpdump -&gt; netfilter/iptables</strong></li><li>å‡ºå»çš„é¡ºåº <strong>iptables -&gt; tcpdump</strong> -&gt; NIC -&gt; Wire</li></ul><blockquote><p>tcp_syn_retries æ˜¯é™åˆ¶ SYN é‡ä¼ æ¬¡æ•°ï¼Œé‚£ç¬¬äºŒæ¬¡æ¡æ‰‹ SYNã€ACK é™åˆ¶æœ€å¤§é‡ä¼ æ¬¡æ•°æ˜¯å¤šå°‘ï¼Ÿ</p></blockquote><p>TCP ç¬¬äºŒæ¬¡æ¡æ‰‹ SYNã€ACK åŒ…çš„æœ€å¤§é‡ä¼ æ¬¡æ•°æ˜¯é€šè¿‡ <code>tcp_synack_retries</code> å†…æ ¸å‚æ•°é™åˆ¶çš„ï¼Œå…¶é»˜è®¤å€¼å¦‚ä¸‹ï¼š</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>$ <span class="token function">cat</span> /proc/sys/net/ipv4/tcp_synack_retries
<span class="token number">5</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>æ˜¯çš„ï¼ŒTCP ç¬¬äºŒæ¬¡æ¡æ‰‹ SYNã€ACK åŒ…çš„æœ€å¤§é‡ä¼ æ¬¡æ•°é»˜è®¤å€¼æ˜¯ <code>5</code> æ¬¡ã€‚</p><p>ä¸ºäº†éªŒè¯ SYNã€ACK åŒ…æœ€å¤§é‡ä¼ æ¬¡æ•°æ˜¯ 5 æ¬¡ï¼Œæˆ‘ä»¬ç»§ç»­åšä¸‹å®éªŒï¼Œæˆ‘ä»¬å…ˆæŠŠå®¢æˆ·ç«¯çš„ <code>tcp_syn_retries</code> è®¾ç½®ä¸º 1ï¼Œè¡¨ç¤ºå®¢æˆ·ç«¯ SYN æœ€å¤§è¶…æ—¶æ¬¡æ•°æ˜¯ 1 æ¬¡ï¼Œç›®çš„æ˜¯ä¸ºäº†é˜²æ­¢å¤šæ¬¡é‡ä¼  SYNï¼ŒæŠŠæœåŠ¡ç«¯ SYNã€ACK è¶…æ—¶å®šæ—¶å™¨é‡ç½®ã€‚</p><p>æ¥ç€ï¼Œè¿˜æ˜¯å¦‚ä¸Šé¢çš„æ­¥éª¤ï¼š</p><ol><li>å®¢æˆ·ç«¯é…ç½®é˜²ç«å¢™å±è”½æœåŠ¡ç«¯çš„æ•°æ®åŒ…</li><li>å®¢æˆ·ç«¯ tcpdump æŠ“å– curl æ‰§è¡Œæ—¶çš„æ•°æ®åŒ…</li></ol><p>æŠŠæŠ“å–çš„æ•°æ®åŒ…ï¼Œç”¨ Wireshark æ‰“å¼€åˆ†æï¼Œæ˜¾ç¤ºçš„æ—¶åºå›¾å¦‚ä¸‹ï¼š</p><figure><img src="`+Bs+`" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><p>ä»ä¸Šå›¾ï¼Œæˆ‘ä»¬å¯ä»¥åˆ†æå‡ºï¼š</p><ul><li>å®¢æˆ·ç«¯çš„ SYN åªè¶…æ—¶é‡ä¼ äº† 1 æ¬¡ï¼Œå› ä¸º <code>tcp_syn_retries</code> å€¼ä¸º 1</li><li>æœåŠ¡ç«¯åº”ç­”äº†å®¢æˆ·ç«¯è¶…æ—¶é‡ä¼ çš„ SYN åŒ…åï¼Œç”±äºä¸€ç›´æ”¶ä¸åˆ°å®¢æˆ·ç«¯çš„ ACK åŒ…ï¼Œæ‰€ä»¥æœåŠ¡ç«¯ä¸€ç›´åœ¨è¶…æ—¶é‡ä¼  SYNã€ACK åŒ…ï¼Œæ¯æ¬¡çš„ RTO ä¹Ÿæ˜¯æŒ‡æ•°ä¸Šæ¶¨çš„ï¼Œ<strong>ä¸€å…±è¶…æ—¶é‡ä¼ äº† 5 æ¬¡</strong>ï¼Œå› ä¸º <code>tcp_synack_retries</code> å€¼ä¸º 5</li></ul><p>æ¥ç€ï¼Œæˆ‘æŠŠ <strong>tcp_synack_retries è®¾ç½®ä¸º 2</strong>ï¼Œ<code>tcp_syn_retries</code> ä¾ç„¶è®¾ç½®ä¸º 1:</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>$ <span class="token builtin class-name">echo</span> <span class="token number">2</span> <span class="token operator">&gt;</span> /proc/sys/net/ipv4/tcp_synack_retries
$ <span class="token builtin class-name">echo</span> <span class="token number">1</span> <span class="token operator">&gt;</span> /proc/sys/net/ipv4/tcp_syn_retries
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¾ç„¶ä¿æŒä¸€æ ·çš„å®éªŒæ­¥éª¤è¿›è¡Œæ“ä½œï¼Œæ¥ç€æŠŠæŠ“å–çš„æ•°æ®åŒ…ï¼Œç”¨ Wireshark æ‰“å¼€åˆ†æï¼Œæ˜¾ç¤ºçš„æ—¶åºå›¾å¦‚ä¸‹ï¼š</p><figure><img src="`+Os+'" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><p>å¯è§ï¼š</p><ul><li>å®¢æˆ·ç«¯çš„ SYN åŒ…åªè¶…æ—¶é‡ä¼ äº† 1 æ¬¡ï¼Œç¬¦åˆ tcp_syn_retries è®¾ç½®çš„å€¼ï¼›</li><li>æœåŠ¡ç«¯çš„ SYNã€ACK è¶…æ—¶é‡ä¼ äº† 2 æ¬¡ï¼Œç¬¦åˆ tcp_synack_retries è®¾ç½®çš„å€¼</li></ul><blockquote><p>å®éªŒäºŒçš„å®éªŒå°ç»“</p></blockquote><p>é€šè¿‡å®éªŒäºŒçš„å®éªŒç»“æœï¼Œæˆ‘ä»¬å¯ä»¥å¾—çŸ¥ï¼Œå½“ TCP ç¬¬äºŒæ¬¡æ¡æ‰‹ SYNã€ACK åŒ…ä¸¢äº†åï¼Œå®¢æˆ·ç«¯ SYN åŒ…ä¼šå‘ç”Ÿè¶…æ—¶é‡ä¼ ï¼ŒæœåŠ¡ç«¯ SYNã€ACK ä¹Ÿä¼šå‘ç”Ÿè¶…æ—¶é‡ä¼ ã€‚</p><p>å®¢æˆ·ç«¯ SYN åŒ…è¶…æ—¶é‡ä¼ çš„æœ€å¤§æ¬¡æ•°ï¼Œæ˜¯ç”± tcp_syn_retries å†³å®šçš„ï¼Œé»˜è®¤å€¼æ˜¯ 5 æ¬¡ï¼›æœåŠ¡ç«¯ SYNã€ACK åŒ…æ—¶é‡ä¼ çš„æœ€å¤§æ¬¡æ•°ï¼Œæ˜¯ç”± tcp_synack_retries å†³å®šçš„ï¼Œé»˜è®¤å€¼æ˜¯ 5 æ¬¡ã€‚</p><h5 id="å®éªŒä¸‰-tcp-ç¬¬ä¸‰æ¬¡æ¡æ‰‹-ack-ä¸¢åŒ…" tabindex="-1"><a class="header-anchor" href="#å®éªŒä¸‰-tcp-ç¬¬ä¸‰æ¬¡æ¡æ‰‹-ack-ä¸¢åŒ…"><span>- å®éªŒä¸‰ï¼šTCP ç¬¬ä¸‰æ¬¡æ¡æ‰‹ ACK ä¸¢åŒ…</span></a></h5><p>ä¸ºäº†æ¨¡æ‹Ÿ TCP ç¬¬ä¸‰æ¬¡æ¡æ‰‹ ACK åŒ…ä¸¢ï¼Œæˆ‘çš„å®éªŒæ–¹æ³•æ˜¯<strong>åœ¨æœåŠ¡ç«¯é…ç½®é˜²ç«å¢™ï¼Œå±è”½å®¢æˆ·ç«¯ TCP æŠ¥æ–‡ä¸­æ ‡å¿—ä½æ˜¯ ACK çš„åŒ…</strong>ï¼Œä¹Ÿå°±æ˜¯å½“æœåŠ¡ç«¯æ”¶åˆ°å®¢æˆ·ç«¯çš„ TCP ACK çš„æŠ¥æ–‡æ—¶å°±ä¼šä¸¢å¼ƒã€‚</p><p>iptables é…ç½®å‘½ä»¤å¦‚ä¸‹ï¼š</p><img src="'+Qs+'" alt="img" style="zoom:67%;"><p>æ¥ç€ï¼Œåœ¨å®¢æˆ·ç«¯æ‰§è¡Œå¦‚ä¸‹ tcpdump å‘½ä»¤ï¼š</p><img src="'+Gs+'" alt="img" style="zoom:67%;"><p>ç„¶åï¼Œå®¢æˆ·ç«¯å‘æœåŠ¡ç«¯å‘èµ· telnetï¼Œå› ä¸º telnet å‘½ä»¤æ˜¯ä¼šå‘èµ· TCP è¿æ¥ï¼Œæ‰€ä»¥ç”¨æ­¤å‘½ä»¤åšæµ‹è¯•ï¼š</p><img src="'+Vs+'" alt="img" style="zoom:67%;"><p>æ­¤æ—¶ï¼Œç”±äºæœåŠ¡ç«¯æ”¶ä¸åˆ°ç¬¬ä¸‰æ¬¡æ¡æ‰‹çš„ ACK åŒ…ï¼Œæ‰€ä»¥ä¸€ç›´å¤„äº <code>SYN_RECV</code> çŠ¶æ€ï¼š</p><img src="'+Xs+'" alt="img" style="zoom:67%;"><p>è€Œå®¢æˆ·ç«¯æ˜¯å·²å®Œæˆ TCP è¿æ¥å»ºç«‹ï¼Œå¤„äº <code>ESTABLISHED</code> çŠ¶æ€ï¼š</p><img src="'+Zs+'" alt="img" style="zoom:67%;"><p>è¿‡äº† 1 åˆ†é’Ÿåï¼Œè§‚å¯Ÿå‘ç°æœåŠ¡ç«¯çš„ TCP è¿æ¥ä¸è§äº†ï¼š</p><img src="'+Js+'" alt="img" style="zoom:67%;"><p>è¿‡äº† 30 åˆ†é’Ÿï¼Œå®¢æˆ·ç«¯ä¾ç„¶è¿˜æ˜¯å¤„äº <code>ESTABLISHED</code> çŠ¶æ€ï¼š</p><img src="'+$s+'" alt="img" style="zoom:67%;"><p>æ¥ç€ï¼Œåœ¨åˆšæ‰å®¢æˆ·ç«¯å»ºç«‹çš„ telnet ä¼šè¯ï¼Œè¾“å…¥ 123456 å­—ç¬¦ï¼Œè¿›è¡Œå‘é€ï¼š</p><img src="'+oe+'" alt="img" style="zoom:67%;"><p>æŒç»­ã€Œå¥½é•¿ã€ä¸€æ®µæ—¶é—´ï¼Œå®¢æˆ·ç«¯çš„ telnet æ‰æ–­å¼€è¿æ¥ï¼š</p><img src="'+te+'" alt="img" style="zoom:67%;"><p>ä»¥ä¸Šå°±æ˜¯æœ¬æ¬¡çš„å®ç°ä¸‰çš„ç°è±¡ï¼Œè¿™é‡Œå­˜åœ¨ä¸¤ä¸ªç–‘ç‚¹ï¼š</p><ul><li>ä¸ºä»€ä¹ˆæœåŠ¡ç«¯åŸæœ¬å¤„äº <code>SYN_RECV</code> çŠ¶æ€çš„è¿æ¥ï¼Œè¿‡ 1 åˆ†é’Ÿåå°±æ¶ˆå¤±äº†ï¼Ÿ</li><li>ä¸ºä»€ä¹ˆå®¢æˆ·ç«¯ telnet è¾“å…¥ 123456 å­—ç¬¦åï¼Œè¿‡äº†å¥½é•¿ä¸€æ®µæ—¶é—´ï¼Œtelnet æ‰æ–­å¼€è¿æ¥ï¼Ÿ</li></ul><p>ä¸ç€æ€¥ï¼Œæˆ‘ä»¬æŠŠåˆšæŠ“çš„æ•°æ®åŒ…ï¼Œç”¨ Wireshark æ‰“å¼€åˆ†æï¼Œæ˜¾ç¤ºçš„æ—¶åºå›¾å¦‚ä¸‹ï¼š</p><figure><img src="'+se+`" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><p>ä¸Šå›¾çš„æµç¨‹ï¼š</p><ul><li>å®¢æˆ·ç«¯å‘é€ SYN åŒ…ç»™æœåŠ¡ç«¯ï¼ŒæœåŠ¡ç«¯æ”¶åˆ°åï¼Œå›äº†ä¸ª SYNã€ACK åŒ…ç»™å®¢æˆ·ç«¯ï¼Œæ­¤æ—¶æœåŠ¡ç«¯çš„ TCP è¿æ¥å¤„äº <code>SYN_RECV</code> çŠ¶æ€ï¼›</li><li>å®¢æˆ·ç«¯æ”¶åˆ°æœåŠ¡ç«¯çš„ SYNã€ACK åŒ…åï¼Œç»™æœåŠ¡ç«¯å›äº†ä¸ª ACK åŒ…ï¼Œæ­¤æ—¶<strong>å®¢æˆ·ç«¯çš„ TCP è¿æ¥</strong>å¤„äº <code>ESTABLISHED</code> çŠ¶æ€ï¼›</li><li>ç”±äºæœåŠ¡ç«¯é…ç½®äº†é˜²ç«å¢™ï¼Œå±è”½äº†å®¢æˆ·ç«¯çš„ ACK åŒ…ï¼Œæ‰€ä»¥æœåŠ¡ç«¯ä¸€ç›´å¤„äº <code>SYN_RECV</code> çŠ¶æ€ï¼Œæ²¡æœ‰è¿›å…¥ <code>ESTABLISHED</code> çŠ¶æ€ï¼Œtcpdump ä¹‹æ‰€ä»¥èƒ½æŠ“åˆ°å®¢æˆ·ç«¯çš„ ACK åŒ…ï¼Œæ˜¯å› ä¸ºæ•°æ®åŒ…è¿›å…¥ç³»ç»Ÿçš„é¡ºåºæ˜¯å…ˆè¿›å…¥ tcpudmpï¼Œåç»è¿‡ iptablesï¼›</li><li>æ¥ç€ï¼Œ<strong>æœåŠ¡ç«¯è¶…æ—¶é‡ä¼ </strong>äº† SYNã€ACK åŒ…ï¼Œ<strong>é‡ä¼ äº† 5 æ¬¡å</strong>ï¼Œä¹Ÿå°±æ˜¯<strong>è¶…è¿‡ tcp_synack_retries çš„å€¼ï¼ˆé»˜è®¤å€¼æ˜¯ 5ï¼‰ï¼Œç„¶åå°±æ²¡æœ‰ç»§ç»­é‡ä¼ äº†ï¼Œæ­¤æ—¶æœåŠ¡ç«¯çš„ TCP è¿æ¥ä¸»åŠ¨ä¸­æ­¢äº†ï¼Œæ‰€ä»¥åˆšæ‰å¤„äº SYN_RECV çŠ¶æ€çš„ TCP è¿æ¥æ–­å¼€äº†</strong>ï¼Œè€Œå®¢æˆ·ç«¯ä¾ç„¶å¤„äº<code>ESTABLISHED</code> çŠ¶æ€ï¼›</li><li>è™½ç„¶æœåŠ¡ç«¯ TCP æ–­å¼€äº†ï¼Œä½†è¿‡äº†ä¸€æ®µæ—¶é—´ï¼Œå‘ç°å®¢æˆ·ç«¯ä¾ç„¶å¤„äº<code>ESTABLISHED</code> çŠ¶æ€ï¼Œäºæ˜¯å°±åœ¨å®¢æˆ·ç«¯çš„ telnet ä¼šè¯è¾“å…¥äº† 123456 å­—ç¬¦ï¼›</li><li>ç”±äºæœåŠ¡ç«¯çš„é˜²ç«å¢™é…ç½®äº†å±è”½æ‰€æœ‰æºå¸¦ ACK æ ‡å¿—ä½çš„ TCP æŠ¥æ–‡ï¼Œå®¢æˆ·ç«¯å‘é€çš„æ•°æ®æŠ¥æ–‡ï¼ŒæœåŠ¡ç«¯å¹¶ä¸ä¼šæ¥æ”¶ï¼Œè€Œæ˜¯ä¸¢å¼ƒï¼ˆå¦‚æœæœåŠ¡ç«¯æ²¡æœ‰è®¾ç½®é˜²ç«å¢™ï¼Œç”±äºæœåŠ¡ç«¯å·²ç»æ–­å¼€è¿æ¥ï¼Œæ­¤æ—¶æ”¶åˆ°å®¢æˆ·çš„å‘æ¥çš„æ•°æ®æŠ¥æ–‡åï¼Œä¼š<strong>å› RST æŠ¥æ–‡</strong>ï¼‰ã€‚å®¢æˆ·ç«¯ç”±äºä¸€ç›´æ”¶ä¸åˆ°æ•°æ®æŠ¥æ–‡çš„ç¡®è®¤æŠ¥æ–‡ï¼Œæ‰€ä»¥<strong>è§¦å‘è¶…æ—¶é‡ä¼ </strong>ï¼Œåœ¨è¶…æ—¶é‡ä¼ è¿‡ç¨‹ä¸­ï¼Œæ¯ä¸€æ¬¡é‡ä¼ ï¼ŒRTO çš„å€¼æ˜¯æŒ‡æ•°å¢é•¿çš„ï¼Œæ‰€ä»¥æŒç»­äº†å¥½é•¿ä¸€æ®µæ—¶é—´ï¼Œå®¢æˆ·ç«¯çš„ telnet æ‰æŠ¥é”™é€€å‡ºäº†ï¼Œæ­¤æ—¶å…±é‡ä¼ äº† 15 æ¬¡ï¼Œç„¶åå®¢æˆ·ç«¯çš„ä¹Ÿæ–­å¼€äº†è¿æ¥ã€‚</li></ul><p>é€šè¿‡è¿™ä¸€æ³¢åˆ†æï¼Œåˆšæ‰çš„ä¸¤ä¸ªç–‘ç‚¹å·²ç»è§£é™¤äº†ï¼š</p><ul><li>æœåŠ¡ç«¯åœ¨é‡ä¼  SYNã€ACK åŒ…æ—¶ï¼Œè¶…è¿‡äº†æœ€å¤§é‡ä¼ æ¬¡æ•° <code>tcp_synack_retries</code>ï¼Œäºæ˜¯<strong>æœåŠ¡ç«¯çš„ TCP è¿æ¥ä¸»åŠ¨æ–­å¼€äº†ã€‚</strong></li><li>å®¢æˆ·ç«¯å‘æœåŠ¡ç«¯å‘é€æ•°æ®æŠ¥æ–‡æ—¶ï¼Œå¦‚æœè¿Ÿè¿Ÿæ²¡æœ‰æ”¶åˆ°æ•°æ®åŒ…çš„ç¡®è®¤æŠ¥æ–‡ï¼Œä¹Ÿä¼š<strong>è§¦å‘è¶…æ—¶é‡ä¼ </strong>ï¼Œä¸€å…±é‡ä¼ äº† 15 æ¬¡æ•°æ®æŠ¥æ–‡ï¼Œ æœ€å telnet å°±æ–­å¼€äº†è¿æ¥ã€‚</li></ul><blockquote><p>TCP ç¬¬ä¸€æ¬¡æ¡æ‰‹çš„ SYN åŒ…è¶…æ—¶é‡ä¼ æœ€å¤§æ¬¡æ•°æ˜¯ç”± tcp_syn_retries æŒ‡å®šï¼ŒTCP ç¬¬äºŒæ¬¡æ¡æ‰‹çš„ SYNã€ACK åŒ…è¶…æ—¶é‡ä¼ æœ€å¤§æ¬¡æ•°æ˜¯ç”± tcp_synack_retries æŒ‡å®šï¼Œé‚£ TCP å»ºç«‹è¿æ¥åçš„æ•°æ®åŒ…æœ€å¤§è¶…æ—¶é‡ä¼ æ¬¡æ•°æ˜¯ç”±ä»€ä¹ˆå‚æ•°æŒ‡å®šå‘¢ï¼Ÿ</p></blockquote><p>TCP å»ºç«‹è¿æ¥åçš„æ•°æ®åŒ…ä¼ è¾“ï¼Œæœ€å¤§è¶…æ—¶é‡ä¼ æ¬¡æ•°æ˜¯ç”± <code>tcp_retries2</code> æŒ‡å®šï¼Œé»˜è®¤å€¼æ˜¯ 15 æ¬¡ï¼Œå¦‚ä¸‹ï¼š</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>$ cat /proc/sys/net/ipv4/tcp_retries2
15
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>å¦‚æœ 15 æ¬¡é‡ä¼ éƒ½åšå®Œäº†ï¼ŒTCP å°±ä¼šå‘Šè¯‰åº”ç”¨å±‚è¯´ï¼šâ€œæä¸å®šäº†ï¼ŒåŒ…æ€ä¹ˆéƒ½ä¼ ä¸è¿‡å»ï¼â€</p><blockquote><h4 id="é‚£å¦‚æœå®¢æˆ·ç«¯ä¸å‘é€æ•°æ®-ä»€ä¹ˆæ—¶å€™æ‰ä¼šæ–­å¼€å¤„äº-established-çŠ¶æ€çš„è¿æ¥" tabindex="-1"><a class="header-anchor" href="#é‚£å¦‚æœå®¢æˆ·ç«¯ä¸å‘é€æ•°æ®-ä»€ä¹ˆæ—¶å€™æ‰ä¼šæ–­å¼€å¤„äº-established-çŠ¶æ€çš„è¿æ¥"><span>é‚£å¦‚æœå®¢æˆ·ç«¯ä¸å‘é€æ•°æ®ï¼Œä»€ä¹ˆæ—¶å€™æ‰ä¼šæ–­å¼€å¤„äº ESTABLISHED çŠ¶æ€çš„è¿æ¥ï¼Ÿ</span></a></h4></blockquote><p>è¿™é‡Œå°±éœ€è¦æåˆ° TCP çš„ <strong>ä¿æ´»æœºåˆ¶</strong>ã€‚è¿™ä¸ªæœºåˆ¶çš„åŸç†æ˜¯è¿™æ ·çš„ï¼š</p><p>å®šä¹‰ä¸€ä¸ªæ—¶é—´æ®µï¼Œåœ¨è¿™ä¸ªæ—¶é—´æ®µå†…ï¼Œå¦‚æœ<strong>æ²¡æœ‰ä»»ä½•è¿æ¥ç›¸å…³çš„æ´»åŠ¨</strong>ï¼ŒTCP ä¿æ´»æœºåˆ¶ä¼šå¼€å§‹ä½œç”¨ï¼Œæ¯éš”ä¸€ä¸ªæ—¶é—´é—´éš”ï¼Œå‘é€ä¸€ä¸ª**ã€Œæ¢æµ‹æŠ¥æ–‡ã€<strong>ï¼Œè¯¥æ¢æµ‹æŠ¥æ–‡åŒ…å«çš„æ•°æ®éå¸¸å°‘ï¼Œå¦‚æœ</strong>è¿ç»­å‡ ä¸ªæ¢æµ‹æŠ¥æ–‡éƒ½æ²¡æœ‰å¾—åˆ°å“åº”**ï¼Œåˆ™è®¤ä¸ºå½“å‰çš„ TCP è¿æ¥å·²ç»æ­»äº¡ï¼Œ<strong>ç³»ç»Ÿå†…æ ¸å°†é”™è¯¯ä¿¡æ¯é€šçŸ¥ç»™ä¸Šå±‚åº”ç”¨ç¨‹åºã€‚</strong></p><p>åœ¨ Linux å†…æ ¸å¯ä»¥æœ‰å¯¹åº”çš„å‚æ•°å¯ä»¥è®¾ç½®ä¿æ´»æ—¶é—´ã€ä¿æ´»æ¢æµ‹çš„æ¬¡æ•°ã€ä¿æ´»æ¢æµ‹çš„æ—¶é—´é—´éš”ï¼Œä»¥ä¸‹éƒ½ä¸ºé»˜è®¤å€¼ï¼š</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>net.ipv4.tcp_keepalive_time=7200
net.ipv4.tcp_keepalive_intvl=75  
net.ipv4.tcp_keepalive_probes=9
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>tcp_keepalive_time=7200ï¼šè¡¨ç¤ºä¿æ´»æ—¶é—´æ˜¯ 7200 ç§’ï¼ˆ2å°æ—¶ï¼‰ï¼Œä¹Ÿå°± 2 å°æ—¶å†…å¦‚æœæ²¡æœ‰ä»»ä½•è¿æ¥ç›¸å…³çš„æ´»åŠ¨ï¼Œåˆ™ä¼šå¯åŠ¨ä¿æ´»æœºåˆ¶</li><li>tcp_keepalive_intvl=75ï¼šè¡¨ç¤ºæ¯æ¬¡æ£€æµ‹é—´éš” 75 ç§’ï¼›</li><li>tcp_keepalive_probes=9ï¼šè¡¨ç¤ºæ£€æµ‹ 9 æ¬¡æ— å“åº”ï¼Œè®¤ä¸ºå¯¹æ–¹æ˜¯ä¸å¯è¾¾çš„ï¼Œä»è€Œä¸­æ–­æœ¬æ¬¡çš„è¿æ¥ã€‚</li></ul><p>ä¹Ÿå°±æ˜¯è¯´åœ¨ Linux ç³»ç»Ÿä¸­ï¼Œæœ€å°‘éœ€è¦ç»è¿‡ <strong>2 å°æ—¶ 11 åˆ† 15 ç§’æ‰å¯ä»¥å‘ç°ä¸€ä¸ªã€Œæ­»äº¡ã€è¿æ¥</strong>ã€‚</p><figure><img src="`+ee+'" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><p>è¿™ä¸ªæ—¶é—´æ˜¯æœ‰ç‚¹é•¿çš„ï¼Œæ‰€ä»¥å¦‚æœæˆ‘æŠ“åŒ…è¶³å¤Ÿä¹…ï¼Œæˆ–è®¸èƒ½æŠ“åˆ°æ¢æµ‹æŠ¥æ–‡ã€‚</p><blockquote><p>å®éªŒä¸‰çš„å®éªŒå°ç»“</p></blockquote><p>åœ¨å»ºç«‹ TCP è¿æ¥æ—¶ï¼Œå¦‚æœç¬¬ä¸‰æ¬¡æ¡æ‰‹çš„ ACKï¼ŒæœåŠ¡ç«¯æ— æ³•æ”¶åˆ°ï¼Œåˆ™æœåŠ¡ç«¯å°±ä¼šçŸ­æš‚å¤„äº <code>SYN_RECV</code> çŠ¶æ€ï¼Œè€Œå®¢æˆ·ç«¯ä¼šå¤„äº <code>ESTABLISHED</code> çŠ¶æ€ã€‚</p><p>ç”±äº<strong>æœåŠ¡ç«¯</strong>ä¸€ç›´æ”¶ä¸åˆ° TCP ç¬¬ä¸‰æ¬¡æ¡æ‰‹çš„ ACKï¼Œåˆ™ä¼š<strong>ä¸€ç›´é‡ä¼  SYNã€ACK åŒ…</strong>ï¼Œç›´åˆ°é‡ä¼ æ¬¡æ•°è¶…è¿‡ <code>tcp_synack_retries</code> å€¼ï¼ˆé»˜è®¤å€¼ 5 æ¬¡ï¼‰åï¼ŒæœåŠ¡ç«¯å°±ä¼šæ–­å¼€ TCP è¿æ¥ã€‚</p><p>è€Œ<strong>å®¢æˆ·ç«¯</strong>åˆ™ä¼šæœ‰ä¸¤ç§æƒ…å†µï¼š</p><ul><li>å¦‚æœå®¢æˆ·ç«¯æ²¡å‘é€æ•°æ®åŒ…ï¼Œä¸€ç›´å¤„äº <code>ESTABLISHED</code> çŠ¶æ€ï¼Œç„¶åç»è¿‡ 2 å°æ—¶ 11 åˆ† 15 ç§’æ‰å¯ä»¥å‘ç°ä¸€ä¸ªã€Œæ­»äº¡ã€è¿æ¥ï¼Œäºæ˜¯<strong>å®¢æˆ·ç«¯è¿æ¥å°±ä¼šæ–­å¼€è¿æ¥ã€‚</strong></li><li>å¦‚æœå®¢æˆ·ç«¯å‘é€äº†æ•°æ®åŒ…ï¼Œä¸€ç›´æ²¡æœ‰æ”¶åˆ°æœåŠ¡ç«¯å¯¹è¯¥æ•°æ®åŒ…çš„ç¡®è®¤æŠ¥æ–‡ï¼Œåˆ™ä¼šä¸€ç›´é‡ä¼ è¯¥æ•°æ®åŒ…ï¼Œç›´åˆ°é‡ä¼ æ¬¡æ•°è¶…è¿‡ <code>tcp_retries2</code> å€¼ï¼ˆé»˜è®¤å€¼ 15 æ¬¡ï¼‰åï¼Œå®¢æˆ·ç«¯å°±ä¼šæ–­å¼€ TCP è¿æ¥ã€‚</li></ul><h4 id="tcp-å¿«é€Ÿå»ºç«‹è¿æ¥" tabindex="-1"><a class="header-anchor" href="#tcp-å¿«é€Ÿå»ºç«‹è¿æ¥"><span>- TCP å¿«é€Ÿå»ºç«‹è¿æ¥</span></a></h4><p>å®¢æˆ·ç«¯åœ¨å‘æœåŠ¡ç«¯å‘èµ· HTTP GET è¯·æ±‚æ—¶ï¼Œ<strong>ä¸€ä¸ªå®Œæ•´çš„äº¤äº’è¿‡ç¨‹</strong>ï¼Œéœ€è¦ <strong>2.5 ä¸ª RTT çš„æ—¶å»¶ã€‚</strong></p><p>ç”±äº<strong>ç¬¬ä¸‰æ¬¡æ¡æ‰‹æ˜¯å¯ä»¥æºå¸¦æ•°æ®çš„</strong>ï¼Œè¿™æ—¶å¦‚æœ<strong>åœ¨ç¬¬ä¸‰æ¬¡æ¡æ‰‹å‘èµ· HTTP GET è¯·æ±‚</strong>ï¼Œéœ€è¦ 2 ä¸ª RTT çš„æ—¶å»¶ã€‚</p><p>ä½†æ˜¯åœ¨ä¸‹ä¸€æ¬¡ï¼ˆä¸æ˜¯åŒä¸ª TCP è¿æ¥çš„ä¸‹ä¸€æ¬¡ï¼‰å‘èµ· HTTP GET è¯·æ±‚æ—¶ï¼Œç»å†çš„ RTT ä¹Ÿæ˜¯ä¸€æ ·ï¼Œå¦‚ä¸‹å›¾ï¼š</p><figure><img src="'+ne+'" alt="å¸¸è§„ HTTP è¯·æ±‚" tabindex="0" loading="lazy"><figcaption>å¸¸è§„ HTTP è¯·æ±‚</figcaption></figure><p>åœ¨ Linux 3.7 å†…æ ¸ç‰ˆæœ¬ä¸­ï¼Œæä¾›äº† TCP Fast Open åŠŸèƒ½ï¼Œè¿™ä¸ªåŠŸèƒ½å¯ä»¥<strong>å‡å°‘ TCP è¿æ¥å»ºç«‹çš„æ—¶å»¶ã€‚</strong></p><figure><img src="'+pe+'" alt="å¸¸è§„ HTTP è¯·æ±‚ ä¸ Fast  Open HTTP è¯·æ±‚" tabindex="0" loading="lazy"><figcaption>å¸¸è§„ HTTP è¯·æ±‚ ä¸ Fast Open HTTP è¯·æ±‚</figcaption></figure><ul><li>åœ¨ç¬¬ä¸€æ¬¡å»ºç«‹è¿æ¥çš„æ—¶å€™ï¼ŒæœåŠ¡ç«¯<strong>åœ¨ç¬¬äºŒæ¬¡æ¡æ‰‹</strong>äº§ç”Ÿä¸€ä¸ª <code>Cookie</code> ï¼ˆå·²åŠ å¯†ï¼‰å¹¶é€šè¿‡ SYNã€ACK åŒ…ä¸€èµ·å‘ç»™å®¢æˆ·ç«¯ï¼Œäºæ˜¯å®¢æˆ·ç«¯å°±ä¼šç¼“å­˜è¿™ä¸ª <code>Cookie</code>ï¼Œæ‰€ä»¥ç¬¬ä¸€æ¬¡å‘èµ· HTTP Get è¯·æ±‚çš„æ—¶å€™ï¼Œè¿˜æ˜¯éœ€è¦ 2 ä¸ª RTT çš„æ—¶å»¶ï¼›</li><li>åœ¨ä¸‹æ¬¡è¯·æ±‚çš„æ—¶å€™ï¼Œå®¢æˆ·ç«¯åœ¨ SYN åŒ…å¸¦ä¸Š <code>Cookie</code> å‘ç»™æœåŠ¡ç«¯ï¼Œå°±æå‰å¯ä»¥<strong>è·³è¿‡ä¸‰æ¬¡æ¡æ‰‹çš„è¿‡ç¨‹</strong>ï¼Œå› ä¸º <code>Cookie</code> ä¸­ç»´æŠ¤äº†ä¸€äº›ä¿¡æ¯ï¼ŒæœåŠ¡ç«¯å¯ä»¥ä» <code>Cookie</code> <strong>è·å– TCP ç›¸å…³çš„ä¿¡æ¯ï¼Œè¿™æ—¶å‘èµ·çš„ HTTP GET è¯·æ±‚å°±åªéœ€è¦ 1 ä¸ª RTT çš„æ—¶å»¶</strong>ï¼›</li></ul><p>æ³¨ï¼šå®¢æˆ·ç«¯åœ¨è¯·æ±‚å¹¶å­˜å‚¨äº† Fast Open Cookie ä¹‹åï¼Œå¯ä»¥ä¸æ–­é‡å¤ TCP Fast Open ç›´è‡³æœåŠ¡å™¨è®¤ä¸º Cookie æ— æ•ˆï¼ˆé€šå¸¸ä¸ºè¿‡æœŸï¼‰</p><blockquote><p>åœ¨ Linux ä¸Šå¦‚ä½•æ‰“å¼€ Fast Open åŠŸèƒ½ï¼Ÿ</p></blockquote><p>å¯ä»¥é€šè¿‡è®¾ç½® <code>net.ipv4.tcp_fastopen</code> å†…æ ¸å‚æ•°ï¼Œæ¥æ‰“å¼€ Fast Open åŠŸèƒ½ã€‚</p><p>net.ipv4.tcp_fastopen å„ä¸ªå€¼çš„æ„ä¹‰:</p><ul><li>0 å…³é—­</li><li>1 ä½œä¸ºå®¢æˆ·ç«¯ä½¿ç”¨ Fast Open åŠŸèƒ½</li><li>2 ä½œä¸ºæœåŠ¡ç«¯ä½¿ç”¨ Fast Open åŠŸèƒ½</li><li>3 æ— è®ºä½œä¸ºå®¢æˆ·ç«¯è¿˜æ˜¯æœåŠ¡å™¨ï¼Œéƒ½å¯ä»¥ä½¿ç”¨ Fast Open åŠŸèƒ½</li></ul><blockquote><p>TCP Fast Open æŠ“åŒ…åˆ†æ</p></blockquote><p>åœ¨ä¸‹å›¾ï¼Œæ•°æ®åŒ… 7 å·ï¼Œå®¢æˆ·ç«¯å‘èµ·äº†ç¬¬äºŒæ¬¡ TCP è¿æ¥æ—¶ï¼ŒSYN åŒ…ä¼šæºå¸¦ Cooikeï¼Œå¹¶ä¸”é•¿åº¦ä¸º 5 çš„æ•°æ®ã€‚</p><p>æœåŠ¡ç«¯æ”¶åˆ°åï¼Œæ ¡éªŒ Cooike åˆæ³•ï¼Œäºæ˜¯å°±å›äº† SYNã€ACK åŒ…ï¼Œå¹¶ä¸”ç¡®è®¤åº”ç­”æ”¶åˆ°äº†å®¢æˆ·ç«¯çš„æ•°æ®åŒ…ï¼ŒACK = 5 + 1 = 6</p><figure><img src="'+re+'" alt="TCP Fast Open æŠ“åŒ…åˆ†æ" tabindex="0" loading="lazy"><figcaption>TCP Fast Open æŠ“åŒ…åˆ†æ</figcaption></figure><h4 id="tcp-é‡å¤ç¡®è®¤å’Œå¿«é€Ÿé‡ä¼ " tabindex="-1"><a class="header-anchor" href="#tcp-é‡å¤ç¡®è®¤å’Œå¿«é€Ÿé‡ä¼ "><span>- TCP é‡å¤ç¡®è®¤å’Œå¿«é€Ÿé‡ä¼ </span></a></h4><p>å½“æ¥æ”¶æ–¹æ”¶åˆ°<strong>ä¹±åºæ•°æ®åŒ…æ—¶</strong>ï¼Œä¼šå‘é€<strong>é‡å¤çš„ ACK</strong>ï¼Œä»¥ä¾¿å‘ŠçŸ¥å‘é€æ–¹è¦é‡å‘è¯¥æ•°æ®åŒ…ï¼Œ<strong>å½“å‘é€æ–¹æ”¶åˆ° 3 ä¸ªé‡å¤ ACK æ—¶ï¼Œå°±ä¼šè§¦å‘ å¿«é€Ÿé‡ä¼ ï¼Œç«‹åˆ»é‡å‘ä¸¢å¤±æ•°æ®åŒ…ã€‚</strong></p><figure><img src="'+ie+'" alt="å¿«é€Ÿé‡ä¼ æœºåˆ¶" tabindex="0" loading="lazy"><figcaption>å¿«é€Ÿé‡ä¼ æœºåˆ¶</figcaption></figure><p>TCP é‡å¤ç¡®è®¤å’Œå¿«é€Ÿé‡ä¼ çš„ä¸€ä¸ªæ¡ˆä¾‹ï¼Œç”¨ Wireshark åˆ†æï¼Œæ˜¾ç¤ºå¦‚ä¸‹ï¼š</p><figure><img src="'+ge+'" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><ul><li>æ•°æ®åŒ… 1 æœŸæœ›çš„ä¸‹ä¸€ä¸ªæ•°æ®åŒ… Seq æ˜¯ 1ï¼Œä½†æ˜¯æ•°æ®åŒ… 2 å‘é€çš„ Seq å´æ˜¯ 10945ï¼Œè¯´æ˜<strong>æ”¶åˆ°çš„æ˜¯ä¹±åºæ•°æ®åŒ…</strong>ï¼Œäºæ˜¯å›äº†æ•°æ®åŒ… 3 ï¼Œè¿˜æ˜¯åŒæ ·çš„ Seq = 1ï¼ŒAck = 1ï¼Œè¿™è¡¨æ˜æ˜¯é‡å¤çš„ ACKï¼›</li><li>æ•°æ®åŒ… 4 å’Œ 6 ä¾ç„¶æ˜¯ä¹±åºçš„æ•°æ®åŒ…ï¼Œäºæ˜¯ä¾ç„¶å›äº†é‡å¤çš„ ACKï¼›</li><li>å½“å¯¹æ–¹æ”¶åˆ°ä¸‰æ¬¡é‡å¤çš„ ACK åï¼Œäºæ˜¯å°±<strong>å¿«é€Ÿé‡ä¼ äº†</strong> Seq = 1 ã€Len = 1368 çš„æ•°æ®åŒ… 8ï¼›</li><li>å½“æ”¶åˆ°é‡ä¼ çš„æ•°æ®åŒ…åï¼Œ<strong>å‘ç° Seq = 1 æ˜¯æœŸæœ›çš„æ•°æ®åŒ…</strong>ï¼Œäºæ˜¯å°±å‘é€äº†ä¸ª<strong>ç¡®è®¤æ”¶åˆ°å¿«é€Ÿé‡ä¼ çš„ ACK</strong></li></ul><p>æ³¨æ„ï¼šå¿«é€Ÿé‡ä¼ å’Œé‡å¤ ACK æ ‡è®°ä¿¡æ¯æ˜¯ Wireshark çš„åŠŸèƒ½ï¼Œéæ•°æ®åŒ…æœ¬èº«çš„ä¿¡æ¯ã€‚</p><p>ä»¥ä¸Šæ¡ˆä¾‹åœ¨ TCP ä¸‰æ¬¡æ¡æ‰‹æ—¶åå•†å¼€å¯äº†<strong>é€‰æ‹©æ€§ç¡®è®¤ SACK</strong>ï¼Œå› æ­¤ä¸€æ—¦æ•°æ®åŒ…ä¸¢å¤±å¹¶æ”¶åˆ°é‡å¤ ACK ï¼Œå³ä½¿åœ¨ä¸¢å¤±æ•°æ®åŒ…ä¹‹åè¿˜æˆåŠŸæ¥æ”¶äº†å…¶ä»–æ•°æ®åŒ…ï¼Œä¹Ÿ<strong>åªéœ€è¦é‡ä¼ ä¸¢å¤±çš„æ•°æ®åŒ…</strong>ã€‚<strong>å¦‚æœä¸å¯ç”¨ SACKï¼Œå°±å¿…é¡»é‡ä¼ ä¸¢å¤±åŒ…ä¹‹åçš„æ¯ä¸ªæ•°æ®åŒ…ã€‚</strong></p><p>å¦‚æœè¦æ”¯æŒ <code>SACK</code>ï¼Œå¿…é¡»åŒæ–¹éƒ½è¦æ”¯æŒã€‚åœ¨ Linux ä¸‹ï¼Œå¯ä»¥é€šè¿‡ <code>net.ipv4.tcp_sack</code> å‚æ•°æ‰“å¼€è¿™ä¸ªåŠŸèƒ½ï¼ˆLinux 2.4 åé»˜è®¤æ‰“å¼€ï¼‰ã€‚</p><h4 id="tcp-æµé‡æ§åˆ¶" tabindex="-1"><a class="header-anchor" href="#tcp-æµé‡æ§åˆ¶"><span>- TCP æµé‡æ§åˆ¶</span></a></h4><p>TCP ä¸ºäº†é˜²æ­¢å‘é€æ–¹æ— è„‘çš„å‘é€æ•°æ®ï¼Œå¯¼è‡´æ¥æ”¶æ–¹ç¼“å†²åŒºè¢«å¡«æ»¡ï¼Œæ‰€ä»¥å°±æœ‰äº†<strong>æ»‘åŠ¨çª—å£çš„æœºåˆ¶</strong>ï¼Œå®ƒå¯<strong>åˆ©ç”¨æ¥æ”¶æ–¹çš„æ¥æ”¶çª—å£æ¥æ§åˆ¶å‘é€æ–¹è¦å‘é€çš„æ•°æ®é‡</strong>ï¼Œä¹Ÿå°±æ˜¯<strong>æµé‡æ§åˆ¶ã€‚</strong></p><p>æ¥æ”¶çª—å£æ˜¯<strong>ç”±æ¥æ”¶æ–¹æŒ‡å®šçš„å€¼</strong>ï¼Œå­˜å‚¨åœ¨ <strong>TCP å¤´éƒ¨</strong>ä¸­ï¼Œå®ƒå¯ä»¥å‘Šè¯‰å‘é€æ–¹è‡ªå·±çš„ TCP ç¼“å†²ç©ºé—´åŒºå¤§å°ï¼Œè¿™ä¸ªç¼“å†²åŒºæ˜¯ç»™åº”ç”¨ç¨‹åºè¯»å–æ•°æ®çš„ç©ºé—´ï¼š</p><blockquote><ul><li>å¦‚æœåº”ç”¨ç¨‹åºè¯»å–äº†ç¼“å†²åŒºçš„æ•°æ®ï¼Œé‚£ä¹ˆç¼“å†²ç©ºé—´åŒºå°±ä¼šæŠŠè¢«è¯»å–çš„æ•°æ®ç§»é™¤</li><li>å¦‚æœ<strong>åº”ç”¨ç¨‹åºæ²¡æœ‰è¯»å–æ•°æ®</strong>ï¼Œåˆ™æ•°æ®ä¼šä¸€ç›´æ»ç•™åœ¨<strong>ç¼“å†²åŒº</strong>ã€‚</li></ul></blockquote><p><strong>æ¥æ”¶çª—å£çš„å¤§å°ï¼Œæ˜¯åœ¨ TCP ä¸‰æ¬¡æ¡æ‰‹ä¸­åå•†å¥½çš„</strong>ï¼Œåç»­æ•°æ®ä¼ è¾“æ—¶ï¼Œæ¥æ”¶æ–¹å‘é€ç¡®è®¤åº”ç­” ACK æŠ¥æ–‡æ—¶ï¼Œä¼šæºå¸¦å½“å‰çš„æ¥æ”¶çª—å£çš„å¤§å°ï¼Œä»¥æ­¤æ¥å‘ŠçŸ¥å‘é€æ–¹ã€‚</p><p>å‡è®¾æ¥æ”¶æ–¹æ¥æ”¶åˆ°æ•°æ®åï¼Œåº”ç”¨å±‚èƒ½å¾ˆå¿«çš„ä»ç¼“å†²åŒºé‡Œè¯»å–æ•°æ®ï¼Œé‚£ä¹ˆçª—å£å¤§å°ä¼šä¸€ç›´ä¿æŒä¸å˜ï¼Œè¿‡ç¨‹å¦‚ä¸‹ï¼š</p><figure><img src="'+ae+'" alt="ç†æƒ³çŠ¶æ€ä¸‹çš„çª—å£å˜åŒ–" tabindex="0" loading="lazy"><figcaption>ç†æƒ³çŠ¶æ€ä¸‹çš„çª—å£å˜åŒ–</figcaption></figure><p>ä½†æ˜¯ç°å®ä¸­<strong>æœåŠ¡å™¨ä¼šå‡ºç°ç¹å¿™</strong>çš„æƒ…å†µï¼Œå½“<strong>åº”ç”¨ç¨‹åºè¯»å–é€Ÿåº¦æ…¢</strong>ï¼Œé‚£ä¹ˆ<strong>ç¼“å­˜ç©ºé—´ä¼šæ…¢æ…¢è¢«å æ»¡</strong>ï¼Œäºæ˜¯ä¸ºäº†ä¿è¯å‘é€æ–¹å‘é€çš„æ•°æ®ä¸ä¼šè¶…è¿‡ç¼“å†²åŒºå¤§å°ï¼Œ<strong>æœåŠ¡å™¨åˆ™ä¼šè°ƒæ•´çª—å£å¤§å°çš„å€¼ï¼Œæ¥ç€é€šè¿‡ ACK æŠ¥æ–‡é€šçŸ¥ç»™å¯¹æ–¹</strong>ï¼Œå‘ŠçŸ¥ç°åœ¨çš„æ¥æ”¶çª—å£å¤§å°ï¼Œä»è€Œæ§åˆ¶å‘é€æ–¹å‘é€çš„æ•°æ®å¤§å°ã€‚</p><figure><img src="'+le+'" alt="æœåŠ¡ç«¯ç¹å¿™çŠ¶æ€ä¸‹çš„çª—å£å˜åŒ–" tabindex="0" loading="lazy"><figcaption>æœåŠ¡ç«¯ç¹å¿™çŠ¶æ€ä¸‹çš„çª—å£å˜åŒ–</figcaption></figure><h4 id="é›¶çª—å£é€šçŸ¥ä¸çª—å£æ¢æµ‹" tabindex="-1"><a class="header-anchor" href="#é›¶çª—å£é€šçŸ¥ä¸çª—å£æ¢æµ‹"><span>- é›¶çª—å£é€šçŸ¥ä¸çª—å£æ¢æµ‹</span></a></h4><p>å‡è®¾<strong>æ¥æ”¶æ–¹å¤„ç†æ•°æ®</strong>çš„é€Ÿåº¦è·Ÿä¸ä¸Š<strong>æ¥æ”¶æ•°æ®çš„é€Ÿåº¦</strong>ï¼Œç¼“å­˜å°±ä¼šè¢«å æ»¡ï¼Œä»è€Œå¯¼è‡´æ¥æ”¶çª—å£ä¸º 0ï¼Œå½“å‘é€æ–¹æ¥æ”¶åˆ°é›¶çª—å£é€šçŸ¥æ—¶ï¼Œå°±ä¼šåœæ­¢å‘é€æ•°æ®ã€‚</p><p>å¦‚ä¸‹å›¾ï¼Œå¯ä»¥çœ‹åˆ°æ¥æ”¶æ–¹çš„çª—å£å¤§å°åœ¨ä¸æ–­çš„æ”¶ç¼©è‡³ 0ï¼š</p><figure><img src="'+ce+'" alt="çª—å£å¤§å°åœ¨æ”¶ç¼©" tabindex="0" loading="lazy"><figcaption>çª—å£å¤§å°åœ¨æ”¶ç¼©</figcaption></figure><p>æ¥ç€ï¼Œå‘é€æ–¹ä¼š<strong>å®šæ—¶å‘é€çª—å£å¤§å°æ¢æµ‹æŠ¥æ–‡</strong>ï¼Œä»¥ä¾¿<strong>åŠæ—¶çŸ¥é“æ¥æ”¶æ–¹çª—å£å¤§å°çš„å˜åŒ–ã€‚</strong></p><p>ä»¥ä¸‹å›¾ Wireshark åˆ†æå›¾ä½œä¸ºä¾‹å­è¯´æ˜ï¼š</p><figure><img src="'+de+'" alt="é›¶çª—å£ ä¸ çª—å£æ¢æµ‹" tabindex="0" loading="lazy"><figcaption>é›¶çª—å£ ä¸ çª—å£æ¢æµ‹</figcaption></figure><ul><li>å‘é€æ–¹å‘é€äº†æ•°æ®åŒ… 1 ç»™æ¥æ”¶æ–¹ï¼Œæ¥æ”¶æ–¹æ”¶åˆ°åï¼Œç”±äºç¼“å†²åŒºè¢«å æ»¡ï¼Œå›äº†ä¸ªé›¶çª—å£é€šçŸ¥ï¼›</li><li>å‘é€æ–¹æ”¶åˆ°é›¶çª—å£é€šçŸ¥åï¼Œå°±ä¸å†å‘é€æ•°æ®äº†ï¼Œç›´åˆ°è¿‡äº† <code>3.4</code> ç§’åï¼Œå‘é€äº†ä¸€ä¸ª TCP Keep-Alive æŠ¥æ–‡ï¼Œä¹Ÿå°±<strong>æ˜¯çª—å£å¤§å°æ¢æµ‹æŠ¥æ–‡ï¼›</strong></li><li>å½“æ¥æ”¶æ–¹æ”¶åˆ°çª—å£æ¢æµ‹æŠ¥æ–‡åï¼Œå°±ç«‹é©¬å›ä¸€ä¸ªçª—å£é€šçŸ¥ï¼Œä½†æ˜¯çª—å£å¤§å°è¿˜æ˜¯ 0ï¼›</li><li>å‘é€æ–¹å‘ç°çª—å£è¿˜æ˜¯ 0ï¼Œäºæ˜¯ç»§ç»­ç­‰å¾…äº† <code>6.8</code>ï¼ˆç¿»å€ï¼‰ ç§’åï¼Œåˆå‘é€äº†çª—å£æ¢æµ‹æŠ¥æ–‡ï¼Œæ¥æ”¶æ–¹ä¾ç„¶è¿˜æ˜¯å›äº†çª—å£ä¸º 0 çš„é€šçŸ¥ï¼›</li><li>å‘é€æ–¹å‘ç°çª—å£è¿˜æ˜¯ 0ï¼Œäºæ˜¯ç»§ç»­ç­‰å¾…äº† <code>13.5</code>ï¼ˆç¿»å€ï¼‰ ç§’åï¼Œåˆå‘é€äº†çª—å£æ¢æµ‹æŠ¥æ–‡ï¼Œæ¥æ”¶æ–¹ä¾ç„¶è¿˜æ˜¯å›äº†çª—å£ä¸º 0 çš„é€šçŸ¥ï¼›</li></ul><p>å¯ä»¥å‘ç°ï¼Œè¿™äº›çª—å£æ¢æµ‹æŠ¥æ–‡ä»¥ 3.4sã€6.5sã€13.5s çš„é—´éš”å‡ºç°ï¼Œè¯´æ˜è¶…æ—¶æ—¶é—´ä¼š<strong>ç¿»å€</strong>é€’å¢ã€‚</p><p>è¿™è¿æ¥æš‚åœäº† 25sï¼Œæƒ³è±¡ä¸€ä¸‹ä½ åœ¨æ‰“ç‹è€…çš„æ—¶å€™ï¼Œ25s çš„å»¶è¿Ÿä½ è¿˜èƒ½ä¸Šç‹è€…å—ï¼Ÿ</p><h4 id="å‘é€çª—å£çš„åˆ†æ" tabindex="-1"><a class="header-anchor" href="#å‘é€çª—å£çš„åˆ†æ"><span>- å‘é€çª—å£çš„åˆ†æ</span></a></h4><blockquote><p>åœ¨ Wireshark çœ‹åˆ°çš„ Windows size ä¹Ÿå°±æ˜¯ &quot; win = &quot;ï¼Œè¿™ä¸ªå€¼è¡¨ç¤ºå‘é€çª—å£å—ï¼Ÿ</p></blockquote><p>è¿™ä¸æ˜¯å‘é€çª—å£ï¼Œè€Œæ˜¯åœ¨<strong>å‘å¯¹æ–¹å£°æ˜è‡ªå·±çš„æ¥æ”¶çª—å£ã€‚</strong></p><p>ä½ å¯èƒ½ä¼šå¥½å¥‡ï¼ŒæŠ“åŒ…æ–‡ä»¶é‡Œæœ‰ã€ŒWindow size scaling factorã€ï¼Œå®ƒå…¶å®æ˜¯ç®—å‡ºå®é™…çª—å£å¤§å°çš„ä¹˜æ³•å› å­ï¼Œã€ŒWindow size valueã€å®é™…ä¸Šå¹¶ä¸æ˜¯çœŸå®çš„çª—å£å¤§å°ï¼ŒçœŸå®çª—å£å¤§å°çš„è®¡ç®—å…¬å¼å¦‚ä¸‹ï¼š</p><p>ã€ŒWindow size valueã€ * ã€ŒWindow size scaling factorã€ = ã€ŒCaculated window size ã€</p><p>å¯¹åº”çš„ä¸‹å›¾æ¡ˆä¾‹ï¼Œä¹Ÿå°±æ˜¯ 32 * 2048 = 65536ã€‚</p><figure><img src="'+me+'" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><p>å®é™…ä¸Šæ˜¯ Caculated window size çš„å€¼æ˜¯ Wireshark å·¥å…·å¸®æˆ‘ä»¬ç®—å¥½çš„ï¼ŒWindow size scaling factor å’Œ Windos size value çš„å€¼æ˜¯åœ¨ TCP å¤´éƒ¨ä¸­ï¼Œå…¶ä¸­ Window size scaling factor æ˜¯åœ¨ä¸‰æ¬¡æ¡æ‰‹è¿‡ç¨‹ä¸­ç¡®å®šçš„ï¼Œå¦‚æœä½ æŠ“åŒ…çš„æ•°æ®æ²¡æœ‰ TCP ä¸‰æ¬¡æ¡æ‰‹ï¼Œé‚£å¯èƒ½å°±æ— æ³•ç®—å‡ºçœŸå®çš„çª—å£å¤§å°çš„å€¼ï¼Œå¦‚ä¸‹å›¾ï¼š</p><figure><img src="'+Te+`" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><blockquote><p>å¦‚ä½•åœ¨åŒ…é‡Œçœ‹å‡ºå‘é€çª—å£çš„å¤§å°ï¼Ÿ</p></blockquote><p>å¾ˆé—æ†¾ï¼Œæ²¡æœ‰ç®€å•çš„åŠæ³•ï¼Œå‘é€çª—å£è™½ç„¶æ˜¯ç”±æ¥æ”¶çª—å£å†³å®šï¼Œä½†æ˜¯å®ƒ<strong>åˆå¯ä»¥è¢«ç½‘ç»œå› ç´ å½±å“</strong>ï¼Œä¹Ÿå°±æ˜¯<strong>æ‹¥å¡çª—å£</strong>ï¼Œå®é™…ä¸Šå‘é€çª—å£æ˜¯å€¼æ˜¯ min(æ‹¥å¡çª—å£ï¼Œæ¥æ”¶çª—å£)ã€‚</p><blockquote><p>å‘é€çª—å£å’Œ MSS æœ‰ä»€ä¹ˆå…³ç³»ï¼Ÿ</p></blockquote><p><strong>å‘é€çª—å£å†³å®šäº†ä¸€å£æ°”èƒ½å‘å¤šå°‘å­—èŠ‚</strong>ï¼Œè€Œ <strong>MSS å†³å®šäº†è¿™äº›å­—èŠ‚è¦åˆ†å¤šå°‘åŒ…æ‰èƒ½å‘å®Œ</strong>ã€‚</p><p>ä¸¾ä¸ªä¾‹å­ï¼Œå¦‚æœå‘é€çª—å£ä¸º 16000 å­—èŠ‚çš„æƒ…å†µä¸‹ï¼Œå¦‚æœ MSS æ˜¯ 1000 å­—èŠ‚ï¼Œé‚£å°±éœ€è¦å‘é€ 1600/1000 = 16 ä¸ªåŒ…ã€‚</p><blockquote><p>å‘é€æ–¹åœ¨ä¸€ä¸ªçª—å£å‘å‡º n ä¸ªåŒ…ï¼Œæ˜¯ä¸æ˜¯éœ€è¦ n ä¸ª ACK ç¡®è®¤æŠ¥æ–‡ï¼Ÿ</p></blockquote><p>ä¸ä¸€å®šï¼Œå› ä¸º TCP æœ‰<strong>ç´¯è®¡ç¡®è®¤æœºåˆ¶</strong>ï¼Œæ‰€ä»¥å½“æ”¶åˆ°å¤šä¸ªæ•°æ®åŒ…æ—¶ï¼Œ<strong>åªéœ€è¦åº”ç­”æœ€åä¸€ä¸ªæ•°æ®åŒ…çš„ ACK æŠ¥æ–‡å°±å¯ä»¥äº†ã€‚</strong></p><h4 id="tcp-å»¶è¿Ÿç¡®è®¤ä¸-nagle-ç®—æ³•" tabindex="-1"><a class="header-anchor" href="#tcp-å»¶è¿Ÿç¡®è®¤ä¸-nagle-ç®—æ³•"><span>- TCP å»¶è¿Ÿç¡®è®¤ä¸ Nagle ç®—æ³•</span></a></h4><p>å½“æˆ‘ä»¬ TCP æŠ¥æ–‡çš„æ‰¿è½½çš„æ•°æ®éå¸¸å°çš„æ—¶å€™ï¼Œä¾‹å¦‚å‡ ä¸ªå­—èŠ‚ï¼Œé‚£ä¹ˆ<strong>æ•´ä¸ªç½‘ç»œçš„æ•ˆç‡æ˜¯å¾ˆä½çš„</strong>ï¼Œå› ä¸ºæ¯ä¸ª TCP æŠ¥æ–‡ä¸­éƒ½ä¼šæœ‰ 20 ä¸ªå­—èŠ‚çš„ TCP å¤´éƒ¨ï¼Œä¹Ÿä¼šæœ‰ 20 ä¸ªå­—èŠ‚çš„ IP å¤´éƒ¨ï¼Œ<strong>è€Œæ•°æ®åªæœ‰å‡ ä¸ªå­—èŠ‚</strong>ï¼Œæ‰€ä»¥åœ¨æ•´ä¸ªæŠ¥æ–‡ä¸­æœ‰æ•ˆæ•°æ®å æœ‰çš„æ¯”é‡å°±ä¼šéå¸¸ä½ã€‚</p><p>è¿™å°±å¥½åƒå¿«é€’å‘˜å¼€ç€å¤§è´§è½¦é€ä¸€ä¸ªå°åŒ…è£¹ä¸€æ ·æµªè´¹ã€‚</p><p>é‚£ä¹ˆå°±å‡ºç°äº†å¸¸è§çš„ä¸¤ç§ç­–ç•¥ï¼Œæ¥<strong>å‡å°‘å°æŠ¥æ–‡çš„ä¼ è¾“</strong>ï¼Œåˆ†åˆ«æ˜¯ï¼š</p><ul><li>Nagle ç®—æ³•</li><li>å»¶è¿Ÿç¡®è®¤</li></ul><blockquote><p>Nagle ç®—æ³•æ˜¯å¦‚ä½•é¿å…å¤§é‡ TCP å°æ•°æ®æŠ¥æ–‡çš„ä¼ è¾“ï¼Ÿ</p></blockquote><p>Nagle ç®—æ³•åšäº†ä¸€äº›ç­–ç•¥æ¥<strong>é¿å…è¿‡å¤šçš„å°æ•°æ®æŠ¥æ–‡å‘é€</strong>ï¼Œè¿™å¯æé«˜ä¼ è¾“æ•ˆç‡ã€‚</p><p>Nagle ä¼ªä»£ç å¦‚ä¸‹ï¼š</p><div class="language-c line-numbers-mode" data-ext="c" data-title="c"><pre class="language-c"><code><span class="token keyword">if</span> æœ‰æ•°æ®è¦å‘é€ <span class="token punctuation">{</span>
    <span class="token keyword">if</span> å¯ç”¨çª—å£å¤§å° <span class="token operator">&gt;=</span> MSS and å¯å‘é€çš„æ•°æ® <span class="token operator">&gt;=</span> MSS <span class="token punctuation">{</span>
    	ç«‹åˆ»å‘é€MSSå¤§å°çš„æ•°æ®
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> æœ‰æœªç¡®è®¤çš„æ•°æ® <span class="token punctuation">{</span>
            å°†æ•°æ®æ”¾å…¥ç¼“å­˜ç­‰å¾…æ¥æ”¶ACK
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            ç«‹åˆ»å‘é€æ•°æ®
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä½¿ç”¨ Nagle ç®—æ³•ï¼Œè¯¥ç®—æ³•çš„æ€è·¯æ˜¯<strong>å»¶æ—¶å¤„ç†</strong>ï¼Œåªæœ‰æ»¡è¶³ä¸‹é¢ä¸¤ä¸ªæ¡ä»¶ä¸­çš„ä»»æ„ä¸€ä¸ªæ¡ä»¶ï¼Œæ‰èƒ½å¯ä»¥å‘é€æ•°æ®ï¼š</p><ul><li>æ¡ä»¶ä¸€ï¼šè¦ç­‰åˆ°çª—å£å¤§å° &gt;= <code>MSS</code> å¹¶ä¸” æ•°æ®å¤§å° &gt;= <code>MSS</code>ï¼›</li><li>æ¡ä»¶äºŒï¼šæ”¶åˆ°ä¹‹å‰å‘é€æ•°æ®çš„ <code>ack</code> å›åŒ…ï¼›</li></ul><p>åªè¦ä¸Šé¢ä¸¤ä¸ªæ¡ä»¶éƒ½ä¸æ»¡è¶³ï¼Œå‘é€æ–¹ä¸€ç›´åœ¨<strong>å›¤ç§¯æ•°æ®</strong>ï¼Œç›´åˆ°æ»¡è¶³ä¸Šé¢çš„å‘é€æ¡ä»¶ã€‚</p><figure><img src="`+he+'" alt="ç¦ç”¨ Nagle ç®—æ³• ä¸ å¯ç”¨ Nagle ç®—æ³•" tabindex="0" loading="lazy"><figcaption>ç¦ç”¨ Nagle ç®—æ³• ä¸ å¯ç”¨ Nagle ç®—æ³•</figcaption></figure><p>ä¸Šå›¾å³ä¾§å¯ç”¨äº† Nagle ç®—æ³•ï¼Œå®ƒçš„å‘é€æ•°æ®çš„è¿‡ç¨‹ï¼š</p><ul><li>ä¸€å¼€å§‹ç”±äºæ²¡æœ‰å·²å‘é€æœªç¡®è®¤çš„æŠ¥æ–‡ï¼Œæ‰€ä»¥å°±ç«‹åˆ»å‘äº† H å­—ç¬¦ï¼›</li><li>æ¥ç€ï¼Œåœ¨è¿˜æ²¡æ”¶åˆ°å¯¹ H å­—ç¬¦çš„ç¡®è®¤æŠ¥æ–‡æ—¶ï¼Œå‘é€æ–¹å°±ä¸€ç›´åœ¨å›¤ç§¯æ•°æ®ï¼Œç›´åˆ°æ”¶åˆ°äº†ç¡®è®¤æŠ¥æ–‡åï¼Œæ­¤æ—¶æ²¡æœ‰å·²å‘é€æœªç¡®è®¤çš„æŠ¥æ–‡ï¼Œäºæ˜¯å°±æŠŠå›¤ç§¯åçš„ ELL å­—ç¬¦ä¸€èµ·å‘ç»™äº†æ¥æ”¶æ–¹ï¼›</li><li>å¾…æ”¶åˆ°å¯¹ ELL å­—ç¬¦çš„ç¡®è®¤æŠ¥æ–‡åï¼Œäºæ˜¯æŠŠæœ€åä¸€ä¸ª O å­—ç¬¦å‘é€äº†å‡ºå»</li></ul><p>å¯ä»¥çœ‹å‡ºï¼Œ<strong>Nagle ç®—æ³•ä¸€å®šä¼šæœ‰ä¸€ä¸ªå°æŠ¥æ–‡ï¼Œä¹Ÿå°±æ˜¯åœ¨æœ€å¼€å§‹çš„æ—¶å€™ã€‚</strong></p><p>å¦å¤–ï¼ŒNagle ç®—æ³•<strong>é»˜è®¤æ˜¯æ‰“å¼€çš„</strong>ï¼Œå¦‚æœå¯¹äºä¸€äº›éœ€è¦å°æ•°æ®åŒ…äº¤äº’çš„åœºæ™¯çš„ç¨‹åºï¼Œæ¯”å¦‚ï¼Œtelnet æˆ– ssh è¿™æ ·çš„äº¤äº’æ€§æ¯”è¾ƒå¼ºçš„ç¨‹åºï¼Œåˆ™éœ€è¦å…³é—­ Nagle ç®—æ³•ã€‚</p><p>å¯ä»¥åœ¨ Socket è®¾ç½® <code>TCP_NODELAY</code> é€‰é¡¹æ¥å…³é—­è¿™ä¸ªç®—æ³•ï¼ˆå…³é—­ Nagle ç®—æ³•æ²¡æœ‰å…¨å±€å‚æ•°ï¼Œéœ€è¦æ ¹æ®æ¯ä¸ªåº”ç”¨è‡ªå·±çš„ç‰¹ç‚¹æ¥å…³é—­ï¼‰ã€‚</p><img src="'+ue+'" alt="å…³é—­ Nagle ç®—æ³•" style="zoom:67%;"><blockquote><p>é‚£<strong>å»¶è¿Ÿç¡®è®¤</strong>åˆæ˜¯ä»€ä¹ˆï¼Ÿ</p></blockquote><p>äº‹å®ä¸Š<strong>å½“æ²¡æœ‰æºå¸¦æ•°æ®çš„ ACK</strong>ï¼Œå®ƒçš„<strong>ç½‘ç»œæ•ˆç‡ä¹Ÿæ˜¯å¾ˆä½çš„</strong>ï¼Œå› ä¸ºå®ƒä¹Ÿæœ‰ 40 ä¸ªå­—èŠ‚çš„ IP å¤´ å’Œ TCP å¤´ï¼Œä½†å´æ²¡æœ‰æºå¸¦æ•°æ®æŠ¥æ–‡ã€‚</p><p>ä¸ºäº†è§£å†³ ACK ä¼ è¾“æ•ˆç‡ä½é—®é¢˜ï¼Œæ‰€ä»¥å°±è¡ç”Ÿå‡ºäº† <strong>TCP å»¶è¿Ÿç¡®è®¤</strong>ã€‚</p><p>TCP å»¶è¿Ÿç¡®è®¤çš„ç­–ç•¥ï¼š</p><ul><li>å½“<strong>æœ‰å“åº”æ•°æ®è¦å‘é€</strong>æ—¶ï¼ŒACK ä¼šéšç€å“åº”æ•°æ®ä¸€èµ·ç«‹åˆ»å‘é€ç»™å¯¹æ–¹</li><li>å½“æ²¡æœ‰å“åº”æ•°æ®è¦å‘é€æ—¶ï¼ŒACK å°†ä¼š<strong>å»¶è¿Ÿä¸€æ®µæ—¶é—´</strong>ï¼Œä»¥ç­‰å¾…æ˜¯å¦æœ‰å“åº”æ•°æ®å¯ä»¥ä¸€èµ·å‘é€</li><li>å¦‚æœåœ¨å»¶è¿Ÿç­‰å¾…å‘é€ ACK æœŸé—´ï¼Œ<strong>å¯¹æ–¹çš„ç¬¬äºŒä¸ªæ•°æ®æŠ¥æ–‡åˆåˆ°è¾¾äº†</strong>ï¼Œè¿™æ—¶å°±ä¼šç«‹åˆ»å‘é€ ACK</li></ul><figure><img src="'+_e+'" alt="TCP å»¶è¿Ÿç¡®è®¤" tabindex="0" loading="lazy"><figcaption>TCP å»¶è¿Ÿç¡®è®¤</figcaption></figure><p>å»¶è¿Ÿç­‰å¾…çš„æ—¶é—´æ˜¯åœ¨ Linux å†…æ ¸ä¸­å®šä¹‰çš„ï¼Œå¦‚ä¸‹å›¾ï¼š</p><img src="'+Pe+'" alt="img" style="zoom:67%;"><p>å…³é”®å°±éœ€è¦ <code>HZ</code> è¿™ä¸ªæ•°å€¼å¤§å°ï¼ŒHZ æ˜¯è·Ÿç³»ç»Ÿçš„æ—¶é’Ÿé¢‘ç‡æœ‰å…³ï¼Œæ¯ä¸ªæ“ä½œç³»ç»Ÿéƒ½ä¸ä¸€æ ·ï¼Œåœ¨æˆ‘çš„ Linux ç³»ç»Ÿä¸­ HZ å¤§å°æ˜¯ <code>1000</code>ï¼Œå¦‚ä¸‹å›¾ï¼š</p><img src="'+Ce+'" alt="img" style="zoom:67%;"><p>çŸ¥é“äº† HZ çš„å¤§å°ï¼Œé‚£ä¹ˆå°±å¯ä»¥ç®—å‡ºï¼š</p><ul><li>æœ€å¤§å»¶è¿Ÿç¡®è®¤æ—¶é—´æ˜¯ <code>200</code> ms ï¼ˆ1000/5ï¼‰</li><li>æœ€çŸ­å»¶è¿Ÿç¡®è®¤æ—¶é—´æ˜¯ <code>40</code> ms ï¼ˆ1000/25ï¼‰</li></ul><p>TCP å»¶è¿Ÿç¡®è®¤å¯ä»¥åœ¨ Socket è®¾ç½® <code>TCP_QUICKACK</code> é€‰é¡¹æ¥å…³é—­è¿™ä¸ªç®—æ³•ã€‚</p><img src="'+be+'" alt="å…³é—­ TCP å»¶è¿Ÿç¡®è®¤" style="zoom:67%;"><blockquote><p>å»¶è¿Ÿç¡®è®¤ å’Œ Nagle ç®—æ³•æ··åˆä½¿ç”¨æ—¶ï¼Œä¼šäº§ç”Ÿæ–°çš„é—®é¢˜</p></blockquote><p>å½“ TCP å»¶è¿Ÿç¡®è®¤ å’Œ Nagle ç®—æ³•æ··åˆä½¿ç”¨æ—¶ï¼Œä¼šå¯¼è‡´<strong>æ—¶è€—å¢é•¿</strong>ï¼Œå¦‚ä¸‹å›¾ï¼š</p><figure><img src="'+ke+'" alt="TCP å»¶è¿Ÿç¡®è®¤ å’Œ Nagle ç®—æ³•æ··åˆä½¿ç”¨" tabindex="0" loading="lazy"><figcaption>TCP å»¶è¿Ÿç¡®è®¤ å’Œ Nagle ç®—æ³•æ··åˆä½¿ç”¨</figcaption></figure><p>å‘é€æ–¹ä½¿ç”¨äº† Nagle ç®—æ³•ï¼Œæ¥æ”¶æ–¹ä½¿ç”¨äº† TCP å»¶è¿Ÿç¡®è®¤ä¼šå‘ç”Ÿå¦‚ä¸‹çš„è¿‡ç¨‹ï¼š</p><ul><li>å‘é€æ–¹å…ˆå‘å‡ºä¸€ä¸ªå°æŠ¥æ–‡ï¼Œæ¥æ”¶æ–¹æ”¶åˆ°åï¼Œç”±äºå»¶è¿Ÿç¡®è®¤æœºåˆ¶ï¼Œè‡ªå·±åˆæ²¡æœ‰è¦å‘é€çš„æ•°æ®ï¼Œåªèƒ½å¹²ç­‰ç€å‘é€æ–¹çš„ä¸‹ä¸€ä¸ªæŠ¥æ–‡åˆ°è¾¾ï¼›</li><li>è€Œå‘é€æ–¹ç”±äº Nagle ç®—æ³•æœºåˆ¶ï¼Œåœ¨æœªæ”¶åˆ°ç¬¬ä¸€ä¸ªæŠ¥æ–‡çš„ç¡®è®¤å‰ï¼Œæ˜¯ä¸ä¼šå‘é€åç»­çš„æ•°æ®ï¼›</li><li>æ‰€ä»¥æ¥æ”¶æ–¹åªèƒ½ç­‰å¾…æœ€å¤§æ—¶é—´ 200 ms åï¼Œæ‰å› ACK æŠ¥æ–‡ï¼Œå‘é€æ–¹æ”¶åˆ°ç¬¬ä¸€ä¸ªæŠ¥æ–‡çš„ç¡®è®¤æŠ¥æ–‡åï¼Œä¹Ÿæ‰å¯ä»¥å‘é€åç»­çš„æ•°æ®ã€‚</li></ul><blockquote><p><strong>å¾ˆæ˜æ˜¾ï¼Œè¿™ä¸¤ä¸ªåŒæ—¶ä½¿ç”¨ä¼šé€ æˆé¢å¤–çš„æ—¶å»¶ï¼Œè¿™å°±ä¼šä½¿å¾—ç½‘ç»œ&quot;å¾ˆæ…¢&quot;çš„æ„Ÿè§‰ã€‚</strong></p><p>è¦è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œåªæœ‰ä¸¤ä¸ªåŠæ³•ï¼š</p><ul><li>è¦ä¸å‘é€æ–¹å…³é—­ Nagle ç®—æ³•</li><li>è¦ä¸æ¥æ”¶æ–¹å…³é—­ TCP å»¶è¿Ÿç¡®è®¤</li></ul></blockquote><h4 id="è¯»è€…é—®ç­”" tabindex="-1"><a class="header-anchor" href="#è¯»è€…é—®ç­”"><span>- è¯»è€…é—®ç­”</span></a></h4><blockquote><p>è¯»è€…é—®ï¼šâ€œä¸¤ä¸ªé—®é¢˜ï¼Œè¯·æ•™ä¸€ä¸‹ä½œè€…: tcp_retries1 å‚æ•°ï¼Œæ˜¯ä»€ä¹ˆåœºæ™¯ä¸‹ç”Ÿæ•ˆï¼Ÿ tcp_retries2æ˜¯ä¸æ˜¯åªå—é™äºè§„å®šçš„æ¬¡æ•°ï¼Œè¿˜æ˜¯å—é™äºæ¬¡æ•°å’Œæ—¶é—´é™åˆ¶çš„æœ€å°å€¼ï¼Ÿâ€</p></blockquote><p>tcp_retries1å’Œtcp_retries2éƒ½æ˜¯åœ¨TCPä¸‰æ¬¡æ¡æ‰‹ä¹‹åçš„åœºæ™¯ã€‚</p><ul><li>å½“é‡ä¼ æ¬¡æ•°è¶…è¿‡tcp_retries1å°±ä¼šæŒ‡ç¤º IP å±‚è¿›è¡Œ MTU æ¢æµ‹ã€åˆ·æ–°è·¯ç”±ç­‰è¿‡ç¨‹ï¼Œå¹¶ä¸ä¼šæ–­å¼€TCPè¿æ¥ï¼Œå½“é‡ä¼ æ¬¡æ•°è¶…è¿‡ tcp_retries2 æ‰ä¼šæ–­å¼€TCPæµã€‚</li><li>tcp_retries1 å’Œ tcp_retries2 ä¸¤ä¸ªé‡ä¼ æ¬¡æ•°éƒ½æ˜¯å—ä¸€ä¸ª timeout å€¼é™åˆ¶çš„ï¼Œtimeout çš„å€¼æ˜¯æ ¹æ®å®ƒä¿©çš„å€¼è®¡ç®—å‡ºæ¥çš„ï¼Œå½“é‡ä¼ æ—¶é—´è¶…è¿‡ timeoutï¼Œå°±ä¸ä¼šç»§ç»­é‡ä¼ äº†ï¼Œå³ä½¿æ¬¡æ•°è¿˜æ²¡åˆ°è¾¾ã€‚</li></ul><blockquote><p>è¯»è€…é—®ï¼šâ€œtcp_orphan_retriesä¹Ÿæ˜¯æ§åˆ¶tcpè¿æ¥çš„å…³é—­ã€‚è¿™ä¸ªè·Ÿtcp_retries1 tcp_retries2æœ‰ä»€ä¹ˆåŒºåˆ«å—ï¼Ÿâ€</p></blockquote><p>ä¸»åŠ¨æ–¹å‘é€ FIN æŠ¥æ–‡åï¼Œè¿æ¥å°±å¤„äº FIN_WAIT1 çŠ¶æ€ä¸‹ï¼Œè¯¥çŠ¶æ€é€šå¸¸åº”åœ¨æ•°åæ¯«ç§’å†…è½¬ä¸º FIN_WAIT2ã€‚å¦‚æœè¿Ÿè¿Ÿæ”¶ä¸åˆ°å¯¹æ–¹è¿”å›çš„ ACK æ—¶ï¼Œæ­¤æ—¶ï¼Œå†…æ ¸ä¼šå®šæ—¶é‡å‘ FIN æŠ¥æ–‡ï¼Œå…¶ä¸­é‡å‘æ¬¡æ•°ç”± tcp_orphan_retries å‚æ•°æ§åˆ¶ã€‚</p><blockquote><p>è¯»è€…é—®ï¼šâ€œè¯·é—®ï¼Œä¸ºä»€ä¹ˆè¿ç»­ä¸¤ä¸ªæŠ¥æ–‡çš„seqä¼šæ˜¯ä¸€æ ·çš„å‘¢ï¼Œæ¯”å¦‚ä¸‰æ¬¡æ¡æ‰‹ä¹‹åçš„é‚£ä¸ªæŠ¥æ–‡ï¼Ÿè¿˜æ˜¯è¯´ï¼Œåºå·ç›¸åŒçš„æ˜¯åŒä¸€ä¸ªæŠ¥æ–‡ï¼Œåªæ˜¯æ‹†å¼€æ˜¾ç¤ºäº†ï¼Ÿâ€</p></blockquote><ol><li>ä¸‰æ¬¡æ¡æ‰‹ä¸­çš„å‰ä¸¤æ¬¡ï¼Œæ˜¯ seq+1ï¼›</li><li>ä¸‰æ¬¡æ¡æ‰‹ä¸­çš„æœ€åä¸€ä¸ª ackï¼Œå®é™…ä¸Šæ˜¯å¯ä»¥æºå¸¦æ•°æ®çš„ï¼Œç”±äºæˆ‘æ–‡ç« çš„ä¾‹å­æ˜¯<strong>æ²¡æœ‰å‘é€æ•°æ®çš„</strong>ï¼Œä½ å¯ä»¥çœ‹åˆ°ç¬¬ä¸‰æ¬¡æ¡æ‰‹çš„ len=0 ï¼Œåœ¨æ•°æ®ä¼ è¾“é˜¶æ®µã€Œä¸‹ä¸€ä¸ª seq=seq+len ã€ï¼Œæ‰€ä»¥<strong>ç¬¬ä¸‰æ¬¡æ¡æ‰‹çš„ seq å’Œä¸‹ä¸€ä¸ªæ•°æ®æŠ¥çš„ seq æ˜¯ä¸€æ ·çš„</strong>ï¼Œå› ä¸º len ä¸º 0ï¼›</li></ol><h2 id="-6" tabindex="-1"><a class="header-anchor" href="#-6"><span>--------------</span></a></h2><h2 id="_4-4-tcp-åŠè¿æ¥é˜Ÿåˆ—å’Œå…¨è¿æ¥é˜Ÿåˆ—" tabindex="-1"><a class="header-anchor" href="#_4-4-tcp-åŠè¿æ¥é˜Ÿåˆ—å’Œå…¨è¿æ¥é˜Ÿåˆ—"><span>4.4 TCP åŠè¿æ¥é˜Ÿåˆ—å’Œå…¨è¿æ¥é˜Ÿåˆ—</span></a></h2><img src="'+fe+'" alt="æœ¬æ–‡æçº²" style="zoom:50%;"><h3 id="ä»€ä¹ˆæ˜¯-tcp-åŠè¿æ¥é˜Ÿåˆ—å’Œå…¨è¿æ¥é˜Ÿåˆ—" tabindex="-1"><a class="header-anchor" href="#ä»€ä¹ˆæ˜¯-tcp-åŠè¿æ¥é˜Ÿåˆ—å’Œå…¨è¿æ¥é˜Ÿåˆ—"><span>- ä»€ä¹ˆæ˜¯ TCP åŠè¿æ¥é˜Ÿåˆ—å’Œå…¨è¿æ¥é˜Ÿåˆ—ï¼Ÿ</span></a></h3><p>åœ¨ TCP ä¸‰æ¬¡æ¡æ‰‹çš„æ—¶å€™ï¼ŒLinux å†…æ ¸ä¼šç»´æŠ¤<strong>ä¸¤ä¸ªé˜Ÿåˆ—</strong>ï¼Œåˆ†åˆ«æ˜¯ï¼š</p><ul><li>åŠè¿æ¥é˜Ÿåˆ—ï¼Œä¹Ÿç§° SYN é˜Ÿåˆ—ï¼›</li><li>å…¨è¿æ¥é˜Ÿåˆ—ï¼Œä¹Ÿç§° accept é˜Ÿåˆ—ï¼›</li></ul><p><strong>æœåŠ¡ç«¯</strong>æ”¶åˆ°<strong>å®¢æˆ·ç«¯</strong>å‘èµ·çš„ SYN è¯·æ±‚åï¼Œ<strong>å†…æ ¸ä¼šæŠŠ<code>è¯¥è¿æ¥</code>å­˜å‚¨åˆ°<code>åŠè¿æ¥é˜Ÿåˆ—</code></strong>ï¼Œå¹¶å‘å®¢æˆ·ç«¯å“åº” SYN+ACKï¼Œæ¥ç€å®¢æˆ·ç«¯ä¼šè¿”å› ACKï¼ŒæœåŠ¡ç«¯æ”¶åˆ°ç¬¬ä¸‰æ¬¡æ¡æ‰‹çš„ ACK åï¼Œ<strong>å†…æ ¸ä¼šæŠŠ<code>è¿æ¥ä»åŠè¿æ¥é˜Ÿåˆ—ç§»é™¤</code>ï¼Œç„¶ååˆ›å»º<code>æ–°çš„å®Œå…¨çš„è¿æ¥</code>ï¼Œå¹¶å°†å…¶<code>æ·»åŠ </code>åˆ° <code>accept é˜Ÿåˆ—</code>ï¼Œç­‰å¾…è¿›ç¨‹<code>è°ƒç”¨ accept å‡½æ•°</code>æ—¶æŠŠ<code>è¿æ¥å–å‡ºæ¥</code>ã€‚</strong></p><img src="'+Se+'" alt="åŠè¿æ¥é˜Ÿåˆ—ä¸å…¨è¿æ¥é˜Ÿåˆ—" style="zoom:67%;"><p>ä¸ç®¡æ˜¯åŠè¿æ¥é˜Ÿåˆ—è¿˜æ˜¯å…¨è¿æ¥é˜Ÿåˆ—ï¼Œéƒ½æœ‰<strong>æœ€å¤§é•¿åº¦é™åˆ¶</strong>ï¼Œè¶…è¿‡é™åˆ¶æ—¶ï¼Œå†…æ ¸ä¼š<strong>ç›´æ¥ä¸¢å¼ƒ</strong>ï¼Œæˆ–è¿”å› RST åŒ…ã€‚</p><h3 id="å®æˆ˜-tcp-å…¨è¿æ¥é˜Ÿåˆ—æº¢å‡º" tabindex="-1"><a class="header-anchor" href="#å®æˆ˜-tcp-å…¨è¿æ¥é˜Ÿåˆ—æº¢å‡º"><span>- å®æˆ˜ - TCP å…¨è¿æ¥é˜Ÿåˆ—æº¢å‡º</span></a></h3><blockquote><p>å¦‚ä½•çŸ¥é“åº”ç”¨ç¨‹åºçš„ TCP å…¨è¿æ¥é˜Ÿåˆ—å¤§å°ï¼Ÿ</p></blockquote><p>åœ¨æœåŠ¡ç«¯å¯ä»¥ä½¿ç”¨ <code>ss</code> å‘½ä»¤ï¼Œæ¥æŸ¥çœ‹ TCP å…¨è¿æ¥é˜Ÿåˆ—çš„æƒ…å†µï¼š</p><p>ä½†éœ€è¦æ³¨æ„çš„æ˜¯ <code>ss</code> å‘½ä»¤è·å–çš„ <code>Recv-Q/Send-Q</code> åœ¨ã€ŒLISTEN çŠ¶æ€ã€å’Œã€Œé LISTEN çŠ¶æ€ã€æ‰€è¡¨è¾¾çš„å«ä¹‰æ˜¯ä¸åŒçš„ã€‚ä»ä¸‹é¢çš„å†…æ ¸ä»£ç å¯ä»¥çœ‹å‡ºåŒºåˆ«ï¼š</p><img src="'+Ae+'" alt="img" style="zoom:25%;"><p>åœ¨ã€ŒLISTEN çŠ¶æ€ã€æ—¶ï¼Œ<code>Recv-Q/Send-Q</code> è¡¨ç¤ºçš„å«ä¹‰å¦‚ä¸‹ï¼š</p><img src="'+Ie+'" alt="img" style="zoom:25%;"><ul><li>Recv-Qï¼šå½“å‰å…¨è¿æ¥é˜Ÿåˆ—çš„å¤§å°ï¼Œä¹Ÿå°±æ˜¯å½“å‰å·²å®Œæˆä¸‰æ¬¡æ¡æ‰‹å¹¶ç­‰å¾…æœåŠ¡ç«¯ <code>accept()</code> çš„ TCP è¿æ¥ï¼›</li><li>Send-Qï¼šå½“å‰<strong>å…¨è¿æ¥æœ€å¤§é˜Ÿåˆ—é•¿åº¦</strong>ï¼Œä¸Šé¢çš„è¾“å‡ºç»“æœè¯´æ˜ç›‘å¬ 8088 ç«¯å£çš„ TCP æœåŠ¡ï¼Œæœ€å¤§å…¨è¿æ¥é•¿åº¦ä¸º 128ï¼›</li></ul><p>åœ¨ã€Œé LISTEN çŠ¶æ€ã€æ—¶ï¼Œ<code>Recv-Q/Send-Q</code> è¡¨ç¤ºçš„å«ä¹‰å¦‚ä¸‹ï¼š</p><img src="'+xe+'" alt="img" style="zoom:25%;"><ul><li>Recv-Qï¼šå·²æ”¶åˆ°ä½†æœªè¢«åº”ç”¨è¿›ç¨‹è¯»å–çš„å­—èŠ‚æ•°ï¼›</li><li>Send-Qï¼šå·²å‘é€ä½†æœªæ”¶åˆ°ç¡®è®¤çš„å­—èŠ‚æ•°ï¼›</li></ul><blockquote><h4 id="å¦‚ä½•æ¨¡æ‹Ÿ-tcp-å…¨è¿æ¥é˜Ÿåˆ—æº¢å‡ºçš„åœºæ™¯" tabindex="-1"><a class="header-anchor" href="#å¦‚ä½•æ¨¡æ‹Ÿ-tcp-å…¨è¿æ¥é˜Ÿåˆ—æº¢å‡ºçš„åœºæ™¯"><span>å¦‚ä½•æ¨¡æ‹Ÿ TCP å…¨è¿æ¥é˜Ÿåˆ—æº¢å‡ºçš„åœºæ™¯ï¼Ÿ</span></a></h4></blockquote><img src="'+Ne+'" alt="æµ‹è¯•ç¯å¢ƒ" style="zoom:67%;"><p>å®éªŒç¯å¢ƒï¼š</p><ul><li>å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯éƒ½æ˜¯ CentOs 6.5 ï¼ŒLinux å†…æ ¸ç‰ˆæœ¬ 2.6.32</li><li>æœåŠ¡ç«¯ IP 192.168.3.200ï¼Œå®¢æˆ·ç«¯ IP 192.168.3.100</li><li>æœåŠ¡ç«¯æ˜¯ Nginx æœåŠ¡ï¼Œç«¯å£ä¸º 8088</li></ul><p>è¿™é‡Œå…ˆä»‹ç»ä¸‹ <code>wrk</code> å·¥å…·ï¼Œå®ƒæ˜¯ä¸€æ¬¾ç®€å•çš„ HTTP å‹æµ‹å·¥å…·ï¼Œå®ƒèƒ½å¤Ÿåœ¨å•æœºå¤šæ ¸ CPU çš„æ¡ä»¶ä¸‹ï¼Œä½¿ç”¨ç³»ç»Ÿè‡ªå¸¦çš„é«˜æ€§èƒ½ I/O æœºåˆ¶ï¼Œé€šè¿‡å¤šçº¿ç¨‹å’Œäº‹ä»¶æ¨¡å¼ï¼Œå¯¹ç›®æ ‡æœºå™¨äº§ç”Ÿå¤§é‡çš„è´Ÿè½½ã€‚</p><p>æœ¬æ¬¡æ¨¡æ‹Ÿå®éªŒå°±ä½¿ç”¨ <code>wrk</code> å·¥å…·æ¥å‹åŠ›æµ‹è¯•æœåŠ¡ç«¯ï¼Œå‘èµ·å¤§é‡çš„è¯·æ±‚ï¼Œä¸€èµ·çœ‹çœ‹æœåŠ¡ç«¯ TCP å…¨è¿æ¥é˜Ÿåˆ—æ»¡äº†ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿæœ‰ä»€ä¹ˆè§‚å¯ŸæŒ‡æ ‡ï¼Ÿ</p><p>å®¢æˆ·ç«¯æ‰§è¡Œ <code>wrk</code> å‘½ä»¤å¯¹æœåŠ¡ç«¯å‘èµ·<strong>å‹åŠ›æµ‹è¯•</strong>ï¼Œå¹¶å‘ <strong>3 ä¸‡ä¸ªè¿æ¥ï¼š</strong></p><img src="'+qe+'" alt="img" style="zoom:33%;"><p>åœ¨æœåŠ¡ç«¯å¯ä»¥ä½¿ç”¨ <code>ss</code> å‘½ä»¤ï¼Œæ¥æŸ¥çœ‹å½“å‰ TCP å…¨è¿æ¥é˜Ÿåˆ—çš„æƒ…å†µï¼š</p><img src="'+ye+'" alt="img" style="zoom:25%;"><p>å…¶é—´å…±æ‰§è¡Œäº†ä¸¤æ¬¡ ss å‘½ä»¤ï¼Œä»ä¸Šé¢çš„è¾“å‡ºç»“æœï¼Œå¯ä»¥å‘ç°å½“å‰ TCP å…¨è¿æ¥é˜Ÿåˆ—ä¸Šå‡åˆ°äº† 129 å¤§å°ï¼Œè¶…è¿‡äº†æœ€å¤§ TCP å…¨è¿æ¥é˜Ÿåˆ—ã€‚</p><blockquote><p><strong>å½“è¶…è¿‡äº† TCP æœ€å¤§å…¨è¿æ¥é˜Ÿåˆ—ï¼ŒæœåŠ¡ç«¯åˆ™ä¼šä¸¢æ‰åç»­è¿›æ¥çš„ TCP è¿æ¥</strong>ï¼Œä¸¢æ‰çš„ TCP è¿æ¥çš„ä¸ªæ•°ä¼šè¢«ç»Ÿè®¡èµ·æ¥ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ netstat -s å‘½ä»¤æ¥æŸ¥çœ‹ï¼š</p></blockquote><img src="'+He+'" alt="img" style="zoom:25%;"><p>ä¸Šé¢çœ‹åˆ°çš„ 41150 times ï¼Œè¡¨ç¤ºå…¨è¿æ¥é˜Ÿåˆ—æº¢å‡ºçš„æ¬¡æ•°ï¼Œæ³¨æ„è¿™ä¸ªæ˜¯ç´¯è®¡å€¼ã€‚å¯ä»¥éš”å‡ ç§’é’Ÿæ‰§è¡Œä¸‹ï¼Œå¦‚æœè¿™ä¸ªæ•°å­—ä¸€ç›´åœ¨å¢åŠ çš„è¯è‚¯å®šå…¨è¿æ¥é˜Ÿåˆ—å¶å°”æ»¡äº†ã€‚</p><p>ä»ä¸Šé¢çš„æ¨¡æ‹Ÿç»“æœï¼Œå¯ä»¥å¾—çŸ¥ï¼Œ<strong>å½“æœåŠ¡ç«¯å¹¶å‘å¤„ç†å¤§é‡è¯·æ±‚æ—¶ï¼Œå¦‚æœ TCP å…¨è¿æ¥é˜Ÿåˆ—è¿‡å°ï¼Œå°±å®¹æ˜“æº¢å‡ºã€‚å‘ç”Ÿ TCP å…¨è¿æ¥é˜Ÿæº¢å‡ºçš„æ—¶å€™ï¼Œåç»­çš„è¯·æ±‚å°±ä¼šè¢«ä¸¢å¼ƒï¼Œè¿™æ ·å°±ä¼šå‡ºç°æœåŠ¡ç«¯è¯·æ±‚æ•°é‡ä¸Šä¸å»çš„ç°è±¡ã€‚</strong></p><figure><img src="'+ve+'" alt="å…¨è¿æ¥é˜Ÿåˆ—æº¢å‡º" tabindex="0" loading="lazy"><figcaption>å…¨è¿æ¥é˜Ÿåˆ—æº¢å‡º</figcaption></figure><blockquote><p>Linux æœ‰ä¸ªå‚æ•°å¯ä»¥æŒ‡å®šå½“ TCP å…¨è¿æ¥é˜Ÿåˆ—æ»¡äº†ä¼š<strong>ä½¿ç”¨ä»€ä¹ˆç­–ç•¥</strong>æ¥<strong>å›åº”å®¢æˆ·ç«¯</strong>ã€‚</p></blockquote><p>å®é™…ä¸Šï¼Œä¸¢å¼ƒè¿æ¥åªæ˜¯ Linux çš„é»˜è®¤è¡Œä¸ºï¼Œæˆ‘ä»¬è¿˜å¯ä»¥é€‰æ‹©å‘å®¢æˆ·ç«¯å‘é€ <strong>RST å¤ä½æŠ¥æ–‡</strong>ï¼Œå‘Šè¯‰å®¢æˆ·ç«¯è¿æ¥å·²ç»å»ºç«‹å¤±è´¥ã€‚</p><img src="'+ze+'" alt="img" style="zoom:33%;"><p>tcp_abort_on_overflow å…±æœ‰ä¸¤ä¸ªå€¼åˆ†åˆ«æ˜¯ 0 å’Œ 1ï¼Œå…¶åˆ†åˆ«è¡¨ç¤ºï¼š</p><ul><li>0 ï¼šå¦‚æœå…¨è¿æ¥é˜Ÿåˆ—æ»¡äº†ï¼Œé‚£ä¹ˆ server æ‰”æ‰ client å‘è¿‡æ¥çš„ ack ï¼›</li><li>1 ï¼šå¦‚æœå…¨è¿æ¥é˜Ÿåˆ—æ»¡äº†ï¼Œserver å‘é€ä¸€ä¸ª <code>reset</code> åŒ…ç»™ clientï¼Œè¡¨ç¤ºåºŸæ‰è¿™ä¸ªæ¡æ‰‹è¿‡ç¨‹å’Œè¿™ä¸ªè¿æ¥ï¼›</li></ul><blockquote><p>å¦‚æœè¦æƒ³çŸ¥é“<strong>å®¢æˆ·ç«¯è¿æ¥ä¸ä¸ŠæœåŠ¡ç«¯</strong>ï¼Œ<strong>æ˜¯ä¸æ˜¯æœåŠ¡ç«¯ TCP å…¨è¿æ¥é˜Ÿåˆ—æ»¡</strong>çš„åŸå› ï¼Œ</p></blockquote><p>é‚£ä¹ˆå¯ä»¥æŠŠ tcp_abort_on_overflow è®¾ç½®ä¸º 1ï¼Œè¿™æ—¶å¦‚æœåœ¨å®¢æˆ·ç«¯å¼‚å¸¸ä¸­å¯ä»¥çœ‹åˆ°å¾ˆå¤š <code>connection reset by peer</code> çš„é”™è¯¯ï¼Œé‚£ä¹ˆå°±å¯ä»¥è¯æ˜æ˜¯ç”±äºæœåŠ¡ç«¯ TCP å…¨è¿æ¥é˜Ÿåˆ—æº¢å‡ºçš„é—®é¢˜ã€‚</p><p>é€šå¸¸æƒ…å†µä¸‹ï¼Œåº”å½“æŠŠ tcp_abort_on_overflow è®¾ç½®ä¸º 0ï¼Œå› ä¸ºè¿™æ ·æ›´æœ‰åˆ©äºåº”å¯¹çªå‘æµé‡ã€‚</p><p>ä¸¾ä¸ªä¾‹å­ï¼Œå½“ TCP å…¨è¿æ¥é˜Ÿåˆ—æ»¡å¯¼è‡´æœåŠ¡å™¨ä¸¢æ‰äº† ACKï¼Œä¸æ­¤åŒæ—¶ï¼Œå®¢æˆ·ç«¯çš„è¿æ¥çŠ¶æ€å´æ˜¯ ESTABLISHEDï¼Œè¿›ç¨‹å°±åœ¨å»ºç«‹å¥½çš„è¿æ¥ä¸Šå‘é€è¯·æ±‚ã€‚åªè¦æœåŠ¡å™¨æ²¡æœ‰ä¸ºè¯·æ±‚å›å¤ ACKï¼Œè¯·æ±‚å°±ä¼šè¢«å¤šæ¬¡<strong>é‡å‘</strong>ã€‚å¦‚æœæœåŠ¡å™¨ä¸Šçš„è¿›ç¨‹åªæ˜¯<strong>çŸ­æš‚çš„ç¹å¿™é€ æˆ accept é˜Ÿåˆ—æ»¡ï¼Œé‚£ä¹ˆå½“ TCP å…¨è¿æ¥é˜Ÿåˆ—æœ‰ç©ºä½æ—¶ï¼Œå†æ¬¡æ¥æ”¶åˆ°çš„è¯·æ±‚æŠ¥æ–‡ç”±äºå«æœ‰ ACKï¼Œä»ç„¶ä¼šè§¦å‘æœåŠ¡å™¨ç«¯æˆåŠŸå»ºç«‹è¿æ¥ã€‚</strong></p><p>æ‰€ä»¥ï¼Œtcp_abort_on_overflow è®¾ä¸º 0 å¯ä»¥æé«˜è¿æ¥å»ºç«‹çš„æˆåŠŸç‡ï¼Œåªæœ‰ä½ éå¸¸è‚¯å®š TCP å…¨è¿æ¥é˜Ÿåˆ—ä¼šé•¿æœŸæº¢å‡ºæ—¶ï¼Œæ‰èƒ½è®¾ç½®ä¸º 1 ä»¥å°½å¿«é€šçŸ¥å®¢æˆ·ç«¯ã€‚</p><blockquote><p>å¦‚ä½•å¢å¤§ TCP å…¨è¿æ¥é˜Ÿåˆ—å‘¢ï¼Ÿ</p></blockquote><p>æ˜¯çš„ï¼Œå½“å‘ç° TCP å…¨è¿æ¥é˜Ÿåˆ—å‘ç”Ÿæº¢å‡ºçš„æ—¶å€™ï¼Œæˆ‘ä»¬å°±éœ€è¦å¢å¤§è¯¥é˜Ÿåˆ—çš„å¤§å°ï¼Œä»¥ä¾¿å¯ä»¥åº”å¯¹å®¢æˆ·ç«¯å¤§é‡çš„è¯·æ±‚ã€‚</p><p><strong>TCP å…¨è¿æ¥é˜Ÿåˆ—çš„æœ€å¤§å€¼å–å†³äº somaxconn å’Œ backlog ä¹‹é—´çš„æœ€å°å€¼ï¼Œä¹Ÿå°±æ˜¯ min(somaxconn, backlog)</strong>ã€‚ä»ä¸‹é¢çš„ Linux å†…æ ¸ä»£ç å¯ä»¥å¾—çŸ¥ï¼š</p><img src="'+Ee+'" alt="img" style="zoom:25%;"><ul><li><code>somaxconn</code> æ˜¯ Linux å†…æ ¸çš„å‚æ•°ï¼Œé»˜è®¤å€¼æ˜¯ 128ï¼Œå¯ä»¥é€šè¿‡ <code>/proc/sys/net/core/somaxconn</code> æ¥è®¾ç½®å…¶å€¼ï¼›</li><li><code>backlog</code> æ˜¯ <code>listen(int sockfd, int backlog)</code> å‡½æ•°ä¸­çš„ backlog å¤§å°ï¼ŒNginx é»˜è®¤å€¼æ˜¯ 511ï¼Œå¯ä»¥é€šè¿‡ä¿®æ”¹é…ç½®æ–‡ä»¶è®¾ç½®å…¶é•¿åº¦ï¼›</li></ul><p>å‰é¢æ¨¡æ‹Ÿæµ‹è¯•ä¸­ï¼Œæˆ‘çš„æµ‹è¯•ç¯å¢ƒï¼š</p><ul><li>somaxconn æ˜¯é»˜è®¤å€¼ 128ï¼›</li><li>Nginx çš„ backlog æ˜¯é»˜è®¤å€¼ 511</li></ul><p>æ‰€ä»¥æµ‹è¯•ç¯å¢ƒçš„ TCP å…¨è¿æ¥é˜Ÿåˆ—æœ€å¤§å€¼ä¸º min(128, 511)ï¼Œä¹Ÿå°±æ˜¯ <code>128</code>ï¼Œå¯ä»¥æ‰§è¡Œ <code>ss</code> å‘½ä»¤æŸ¥çœ‹ï¼š</p><img src="'+we+'" alt="img" style="zoom:25%;"><p>ç°åœ¨æˆ‘ä»¬é‡æ–°å‹æµ‹ï¼ŒæŠŠ TCP å…¨è¿æ¥é˜Ÿåˆ—<strong>æå¤§</strong>ï¼ŒæŠŠ <code>somaxconn</code> è®¾ç½®æˆ 5000ï¼š</p><img src="'+Ke+'" alt="img" style="zoom:25%;"><p>æ¥ç€æŠŠ Nginx çš„ backlog ä¹ŸåŒæ ·è®¾ç½®æˆ 5000ï¼š</p><img src="'+De+'" alt="img" style="zoom:25%;"><p>æœ€åè¦é‡å¯ Nginx æœåŠ¡ï¼Œå› ä¸ºåªæœ‰é‡æ–°è°ƒç”¨ <code>listen()</code> å‡½æ•° TCP å…¨è¿æ¥é˜Ÿåˆ—æ‰ä¼šé‡æ–°åˆå§‹åŒ–ã€‚</p><p>é‡å¯å®Œå Nginx æœåŠ¡åï¼ŒæœåŠ¡ç«¯æ‰§è¡Œ ss å‘½ä»¤ï¼ŒæŸ¥çœ‹ TCP å…¨è¿æ¥é˜Ÿåˆ—å¤§å°ï¼š</p><img src="'+Me+'" alt="img" style="zoom:25%;"><p>ä»æ‰§è¡Œç»“æœï¼Œå¯ä»¥å‘ç° TCP å…¨è¿æ¥æœ€å¤§å€¼ä¸º 5000ã€‚</p><blockquote><p>å¢å¤§ TCP å…¨è¿æ¥é˜Ÿåˆ—åï¼Œç»§ç»­å‹æµ‹</p></blockquote><p>å®¢æˆ·ç«¯åŒæ ·ä»¥ 3 ä¸‡ä¸ªè¿æ¥å¹¶å‘å‘é€è¯·æ±‚ç»™æœåŠ¡ç«¯ï¼š</p><img src="'+Le+'" alt="img" style="zoom:25%;"><p>æœåŠ¡ç«¯æ‰§è¡Œ <code>ss</code> å‘½ä»¤ï¼ŒæŸ¥çœ‹ TCP å…¨è¿æ¥é˜Ÿåˆ—ä½¿ç”¨æƒ…å†µï¼š</p><img src="'+Re+'" alt="img" style="zoom:25%;"><p>ä»ä¸Šé¢çš„æ‰§è¡Œç»“æœï¼Œå¯ä»¥å‘ç°å…¨è¿æ¥é˜Ÿåˆ—ä½¿ç”¨å¢é•¿çš„å¾ˆå¿«ï¼Œä½†æ˜¯ä¸€ç›´éƒ½æ²¡æœ‰è¶…è¿‡æœ€å¤§å€¼ï¼Œæ‰€ä»¥å°±ä¸ä¼šæº¢å‡ºï¼Œé‚£ä¹ˆ <code>netstat -s</code> å°±ä¸ä¼šæœ‰ TCP å…¨è¿æ¥é˜Ÿåˆ—æº¢å‡ºä¸ªæ•°çš„æ˜¾ç¤ºï¼š</p><img src="'+Ye+'" alt="img" style="zoom:25%;"><p>è¯´æ˜ TCP å…¨è¿æ¥é˜Ÿåˆ—æœ€å¤§å€¼ä» 128 å¢å¤§åˆ° 5000 åï¼Œ<strong>æœåŠ¡ç«¯æŠ—ä½äº† 3 ä¸‡è¿æ¥å¹¶å‘è¯·æ±‚</strong>ï¼Œä¹Ÿæ²¡æœ‰å‘ç”Ÿå…¨è¿æ¥é˜Ÿåˆ—æº¢å‡ºçš„ç°è±¡äº†ã€‚</p><blockquote><p><strong>å¦‚æœæŒç»­ä¸æ–­åœ°æœ‰è¿æ¥å› ä¸º TCP å…¨è¿æ¥é˜Ÿåˆ—æº¢å‡ºè¢«ä¸¢å¼ƒï¼Œå°±åº”è¯¥è°ƒå¤§ backlog ä»¥åŠ somaxconn å‚æ•°ã€‚</strong></p></blockquote><h3 id="å®æˆ˜-tcp-åŠè¿æ¥é˜Ÿåˆ—æº¢å‡º" tabindex="-1"><a class="header-anchor" href="#å®æˆ˜-tcp-åŠè¿æ¥é˜Ÿåˆ—æº¢å‡º"><span>- å®æˆ˜ - TCP åŠè¿æ¥é˜Ÿåˆ—æº¢å‡º</span></a></h3><blockquote><p>å¦‚ä½•æŸ¥çœ‹ TCP åŠè¿æ¥é˜Ÿåˆ—é•¿åº¦ï¼Ÿ</p></blockquote><p>å¾ˆé—æ†¾ï¼ŒTCP åŠè¿æ¥é˜Ÿåˆ—é•¿åº¦çš„é•¿åº¦ï¼Œæ²¡æœ‰åƒå…¨è¿æ¥é˜Ÿåˆ—é‚£æ ·å¯ä»¥ç”¨ ss å‘½ä»¤æŸ¥çœ‹ã€‚</p><p>ä½†æ˜¯æˆ‘ä»¬å¯ä»¥æŠ“ä½ TCP åŠè¿æ¥çš„ç‰¹ç‚¹ï¼Œå°±æ˜¯æœåŠ¡ç«¯å¤„äº <code>SYN_RECV</code> çŠ¶æ€çš„ TCP è¿æ¥ï¼Œå°±æ˜¯ TCP åŠè¿æ¥é˜Ÿåˆ—ã€‚</p><p>äºæ˜¯ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤è®¡ç®—å½“å‰ TCP åŠè¿æ¥é˜Ÿåˆ—é•¿åº¦ï¼š</p><img src="'+Ue+'" alt="img" style="zoom:33%;"><blockquote><p>å¦‚ä½•æ¨¡æ‹Ÿ TCP åŠè¿æ¥é˜Ÿåˆ—æº¢å‡ºåœºæ™¯ï¼Ÿ</p></blockquote><p>æ¨¡æ‹Ÿ TCP åŠè¿æ¥æº¢å‡ºåœºæ™¯ä¸éš¾ï¼Œå®é™…ä¸Šå°±æ˜¯å¯¹æœåŠ¡ç«¯<strong>ä¸€ç›´å‘é€ TCP SYN åŒ…</strong>ï¼Œä½†æ˜¯<strong>ä¸å›ç¬¬ä¸‰æ¬¡æ¡æ‰‹ ACK</strong>ï¼Œè¿™æ ·å°±ä¼šä½¿å¾—æœåŠ¡ç«¯æœ‰å¤§é‡çš„å¤„äº <code>SYN_RECV</code> çŠ¶æ€çš„ TCP è¿æ¥ã€‚</p><p>è¿™å…¶å®ä¹Ÿå°±æ˜¯æ‰€è°“çš„ <strong>SYN æ´ªæ³›ã€SYN æ”»å‡»ã€DDos æ”»å‡»ã€‚</strong></p><img src="'+Fe+'" alt="æµ‹è¯•ç¯å¢ƒ" style="zoom:67%;"><p>å®éªŒç¯å¢ƒï¼š</p><ul><li>å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯éƒ½æ˜¯ CentOs 6.5 ï¼ŒLinux å†…æ ¸ç‰ˆæœ¬ 2.6.32</li><li>æœåŠ¡ç«¯ IP 192.168.3.200ï¼Œå®¢æˆ·ç«¯ IP 192.168.3.100</li><li>æœåŠ¡ç«¯æ˜¯ Nginx æœåŠ¡ï¼Œç«¯å£ä¸º 8088</li></ul><p>æ³¨æ„ï¼šæœ¬æ¬¡æ¨¡æ‹Ÿå®éªŒæ˜¯æ²¡æœ‰å¼€å¯ tcp_syncookiesï¼Œå…³äº tcp_syncookies çš„ä½œç”¨ï¼Œåç»­ä¼šè¯´æ˜ã€‚</p><p>æœ¬æ¬¡å®éªŒä½¿ç”¨ <code>hping3</code> å·¥å…·æ¨¡æ‹Ÿ SYN æ”»å‡»ï¼š</p><img src="'+je+'" alt="img" style="zoom:25%;"><p>å½“æœåŠ¡ç«¯å—åˆ° SYN æ”»å‡»åï¼Œè¿æ¥æœåŠ¡ç«¯ ssh å°±ä¼šæ–­å¼€äº†ï¼Œæ— æ³•å†è¿ä¸Šã€‚åªèƒ½åœ¨æœåŠ¡ç«¯ä¸»æœºä¸Šæ‰§è¡ŒæŸ¥çœ‹å½“å‰ TCP åŠè¿æ¥é˜Ÿåˆ—å¤§å°ï¼š</p><img src="'+We+'" alt="img" style="zoom:25%;"><p>åŒæ—¶ï¼Œè¿˜å¯ä»¥é€šè¿‡ netstat -s è§‚å¯ŸåŠè¿æ¥é˜Ÿåˆ—æº¢å‡ºçš„æƒ…å†µï¼š</p><img src="'+Be+'" alt="img" style="zoom:25%;"><p>ä¸Šé¢è¾“å‡ºçš„æ•°å€¼æ˜¯<strong>ç´¯è®¡å€¼</strong>ï¼Œè¡¨ç¤ºå…±æœ‰å¤šå°‘ä¸ª TCP è¿æ¥å› ä¸ºåŠè¿æ¥é˜Ÿåˆ—æº¢å‡ºè€Œè¢«ä¸¢å¼ƒã€‚<strong>éš”å‡ ç§’æ‰§è¡Œå‡ æ¬¡ï¼Œå¦‚æœæœ‰ä¸Šå‡çš„è¶‹åŠ¿ï¼Œè¯´æ˜å½“å‰å­˜åœ¨åŠè¿æ¥é˜Ÿåˆ—æº¢å‡ºçš„ç°è±¡</strong>ã€‚</p><blockquote><p>å¤§éƒ¨åˆ†äººéƒ½è¯´ tcp_max_syn_backlog æ˜¯æŒ‡å®šåŠè¿æ¥é˜Ÿåˆ—çš„å¤§å°ï¼Œæ˜¯çœŸçš„å—ï¼Ÿ</p></blockquote><p>å¾ˆé—æ†¾ï¼ŒåŠè¿æ¥é˜Ÿåˆ—çš„å¤§å°å¹¶ä¸å•å•åªè·Ÿ <code>tcp_max_syn_backlog</code> æœ‰å…³ç³»ã€‚</p><p>ä¸Šé¢æ¨¡æ‹Ÿ SYN æ”»å‡»åœºæ™¯æ—¶ï¼ŒæœåŠ¡ç«¯çš„ tcp_max_syn_backlog çš„é»˜è®¤å€¼å¦‚ä¸‹ï¼š</p><img src="'+Oe+'" alt="img" style="zoom:25%;"><p>ä½†æ˜¯åœ¨æµ‹è¯•çš„æ—¶å€™å‘ç°ï¼ŒæœåŠ¡ç«¯æœ€å¤šåªæœ‰ 256 ä¸ªåŠè¿æ¥é˜Ÿåˆ—ï¼Œè€Œä¸æ˜¯ 512ï¼Œæ‰€ä»¥<strong>åŠè¿æ¥é˜Ÿåˆ—çš„æœ€å¤§é•¿åº¦ä¸ä¸€å®šç”± tcp_max_syn_backlog å€¼å†³å®šçš„</strong>ã€‚</p><blockquote><p>æ¥ä¸‹æ¥ï¼Œèµ°è¿› Linux å†…æ ¸çš„æºç ï¼Œæ¥åˆ†æ TCP åŠè¿æ¥é˜Ÿåˆ—çš„æœ€å¤§å€¼æ˜¯å¦‚ä½•å†³å®šçš„ã€‚</p></blockquote><p>TCP ç¬¬ä¸€æ¬¡æ¡æ‰‹ï¼ˆæ”¶åˆ° SYN åŒ…ï¼‰çš„ Linux å†…æ ¸ä»£ç å¦‚ä¸‹ï¼Œå…¶ä¸­ç¼©å‡äº†å¤§é‡çš„ä»£ç ï¼Œåªéœ€è¦é‡ç‚¹å…³æ³¨ TCP åŠè¿æ¥é˜Ÿåˆ—æº¢å‡ºçš„å¤„ç†é€»è¾‘ï¼š</p><img src="'+Qe+'" alt="img" style="zoom:25%;"><p>ä»æºç ä¸­ï¼Œæˆ‘å¯ä»¥å¾—å‡ºå…±æœ‰ä¸‰ä¸ªæ¡ä»¶å› é˜Ÿåˆ—é•¿åº¦çš„å…³ç³»è€Œè¢«ä¸¢å¼ƒçš„ï¼š</p><img src="'+Ge+'" alt="img" style="zoom:50%;"><ol><li><strong>å¦‚æœåŠè¿æ¥é˜Ÿåˆ—æ»¡äº†ï¼Œå¹¶ä¸”æ²¡æœ‰å¼€å¯ tcp_syncookiesï¼Œåˆ™ä¼šä¸¢å¼ƒï¼›</strong></li><li><strong>è‹¥å…¨è¿æ¥é˜Ÿåˆ—æ»¡äº†ï¼Œä¸”æ²¡æœ‰é‡ä¼  SYN+ACK åŒ…çš„è¿æ¥è¯·æ±‚å¤šäº 1 ä¸ªï¼Œåˆ™ä¼šä¸¢å¼ƒï¼›</strong></li><li><strong>å¦‚æœæ²¡æœ‰å¼€å¯ tcp_syncookiesï¼Œå¹¶ä¸” max_syn_backlog å‡å» å½“å‰åŠè¿æ¥é˜Ÿåˆ—é•¿åº¦å°äº (max_syn_backlog &gt;&gt; 2)ï¼Œåˆ™ä¼šä¸¢å¼ƒï¼›</strong></li></ol><p>å…³äº tcp_syncookies çš„è®¾ç½®ï¼Œåé¢åœ¨è¯¦ç»†è¯´æ˜ï¼Œå¯ä»¥å…ˆç»™å¤§å®¶è¯´ä¸€ä¸‹ï¼Œå¼€å¯ tcp_syncookies æ˜¯ç¼“è§£ SYN æ”»å‡»å…¶ä¸­ä¸€ä¸ªæ‰‹æ®µã€‚</p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ç»§ç»­è·Ÿä¸€ä¸‹æ£€æµ‹åŠè¿æ¥é˜Ÿåˆ—æ˜¯å¦æ»¡çš„å‡½æ•° inet_csk_reqsk_queue_is_full å’Œ æ£€æµ‹å…¨è¿æ¥é˜Ÿåˆ—æ˜¯å¦æ»¡çš„å‡½æ•° sk_acceptq_is_full ï¼š</p><img src="'+Ve+'" alt="img" style="zoom:25%;"><p>ä»ä¸Šé¢æºç ï¼Œå¯ä»¥å¾—çŸ¥ï¼š</p><ul><li><strong>å…¨</strong>è¿æ¥é˜Ÿåˆ—çš„æœ€å¤§å€¼æ˜¯ <code>sk_max_ack_backlog</code> å˜é‡ï¼Œsk_max_ack_backlog å®é™…ä¸Šæ˜¯åœ¨ listen() æºç é‡ŒæŒ‡å®šçš„ï¼Œä¹Ÿå°±æ˜¯ <strong>min(somaxconn, backlog)</strong>ï¼›</li><li><strong>åŠ</strong>è¿æ¥é˜Ÿåˆ—çš„æœ€å¤§å€¼æ˜¯ <code>max_qlen_log</code> å˜é‡ï¼Œmax_qlen_log æ˜¯åœ¨å“ªæŒ‡å®šçš„å‘¢ï¼Ÿç°åœ¨æš‚æ—¶è¿˜ä¸çŸ¥é“ï¼Œæˆ‘ä»¬ç»§ç»­è·Ÿè¿›ï¼›</li></ul><p>æˆ‘ä»¬ç»§ç»­è·Ÿè¿›ä»£ç ï¼Œçœ‹ä¸€ä¸‹æ˜¯å“ªé‡Œåˆå§‹åŒ–äº†åŠè¿æ¥é˜Ÿåˆ—çš„æœ€å¤§å€¼ max_qlen_logï¼š</p><img src="'+Xe+'" alt="img" style="zoom:25%;"><p>ä»ä¸Šé¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ç®—å‡º max_qlen_log æ˜¯ 8ï¼Œäºæ˜¯ä»£å…¥åˆ° æ£€æµ‹åŠè¿æ¥é˜Ÿåˆ—æ˜¯å¦æ»¡çš„å‡½æ•° reqsk_queue_is_full ï¼š</p><img src="'+Ze+'" alt="img" style="zoom:25%;"><p>ä¹Ÿå°±æ˜¯ <code>qlen &gt;&gt; 8</code> ä»€ä¹ˆæ—¶å€™ä¸º 1 å°±ä»£è¡¨åŠè¿æ¥é˜Ÿåˆ—æ»¡äº†ã€‚è¿™è®¡ç®—è¿™ä¸éš¾ï¼Œå¾ˆæ˜æ˜¾æ˜¯å½“ qlen ä¸º 256 æ—¶ï¼Œ<code>256 &gt;&gt; 8 = 1</code>ã€‚</p><p>è‡³æ­¤ï¼Œæ€»ç®—çŸ¥é“ä¸ºä»€ä¹ˆä¸Šé¢æ¨¡æ‹Ÿæµ‹è¯• SYN æ”»å‡»çš„æ—¶å€™ï¼ŒæœåŠ¡ç«¯å¤„äº <code>SYN_RECV</code> è¿æ¥æœ€å¤§åªæœ‰ 256 ä¸ªã€‚</p><p>å¯è§ï¼Œ<strong>åŠè¿æ¥é˜Ÿåˆ—æœ€å¤§å€¼ä¸æ˜¯å•å•ç”± max_syn_backlog å†³å®šï¼Œè¿˜è·Ÿ somaxconn å’Œ backlog æœ‰å…³ç³»ã€‚</strong></p><p>åœ¨ Linux 2.6.32 å†…æ ¸ç‰ˆæœ¬ï¼Œå®ƒä»¬ä¹‹é—´çš„å…³ç³»ï¼Œæ€»ä½“å¯ä»¥æ¦‚å†µä¸ºï¼š</p><img src="'+Je+'" alt="img" style="zoom:50%;"><ul><li>å½“ max_syn_backlog &gt; min(somaxconn, backlog) æ—¶ï¼Œ åŠè¿æ¥é˜Ÿåˆ—æœ€å¤§å€¼ max_qlen_log = min(somaxconn, backlog) * 2;</li><li>å½“ max_syn_backlog &lt; min(somaxconn, backlog) æ—¶ï¼Œ åŠè¿æ¥é˜Ÿåˆ—æœ€å¤§å€¼ max_qlen_log = max_syn_backlog * 2;</li></ul><blockquote><p>åŠè¿æ¥é˜Ÿåˆ—æœ€å¤§å€¼ max_qlen_log å°±è¡¨ç¤ºæœåŠ¡ç«¯å¤„äº SYN_RECV çŠ¶æ€çš„æœ€å¤§ä¸ªæ•°å—ï¼Ÿ</p></blockquote><p>ä¾ç„¶å¾ˆé—æ†¾ï¼Œå¹¶ä¸æ˜¯ã€‚</p><p>max_qlen_log æ˜¯<strong>ç†è®º</strong>åŠè¿æ¥é˜Ÿåˆ—æœ€å¤§å€¼ï¼Œå¹¶ä¸ä¸€å®šä»£è¡¨æœåŠ¡ç«¯å¤„äº SYN_RECV çŠ¶æ€çš„æœ€å¤§ä¸ªæ•°ã€‚</p><p>åœ¨å‰é¢æˆ‘ä»¬åœ¨åˆ†æ TCP ç¬¬ä¸€æ¬¡æ¡æ‰‹ï¼ˆæ”¶åˆ° SYN åŒ…ï¼‰æ—¶ä¼šè¢«ä¸¢å¼ƒçš„ä¸‰ç§æ¡ä»¶ï¼š</p><ol><li>å¦‚æœåŠè¿æ¥é˜Ÿåˆ—æ»¡äº†ï¼Œå¹¶ä¸”æ²¡æœ‰å¼€å¯ tcp_syncookiesï¼Œåˆ™ä¼šä¸¢å¼ƒï¼›</li><li>è‹¥å…¨è¿æ¥é˜Ÿåˆ—æ»¡äº†ï¼Œä¸”æ²¡æœ‰é‡ä¼  SYN+ACK åŒ…çš„è¿æ¥è¯·æ±‚å¤šäº 1 ä¸ªï¼Œåˆ™ä¼šä¸¢å¼ƒï¼›</li><li><strong>å¦‚æœæ²¡æœ‰å¼€å¯ tcp_syncookiesï¼Œå¹¶ä¸” max_syn_backlog å‡å» å½“å‰åŠè¿æ¥é˜Ÿåˆ—é•¿åº¦å°äº (max_syn_backlog &gt;&gt; 2)ï¼Œåˆ™ä¼šä¸¢å¼ƒï¼›</strong></li></ol><p>å‡è®¾æ¡ä»¶ 1 å½“å‰åŠè¿æ¥é˜Ÿåˆ—çš„é•¿åº¦ ã€Œæ²¡æœ‰è¶…è¿‡ã€ç†è®ºçš„åŠè¿æ¥é˜Ÿåˆ—æœ€å¤§å€¼ max_qlen_logï¼Œé‚£ä¹ˆå¦‚æœæ¡ä»¶ 3 æˆç«‹ï¼Œåˆ™ä¾ç„¶ä¼šä¸¢å¼ƒ SYN åŒ…ï¼Œä¹Ÿå°±ä¼šä½¿å¾—æœåŠ¡ç«¯å¤„äº SYN_RECV çŠ¶æ€çš„æœ€å¤§ä¸ªæ•°ä¸ä¼šæ˜¯ç†è®ºå€¼ max_qlen_logã€‚</p><p>ä¼¼ä¹å¾ˆéš¾ç†è§£ï¼Œæˆ‘ä»¬ç»§ç»­æ¥ç€åšå®éªŒï¼Œå®éªŒè§çœŸçŸ¥ã€‚</p><p>æœåŠ¡ç«¯ç¯å¢ƒå¦‚ä¸‹ï¼š</p><img src="'+$e+'" alt="img" style="zoom:25%;"><p>é…ç½®å®Œåï¼ŒæœåŠ¡ç«¯è¦é‡å¯ Nginxï¼Œå› ä¸ºå…¨è¿æ¥é˜Ÿåˆ—æœ€å¤§å€¼å’ŒåŠè¿æ¥é˜Ÿåˆ—æœ€å¤§å€¼æ˜¯åœ¨ listen() å‡½æ•°åˆå§‹åŒ–ã€‚</p><p>æ ¹æ®å‰é¢çš„æºç åˆ†æï¼Œæˆ‘ä»¬å¯ä»¥è®¡ç®—å‡ºåŠè¿æ¥é˜Ÿåˆ— max_qlen_log çš„æœ€å¤§å€¼ä¸º 256ï¼š</p><img src="'+on+'" alt="img" style="zoom:50%;"><p>å®¢æˆ·ç«¯æ‰§è¡Œ hping3 å‘èµ· SYN æ”»å‡»ï¼š</p><img src="'+tn+'" alt="img" style="zoom:25%;"><p>æœåŠ¡ç«¯æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼ŒæŸ¥çœ‹å¤„äº SYN_RECV çŠ¶æ€çš„æœ€å¤§ä¸ªæ•°ï¼š</p><img src="'+sn+'" alt="img" style="zoom:25%;"><p>å¯ä»¥å‘ç°ï¼ŒæœåŠ¡ç«¯å¤„äº SYN_RECV çŠ¶æ€çš„æœ€å¤§ä¸ªæ•°å¹¶ä¸æ˜¯ max_qlen_log å˜é‡çš„å€¼ã€‚</p><p>è¿™å°±æ˜¯å‰é¢æ‰€è¯´çš„åŸå› ï¼š<strong>å¦‚æœå½“å‰åŠè¿æ¥é˜Ÿåˆ—çš„é•¿åº¦ ã€Œæ²¡æœ‰è¶…è¿‡ã€ç†è®ºåŠè¿æ¥é˜Ÿåˆ—æœ€å¤§å€¼ max_qlen_logï¼Œé‚£ä¹ˆå¦‚æœæ¡ä»¶ 3 æˆç«‹ï¼Œåˆ™ä¾ç„¶ä¼šä¸¢å¼ƒ SYN åŒ…ï¼Œä¹Ÿå°±ä¼šä½¿å¾—æœåŠ¡ç«¯å¤„äº SYN_RECV çŠ¶æ€çš„æœ€å¤§ä¸ªæ•°ä¸ä¼šæ˜¯ç†è®ºå€¼ max_qlen_logã€‚</strong></p><p>æˆ‘ä»¬æ¥åˆ†æä¸€æ³¢æ¡ä»¶ 3 :</p><img src="'+en+'" alt="img" style="zoom:50%;"><p>ä»ä¸Šé¢çš„åˆ†æï¼Œå¯ä»¥å¾—çŸ¥å¦‚æœè§¦å‘ã€Œå½“å‰åŠè¿æ¥é˜Ÿåˆ—é•¿åº¦ &gt; 192ã€æ¡ä»¶ï¼ŒTCP ç¬¬ä¸€æ¬¡æ¡æ‰‹çš„ SYN åŒ…æ˜¯ä¼šè¢«ä¸¢å¼ƒçš„ã€‚</p><p>åœ¨å‰é¢æˆ‘ä»¬æµ‹è¯•çš„ç»“æœï¼ŒæœåŠ¡ç«¯å¤„äº SYN_RECV çŠ¶æ€çš„æœ€å¤§ä¸ªæ•°æ˜¯ 193ï¼Œæ­£å¥½æ˜¯è§¦å‘äº†æ¡ä»¶ 3ï¼Œæ‰€ä»¥å¤„äº SYN_RECV çŠ¶æ€çš„ä¸ªæ•°è¿˜æ²¡åˆ°ã€Œç†è®ºåŠè¿æ¥é˜Ÿåˆ—æœ€å¤§å€¼ 256ã€ï¼Œå°±å·²ç»æŠŠ SYN åŒ…ä¸¢å¼ƒäº†ã€‚</p><p>æ‰€ä»¥ï¼ŒæœåŠ¡ç«¯å¤„äº SYN_RECV çŠ¶æ€çš„æœ€å¤§ä¸ªæ•°åˆ†ä¸ºå¦‚ä¸‹ä¸¤ç§æƒ…å†µï¼š</p><ul><li>å¦‚æœã€Œå½“å‰åŠè¿æ¥é˜Ÿåˆ—ã€<strong>æ²¡è¶…è¿‡</strong>ã€Œç†è®ºåŠè¿æ¥é˜Ÿåˆ—æœ€å¤§å€¼ã€ï¼Œä½†æ˜¯<strong>è¶…è¿‡</strong> max_syn_backlog - (max_syn_backlog &gt;&gt; 2)ï¼Œé‚£ä¹ˆå¤„äº SYN_RECV çŠ¶æ€çš„æœ€å¤§ä¸ªæ•°å°±æ˜¯ max_syn_backlog - (max_syn_backlog &gt;&gt; 2)ï¼›</li><li>å¦‚æœã€Œå½“å‰åŠè¿æ¥é˜Ÿåˆ—ã€<strong>è¶…è¿‡</strong>ã€Œç†è®ºåŠè¿æ¥é˜Ÿåˆ—æœ€å¤§å€¼ã€ï¼Œé‚£ä¹ˆå¤„äº SYN_RECV çŠ¶æ€çš„æœ€å¤§ä¸ªæ•°å°±æ˜¯ã€Œç†è®ºåŠè¿æ¥é˜Ÿåˆ—æœ€å¤§å€¼ã€ï¼›</li></ul><blockquote><p>æ¯ä¸ª Linux å†…æ ¸ç‰ˆæœ¬ã€Œç†è®ºã€åŠè¿æ¥æœ€å¤§å€¼è®¡ç®—æ–¹å¼ä¼šä¸åŒã€‚</p></blockquote><p>åœ¨ä¸Šé¢æˆ‘ä»¬æ˜¯é’ˆå¯¹ Linux 2.6.32 ç‰ˆæœ¬åˆ†æçš„ã€Œç†è®ºã€åŠè¿æ¥æœ€å¤§å€¼çš„ç®—æ³•ï¼Œå¯èƒ½æ¯ä¸ªç‰ˆæœ¬æœ‰äº›ä¸åŒã€‚</p><p>æ¯”å¦‚åœ¨ Linux 5.0.0 çš„æ—¶å€™ï¼Œã€Œç†è®ºã€åŠè¿æ¥æœ€å¤§å€¼å°±æ˜¯å…¨è¿æ¥é˜Ÿåˆ—æœ€å¤§å€¼ï¼Œä½†ä¾ç„¶è¿˜æ˜¯æœ‰é˜Ÿåˆ—æº¢å‡ºçš„ä¸‰ä¸ªæ¡ä»¶ï¼š</p><img src="'+nn+'" alt="img" style="zoom:25%;"><blockquote><p>å¦‚æœ SYN <strong>åŠè¿æ¥é˜Ÿåˆ—å·²æ»¡</strong>ï¼Œåªèƒ½ä¸¢å¼ƒè¿æ¥å—ï¼Ÿ</p></blockquote><p>å¹¶ä¸æ˜¯è¿™æ ·ï¼Œ<strong>å¼€å¯ syncookies åŠŸèƒ½å°±å¯ä»¥åœ¨ä¸ä½¿ç”¨ SYN åŠè¿æ¥é˜Ÿåˆ—çš„æƒ…å†µä¸‹æˆåŠŸå»ºç«‹è¿æ¥</strong>ï¼Œåœ¨å‰é¢æˆ‘ä»¬æºç åˆ†æä¹Ÿå¯ä»¥çœ‹åˆ°è¿™ç‚¹ï¼Œå½“å¼€å¯äº† syncookies åŠŸèƒ½å°±ä¸ä¼šä¸¢å¼ƒè¿æ¥ã€‚</p><p>syncookies æ˜¯è¿™ä¹ˆåšçš„ï¼šæœåŠ¡å™¨æ ¹æ®å½“å‰çŠ¶æ€è®¡ç®—å‡ºä¸€ä¸ªå€¼ï¼Œæ”¾åœ¨å·±æ–¹å‘å‡ºçš„ SYN+ACK æŠ¥æ–‡ä¸­å‘å‡ºï¼Œå½“å®¢æˆ·ç«¯è¿”å› ACK æŠ¥æ–‡æ—¶ï¼Œå–å‡ºè¯¥å€¼éªŒè¯ï¼Œå¦‚æœåˆæ³•ï¼Œå°±è®¤ä¸ºè¿æ¥å»ºç«‹æˆåŠŸï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚</p><img src="'+pn+'" alt="å¼€å¯ syncookies åŠŸèƒ½" style="zoom:67%;"><p>syncookies å‚æ•°ä¸»è¦æœ‰ä»¥ä¸‹ä¸‰ä¸ªå€¼ï¼š</p><ul><li>0 å€¼ï¼Œè¡¨ç¤ºå…³é—­è¯¥åŠŸèƒ½ï¼›</li><li>1 å€¼ï¼Œè¡¨ç¤ºä»…å½“ SYN åŠè¿æ¥é˜Ÿåˆ—æ”¾ä¸ä¸‹æ—¶ï¼Œå†å¯ç”¨å®ƒï¼›</li><li>2 å€¼ï¼Œè¡¨ç¤ºæ— æ¡ä»¶å¼€å¯åŠŸèƒ½ï¼›</li></ul><p>é‚£ä¹ˆåœ¨åº”å¯¹ SYN æ”»å‡»æ—¶ï¼Œåªéœ€è¦è®¾ç½®ä¸º 1 å³å¯ï¼š</p><img src="'+rn+'" alt="img" style="zoom:25%;"><blockquote><p>å¦‚ä½•é˜²å¾¡ SYN æ”»å‡»ï¼Ÿ</p></blockquote><p>è¿™é‡Œç»™å‡ºå‡ ç§é˜²å¾¡ SYN æ”»å‡»çš„æ–¹æ³•ï¼š</p><ul><li>å¢å¤§åŠè¿æ¥é˜Ÿåˆ—ï¼›</li><li>å¼€å¯ tcp_syncookies åŠŸèƒ½</li><li>å‡å°‘ SYN+ACK é‡ä¼ æ¬¡æ•°</li></ul><p><em>æ–¹å¼ä¸€ï¼šå¢å¤§åŠè¿æ¥é˜Ÿåˆ—</em></p><p>åœ¨å‰é¢æºç å’Œå®éªŒä¸­ï¼Œå¾—çŸ¥<strong>è¦æƒ³å¢å¤§åŠè¿æ¥é˜Ÿåˆ—ï¼Œæˆ‘ä»¬å¾—çŸ¥ä¸èƒ½åªå•çº¯å¢å¤§ tcp_max_syn_backlog çš„å€¼ï¼Œè¿˜éœ€ä¸€åŒå¢å¤§ somaxconn å’Œ backlogï¼Œä¹Ÿå°±æ˜¯å¢å¤§å…¨è¿æ¥é˜Ÿåˆ—</strong>ã€‚å¦åˆ™ï¼Œåªå•çº¯å¢å¤§ tcp_max_syn_backlog æ˜¯æ— æ•ˆçš„ã€‚</p><p>å¢å¤§ tcp_max_syn_backlog å’Œ somaxconn çš„æ–¹æ³•æ˜¯ä¿®æ”¹ Linux å†…æ ¸å‚æ•°ï¼š</p><img src="'+gn+'" alt="img" style="zoom:25%;"><p>å¢å¤§ backlog çš„æ–¹å¼ï¼Œæ¯ä¸ª Web æœåŠ¡éƒ½ä¸åŒï¼Œæ¯”å¦‚ Nginx å¢å¤§ backlog çš„æ–¹æ³•å¦‚ä¸‹ï¼š</p><img src="'+an+'" alt="img" style="zoom:25%;"><p>æœ€åï¼Œæ”¹å˜äº†å¦‚ä¸Šè¿™äº›å‚æ•°åï¼Œè¦é‡å¯ Nginx æœåŠ¡ï¼Œå› ä¸ºåŠè¿æ¥é˜Ÿåˆ—å’Œå…¨è¿æ¥é˜Ÿåˆ—éƒ½æ˜¯åœ¨ listen() åˆå§‹åŒ–çš„ã€‚</p><p><em>æ–¹å¼äºŒï¼šå¼€å¯ tcp_syncookies åŠŸèƒ½</em></p><p>å¼€å¯ tcp_syncookies åŠŸèƒ½çš„æ–¹å¼ä¹Ÿå¾ˆç®€å•ï¼Œä¿®æ”¹ Linux å†…æ ¸å‚æ•°ï¼š</p><img src="'+ln+'" alt="img" style="zoom:25%;"><p><em>æ–¹å¼ä¸‰ï¼šå‡å°‘ SYN+ACK é‡ä¼ æ¬¡æ•°</em></p><p>å½“æœåŠ¡ç«¯å—åˆ° SYN æ”»å‡»æ—¶ï¼Œå°±ä¼šæœ‰å¤§é‡å¤„äº SYN_RECV çŠ¶æ€çš„ TCP è¿æ¥ï¼Œå¤„äºè¿™ä¸ªçŠ¶æ€çš„ TCP ä¼šé‡ä¼  SYN+ACK ï¼Œå½“é‡ä¼ è¶…è¿‡æ¬¡æ•°è¾¾åˆ°ä¸Šé™åï¼Œå°±ä¼šæ–­å¼€è¿æ¥ã€‚</p><p>é‚£ä¹ˆé’ˆå¯¹ SYN æ”»å‡»çš„åœºæ™¯ï¼Œæˆ‘ä»¬å¯ä»¥å‡å°‘ SYN+ACK çš„é‡ä¼ æ¬¡æ•°ï¼Œä»¥åŠ å¿«å¤„äº SYN_RECV çŠ¶æ€çš„ TCP è¿æ¥æ–­å¼€ã€‚</p><img src="'+cn+'" alt="img" style="zoom:25%;"><p>æœ¬æ–‡æ˜¯ä»¥ Linux 2.6.32 ç‰ˆæœ¬çš„å†…æ ¸ç”¨å®éªŒ + æºç çš„æ–¹å¼ï¼Œç»™å¤§å®¶è¯´æ˜äº† TCP åŠè¿æ¥é˜Ÿåˆ—å’Œå…¨è¿æ¥é˜Ÿåˆ—ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ° TCP åŠè¿æ¥é˜Ÿåˆ—ã€Œå¹¶ä¸æ˜¯ã€å¦‚ç½‘ä¸Šè¯´çš„é‚£æ · tcp_max_syn_backlog è¡¨ç¤ºåŠè¿æ¥é˜Ÿåˆ—ã€‚</p><p>TCP åŠè¿æ¥é˜Ÿåˆ—çš„å¤§å°å¯¹äºä¸åŒçš„ Linux å†…æ ¸ç‰ˆæœ¬ä¼šæœ‰ä¸åŒçš„è®¡ç®—æ–¹å¼ï¼Œæ‰€ä»¥å¹¶ä¸è¦æ±‚å¤§å®¶è¦æ­»è®°ä½æœ¬æ–‡è®¡ç®— TCP åŠè¿æ¥é˜Ÿåˆ—çš„å¤§å°ã€‚</p><h2 id="-7" tabindex="-1"><a class="header-anchor" href="#-7"><span>--------------</span></a></h2><h2 id="_4-5-å¦‚ä½•ä¼˜åŒ–-tcp" tabindex="-1"><a class="header-anchor" href="#_4-5-å¦‚ä½•ä¼˜åŒ–-tcp"><span>4.5 å¦‚ä½•ä¼˜åŒ– TCP?</span></a></h2><p>TCP æ€§èƒ½çš„æå‡ä¸ä»…è€ƒå¯Ÿ TCP çš„ç†è®ºçŸ¥è¯†ï¼Œè¿˜è€ƒå¯Ÿäº†å¯¹äºæ“ä½œç³»ç»Ÿæä¾›çš„å†…æ ¸å‚æ•°çš„ç†è§£ä¸åº”ç”¨ã€‚</p><p>TCP åè®®æ˜¯ç”±æ“ä½œç³»ç»Ÿå®ç°ï¼Œæ‰€ä»¥æ“ä½œç³»ç»Ÿæä¾›äº†ä¸å°‘<strong>è°ƒèŠ‚ TCP çš„å‚æ•°</strong>ã€‚</p><img src="'+dn+'" alt="Linux TCP å‚æ•°" style="zoom:67%;"><p>å¦‚ä½•æ­£ç¡®æœ‰æ•ˆçš„ä½¿ç”¨è¿™äº›å‚æ•°ï¼Œæ¥æé«˜ TCP æ€§èƒ½æ˜¯ä¸€ä¸ªä¸é‚£ä¹ˆç®€å•äº‹æƒ…ã€‚æˆ‘ä»¬éœ€è¦<strong>é’ˆå¯¹ TCP æ¯ä¸ªé˜¶æ®µçš„é—®é¢˜</strong>æ¥å¯¹ç—‡ä¸‹è¯ï¼Œè€Œä¸æ˜¯ç—…æ€¥ä¹±æŠ•åŒ»ã€‚</p><p>æ¥ä¸‹æ¥ï¼Œå°†ä»¥ä¸‰ä¸ªè§’åº¦æ¥é˜è¿°æå‡ TCP çš„ç­–ç•¥ï¼Œåˆ†åˆ«æ˜¯ï¼š</p><ul><li>TCP <strong>ä¸‰æ¬¡æ¡æ‰‹çš„æ€§èƒ½æå‡ï¼›</strong></li><li>TCP <strong>å››æ¬¡æŒ¥æ‰‹çš„æ€§èƒ½æå‡ï¼›</strong></li><li>TCP <strong>æ•°æ®ä¼ è¾“çš„æ€§èƒ½æå‡ï¼›</strong></li></ul><img src="'+mn+'" alt="æœ¬èŠ‚æçº²" style="zoom:67%;"><h3 id="tcp-ä¸‰æ¬¡æ¡æ‰‹çš„æ€§èƒ½æå‡" tabindex="-1"><a class="header-anchor" href="#tcp-ä¸‰æ¬¡æ¡æ‰‹çš„æ€§èƒ½æå‡"><span>- TCP ä¸‰æ¬¡æ¡æ‰‹çš„æ€§èƒ½æå‡</span></a></h3><p>TCP æ˜¯<strong>é¢å‘è¿æ¥çš„ã€å¯é çš„ã€åŒå‘ä¼ è¾“</strong>çš„ä¼ è¾“å±‚é€šä¿¡åè®®ï¼Œæ‰€ä»¥åœ¨ä¼ è¾“æ•°æ®ä¹‹å‰éœ€è¦ç»è¿‡ä¸‰æ¬¡æ¡æ‰‹æ‰èƒ½å»ºç«‹è¿æ¥ã€‚</p><img src="'+Tn+'" alt="ä¸‰æ¬¡æ¡æ‰‹ä¸æ•°æ®ä¼ è¾“" style="zoom:67%;"><p>é‚£ä¹ˆï¼Œ<strong>ä¸‰æ¬¡æ¡æ‰‹çš„è¿‡ç¨‹åœ¨ä¸€ä¸ª HTTP è¯·æ±‚çš„å¹³å‡æ—¶é—´å æ¯” 10% ä»¥ä¸Š</strong>ï¼Œåœ¨ç½‘ç»œçŠ¶æ€ä¸ä½³ã€é«˜å¹¶å‘æˆ–è€…é­é‡ SYN æ”»å‡»ç­‰åœºæ™¯ä¸­ï¼Œå¦‚æœä¸èƒ½æœ‰æ•ˆæ­£ç¡®çš„è°ƒèŠ‚ä¸‰æ¬¡æ¡æ‰‹ä¸­çš„å‚æ•°ï¼Œå°±ä¼š<strong>å¯¹æ€§èƒ½äº§ç”Ÿå¾ˆå¤šçš„å½±å“</strong>ã€‚</p><p>å¦‚ä½•æ­£ç¡®æœ‰æ•ˆçš„ä½¿ç”¨è¿™äº›å‚æ•°ï¼Œæ¥æé«˜ TCP ä¸‰æ¬¡æ¡æ‰‹çš„æ€§èƒ½ï¼Œè¿™å°±éœ€è¦ç†è§£**ã€Œä¸‰æ¬¡æ¡æ‰‹çš„çŠ¶æ€å˜è¿ã€**ï¼Œè¿™æ ·å½“å‡ºç°é—®é¢˜æ—¶ï¼Œå…ˆç”¨ <code>netstat</code> å‘½ä»¤æŸ¥çœ‹æ˜¯å“ªä¸ªæ¡æ‰‹é˜¶æ®µå‡ºç°äº†é—®é¢˜ï¼Œå†æ¥å¯¹ç—‡ä¸‹è¯ï¼Œè€Œä¸æ˜¯ç—…æ€¥ä¹±æŠ•åŒ»ã€‚</p><img src="'+hn+'" alt="TCP ä¸‰æ¬¡æ¡æ‰‹çš„çŠ¶æ€å˜è¿" style="zoom:67%;"><p>å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯<strong>éƒ½å¯ä»¥é’ˆå¯¹ä¸‰æ¬¡æ¡æ‰‹ä¼˜åŒ–æ€§èƒ½</strong>ã€‚ä¸»åŠ¨å‘èµ·è¿æ¥çš„å®¢æˆ·ç«¯ä¼˜åŒ–ç›¸å¯¹ç®€å•äº›ï¼Œè€ŒæœåŠ¡ç«¯éœ€è¦ç›‘å¬ç«¯å£ï¼Œå±äºè¢«åŠ¨è¿æ¥æ–¹ï¼Œå…¶é—´ä¿æŒè®¸å¤šçš„ä¸­é—´çŠ¶æ€ï¼Œä¼˜åŒ–æ–¹æ³•ç›¸å¯¹å¤æ‚ä¸€äº›ã€‚</p><p>æ‰€ä»¥ï¼Œå®¢æˆ·ç«¯ï¼ˆä¸»åŠ¨å‘èµ·è¿æ¥æ–¹ï¼‰å’ŒæœåŠ¡ç«¯ï¼ˆè¢«åŠ¨è¿æ¥æ–¹ï¼‰ä¼˜åŒ–çš„æ–¹å¼æ˜¯ä¸åŒçš„ï¼Œæ¥ä¸‹æ¥åˆ†åˆ«é’ˆå¯¹å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ä¼˜åŒ–ã€‚</p><h4 id="å®¢æˆ·ç«¯ä¼˜åŒ–" tabindex="-1"><a class="header-anchor" href="#å®¢æˆ·ç«¯ä¼˜åŒ–"><span>- å®¢æˆ·ç«¯ä¼˜åŒ–</span></a></h4><p><strong>ä¸‰æ¬¡æ¡æ‰‹å»ºç«‹è¿æ¥</strong>çš„<strong>é¦–è¦ç›®çš„</strong>æ˜¯**ã€ŒåŒæ­¥åºåˆ—å·ã€**ã€‚</p><blockquote><p><strong>åªæœ‰åŒæ­¥äº†åºåˆ—å·æ‰æœ‰å¯é ä¼ è¾“</strong>ï¼ŒTCP è®¸å¤šç‰¹æ€§éƒ½<strong>ä¾èµ–äºåºåˆ—å·å®ç°</strong>ï¼Œæ¯”å¦‚<strong>æµé‡æ§åˆ¶ã€ä¸¢åŒ…é‡ä¼ </strong>ç­‰ï¼Œè¿™ä¹Ÿæ˜¯ä¸‰æ¬¡æ¡æ‰‹ä¸­çš„æŠ¥æ–‡ç§°ä¸º SYN çš„åŸå› ï¼ŒSYN çš„å…¨ç§°å°±å« <em>Synchronize Sequence Numbers</em>ï¼ˆåŒæ­¥åºåˆ—å·ï¼‰ã€‚</p></blockquote><img src="'+un+'" alt="TCP å¤´éƒ¨" style="zoom:67%;"><blockquote><p>SYN_SENT çŠ¶æ€çš„ä¼˜åŒ–</p></blockquote><p>å®¢æˆ·ç«¯ä½œä¸ºä¸»åŠ¨å‘èµ·è¿æ¥æ–¹ï¼Œé¦–å…ˆå®ƒå°†å‘é€ <strong>SYN åŒ…</strong>ï¼Œäºæ˜¯å®¢æˆ·ç«¯çš„è¿æ¥å°±ä¼šå¤„äº <code>SYN_SENT</code> çŠ¶æ€ã€‚</p><p>å®¢æˆ·ç«¯åœ¨<strong>ç­‰å¾…æœåŠ¡ç«¯å›å¤çš„ ACK æŠ¥æ–‡</strong>ï¼Œæ­£å¸¸æƒ…å†µä¸‹ï¼ŒæœåŠ¡å™¨ä¼šåœ¨å‡ æ¯«ç§’å†…è¿”å› SYN+ACK ï¼Œä½†å¦‚æœ<strong>å®¢æˆ·ç«¯é•¿æ—¶é—´æ²¡æœ‰æ”¶åˆ°</strong> SYN+ACK æŠ¥æ–‡ï¼Œåˆ™ä¼š<strong>é‡å‘ SYN åŒ…</strong>ï¼Œ<strong>é‡å‘çš„æ¬¡æ•°ç”± tcp_syn_retries å‚æ•°æ§åˆ¶</strong>ï¼Œé»˜è®¤æ˜¯ 5 æ¬¡ï¼š</p><img src="'+_n+'" alt="img" style="zoom:50%;"><p>é€šå¸¸ï¼Œç¬¬ä¸€æ¬¡è¶…æ—¶é‡ä¼ æ˜¯åœ¨ 1 ç§’åï¼Œç¬¬äºŒæ¬¡è¶…æ—¶é‡ä¼ æ˜¯åœ¨ 2 ç§’ï¼Œç¬¬ä¸‰æ¬¡è¶…æ—¶é‡ä¼ æ˜¯åœ¨ 4 ç§’åï¼Œç¬¬å››æ¬¡è¶…æ—¶é‡ä¼ æ˜¯åœ¨ 8 ç§’åï¼Œç¬¬äº”æ¬¡æ˜¯åœ¨è¶…æ—¶é‡ä¼  16 ç§’åã€‚æ²¡é”™ï¼Œ<strong>æ¯æ¬¡è¶…æ—¶çš„æ—¶é—´æ˜¯ä¸Šä¸€æ¬¡çš„ 2 å€</strong>ã€‚</p><p>å½“ç¬¬äº”æ¬¡è¶…æ—¶é‡ä¼ åï¼Œä¼šç»§ç»­ç­‰å¾… 32 ç§’ï¼Œå¦‚æœæœåŠ¡ç«¯ä»ç„¶æ²¡æœ‰å›åº” ACKï¼Œå®¢æˆ·ç«¯<strong>å°±ä¼šç»ˆæ­¢ä¸‰æ¬¡æ¡æ‰‹</strong>ã€‚</p><p>æ‰€ä»¥ï¼Œæ€»è€—æ—¶æ˜¯ 1+2+4+8+16+32=63 ç§’ï¼Œå¤§çº¦ 1 åˆ†é’Ÿå·¦å³ã€‚</p><img src="'+Pn+'" alt="SYN è¶…æ—¶é‡ä¼ " style="zoom:67%;"><p>ä½ å¯ä»¥æ ¹æ®ç½‘ç»œçš„ç¨³å®šæ€§å’Œç›®æ ‡æœåŠ¡å™¨çš„ç¹å¿™ç¨‹åº¦<strong>ä¿®æ”¹ SYN çš„é‡ä¼ æ¬¡æ•°</strong>ï¼Œè°ƒæ•´å®¢æˆ·ç«¯çš„ä¸‰æ¬¡æ¡æ‰‹æ—¶é—´ä¸Šé™ã€‚æ¯”å¦‚å†…ç½‘ä¸­é€šè®¯æ—¶ï¼Œå°±å¯ä»¥é€‚å½“<strong>è°ƒä½é‡è¯•æ¬¡æ•°</strong>ï¼Œå°½å¿«æŠŠé”™è¯¯æš´éœ²ç»™åº”ç”¨ç¨‹åºã€‚</p><h4 id="æœåŠ¡ç«¯ä¼˜åŒ–" tabindex="-1"><a class="header-anchor" href="#æœåŠ¡ç«¯ä¼˜åŒ–"><span>- æœåŠ¡ç«¯ä¼˜åŒ–</span></a></h4><p>å½“æœåŠ¡ç«¯æ”¶åˆ° SYN åŒ…åï¼Œ<strong>æœåŠ¡ç«¯ä¼šç«‹é©¬å›å¤ SYN+ACK åŒ…</strong>ï¼Œè¡¨æ˜ç¡®è®¤æ”¶åˆ°äº†å®¢æˆ·ç«¯çš„åºåˆ—å·ï¼ŒåŒæ—¶ä¹ŸæŠŠè‡ªå·±çš„åºåˆ—å·å‘ç»™å¯¹æ–¹ã€‚</p><p>æ­¤æ—¶ï¼ŒæœåŠ¡ç«¯å‡ºç°äº†æ–°è¿æ¥ï¼ŒçŠ¶æ€æ˜¯ <code>SYN_RCV</code>ã€‚åœ¨è¿™ä¸ªçŠ¶æ€ä¸‹ï¼ŒLinux å†…æ ¸å°±ä¼šå»ºç«‹ä¸€ä¸ª**ã€ŒåŠè¿æ¥é˜Ÿåˆ—ã€<strong>æ¥ç»´æŠ¤</strong>ã€Œæœªå®Œæˆã€çš„æ¡æ‰‹ä¿¡æ¯**ï¼Œå½“åŠè¿æ¥é˜Ÿåˆ—<strong>æº¢å‡ºåï¼ŒæœåŠ¡ç«¯å°±æ— æ³•å†å»ºç«‹æ–°çš„è¿æ¥</strong>ã€‚</p><img src="'+Cn+'" alt="åŠè¿æ¥é˜Ÿåˆ—ä¸å…¨è¿æ¥é˜Ÿåˆ—" style="zoom:67%;"><p>SYN æ”»å‡»ï¼Œæ”»å‡»çš„æ˜¯å°±æ˜¯è¿™ä¸ª<strong>åŠè¿æ¥é˜Ÿåˆ—</strong>ã€‚</p><blockquote><p>å¦‚ä½•æŸ¥çœ‹ç”±äº SYN åŠè¿æ¥é˜Ÿåˆ—å·²æ»¡ï¼Œè€Œè¢«ä¸¢å¼ƒè¿æ¥çš„æƒ…å†µï¼Ÿ</p></blockquote><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡è¯¥ <code>netstat -s</code> å‘½ä»¤ç»™å‡ºçš„ç»Ÿè®¡ç»“æœä¸­ï¼Œ å¯ä»¥å¾—åˆ°<strong>ç”±äºåŠè¿æ¥é˜Ÿåˆ—å·²æ»¡ï¼Œå¼•å‘çš„å¤±è´¥æ¬¡æ•°ï¼š</strong></p><img src="'+bn+'" alt="img" style="zoom:50%;"><p>ä¸Šé¢è¾“å‡ºçš„æ•°å€¼æ˜¯<strong>ç´¯è®¡å€¼</strong>ï¼Œè¡¨ç¤ºå…±æœ‰å¤šå°‘ä¸ª TCP è¿æ¥å› ä¸ºåŠè¿æ¥é˜Ÿåˆ—æº¢å‡ºè€Œè¢«ä¸¢å¼ƒã€‚<strong>éš”å‡ ç§’æ‰§è¡Œå‡ æ¬¡ï¼Œå¦‚æœæœ‰ä¸Šå‡çš„è¶‹åŠ¿ï¼Œè¯´æ˜å½“å‰å­˜åœ¨åŠè¿æ¥é˜Ÿåˆ—æº¢å‡ºçš„ç°è±¡</strong>ã€‚</p><blockquote><p>å¦‚ä½•è°ƒæ•´ SYN åŠè¿æ¥é˜Ÿåˆ—å¤§å°ï¼Ÿ</p></blockquote><p>è¦æƒ³å¢å¤§åŠè¿æ¥é˜Ÿåˆ—ï¼Œ<strong>ä¸èƒ½åªå•çº¯å¢å¤§ tcp_max_syn_backlog çš„å€¼ï¼Œè¿˜éœ€ä¸€åŒå¢å¤§ somaxconn å’Œ backlogï¼Œä¹Ÿå°±æ˜¯å¢å¤§ accept é˜Ÿåˆ—ã€‚å¦åˆ™ï¼Œåªå•çº¯å¢å¤§ tcp_max_syn_backlog æ˜¯æ— æ•ˆçš„ã€‚</strong></p><p>å¢å¤§ tcp_max_syn_backlog å’Œ somaxconn çš„æ–¹æ³•æ˜¯ä¿®æ”¹ Linux å†…æ ¸å‚æ•°ï¼š</p><img src="'+kn+'" alt="img" style="zoom:50%;"><p>å¢å¤§ backlog çš„æ–¹å¼ï¼Œæ¯ä¸ª Web æœåŠ¡éƒ½ä¸åŒï¼Œæ¯”å¦‚ Nginx å¢å¤§ backlog çš„æ–¹æ³•å¦‚ä¸‹ï¼š</p><img src="'+fn+'" alt="img" style="zoom:50%;"><p>æœ€åï¼Œæ”¹å˜äº†å¦‚ä¸Šè¿™äº›å‚æ•°åï¼Œè¦é‡å¯ Nginx æœåŠ¡ï¼Œå› ä¸º SYN åŠè¿æ¥é˜Ÿåˆ—å’Œ accept é˜Ÿåˆ—éƒ½æ˜¯åœ¨ <code>listen()</code> åˆå§‹åŒ–çš„ã€‚</p><blockquote><p>å¦‚æœ SYN åŠè¿æ¥é˜Ÿåˆ—å·²æ»¡ï¼Œåªèƒ½ä¸¢å¼ƒè¿æ¥å—ï¼Ÿ</p></blockquote><p>å¹¶ä¸æ˜¯è¿™æ ·ï¼Œ<strong>å¼€å¯ <code>syn cookies </code>åŠŸèƒ½å°±å¯ä»¥åœ¨<code>ä¸ä½¿ç”¨ SYN åŠè¿æ¥é˜Ÿåˆ—</code>çš„æƒ…å†µä¸‹<code>æˆåŠŸå»ºç«‹è¿æ¥</code></strong>ã€‚</p><p>syncookies çš„å·¥ä½œåŸç†ï¼šæœåŠ¡å™¨<strong>æ ¹æ®å½“å‰çŠ¶æ€è®¡ç®—å‡ºä¸€ä¸ªå€¼</strong>ï¼Œæ”¾åœ¨<strong>å·±æ–¹å‘å‡ºçš„ SYN+ACK æŠ¥æ–‡ä¸­å‘å‡º</strong>ï¼Œ<strong>å½“å®¢æˆ·ç«¯è¿”å› ACK æŠ¥æ–‡æ—¶ï¼Œå–å‡ºè¯¥å€¼éªŒè¯</strong>ï¼Œå¦‚æœ<strong>åˆæ³•</strong>ï¼Œå°±è®¤ä¸ºè¿æ¥å»ºç«‹æˆåŠŸï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚</p><img src="'+Sn+'" alt="å¼€å¯ syncookies åŠŸèƒ½" style="zoom:67%;"><p>syncookies å‚æ•°ä¸»è¦æœ‰ä»¥ä¸‹ä¸‰ä¸ªå€¼ï¼š</p><ul><li>0 å€¼ï¼Œè¡¨ç¤ºå…³é—­è¯¥åŠŸèƒ½ï¼›</li><li>1 å€¼ï¼Œè¡¨ç¤ºä»…å½“ SYN åŠè¿æ¥é˜Ÿåˆ—æ”¾ä¸ä¸‹æ—¶ï¼Œå†å¯ç”¨å®ƒï¼›</li><li>2 å€¼ï¼Œè¡¨ç¤ºæ— æ¡ä»¶å¼€å¯åŠŸèƒ½ï¼›</li></ul><p>é‚£ä¹ˆåœ¨åº”å¯¹ SYN æ”»å‡»æ—¶ï¼Œåªéœ€è¦è®¾ç½®ä¸º 1 å³å¯ï¼š</p><img src="'+An+'" alt="img" style="zoom:50%;"><blockquote><p>SYN_RCV çŠ¶æ€çš„ä¼˜åŒ–</p></blockquote><p>å½“å®¢æˆ·ç«¯æ¥æ”¶åˆ°æœåŠ¡å™¨å‘æ¥çš„ SYN+ACK æŠ¥æ–‡åï¼Œå°±ä¼šå›å¤ ACK ç»™æœåŠ¡å™¨ï¼ŒåŒæ—¶å®¢æˆ·ç«¯è¿æ¥çŠ¶æ€ä» SYN_SENT è½¬æ¢ä¸º ESTABLISHEDï¼Œè¡¨ç¤ºè¿æ¥å»ºç«‹æˆåŠŸã€‚</p><p>æœåŠ¡å™¨ç«¯è¿æ¥æˆåŠŸå»ºç«‹çš„æ—¶é—´è¿˜è¦å†å¾€åï¼Œç­‰åˆ°æœåŠ¡ç«¯æ”¶åˆ°å®¢æˆ·ç«¯çš„ ACK åï¼ŒæœåŠ¡ç«¯çš„è¿æ¥çŠ¶æ€æ‰å˜ä¸º ESTABLISHEDã€‚</p><p>å¦‚æœæœåŠ¡å™¨æ²¡æœ‰æ”¶åˆ° ACKï¼Œå°±ä¼šé‡å‘ SYN+ACK æŠ¥æ–‡ï¼ŒåŒæ—¶ä¸€ç›´å¤„äº SYN_RCV çŠ¶æ€ã€‚</p><p>å½“ç½‘ç»œç¹å¿™ã€ä¸ç¨³å®šæ—¶ï¼ŒæŠ¥æ–‡ä¸¢å¤±å°±ä¼šå˜ä¸¥é‡ï¼Œæ­¤æ—¶åº”è¯¥è°ƒå¤§é‡å‘æ¬¡æ•°ã€‚åä¹‹åˆ™å¯ä»¥è°ƒå°é‡å‘æ¬¡æ•°ã€‚<strong>ä¿®æ”¹é‡å‘æ¬¡æ•°çš„æ–¹æ³•æ˜¯ï¼Œè°ƒæ•´ tcp_synack_retries å‚æ•°</strong>ï¼š</p><img src="'+In+'" alt="img" style="zoom:50%;"><p>tcp_synack_retries çš„é»˜è®¤é‡è¯•æ¬¡æ•°æ˜¯ 5 æ¬¡ï¼Œä¸å®¢æˆ·ç«¯é‡ä¼  SYN ç±»ä¼¼ï¼Œå®ƒçš„é‡ä¼ ä¼šç»å† 1ã€2ã€4ã€8ã€16 ç§’ï¼Œæœ€åä¸€æ¬¡é‡ä¼ åä¼šç»§ç»­ç­‰å¾… 32 ç§’ï¼Œå¦‚æœæœåŠ¡ç«¯ä»ç„¶æ²¡æœ‰æ”¶åˆ° ACKï¼Œæ‰ä¼šå…³é—­è¿æ¥ï¼Œæ•…å…±éœ€è¦ç­‰å¾… 63 ç§’ã€‚</p><p>æœåŠ¡å™¨æ”¶åˆ° ACK åè¿æ¥å»ºç«‹æˆåŠŸï¼Œæ­¤æ—¶ï¼Œå†…æ ¸ä¼šæŠŠ<strong>è¿æ¥ä»åŠè¿æ¥é˜Ÿåˆ—ç§»é™¤</strong>ï¼Œç„¶å<strong>åˆ›å»ºæ–°çš„å®Œå…¨çš„è¿æ¥</strong>ï¼Œå¹¶å°†å…¶æ·»åŠ åˆ° <strong>accept é˜Ÿåˆ—</strong>ï¼Œç­‰å¾…è¿›ç¨‹<strong>è°ƒç”¨ accept å‡½æ•°æ—¶æŠŠè¿æ¥å–å‡ºæ¥</strong>ã€‚</p><p>å¦‚æœè¿›ç¨‹ä¸èƒ½åŠæ—¶åœ°è°ƒç”¨ accept å‡½æ•°ï¼Œå°±ä¼šé€ æˆ <strong>accept é˜Ÿåˆ—ï¼ˆä¹Ÿç§°å…¨è¿æ¥é˜Ÿåˆ—ï¼‰æº¢å‡º</strong>ï¼Œæœ€ç»ˆå¯¼è‡´å»ºç«‹å¥½çš„ TCP è¿æ¥è¢«ä¸¢å¼ƒã€‚</p><figure><img src="'+xn+'" alt=" accept é˜Ÿåˆ—æº¢å‡º" tabindex="0" loading="lazy"><figcaption> accept é˜Ÿåˆ—æº¢å‡º</figcaption></figure><blockquote><p>accept é˜Ÿåˆ—å·²æ»¡ï¼Œåªèƒ½ä¸¢å¼ƒè¿æ¥å—ï¼Ÿ</p></blockquote><p>ä¸¢å¼ƒè¿æ¥åªæ˜¯ Linux çš„é»˜è®¤è¡Œä¸ºï¼Œæˆ‘ä»¬è¿˜å¯ä»¥é€‰æ‹©<strong>å‘å®¢æˆ·ç«¯å‘é€ RST å¤ä½æŠ¥æ–‡</strong>ï¼Œå‘Šè¯‰å®¢æˆ·ç«¯è¿æ¥å·²ç»å»ºç«‹å¤±è´¥ã€‚æ‰“å¼€è¿™ä¸€åŠŸèƒ½éœ€è¦å°† tcp_abort_on_overflow å‚æ•°è®¾ç½®ä¸º 1ã€‚</p><img src="'+Nn+'" alt="img" style="zoom:50%;"><p>tcp_abort_on_overflow å…±æœ‰ä¸¤ä¸ªå€¼åˆ†åˆ«æ˜¯ 0 å’Œ 1ï¼Œå…¶åˆ†åˆ«è¡¨ç¤ºï¼š</p><ul><li>0 ï¼šå¦‚æœ accept é˜Ÿåˆ—æ»¡äº†ï¼Œé‚£ä¹ˆ server æ‰”æ‰ client å‘è¿‡æ¥çš„ ack ï¼›</li><li>1 ï¼šå¦‚æœ accept é˜Ÿåˆ—æ»¡äº†ï¼Œserver å‘é€ä¸€ä¸ª <code>RST</code> åŒ…ç»™ clientï¼Œè¡¨ç¤ºåºŸæ‰è¿™ä¸ªæ¡æ‰‹è¿‡ç¨‹å’Œè¿™ä¸ªè¿æ¥ï¼›</li></ul><p>å¦‚æœè¦æƒ³çŸ¥é“å®¢æˆ·ç«¯è¿æ¥ä¸ä¸ŠæœåŠ¡ç«¯ï¼Œæ˜¯ä¸æ˜¯æœåŠ¡ç«¯ TCP å…¨è¿æ¥é˜Ÿåˆ—æ»¡çš„åŸå› ï¼Œé‚£ä¹ˆå¯ä»¥æŠŠ tcp_abort_on_overflow è®¾ç½®ä¸º 1ï¼Œè¿™æ—¶å¦‚æœåœ¨å®¢æˆ·ç«¯å¼‚å¸¸ä¸­å¯ä»¥çœ‹åˆ°å¾ˆå¤š <code>connection reset by peer</code> çš„é”™è¯¯ï¼Œé‚£ä¹ˆå°±å¯ä»¥è¯æ˜æ˜¯ç”±äºæœåŠ¡ç«¯ TCP å…¨è¿æ¥é˜Ÿåˆ—æº¢å‡ºçš„é—®é¢˜ã€‚</p><p>é€šå¸¸æƒ…å†µä¸‹ï¼Œåº”å½“æŠŠ tcp_abort_on_overflow è®¾ç½®ä¸º 0ï¼Œå› ä¸ºè¿™æ ·æ›´æœ‰åˆ©äº<strong>åº”å¯¹çªå‘æµé‡</strong>ã€‚</p><p>ä¸¾ä¸ªä¾‹å­ï¼Œå½“ accept é˜Ÿåˆ—æ»¡å¯¼è‡´æœåŠ¡å™¨ä¸¢æ‰äº† ACKï¼Œä¸æ­¤åŒæ—¶ï¼Œå®¢æˆ·ç«¯çš„è¿æ¥çŠ¶æ€å´æ˜¯ ESTABLISHEDï¼Œå®¢æˆ·ç«¯è¿›ç¨‹å°±åœ¨å»ºç«‹å¥½çš„è¿æ¥ä¸Šå‘é€è¯·æ±‚ã€‚åªè¦æœåŠ¡å™¨æ²¡æœ‰ä¸ºè¯·æ±‚å›å¤ ACKï¼Œå®¢æˆ·ç«¯çš„è¯·æ±‚å°±ä¼šè¢«å¤šæ¬¡ã€Œé‡å‘ã€ã€‚<strong>å¦‚æœæœåŠ¡å™¨ä¸Šçš„è¿›ç¨‹åªæ˜¯çŸ­æš‚çš„ç¹å¿™é€ æˆ accept é˜Ÿåˆ—æ»¡ï¼Œé‚£ä¹ˆå½“ accept é˜Ÿåˆ—æœ‰ç©ºä½æ—¶ï¼Œå†æ¬¡æ¥æ”¶åˆ°çš„è¯·æ±‚æŠ¥æ–‡ç”±äºå«æœ‰ ACKï¼Œä»ç„¶ä¼šè§¦å‘æœåŠ¡å™¨ç«¯æˆåŠŸå»ºç«‹è¿æ¥ã€‚</strong></p><img src="'+qn+'" alt="tcp_abort_on_overflow ä¸º 0 å¯ä»¥åº”å¯¹çªå‘æµé‡" style="zoom:67%;"><p>æ‰€ä»¥ï¼Œtcp_abort_on_overflow è®¾ä¸º 0 å¯ä»¥<strong>æé«˜è¿æ¥å»ºç«‹çš„æˆåŠŸç‡</strong>ï¼Œåªæœ‰ä½ éå¸¸è‚¯å®š TCP å…¨è¿æ¥é˜Ÿåˆ—ä¼šé•¿æœŸæº¢å‡ºæ—¶ï¼Œæ‰èƒ½è®¾ç½®ä¸º 1 ä»¥å°½å¿«é€šçŸ¥å®¢æˆ·ç«¯ã€‚</p><blockquote><p>å¦‚ä½•è°ƒæ•´ accept é˜Ÿåˆ—çš„é•¿åº¦å‘¢ï¼Ÿ</p></blockquote><p>accept é˜Ÿåˆ—çš„é•¿åº¦å–å†³äº somaxconn å’Œ backlog ä¹‹é—´çš„æœ€å°å€¼ï¼Œä¹Ÿå°±æ˜¯ min(somaxconn, backlog)ï¼Œå…¶ä¸­ï¼š</p><ul><li>somaxconn æ˜¯ Linux å†…æ ¸çš„å‚æ•°ï¼Œé»˜è®¤å€¼æ˜¯ 128ï¼Œå¯ä»¥é€šè¿‡ <code>net.core.somaxconn</code> æ¥è®¾ç½®å…¶å€¼ï¼›</li><li>backlog æ˜¯ <code>listen(int sockfd, int backlog)</code> å‡½æ•°ä¸­çš„ backlog å¤§å°ï¼›</li></ul><p>Tomcatã€Nginxã€Apache å¸¸è§çš„ Web æœåŠ¡çš„ backlog é»˜è®¤å€¼éƒ½æ˜¯ 511ã€‚</p><blockquote><p>å¦‚ä½•æŸ¥çœ‹æœåŠ¡ç«¯è¿›ç¨‹ accept é˜Ÿåˆ—çš„é•¿åº¦ï¼Ÿ</p></blockquote><p>å¯ä»¥é€šè¿‡ <code>ss -ltn</code> å‘½ä»¤æŸ¥çœ‹ï¼š</p><img src="'+yn+'" alt="img" style="zoom:50%;"><ul><li>Recv-Qï¼šå½“å‰ accept é˜Ÿåˆ—çš„å¤§å°ï¼Œä¹Ÿå°±æ˜¯å½“å‰å·²å®Œæˆä¸‰æ¬¡æ¡æ‰‹å¹¶ç­‰å¾…æœåŠ¡ç«¯ <code>accept()</code> çš„ TCP è¿æ¥ï¼›</li><li>Send-Qï¼šaccept é˜Ÿåˆ—æœ€å¤§é•¿åº¦ï¼Œä¸Šé¢çš„è¾“å‡ºç»“æœè¯´æ˜ç›‘å¬ 8088 ç«¯å£çš„ TCP æœåŠ¡ï¼Œaccept é˜Ÿåˆ—çš„æœ€å¤§é•¿åº¦ä¸º 128ï¼›</li></ul><blockquote><p>å¦‚ä½•æŸ¥çœ‹ç”±äº accept è¿æ¥é˜Ÿåˆ—å·²æ»¡ï¼Œè€Œè¢«ä¸¢å¼ƒçš„è¿æ¥ï¼Ÿ</p></blockquote><p>å½“è¶…è¿‡äº† accept è¿æ¥é˜Ÿåˆ—ï¼ŒæœåŠ¡ç«¯åˆ™ä¼šä¸¢æ‰åç»­è¿›æ¥çš„ TCP è¿æ¥ï¼Œä¸¢æ‰çš„ TCP è¿æ¥çš„ä¸ªæ•°ä¼šè¢«ç»Ÿè®¡èµ·æ¥ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ netstat -s å‘½ä»¤æ¥æŸ¥çœ‹ï¼š</p><img src="'+Hn+'" alt="img" style="zoom:50%;"><p>ä¸Šé¢çœ‹åˆ°çš„ 41150 times ï¼Œè¡¨ç¤º accept é˜Ÿåˆ—æº¢å‡ºçš„æ¬¡æ•°ï¼Œæ³¨æ„è¿™ä¸ªæ˜¯ç´¯è®¡å€¼ã€‚å¯ä»¥éš”å‡ ç§’é’Ÿæ‰§è¡Œä¸‹ï¼Œå¦‚æœè¿™ä¸ªæ•°å­—ä¸€ç›´åœ¨å¢åŠ çš„è¯ï¼Œè¯´æ˜ accept è¿æ¥é˜Ÿåˆ—å¶å°”æ»¡äº†ã€‚</p><p>å¦‚æœæŒç»­ä¸æ–­åœ°æœ‰è¿æ¥å› ä¸º accept é˜Ÿåˆ—æº¢å‡ºè¢«ä¸¢å¼ƒï¼Œå°±åº”è¯¥è°ƒå¤§ backlog ä»¥åŠ somaxconn å‚æ•°ã€‚</p><h4 id="å¦‚ä½•ç»•è¿‡ä¸‰æ¬¡æ¡æ‰‹" tabindex="-1"><a class="header-anchor" href="#å¦‚ä½•ç»•è¿‡ä¸‰æ¬¡æ¡æ‰‹"><span>- å¦‚ä½•ç»•è¿‡ä¸‰æ¬¡æ¡æ‰‹ï¼Ÿ</span></a></h4><p>ä»¥ä¸Šæˆ‘ä»¬åªæ˜¯åœ¨å¯¹ä¸‰æ¬¡æ¡æ‰‹çš„è¿‡ç¨‹è¿›è¡Œä¼˜åŒ–ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬çœ‹çœ‹å¦‚ä½•<strong>ç»•è¿‡ä¸‰æ¬¡æ¡æ‰‹å‘é€æ•°æ®</strong>ã€‚</p><blockquote><p>ä¸‰æ¬¡æ¡æ‰‹å»ºç«‹è¿æ¥é€ æˆçš„åæœå°±æ˜¯ï¼Œ<strong>HTTP è¯·æ±‚</strong>å¿…é¡»åœ¨<strong>ä¸€ä¸ª RTTï¼ˆä»å®¢æˆ·ç«¯åˆ°æœåŠ¡å™¨ä¸€ä¸ªå¾€è¿”çš„æ—¶é—´ï¼‰å</strong>æ‰èƒ½å‘é€ã€‚</p></blockquote><figure><img src="'+vn+'" alt="å¸¸è§„ HTTP è¯·æ±‚" tabindex="0" loading="lazy"><figcaption>å¸¸è§„ HTTP è¯·æ±‚</figcaption></figure><p>åœ¨ Linux 3.7 å†…æ ¸ç‰ˆæœ¬ä¹‹åï¼Œæä¾›äº† TCP Fast Open åŠŸèƒ½ï¼Œè¿™ä¸ªåŠŸèƒ½å¯ä»¥å‡å°‘ TCP è¿æ¥å»ºç«‹çš„æ—¶å»¶ã€‚</p><blockquote><p>æ¥ä¸‹æ¥è¯´è¯´ï¼ŒTCP Fast Open åŠŸèƒ½çš„å·¥ä½œæ–¹å¼ã€‚</p></blockquote><img src="'+zn+'" alt="å¼€å¯ TCP Fast Open åŠŸèƒ½" style="zoom:67%;"><p>åœ¨å®¢æˆ·ç«¯<strong>é¦–æ¬¡å»ºç«‹è¿æ¥æ—¶</strong>çš„è¿‡ç¨‹ï¼š</p><ol><li>å®¢æˆ·ç«¯å‘é€ SYN æŠ¥æ–‡ï¼Œè¯¥æŠ¥æ–‡åŒ…å« <strong>Fast Open é€‰é¡¹</strong>ï¼Œä¸”è¯¥é€‰é¡¹çš„ <strong>Cookie ä¸ºç©º</strong>ï¼Œè¿™è¡¨æ˜å®¢æˆ·ç«¯<strong>è¯·æ±‚ Fast Open Cookieï¼›</strong></li><li>æ”¯æŒ TCP Fast Open çš„æœåŠ¡å™¨<strong>ç”Ÿæˆ Cookie</strong>ï¼Œå¹¶å°†å…¶<strong>ç½®äº SYN-ACK æ•°æ®åŒ…ä¸­çš„ Fast Open é€‰é¡¹</strong>ä»¥å‘å›å®¢æˆ·ç«¯ï¼›</li><li>å®¢æˆ·ç«¯æ”¶åˆ° SYN-ACK åï¼Œ<strong>æœ¬åœ°ç¼“å­˜ Fast Open é€‰é¡¹ä¸­çš„ Cookie</strong>ã€‚</li></ol><p>æ‰€ä»¥ï¼Œ<strong>ç¬¬ä¸€æ¬¡å‘èµ· HTTP GET è¯·æ±‚çš„æ—¶å€™</strong>ï¼Œè¿˜æ˜¯<strong>éœ€è¦æ­£å¸¸çš„ä¸‰æ¬¡æ¡æ‰‹æµç¨‹</strong>ã€‚</p><p>ä¹‹åï¼Œå¦‚æœå®¢æˆ·ç«¯<strong>å†æ¬¡å‘æœåŠ¡å™¨å»ºç«‹è¿æ¥æ—¶çš„è¿‡ç¨‹</strong>ï¼š</p><ol><li>å®¢æˆ·ç«¯å‘é€ SYN æŠ¥æ–‡ï¼Œè¯¥æŠ¥æ–‡<strong>åŒ…å«ã€Œæ•°æ®ã€</strong>ï¼ˆå¯¹äº<strong>é TFO çš„æ™®é€š TCP æ¡æ‰‹è¿‡ç¨‹ï¼ŒSYN æŠ¥æ–‡ä¸­ä¸åŒ…å«ã€Œæ•°æ®ã€</strong>ï¼‰ä»¥åŠ<strong>æ­¤å‰è®°å½•çš„ Cookie</strong>ï¼›</li><li>æ”¯æŒ TCP Fast Open çš„æœåŠ¡å™¨ä¼š<strong>å¯¹æ”¶åˆ° Cookie è¿›è¡Œæ ¡éªŒ</strong>ï¼šå¦‚æœ Cookie æœ‰æ•ˆï¼ŒæœåŠ¡å™¨å°†åœ¨ SYN-ACK æŠ¥æ–‡ä¸­å¯¹ SYN å’Œã€Œæ•°æ®ã€è¿›è¡Œ<strong>ç¡®è®¤</strong>ï¼ŒæœåŠ¡å™¨**<code>éšå</code>** <strong>å°†ã€Œæ•°æ®ã€é€’é€è‡³ç›¸åº”çš„åº”ç”¨ç¨‹åº</strong>ï¼›å¦‚æœ Cookie æ— æ•ˆï¼ŒæœåŠ¡å™¨å°†<strong>ä¸¢å¼ƒ SYN æŠ¥æ–‡ä¸­åŒ…å«çš„ã€Œæ•°æ®ã€</strong>ï¼Œä¸”å…¶éšåå‘å‡ºçš„ SYN-ACK æŠ¥æ–‡<strong>å°†åªç¡®è®¤ SYN çš„å¯¹åº”åºåˆ—å·</strong>ï¼›</li><li>å¦‚æœæœåŠ¡å™¨<strong>æ¥å—äº† SYN æŠ¥æ–‡ä¸­çš„ã€Œæ•°æ®ã€</strong>ï¼ŒæœåŠ¡å™¨å¯åœ¨<strong>æ¡æ‰‹å®Œæˆä¹‹å‰å‘é€ã€Œæ•°æ®ã€</strong>ï¼Œ<strong>è¿™å°±å‡å°‘äº†æ¡æ‰‹å¸¦æ¥çš„ 1 ä¸ª RTT çš„æ—¶é—´æ¶ˆè€—</strong>ï¼›</li><li>å®¢æˆ·ç«¯å°†å‘é€ ACK ç¡®è®¤æœåŠ¡å™¨å‘å›çš„ SYN ä»¥åŠã€Œæ•°æ®ã€ï¼Œä½†å¦‚æœå®¢æˆ·ç«¯åœ¨åˆå§‹çš„ SYN æŠ¥æ–‡ä¸­å‘é€çš„ã€Œæ•°æ®ã€æ²¡æœ‰è¢«ç¡®è®¤ï¼Œåˆ™å®¢æˆ·ç«¯å°†é‡æ–°å‘é€ã€Œæ•°æ®ã€ï¼›</li><li>æ­¤åçš„ TCP è¿æ¥çš„æ•°æ®ä¼ è¾“è¿‡ç¨‹å’Œé TFO çš„æ­£å¸¸æƒ…å†µä¸€è‡´ã€‚</li></ol><p>æ‰€ä»¥ï¼Œ<strong>ä¹‹åå‘èµ· HTTP GET è¯·æ±‚çš„</strong>æ—¶å€™ï¼Œå¯ä»¥<strong>ç»•è¿‡ä¸‰æ¬¡æ¡æ‰‹</strong>ï¼Œè¿™å°±å‡å°‘äº†æ¡æ‰‹å¸¦æ¥çš„ 1 ä¸ª RTT çš„æ—¶é—´æ¶ˆè€—ã€‚</p><p>å¼€å¯äº† TFO åŠŸèƒ½ï¼Œcookie çš„å€¼æ˜¯å­˜æ”¾åˆ° TCP option å­—æ®µé‡Œçš„ï¼š</p><img src="'+En+'" alt="TCP option å­—æ®µ - TFO" style="zoom:67%;"><p>æ³¨ï¼šå®¢æˆ·ç«¯åœ¨è¯·æ±‚å¹¶å­˜å‚¨äº† Fast Open Cookie ä¹‹åï¼Œå¯ä»¥<strong>ä¸æ–­é‡å¤ TCP Fast Open ç›´è‡³æœåŠ¡å™¨è®¤ä¸º Cookie æ— æ•ˆï¼ˆé€šå¸¸ä¸ºè¿‡æœŸï¼‰ã€‚</strong></p><blockquote><p>Linux ä¸‹æ€ä¹ˆæ‰“å¼€ TCP Fast Open åŠŸèƒ½å‘¢ï¼Ÿ</p></blockquote><p>åœ¨ Linux ç³»ç»Ÿä¸­ï¼Œå¯ä»¥é€šè¿‡<strong>è®¾ç½® tcp_fastopn å†…æ ¸å‚æ•°ï¼Œæ¥æ‰“å¼€ Fast Open åŠŸèƒ½</strong>ï¼š</p><img src="'+wn+'" alt="img" style="zoom:50%;"><p>tcp_fastopn å„ä¸ªå€¼çš„æ„ä¹‰:</p><ul><li>0 å…³é—­</li><li>1 ä½œä¸ºå®¢æˆ·ç«¯ä½¿ç”¨ Fast Open åŠŸèƒ½</li><li>2 ä½œä¸ºæœåŠ¡ç«¯ä½¿ç”¨ Fast Open åŠŸèƒ½</li><li>3 æ— è®ºä½œä¸ºå®¢æˆ·ç«¯è¿˜æ˜¯æœåŠ¡å™¨ï¼Œéƒ½å¯ä»¥ä½¿ç”¨ Fast Open åŠŸèƒ½</li></ul><p><strong>TCP Fast Open åŠŸèƒ½éœ€è¦å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯åŒæ—¶æ”¯æŒï¼Œæ‰æœ‰æ•ˆæœã€‚</strong></p><h4 id="å°ç»“-1" tabindex="-1"><a class="header-anchor" href="#å°ç»“-1"><span>- å°ç»“</span></a></h4><p>æœ¬å°ç»“ä¸»è¦ä»‹ç»äº†å…³äºä¼˜åŒ– TCP ä¸‰æ¬¡æ¡æ‰‹çš„å‡ ä¸ª TCP å‚æ•°ã€‚</p><img src="'+Kn+'" alt="ä¸‰æ¬¡æ¡æ‰‹ä¼˜åŒ–ç­–ç•¥" style="zoom:67%;"><blockquote><p>å®¢æˆ·ç«¯çš„ä¼˜åŒ–</p></blockquote><p>å½“å®¢æˆ·ç«¯å‘èµ· SYN åŒ…æ—¶ï¼Œå¯ä»¥é€šè¿‡ <code>tcp_syn_retries</code> æ§åˆ¶å…¶é‡ä¼ çš„æ¬¡æ•°ã€‚</p><blockquote><p>æœåŠ¡ç«¯çš„ä¼˜åŒ–</p></blockquote><p>å½“æœåŠ¡ç«¯ SYN åŠè¿æ¥é˜Ÿåˆ—æº¢å‡ºåï¼Œä¼šå¯¼è‡´åç»­è¿æ¥è¢«ä¸¢å¼ƒï¼Œå¯ä»¥é€šè¿‡ <code>netstat -s</code> è§‚å¯ŸåŠè¿æ¥é˜Ÿåˆ—æº¢å‡ºçš„æƒ…å†µï¼Œå¦‚æœ SYN åŠè¿æ¥é˜Ÿåˆ—æº¢å‡ºæƒ…å†µæ¯”è¾ƒä¸¥é‡ï¼Œå¯ä»¥é€šè¿‡ <code>tcp_max_syn_backlogã€somaxconnã€backlog</code> å‚æ•°æ¥è°ƒæ•´ SYN åŠè¿æ¥é˜Ÿåˆ—çš„å¤§å°ã€‚</p><p>æœåŠ¡ç«¯å›å¤ SYN+ACK çš„é‡ä¼ æ¬¡æ•°ç”± <code>tcp_synack_retries</code> å‚æ•°æ§åˆ¶ã€‚å¦‚æœé­å— SYN æ”»å‡»ï¼Œåº”æŠŠ <code>tcp_syncookies</code> å‚æ•°è®¾ç½®ä¸º 1ï¼Œè¡¨ç¤ºä»…åœ¨ SYN é˜Ÿåˆ—æ»¡åå¼€å¯ syncookie åŠŸèƒ½ï¼Œå¯ä»¥ä¿è¯æ­£å¸¸çš„è¿æ¥æˆåŠŸå»ºç«‹ã€‚</p><p>æœåŠ¡ç«¯æ”¶åˆ°å®¢æˆ·ç«¯è¿”å›çš„ ACKï¼Œä¼šæŠŠè¿æ¥ç§»å…¥ accpet é˜Ÿåˆ—ï¼Œç­‰å¾…è¿›è¡Œè°ƒç”¨ accpet() å‡½æ•°å–å‡ºè¿æ¥ã€‚</p><p>å¯ä»¥é€šè¿‡ <code>ss -lnt</code> æŸ¥çœ‹æœåŠ¡ç«¯è¿›ç¨‹çš„ accept é˜Ÿåˆ—é•¿åº¦ï¼Œå¦‚æœ accept é˜Ÿåˆ—æº¢å‡ºï¼Œç³»ç»Ÿé»˜è®¤ä¸¢å¼ƒ ACKï¼Œå¦‚æœå¯ä»¥æŠŠ <code>tcp_abort_on_overflow</code> è®¾ç½®ä¸º 1 ï¼Œè¡¨ç¤ºç”¨ RST é€šçŸ¥å®¢æˆ·ç«¯è¿æ¥å»ºç«‹å¤±è´¥ã€‚</p><p>å¦‚æœ accpet é˜Ÿåˆ—æº¢å‡ºä¸¥é‡ï¼Œå¯ä»¥é€šè¿‡ listen å‡½æ•°çš„ <code>backlog</code> å‚æ•°å’Œ <code>somaxconn</code> ç³»ç»Ÿå‚æ•°æé«˜é˜Ÿåˆ—å¤§å°ï¼Œaccept é˜Ÿåˆ—é•¿åº¦å–å†³äº min(backlog, somaxconn)ã€‚</p><blockquote><p>ç»•è¿‡ä¸‰æ¬¡æ¡æ‰‹</p></blockquote><p>TCP Fast Open åŠŸèƒ½å¯ä»¥ç»•è¿‡ä¸‰æ¬¡æ¡æ‰‹ï¼Œä½¿å¾— HTTP è¯·æ±‚å‡å°‘äº† 1 ä¸ª RTT çš„æ—¶é—´ï¼ŒLinux ä¸‹å¯ä»¥é€šè¿‡ <code>tcp_fastopen</code> å¼€å¯è¯¥åŠŸèƒ½ï¼ŒåŒæ—¶å¿…é¡»ä¿è¯æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯åŒæ—¶æ”¯æŒã€‚</p><h3 id="tcp-å››æ¬¡æŒ¥æ‰‹çš„æ€§èƒ½æå‡" tabindex="-1"><a class="header-anchor" href="#tcp-å››æ¬¡æŒ¥æ‰‹çš„æ€§èƒ½æå‡"><span>- TCP å››æ¬¡æŒ¥æ‰‹çš„æ€§èƒ½æå‡</span></a></h3><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä¸€èµ·çœ‹çœ‹é’ˆå¯¹ TCP å››æ¬¡æŒ¥æ‰‹å…³é—­è¿æ¥æ—¶ï¼Œå¦‚ä½•ä¼˜åŒ–æ€§èƒ½ã€‚</p><p>åœ¨å¼€å§‹ä¹‹å‰ï¼Œæˆ‘ä»¬å¾—å…ˆäº†è§£å››æ¬¡æŒ¥æ‰‹çŠ¶æ€å˜è¿çš„è¿‡ç¨‹ã€‚</p><p>å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯åŒæ–¹éƒ½å¯ä»¥ä¸»åŠ¨æ–­å¼€è¿æ¥ï¼Œ<strong>é€šå¸¸å…ˆå…³é—­è¿æ¥çš„ä¸€æ–¹ç§°ä¸ºä¸»åŠ¨æ–¹ï¼Œåå…³é—­è¿æ¥çš„ä¸€æ–¹ç§°ä¸ºè¢«åŠ¨æ–¹ã€‚</strong></p><figure><img src="'+Dn+'" alt="å®¢æˆ·ç«¯ä¸»åŠ¨å…³é—­" tabindex="0" loading="lazy"><figcaption>å®¢æˆ·ç«¯ä¸»åŠ¨å…³é—­</figcaption></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œ<strong>å››æ¬¡æŒ¥æ‰‹è¿‡ç¨‹åªæ¶‰åŠäº†ä¸¤ç§æŠ¥æ–‡ï¼Œåˆ†åˆ«æ˜¯ FIN å’Œ ACK</strong>ï¼š</p><ul><li>FIN å°±æ˜¯ç»“æŸè¿æ¥çš„æ„æ€ï¼Œè°å‘å‡º FIN æŠ¥æ–‡ï¼Œå°±è¡¨ç¤ºå®ƒå°†ä¸ä¼šå†å‘é€ä»»ä½•æ•°æ®ï¼Œå…³é—­è¿™ä¸€æ–¹å‘ä¸Šçš„ä¼ è¾“é€šé“ï¼›</li><li>ACK å°±æ˜¯ç¡®è®¤çš„æ„æ€ï¼Œç”¨æ¥é€šçŸ¥å¯¹æ–¹ï¼šä½ æ–¹çš„å‘é€é€šé“å·²ç»å…³é—­ï¼›</li></ul><p>å››æ¬¡æŒ¥æ‰‹çš„è¿‡ç¨‹:</p><ul><li>å½“ä¸»åŠ¨æ–¹å…³é—­è¿æ¥æ—¶ï¼Œä¼šå‘é€ FIN æŠ¥æ–‡ï¼Œæ­¤æ—¶å‘é€æ–¹çš„ TCP è¿æ¥å°†ä» ESTABLISHED å˜æˆ FIN_WAIT1ã€‚</li><li>å½“è¢«åŠ¨æ–¹æ”¶åˆ° FIN æŠ¥æ–‡åï¼Œå†…æ ¸ä¼šè‡ªåŠ¨å›å¤ ACK æŠ¥æ–‡ï¼Œè¿æ¥çŠ¶æ€å°†ä» ESTABLISHED å˜æˆ CLOSE_WAITï¼Œè¡¨ç¤ºè¢«åŠ¨æ–¹åœ¨ç­‰å¾…è¿›ç¨‹è°ƒç”¨ close å‡½æ•°å…³é—­è¿æ¥ã€‚</li><li>å½“ä¸»åŠ¨æ–¹æ”¶åˆ°è¿™ä¸ª ACK åï¼Œè¿æ¥çŠ¶æ€ç”± FIN_WAIT1 å˜ä¸º FIN_WAIT2ï¼Œä¹Ÿå°±æ˜¯è¡¨ç¤º<strong>ä¸»åŠ¨æ–¹çš„å‘é€é€šé“å°±å…³é—­äº†</strong>ã€‚</li><li>å½“è¢«åŠ¨æ–¹è¿›å…¥ CLOSE_WAIT æ—¶ï¼Œè¢«åŠ¨æ–¹è¿˜ä¼šç»§ç»­å¤„ç†æ•°æ®ï¼Œç­‰åˆ°è¿›ç¨‹çš„ read å‡½æ•°è¿”å› 0 åï¼Œåº”ç”¨ç¨‹åºå°±ä¼šè°ƒç”¨ close å‡½æ•°ï¼Œè¿›è€Œè§¦å‘å†…æ ¸å‘é€ FIN æŠ¥æ–‡ï¼Œæ­¤æ—¶è¢«åŠ¨æ–¹çš„è¿æ¥çŠ¶æ€å˜ä¸º LAST_ACKã€‚</li><li>å½“ä¸»åŠ¨æ–¹æ”¶åˆ°è¿™ä¸ª FIN æŠ¥æ–‡åï¼Œå†…æ ¸ä¼šå›å¤ ACK æŠ¥æ–‡ç»™è¢«åŠ¨æ–¹ï¼ŒåŒæ—¶ä¸»åŠ¨æ–¹çš„è¿æ¥çŠ¶æ€ç”± FIN_WAIT2 å˜ä¸º TIME_WAITï¼Œ<strong>åœ¨ Linux ç³»ç»Ÿä¸‹å¤§çº¦ç­‰å¾… 1 åˆ†é’Ÿåï¼ŒTIME_WAIT çŠ¶æ€çš„è¿æ¥æ‰ä¼šå½»åº•å…³é—­</strong>ã€‚</li><li>å½“è¢«åŠ¨æ–¹æ”¶åˆ°æœ€åçš„ ACK æŠ¥æ–‡åï¼Œ<strong>è¢«åŠ¨æ–¹çš„è¿æ¥å°±ä¼šå…³é—­</strong>ã€‚</li></ul><p>ä½ å¯ä»¥çœ‹åˆ°ï¼Œæ¯ä¸ªæ–¹å‘éƒ½éœ€è¦<strong>ä¸€ä¸ª FIN å’Œä¸€ä¸ª ACK</strong>ï¼Œå› æ­¤é€šå¸¸è¢«ç§°ä¸º<strong>å››æ¬¡æŒ¥æ‰‹</strong>ã€‚</p><p>è¿™é‡Œä¸€ç‚¹éœ€è¦æ³¨æ„æ˜¯ï¼š<strong>ä¸»åŠ¨å…³é—­è¿æ¥çš„ï¼Œæ‰æœ‰ TIME_WAIT çŠ¶æ€ã€‚</strong></p><p>ä¸»åŠ¨å…³é—­æ–¹å’Œè¢«åŠ¨å…³é—­æ–¹ä¼˜åŒ–çš„æ€è·¯ä¹Ÿä¸åŒï¼Œæ¥ä¸‹æ¥åˆ†åˆ«è¯´è¯´å¦‚ä½•ä¼˜åŒ–ä»–ä»¬ã€‚</p>',605),wi={id:"ä¸»åŠ¨æ–¹çš„ä¼˜åŒ–",tabindex:"-1"},Ki={class:"header-anchor",href:"#ä¸»åŠ¨æ–¹çš„ä¼˜åŒ–"},Di={href:"https://xiaolincoding.com/network/3_tcp/tcp_optimize.html#%E4%B8%BB%E5%8A%A8%E6%96%B9%E7%9A%84%E4%BC%98%E5%8C%96",target:"_blank",rel:"noopener noreferrer"},Mi=n('<p>å…³é—­è¿æ¥çš„æ–¹å¼é€šå¸¸æœ‰ä¸¤ç§ï¼Œåˆ†åˆ«æ˜¯ RST æŠ¥æ–‡å…³é—­å’Œ FIN æŠ¥æ–‡å…³é—­ã€‚</p><p>å¦‚æœè¿›ç¨‹æ”¶åˆ° RST æŠ¥æ–‡ï¼Œå°±ç›´æ¥å…³é—­è¿æ¥äº†ï¼Œä¸éœ€è¦èµ°å››æ¬¡æŒ¥æ‰‹æµç¨‹ï¼Œæ˜¯ä¸€ä¸ªæš´åŠ›å…³é—­è¿æ¥çš„æ–¹å¼ã€‚</p><p>å®‰å…¨å…³é—­è¿æ¥çš„æ–¹å¼å¿…é¡»é€šè¿‡å››æ¬¡æŒ¥æ‰‹ï¼Œå®ƒç”±è¿›ç¨‹è°ƒç”¨ <code>close</code> å’Œ <code>shutdown</code> å‡½æ•°å‘èµ· FIN æŠ¥æ–‡ï¼ˆshutdown å‚æ•°é¡»ä¼ å…¥ SHUT_WR æˆ–è€… SHUT_RDWR æ‰ä¼šå‘é€ FINï¼‰ã€‚</p><blockquote><p>è°ƒç”¨ close å‡½æ•°å’Œ shutdown å‡½æ•°æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</p></blockquote><p>è°ƒç”¨äº† close å‡½æ•°æ„å‘³ç€å®Œå…¨æ–­å¼€è¿æ¥ï¼Œ<strong>å®Œå…¨æ–­å¼€ä¸ä»…æŒ‡æ— æ³•ä¼ è¾“æ•°æ®ï¼Œè€Œä¸”ä¹Ÿä¸èƒ½å‘é€æ•°æ®ã€‚ æ­¤æ—¶ï¼Œè°ƒç”¨äº† close å‡½æ•°çš„ä¸€æ–¹çš„è¿æ¥å«åšã€Œå­¤å„¿è¿æ¥ã€ï¼Œå¦‚æœä½ ç”¨ netstat -p å‘½ä»¤ï¼Œä¼šå‘ç°è¿æ¥å¯¹åº”çš„è¿›ç¨‹åä¸ºç©ºã€‚</strong></p><p>ä½¿ç”¨ close å‡½æ•°å…³é—­è¿æ¥æ˜¯ä¸ä¼˜é›…çš„ã€‚äºæ˜¯ï¼Œå°±å‡ºç°äº†ä¸€ç§ä¼˜é›…å…³é—­è¿æ¥çš„ <code>shutdown</code> å‡½æ•°ï¼Œ<strong>å®ƒå¯ä»¥æ§åˆ¶åªå…³é—­ä¸€ä¸ªæ–¹å‘çš„è¿æ¥</strong>ï¼š</p><figure><img src="'+Mn+'" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><p>ç¬¬äºŒä¸ªå‚æ•°å†³å®šæ–­å¼€è¿æ¥çš„æ–¹å¼ï¼Œä¸»è¦æœ‰ä»¥ä¸‹ä¸‰ç§æ–¹å¼ï¼š</p><ul><li>SHUT_RD(0)ï¼š<strong>å…³é—­è¿æ¥çš„ã€Œè¯»ã€è¿™ä¸ªæ–¹å‘</strong>ï¼Œå¦‚æœæ¥æ”¶ç¼“å†²åŒºæœ‰å·²æ¥æ”¶çš„æ•°æ®ï¼Œåˆ™å°†ä¼šè¢«ä¸¢å¼ƒï¼Œå¹¶ä¸”åç»­å†æ”¶åˆ°æ–°çš„æ•°æ®ï¼Œä¼šå¯¹æ•°æ®è¿›è¡Œ ACKï¼Œç„¶åæ‚„æ‚„åœ°ä¸¢å¼ƒã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¯¹ç«¯è¿˜æ˜¯ä¼šæ¥æ”¶åˆ° ACKï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹æ ¹æœ¬ä¸çŸ¥é“æ•°æ®å·²ç»è¢«ä¸¢å¼ƒäº†ã€‚</li><li>SHUT_WR(1)ï¼š<strong>å…³é—­è¿æ¥çš„ã€Œå†™ã€è¿™ä¸ªæ–¹å‘</strong>ï¼Œè¿™å°±æ˜¯å¸¸è¢«ç§°ä¸ºã€ŒåŠå…³é—­ã€çš„è¿æ¥ã€‚å¦‚æœå‘é€ç¼“å†²åŒºè¿˜æœ‰æœªå‘é€çš„æ•°æ®ï¼Œå°†è¢«ç«‹å³å‘é€å‡ºå»ï¼Œå¹¶å‘é€ä¸€ä¸ª FIN æŠ¥æ–‡ç»™å¯¹ç«¯ã€‚</li><li>SHUT_RDWR(2)ï¼šç›¸å½“äº SHUT_RD å’Œ SHUT_WR æ“ä½œå„ä¸€æ¬¡ï¼Œ<strong>å…³é—­å¥—æ¥å­—çš„è¯»å’Œå†™ä¸¤ä¸ªæ–¹å‘</strong>ã€‚</li></ul><p>close å’Œ shutdown å‡½æ•°éƒ½å¯ä»¥å…³é—­è¿æ¥ï¼Œä½†è¿™ä¸¤ç§æ–¹å¼å…³é—­çš„è¿æ¥ï¼Œä¸åªåŠŸèƒ½ä¸Šæœ‰å·®å¼‚ï¼Œæ§åˆ¶å®ƒä»¬çš„ Linux å‚æ•°ä¹Ÿä¸ç›¸åŒã€‚</p><blockquote><p>FIN_WAIT1 çŠ¶æ€çš„ä¼˜åŒ–</p></blockquote><p>ä¸»åŠ¨æ–¹å‘é€ FIN æŠ¥æ–‡åï¼Œè¿æ¥å°±å¤„äº FIN_WAIT1 çŠ¶æ€ï¼Œæ­£å¸¸æƒ…å†µä¸‹ï¼Œå¦‚æœèƒ½åŠæ—¶æ”¶åˆ°è¢«åŠ¨æ–¹çš„ ACKï¼Œåˆ™ä¼šå¾ˆå¿«å˜ä¸º FIN_WAIT2 çŠ¶æ€ã€‚</p><p>ä½†æ˜¯å½“è¿Ÿè¿Ÿæ”¶ä¸åˆ°å¯¹æ–¹è¿”å›çš„ ACK æ—¶ï¼Œè¿æ¥å°±ä¼šä¸€ç›´å¤„äº FIN_WAIT1 çŠ¶æ€ã€‚æ­¤æ—¶ï¼Œ<strong>å†…æ ¸ä¼šå®šæ—¶é‡å‘ FIN æŠ¥æ–‡ï¼Œå…¶ä¸­é‡å‘æ¬¡æ•°ç”± tcp_orphan_retries å‚æ•°æ§åˆ¶</strong>ï¼ˆæ³¨æ„ï¼Œorphan è™½ç„¶æ˜¯å­¤å„¿çš„æ„æ€ï¼Œè¯¥å‚æ•°å´ä¸åªå¯¹å­¤å„¿è¿æ¥æœ‰æ•ˆï¼Œäº‹å®ä¸Šï¼Œå®ƒå¯¹æ‰€æœ‰ FIN_WAIT1 çŠ¶æ€ä¸‹çš„è¿æ¥éƒ½æœ‰æ•ˆï¼‰ï¼Œé»˜è®¤å€¼æ˜¯ 0ã€‚</p><figure><img src="'+Ln+'" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><p>ä½ å¯èƒ½ä¼šå¥½å¥‡ï¼Œè¿™ 0 è¡¨ç¤ºå‡ æ¬¡ï¼Ÿ<strong>å®é™…ä¸Šå½“ä¸º 0 æ—¶ï¼Œç‰¹æŒ‡ 8 æ¬¡</strong>ï¼Œä»ä¸‹é¢çš„å†…æ ¸æºç å¯çŸ¥ï¼š</p><figure><img src="'+Rn+'" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><p>å¦‚æœ FIN_WAIT1 çŠ¶æ€è¿æ¥å¾ˆå¤šï¼Œæˆ‘ä»¬å°±éœ€è¦è€ƒè™‘é™ä½ tcp_orphan_retries çš„å€¼ï¼Œå½“é‡ä¼ æ¬¡æ•°è¶…è¿‡ tcp_orphan_retries æ—¶ï¼Œè¿æ¥å°±ä¼šç›´æ¥å…³é—­æ‰ã€‚</p><p>å¯¹äºæ™®éæ­£å¸¸æƒ…å†µæ—¶ï¼Œè°ƒä½ tcp_orphan_retries å°±å·²ç»å¯ä»¥äº†ã€‚å¦‚æœé‡åˆ°æ¶æ„æ”»å‡»ï¼ŒFIN æŠ¥æ–‡æ ¹æœ¬æ— æ³•å‘é€å‡ºå»ï¼Œè¿™ç”± TCP ä¸¤ä¸ªç‰¹æ€§å¯¼è‡´çš„ï¼š</p><ul><li>é¦–å…ˆï¼ŒTCP å¿…é¡»ä¿è¯æŠ¥æ–‡æ˜¯æœ‰åºå‘é€çš„ï¼ŒFIN æŠ¥æ–‡ä¹Ÿä¸ä¾‹å¤–ï¼Œå½“å‘é€ç¼“å†²åŒºè¿˜æœ‰æ•°æ®æ²¡æœ‰å‘é€æ—¶ï¼ŒFIN æŠ¥æ–‡ä¹Ÿä¸èƒ½æå‰å‘é€ã€‚</li><li>å…¶æ¬¡ï¼ŒTCP æœ‰æµé‡æ§åˆ¶åŠŸèƒ½ï¼Œå½“æ¥æ”¶æ–¹æ¥æ”¶çª—å£ä¸º 0 æ—¶ï¼Œå‘é€æ–¹å°±ä¸èƒ½å†å‘é€æ•°æ®ã€‚æ‰€ä»¥ï¼Œå½“æ”»å‡»è€…ä¸‹è½½å¤§æ–‡ä»¶æ—¶ï¼Œå°±å¯ä»¥é€šè¿‡æ¥æ”¶çª—å£è®¾ä¸º 0 ï¼Œè¿™å°±ä¼šä½¿å¾— FIN æŠ¥æ–‡éƒ½æ— æ³•å‘é€å‡ºå»ï¼Œé‚£ä¹ˆè¿æ¥ä¼šä¸€ç›´å¤„äº FIN_WAIT1 çŠ¶æ€ã€‚</li></ul><p>è§£å†³è¿™ç§é—®é¢˜çš„æ–¹æ³•ï¼Œæ˜¯<strong>è°ƒæ•´ tcp_max_orphans å‚æ•°ï¼Œå®ƒå®šä¹‰äº†ã€Œå­¤å„¿è¿æ¥ã€çš„æœ€å¤§æ•°é‡</strong>ï¼š</p><figure><img src="'+Yn+'" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><p>å½“è¿›ç¨‹è°ƒç”¨äº† <code>close</code> å‡½æ•°å…³é—­è¿æ¥ï¼Œæ­¤æ—¶è¿æ¥å°±ä¼šæ˜¯ã€Œå­¤å„¿è¿æ¥ã€ï¼Œå› ä¸ºå®ƒæ— æ³•å†å‘é€å’Œæ¥æ”¶æ•°æ®ã€‚Linux ç³»ç»Ÿä¸ºäº†é˜²æ­¢å­¤å„¿è¿æ¥è¿‡å¤šï¼Œå¯¼è‡´ç³»ç»Ÿèµ„æºé•¿æ—¶é—´è¢«å ç”¨ï¼Œå°±æä¾›äº† <code>tcp_max_orphans</code> å‚æ•°ã€‚å¦‚æœå­¤å„¿è¿æ¥æ•°é‡å¤§äºå®ƒï¼Œæ–°å¢çš„å­¤å„¿è¿æ¥å°†ä¸å†èµ°å››æ¬¡æŒ¥æ‰‹ï¼Œè€Œæ˜¯ç›´æ¥å‘é€ RST å¤ä½æŠ¥æ–‡å¼ºåˆ¶å…³é—­ã€‚</p><blockquote><p>FIN_WAIT2 çŠ¶æ€çš„ä¼˜åŒ–</p></blockquote><p>å½“ä¸»åŠ¨æ–¹æ”¶åˆ° ACK æŠ¥æ–‡åï¼Œä¼šå¤„äº FIN_WAIT2 çŠ¶æ€ï¼Œå°±è¡¨ç¤ºä¸»åŠ¨æ–¹çš„å‘é€é€šé“å·²ç»å…³é—­ï¼Œæ¥ä¸‹æ¥å°†ç­‰å¾…å¯¹æ–¹å‘é€ FIN æŠ¥æ–‡ï¼Œå…³é—­å¯¹æ–¹çš„å‘é€é€šé“ã€‚</p><p>è¿™æ—¶ï¼Œ<strong>å¦‚æœè¿æ¥æ˜¯ç”¨ shutdown å‡½æ•°å…³é—­çš„ï¼Œè¿æ¥å¯ä»¥ä¸€ç›´å¤„äº FIN_WAIT2 çŠ¶æ€ï¼Œå› ä¸ºå®ƒå¯èƒ½è¿˜å¯ä»¥å‘é€æˆ–æ¥æ”¶æ•°æ®ã€‚ä½†å¯¹äº close å‡½æ•°å…³é—­çš„å­¤å„¿è¿æ¥ï¼Œç”±äºæ— æ³•å†å‘é€å’Œæ¥æ”¶æ•°æ®ï¼Œæ‰€ä»¥è¿™ä¸ªçŠ¶æ€ä¸å¯ä»¥æŒç»­å¤ªä¹…ï¼Œè€Œ tcp_fin_timeout æ§åˆ¶äº†è¿™ä¸ªçŠ¶æ€ä¸‹è¿æ¥çš„æŒç»­æ—¶é•¿</strong>ï¼Œé»˜è®¤å€¼æ˜¯ 60 ç§’ï¼š</p><figure><img src="'+Un+'" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><p>å®ƒæ„å‘³ç€å¯¹äºå­¤å„¿è¿æ¥ï¼ˆè°ƒç”¨ close å…³é—­çš„è¿æ¥ï¼‰ï¼Œå¦‚æœåœ¨ 60 ç§’åè¿˜æ²¡æœ‰æ”¶åˆ° FIN æŠ¥æ–‡ï¼Œè¿æ¥å°±ä¼šç›´æ¥å…³é—­ã€‚</p><p>è¿™ä¸ª 60 ç§’ä¸æ˜¯éšä¾¿å†³å®šçš„ï¼Œå®ƒä¸ TIME_WAIT çŠ¶æ€æŒç»­çš„æ—¶é—´æ˜¯ç›¸åŒçš„ï¼Œåé¢æˆ‘ä»¬å†æ¥è¯´è¯´ä¸ºä»€ä¹ˆæ˜¯ 60 ç§’ã€‚</p><blockquote><p>TIME_WAIT çŠ¶æ€çš„ä¼˜åŒ–</p></blockquote><p>TIME_WAIT æ˜¯ä¸»åŠ¨æ–¹å››æ¬¡æŒ¥æ‰‹çš„æœ€åä¸€ä¸ªçŠ¶æ€ï¼Œä¹Ÿæ˜¯æœ€å¸¸é‡è§çš„çŠ¶æ€ã€‚</p><p>å½“æ”¶åˆ°è¢«åŠ¨æ–¹å‘æ¥çš„ FIN æŠ¥æ–‡åï¼Œä¸»åŠ¨æ–¹ä¼šç«‹åˆ»å›å¤ ACKï¼Œè¡¨ç¤ºç¡®è®¤å¯¹æ–¹çš„å‘é€é€šé“å·²ç»å…³é—­ï¼Œæ¥ç€å°±å¤„äº TIME_WAIT çŠ¶æ€ã€‚åœ¨ Linux ç³»ç»Ÿï¼ŒTIME_WAIT çŠ¶æ€ä¼šæŒç»­ 60 ç§’åæ‰ä¼šè¿›å…¥å…³é—­çŠ¶æ€ã€‚</p><p>TIME_WAIT çŠ¶æ€çš„è¿æ¥ï¼Œåœ¨ä¸»åŠ¨æ–¹çœ‹æ¥ç¡®å®å¿«å·²ç»å…³é—­äº†ã€‚ç„¶åï¼Œè¢«åŠ¨æ–¹æ²¡æœ‰æ”¶åˆ° ACK æŠ¥æ–‡å‰ï¼Œè¿˜æ˜¯å¤„äº LAST_ACK çŠ¶æ€ã€‚å¦‚æœè¿™ä¸ª ACK æŠ¥æ–‡æ²¡æœ‰åˆ°è¾¾è¢«åŠ¨æ–¹ï¼Œè¢«åŠ¨æ–¹å°±ä¼šé‡å‘ FIN æŠ¥æ–‡ã€‚é‡å‘æ¬¡æ•°ä»ç„¶ç”±å‰é¢ä»‹ç»è¿‡çš„ tcp_orphan_retries å‚æ•°æ§åˆ¶ã€‚</p><p>TIME-WAIT çš„çŠ¶æ€å°¤å…¶é‡è¦ï¼Œä¸»è¦æ˜¯ä¸¤ä¸ªåŸå› ï¼š</p><ul><li>é˜²æ­¢å†å²è¿æ¥ä¸­çš„æ•°æ®ï¼Œè¢«åé¢ç›¸åŒå››å…ƒç»„çš„è¿æ¥é”™è¯¯çš„æ¥æ”¶ï¼›</li><li>ä¿è¯ã€Œè¢«åŠ¨å…³é—­è¿æ¥ã€çš„ä¸€æ–¹ï¼Œèƒ½è¢«æ­£ç¡®çš„å…³é—­ï¼›</li></ul><p><em>åŸå› ä¸€ï¼šé˜²æ­¢å†å²è¿æ¥ä¸­çš„æ•°æ®ï¼Œè¢«åé¢ç›¸åŒå››å…ƒç»„çš„è¿æ¥é”™è¯¯çš„æ¥æ”¶</em></p><p>TIME-WAIT çš„ä¸€ä¸ªä½œç”¨æ˜¯<strong>é˜²æ­¢æ”¶åˆ°å†å²æ•°æ®ï¼Œä»è€Œå¯¼è‡´æ•°æ®é”™ä¹±çš„é—®é¢˜ã€‚</strong></p><p>å‡è®¾ TIME-WAIT æ²¡æœ‰ç­‰å¾…æ—¶é—´æˆ–æ—¶é—´è¿‡çŸ­ï¼Œè¢«å»¶è¿Ÿçš„æ•°æ®åŒ…æŠµè¾¾åä¼šå‘ç”Ÿä»€ä¹ˆå‘¢ï¼Ÿ</p><figure><img src="'+Fn+'" alt="TIME-WAIT æ—¶é—´è¿‡çŸ­ï¼Œæ”¶åˆ°æ—§è¿æ¥çš„æ•°æ®æŠ¥æ–‡" tabindex="0" loading="lazy"><figcaption>TIME-WAIT æ—¶é—´è¿‡çŸ­ï¼Œæ”¶åˆ°æ—§è¿æ¥çš„æ•°æ®æŠ¥æ–‡</figcaption></figure><ul><li>å¦‚ä¸Šå›¾ï¼š <ul><li>æœåŠ¡ç«¯åœ¨å…³é—­è¿æ¥ä¹‹å‰å‘é€çš„ <code>SEQ = 301</code> æŠ¥æ–‡ï¼Œè¢«ç½‘ç»œå»¶è¿Ÿäº†ã€‚</li><li>æ¥ç€ï¼ŒæœåŠ¡ç«¯ä»¥ç›¸åŒçš„å››å…ƒç»„é‡æ–°æ‰“å¼€äº†æ–°è¿æ¥ï¼Œå‰é¢è¢«å»¶è¿Ÿçš„ <code>SEQ = 301</code> è¿™æ—¶æŠµè¾¾äº†å®¢æˆ·ç«¯ï¼Œè€Œä¸”è¯¥æ•°æ®æŠ¥æ–‡çš„åºåˆ—å·åˆšå¥½åœ¨å®¢æˆ·ç«¯æ¥æ”¶çª—å£å†…ï¼Œå› æ­¤å®¢æˆ·ç«¯ä¼šæ­£å¸¸æ¥æ”¶è¿™ä¸ªæ•°æ®æŠ¥æ–‡ï¼Œä½†æ˜¯è¿™ä¸ªæ•°æ®æŠ¥æ–‡æ˜¯ä¸Šä¸€ä¸ªè¿æ¥æ®‹ç•™ä¸‹æ¥çš„ï¼Œè¿™æ ·å°±äº§ç”Ÿæ•°æ®é”™ä¹±ç­‰ä¸¥é‡çš„é—®é¢˜ã€‚</li></ul></li></ul><p>ä¸ºäº†é˜²æ­¢å†å²è¿æ¥ä¸­çš„æ•°æ®ï¼Œè¢«åé¢ç›¸åŒå››å…ƒç»„çš„è¿æ¥é”™è¯¯çš„æ¥æ”¶ï¼Œå› æ­¤ TCP è®¾è®¡äº† TIME_WAIT çŠ¶æ€ï¼ŒçŠ¶æ€ä¼šæŒç»­ <code>2MSL</code> æ—¶é•¿ï¼Œè¿™ä¸ªæ—¶é—´<strong>è¶³ä»¥è®©ä¸¤ä¸ªæ–¹å‘ä¸Šçš„æ•°æ®åŒ…éƒ½è¢«ä¸¢å¼ƒï¼Œä½¿å¾—åŸæ¥è¿æ¥çš„æ•°æ®åŒ…åœ¨ç½‘ç»œä¸­éƒ½è‡ªç„¶æ¶ˆå¤±ï¼Œå†å‡ºç°çš„æ•°æ®åŒ…ä¸€å®šéƒ½æ˜¯æ–°å»ºç«‹è¿æ¥æ‰€äº§ç”Ÿçš„ã€‚</strong></p><p><em>åŸå› äºŒï¼šä¿è¯ã€Œè¢«åŠ¨å…³é—­è¿æ¥ã€çš„ä¸€æ–¹ï¼Œèƒ½è¢«æ­£ç¡®çš„å…³é—­</em></p><p>åœ¨ RFC 793 æŒ‡å‡º TIME-WAIT å¦ä¸€ä¸ªé‡è¦çš„ä½œç”¨æ˜¯ï¼š</p><p><em>TIME-WAIT - represents waiting for enough time to pass to be sure the remote TCP received the acknowledgment of its connection termination request.</em></p><p>ä¹Ÿå°±æ˜¯è¯´ï¼ŒTIME-WAIT ä½œç”¨æ˜¯<strong>ç­‰å¾…è¶³å¤Ÿçš„æ—¶é—´ä»¥ç¡®ä¿æœ€åçš„ ACK èƒ½è®©è¢«åŠ¨å…³é—­æ–¹æ¥æ”¶ï¼Œä»è€Œå¸®åŠ©å…¶æ­£å¸¸å…³é—­ã€‚</strong></p><p>å¦‚æœå®¢æˆ·ç«¯ï¼ˆä¸»åŠ¨å…³é—­æ–¹ï¼‰æœ€åä¸€æ¬¡ ACK æŠ¥æ–‡ï¼ˆç¬¬å››æ¬¡æŒ¥æ‰‹ï¼‰åœ¨ç½‘ç»œä¸­ä¸¢å¤±äº†ï¼Œé‚£ä¹ˆæŒ‰ç…§ TCP å¯é æ€§åŸåˆ™ï¼ŒæœåŠ¡ç«¯ï¼ˆè¢«åŠ¨å…³é—­æ–¹ï¼‰ä¼šé‡å‘ FIN æŠ¥æ–‡ã€‚</p><p>å‡è®¾å®¢æˆ·ç«¯æ²¡æœ‰ TIME_WAIT çŠ¶æ€ï¼Œè€Œæ˜¯åœ¨å‘å®Œæœ€åä¸€æ¬¡å› ACK æŠ¥æ–‡å°±ç›´æ¥è¿›å…¥ CLOSED çŠ¶æ€ï¼Œå¦‚æœè¯¥ ACK æŠ¥æ–‡ä¸¢å¤±äº†ï¼ŒæœåŠ¡ç«¯åˆ™é‡ä¼ çš„ FIN æŠ¥æ–‡ï¼Œè€Œè¿™æ—¶å®¢æˆ·ç«¯å·²ç»è¿›å…¥åˆ°å…³é—­çŠ¶æ€äº†ï¼Œåœ¨æ”¶åˆ°æœåŠ¡ç«¯é‡ä¼ çš„ FIN æŠ¥æ–‡åï¼Œå°±ä¼šå› RST æŠ¥æ–‡ã€‚</p><figure><img src="'+jn+'" alt="TIME-WAIT æ—¶é—´è¿‡çŸ­ï¼Œæ²¡æœ‰ç¡®ä¿è¿æ¥æ­£å¸¸å…³é—­" tabindex="0" loading="lazy"><figcaption>TIME-WAIT æ—¶é—´è¿‡çŸ­ï¼Œæ²¡æœ‰ç¡®ä¿è¿æ¥æ­£å¸¸å…³é—­</figcaption></figure><p>æœåŠ¡ç«¯æ”¶åˆ°è¿™ä¸ª RST å¹¶å°†å…¶è§£é‡Šä¸ºä¸€ä¸ªé”™è¯¯ï¼ˆConnection reset by peerï¼‰ï¼Œè¿™å¯¹äºä¸€ä¸ªå¯é çš„åè®®æ¥è¯´ä¸æ˜¯ä¸€ä¸ªä¼˜é›…çš„ç»ˆæ­¢æ–¹å¼ã€‚</p><p>ä¸ºäº†é˜²æ­¢è¿™ç§æƒ…å†µå‡ºç°ï¼Œå®¢æˆ·ç«¯å¿…é¡»ç­‰å¾…è¶³å¤Ÿé•¿çš„æ—¶é—´ï¼Œç¡®ä¿æœåŠ¡ç«¯èƒ½å¤Ÿæ”¶åˆ° ACKï¼Œå¦‚æœæœåŠ¡ç«¯æ²¡æœ‰æ”¶åˆ° ACKï¼Œé‚£ä¹ˆå°±ä¼šè§¦å‘ TCP é‡ä¼ æœºåˆ¶ï¼ŒæœåŠ¡ç«¯ä¼šé‡æ–°å‘é€ä¸€ä¸ª FINï¼Œè¿™æ ·ä¸€å»ä¸€æ¥åˆšå¥½ä¸¤ä¸ª MSL çš„æ—¶é—´ã€‚</p><figure><img src="'+Wn+'" alt="TIME-WAIT æ—¶é—´æ­£å¸¸ï¼Œç¡®ä¿äº†è¿æ¥æ­£å¸¸å…³é—­" tabindex="0" loading="lazy"><figcaption>TIME-WAIT æ—¶é—´æ­£å¸¸ï¼Œç¡®ä¿äº†è¿æ¥æ­£å¸¸å…³é—­</figcaption></figure><p>å®¢æˆ·ç«¯åœ¨æ”¶åˆ°æœåŠ¡ç«¯é‡ä¼ çš„ FIN æŠ¥æ–‡æ—¶ï¼ŒTIME_WAIT çŠ¶æ€çš„ç­‰å¾…æ—¶é—´ï¼Œä¼šé‡ç½®å› 2MSLã€‚</p><p>æˆ‘ä»¬å†å›è¿‡å¤´æ¥çœ‹çœ‹ï¼Œä¸ºä»€ä¹ˆ TIME_WAIT çŠ¶æ€è¦ä¿æŒ 60 ç§’å‘¢ï¼Ÿ</p><p>è¿™ä¸å­¤å„¿è¿æ¥ FIN_WAIT2 çŠ¶æ€é»˜è®¤ä¿ç•™ 60 ç§’çš„åŸç†æ˜¯ä¸€æ ·çš„ï¼Œ<strong>å› ä¸ºè¿™ä¸¤ä¸ªçŠ¶æ€éƒ½éœ€è¦ä¿æŒ 2MSL æ—¶é•¿ã€‚MSL å…¨ç§°æ˜¯ Maximum Segment Lifetimeï¼Œå®ƒå®šä¹‰äº†ä¸€ä¸ªæŠ¥æ–‡åœ¨ç½‘ç»œä¸­çš„æœ€é•¿ç”Ÿå­˜æ—¶é—´</strong>ï¼ˆæŠ¥æ–‡æ¯ç»è¿‡ä¸€æ¬¡è·¯ç”±å™¨çš„è½¬å‘ï¼ŒIP å¤´éƒ¨çš„ TTL å­—æ®µå°±ä¼šå‡ 1ï¼Œå‡åˆ° 0 æ—¶æŠ¥æ–‡å°±è¢«ä¸¢å¼ƒï¼Œè¿™å°±é™åˆ¶äº†æŠ¥æ–‡çš„æœ€é•¿å­˜æ´»æ—¶é—´ï¼‰ã€‚</p><p>ä¸ºä»€ä¹ˆæ˜¯ 2 MSL çš„æ—¶é•¿å‘¢ï¼Ÿè¿™å…¶å®æ˜¯ç›¸å½“äº<strong>è‡³å°‘å…è®¸æŠ¥æ–‡ä¸¢å¤±ä¸€æ¬¡</strong>ã€‚æ¯”å¦‚ï¼Œè‹¥ ACK åœ¨ä¸€ä¸ª MSL å†…ä¸¢å¤±ï¼Œè¿™æ ·è¢«åŠ¨æ–¹é‡å‘çš„ FIN ä¼šåœ¨ç¬¬ 2 ä¸ª MSL å†…åˆ°è¾¾ï¼ŒTIME_WAIT çŠ¶æ€çš„è¿æ¥å¯ä»¥åº”å¯¹ã€‚</p><p>ä¸ºä»€ä¹ˆä¸æ˜¯ 4 æˆ–è€… 8 MSL çš„æ—¶é•¿å‘¢ï¼Ÿä½ å¯ä»¥æƒ³è±¡ä¸€ä¸ªä¸¢åŒ…ç‡è¾¾åˆ°ç™¾åˆ†ä¹‹ä¸€çš„ç³Ÿç³•ç½‘ç»œï¼Œè¿ç»­ä¸¤æ¬¡ä¸¢åŒ…çš„æ¦‚ç‡åªæœ‰ä¸‡åˆ†ä¹‹ä¸€ï¼Œè¿™ä¸ªæ¦‚ç‡å®åœ¨æ˜¯å¤ªå°äº†ï¼Œå¿½ç•¥å®ƒæ¯”è§£å†³å®ƒæ›´å…·æ€§ä»·æ¯”ã€‚</p><p><strong>å› æ­¤ï¼ŒTIME_WAIT å’Œ FIN_WAIT2 çŠ¶æ€çš„æœ€å¤§æ—¶é•¿éƒ½æ˜¯ 2 MSLï¼Œç”±äºåœ¨ Linux ç³»ç»Ÿä¸­ï¼ŒMSL çš„å€¼å›ºå®šä¸º 30 ç§’ï¼Œæ‰€ä»¥å®ƒä»¬éƒ½æ˜¯ 60 ç§’ã€‚</strong></p><blockquote><p>TIME_WAIT çŠ¶æ€ä¼˜åŒ–æ–¹å¼ä¸€</p></blockquote><p><strong>Linux æä¾›äº† tcp_max_tw_buckets å‚æ•°ï¼Œå½“ TIME_WAIT çš„è¿æ¥æ•°é‡è¶…è¿‡è¯¥å‚æ•°æ—¶ï¼Œæ–°å…³é—­çš„è¿æ¥å°±ä¸å†ç»å† TIME_WAIT è€Œç›´æ¥å…³é—­ï¼š</strong></p><figure><img src="'+Bn+'" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><p>å½“æœåŠ¡å™¨çš„å¹¶å‘è¿æ¥å¢å¤šæ—¶ï¼Œç›¸åº”åœ°ï¼ŒåŒæ—¶å¤„äº TIME_WAIT çŠ¶æ€çš„è¿æ¥æ•°é‡ä¹Ÿä¼šå˜å¤šï¼Œæ­¤æ—¶å°±åº”å½“è°ƒå¤§ <code>tcp_max_tw_buckets</code> å‚æ•°ï¼Œå‡å°‘ä¸åŒè¿æ¥é—´æ•°æ®é”™ä¹±çš„æ¦‚ç‡ã€‚tcp_max_tw_buckets ä¹Ÿä¸æ˜¯è¶Šå¤§è¶Šå¥½ï¼Œæ¯•ç«Ÿç³»ç»Ÿèµ„æºæ˜¯æœ‰é™çš„ã€‚</p><blockquote><p>TIME_WAIT çŠ¶æ€ä¼˜åŒ–æ–¹å¼äºŒ</p></blockquote><p><strong>æœ‰ä¸€ç§æ–¹å¼å¯ä»¥åœ¨å»ºç«‹æ–°è¿æ¥æ—¶ï¼Œå¤ç”¨å¤„äº TIME_WAIT çŠ¶æ€çš„è¿æ¥ï¼Œé‚£å°±æ˜¯æ‰“å¼€ tcp_tw_reuse å‚æ•°ã€‚ä½†æ˜¯éœ€è¦æ³¨æ„ï¼Œè¯¥å‚æ•°æ˜¯åªç”¨äºå®¢æˆ·ç«¯ï¼ˆå»ºç«‹è¿æ¥çš„å‘èµ·æ–¹ï¼‰ï¼Œå› ä¸ºæ˜¯åœ¨è°ƒç”¨ connect() æ—¶èµ·ä½œç”¨çš„ï¼Œè€Œå¯¹äºæœåŠ¡ç«¯ï¼ˆè¢«åŠ¨è¿æ¥æ–¹ï¼‰æ˜¯æ²¡æœ‰ç”¨çš„ã€‚</strong></p><figure><img src="'+On+'" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><p>ç½‘ä¸Šå¾ˆå¤šåšå®¢éƒ½è¯´åœ¨æœåŠ¡ç«¯å¼€å¯ tcp_tw_reuse å‚æ•°æ¥ä¼˜åŒ– TCPï¼Œæˆ‘ä¿¡ä½ ä¸ªé¬¼ï¼Œç³Ÿè€å¤´åçš„å¾ˆï¼<strong>tcp_tw_reuse åªä½œç”¨åœ¨ connect å‡½æ•°ï¼Œä¹Ÿå°±æ˜¯å®¢æˆ·ç«¯ï¼Œè·ŸæœåŠ¡ç«¯ä¸€æ¯›å…³ç³»çš„æ²¡æœ‰</strong>ã€‚</p><p>tcp_tw_reuse ä»åè®®è§’åº¦ç†è§£æ˜¯å®‰å…¨å¯æ§çš„ï¼Œå¯ä»¥å¤ç”¨å¤„äº TIME_WAIT çš„ç«¯å£ä¸ºæ–°çš„è¿æ¥æ‰€ç”¨ã€‚</p><p>ä»€ä¹ˆæ˜¯åè®®è§’åº¦ç†è§£çš„å®‰å…¨å¯æ§å‘¢ï¼Ÿä¸»è¦æœ‰ä¸¤ç‚¹ï¼š</p><ul><li>åªé€‚ç”¨äºè¿æ¥å‘èµ·æ–¹ï¼Œä¹Ÿå°±æ˜¯ C/S æ¨¡å‹ä¸­çš„å®¢æˆ·ç«¯ï¼›</li><li>å¯¹åº”çš„ TIME_WAIT çŠ¶æ€çš„è¿æ¥åˆ›å»ºæ—¶é—´è¶…è¿‡ 1 ç§’æ‰å¯ä»¥è¢«å¤ç”¨ã€‚</li></ul><p>ä½¿ç”¨è¿™ä¸ªé€‰é¡¹ï¼Œè¿˜æœ‰ä¸€ä¸ªå‰æï¼Œéœ€è¦æ‰“å¼€å¯¹ TCP æ—¶é—´æˆ³çš„æ”¯æŒï¼ˆå¯¹æ–¹ä¹Ÿè¦æ‰“å¼€ ï¼‰ï¼š</p><figure><img src="'+Qn+'" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><p>ç”±äºå¼•å…¥äº†æ—¶é—´æˆ³ï¼Œå®ƒèƒ½å¸¦æ¥äº†äº›å¥½å¤„ï¼š</p><ul><li>æˆ‘ä»¬åœ¨å‰é¢æåˆ°çš„ 2MSLï¼ˆTIME_WAITçŠ¶æ€çš„æŒç»­æ—¶é—´ï¼‰ é—®é¢˜å°±ä¸å¤å­˜åœ¨äº†ï¼Œå› ä¸ºé‡å¤çš„æ•°æ®åŒ…ä¼šå› ä¸ºæ—¶é—´æˆ³è¿‡æœŸè¢«è‡ªç„¶ä¸¢å¼ƒï¼›</li><li>åŒæ—¶ï¼Œå®ƒè¿˜å¯ä»¥é˜²æ­¢åºåˆ—å·ç»•å›ï¼Œä¹Ÿæ˜¯å› ä¸ºé‡å¤çš„æ•°æ®åŒ…ä¼šç”±äºæ—¶é—´æˆ³è¿‡æœŸè¢«è‡ªç„¶ä¸¢å¼ƒï¼›</li></ul><p>æ—¶é—´æˆ³æ˜¯åœ¨ TCP çš„é€‰é¡¹å­—æ®µé‡Œå®šä¹‰çš„ï¼Œå¼€å¯äº†æ—¶é—´æˆ³åŠŸèƒ½ï¼Œåœ¨ TCP æŠ¥æ–‡ä¼ è¾“çš„æ—¶å€™ä¼šå¸¦ä¸Šå‘é€æŠ¥æ–‡çš„æ—¶é—´æˆ³ã€‚</p><p>![TCP option å­—æ®µ - æ—¶é—´æˆ³](../../.vuepress/public/assets/mdimages/TCP optionå­—æ®µ-æ—¶é—´æˆ³.png)</p><p>å¦å¤–ï¼Œè€ç‰ˆæœ¬çš„ Linux è¿˜æä¾›äº† <code>tcp_tw_recycle</code> å‚æ•°ï¼Œä½†æ˜¯å½“å¼€å¯äº†å®ƒï¼Œå…è®¸å¤„äº TIME_WAIT çŠ¶æ€çš„è¿æ¥è¢«å¿«é€Ÿå›æ”¶ï¼Œä½†æ˜¯æœ‰ä¸ª<strong>å¤§å‘</strong>ã€‚</p><p>å¼€å¯äº† recycle å’Œ timestamps é€‰é¡¹ï¼Œå°±ä¼šå¼€å¯ä¸€ç§å« per-host çš„ PAWSï¼ˆåˆ¤æ–­TCP æŠ¥æ–‡ä¸­æ—¶é—´æˆ³æ˜¯å¦æ˜¯å†å²æŠ¥æ–‡ï¼‰ æœºåˆ¶ï¼Œ<strong>per-host æ˜¯å¯¹ã€Œå¯¹ç«¯ IP åš PAWS æ£€æŸ¥ã€</strong>ï¼Œè€Œéå¯¹ã€ŒIP + ç«¯å£ã€å››å…ƒç»„åš PAWS æ£€æŸ¥ã€‚</p><p>å¦‚æœå®¢æˆ·ç«¯ç½‘ç»œç¯å¢ƒæ˜¯ç”¨äº† NAT ç½‘å…³ï¼Œé‚£ä¹ˆå®¢æˆ·ç«¯ç¯å¢ƒçš„æ¯ä¸€å°æœºå™¨é€šè¿‡ NAT ç½‘å…³åï¼Œéƒ½ä¼šæ˜¯ç›¸åŒçš„ IP åœ°å€ï¼Œåœ¨æœåŠ¡ç«¯çœ‹æ¥ï¼Œå°±å¥½åƒåªæ˜¯åœ¨è·Ÿä¸€ä¸ªå®¢æˆ·ç«¯æ‰“äº¤é“ä¸€æ ·ï¼Œæ— æ³•åŒºåˆ†å‡ºæ¥ã€‚</p><p>Per-host PAWS æœºåˆ¶åˆ©ç”¨ TCP option é‡Œçš„ timestamp å­—æ®µçš„å¢é•¿æ¥åˆ¤æ–­ä¸²æ‰°æ•°æ®ï¼Œè€Œ timestamp æ˜¯æ ¹æ®å®¢æˆ·ç«¯å„è‡ªçš„ CPU tick å¾—å‡ºçš„å€¼ã€‚</p><p>å½“å®¢æˆ·ç«¯ A é€šè¿‡ NAT ç½‘å…³å’ŒæœåŠ¡å™¨å»ºç«‹ TCP è¿æ¥ï¼Œç„¶åæœåŠ¡å™¨ä¸»åŠ¨å…³é—­å¹¶ä¸”å¿«é€Ÿå›æ”¶ TIME-WAIT çŠ¶æ€çš„è¿æ¥åï¼Œ<strong>å®¢æˆ·ç«¯ B ä¹Ÿé€šè¿‡ NAT ç½‘å…³å’ŒæœåŠ¡å™¨å»ºç«‹ TCP è¿æ¥ï¼Œæ³¨æ„å®¢æˆ·ç«¯ A å’Œ å®¢æˆ·ç«¯ B å› ä¸ºç»è¿‡ç›¸åŒçš„ NAT ç½‘å…³ï¼Œæ‰€ä»¥æ˜¯ç”¨ç›¸åŒçš„ IP åœ°å€ä¸æœåŠ¡ç«¯å»ºç«‹ TCP è¿æ¥ï¼Œå¦‚æœå®¢æˆ·ç«¯ B çš„ timestamp æ¯” å®¢æˆ·ç«¯ A çš„ timestamp å°ï¼Œé‚£ä¹ˆç”±äºæœåŠ¡ç«¯çš„ per-host çš„ PAWS æœºåˆ¶çš„ä½œç”¨ï¼ŒæœåŠ¡ç«¯å°±ä¼šä¸¢å¼ƒå®¢æˆ·ç«¯ä¸»æœº B å‘æ¥çš„ SYN åŒ…</strong>ã€‚</p><p>å› æ­¤ï¼Œtcp_tw_recycle åœ¨ä½¿ç”¨äº† NAT çš„ç½‘ç»œä¸‹æ˜¯å­˜åœ¨é—®é¢˜çš„ï¼Œå¦‚æœå®ƒæ˜¯å¯¹ TCP å››å…ƒç»„åš PAWS æ£€æŸ¥ï¼Œè€Œä¸æ˜¯å¯¹ã€Œç›¸åŒçš„ IP åš PAWS æ£€æŸ¥ã€ï¼Œé‚£ä¹ˆå°±ä¸ä¼šå­˜åœ¨è¿™ä¸ªé—®é¢˜äº†ã€‚</p><p>ç½‘ä¸Šå¾ˆå¤šåšå®¢éƒ½è¯´å¼€å¯ tcp_tw_recycle å‚æ•°æ¥ä¼˜åŒ– TCPï¼Œæˆ‘ä¿¡ä½ ä¸ªé¬¼ï¼Œç³Ÿè€å¤´åçš„å¾ˆï¼</p><p>æ‰€ä»¥ï¼Œä¸å»ºè®®è®¾ç½®ä¸º 1 ï¼Œåœ¨ Linux 4.12 ç‰ˆæœ¬åï¼ŒLinux å†…æ ¸ç›´æ¥å–æ¶ˆäº†è¿™ä¸€å‚æ•°ï¼Œå»ºè®®å…³é—­å®ƒï¼š</p><figure><img src="'+Gn+'" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><blockquote><p>TIME_WAIT çŠ¶æ€ä¼˜åŒ–æ–¹å¼ä¸‰</p></blockquote><p>æˆ‘ä»¬å¯ä»¥åœ¨ç¨‹åºä¸­è®¾ç½® socket é€‰é¡¹ï¼Œæ¥è®¾ç½®è°ƒç”¨ close å…³é—­è¿æ¥è¡Œä¸ºã€‚</p><figure><img src="'+Vn+'" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><p>å¦‚æœ <code>l_onoff</code> ä¸ºé 0ï¼Œ ä¸” <code>l_linger</code> å€¼ä¸º 0ï¼Œ<strong>é‚£ä¹ˆè°ƒç”¨ close åï¼Œä¼šç«‹è¯¥å‘é€ä¸€ä¸ª RST æ ‡å¿—ç»™å¯¹ç«¯ï¼Œè¯¥ TCP è¿æ¥å°†è·³è¿‡å››æ¬¡æŒ¥æ‰‹ï¼Œä¹Ÿå°±è·³è¿‡äº† TIME_WAIT çŠ¶æ€ï¼Œç›´æ¥å…³é—­ã€‚</strong></p><p>è¿™ç§æ–¹å¼åªæ¨èåœ¨å®¢æˆ·ç«¯ä½¿ç”¨ï¼ŒæœåŠ¡ç«¯åƒä¸‡ä¸è¦ä½¿ç”¨ã€‚å› ä¸ºæœåŠ¡ç«¯ä¸€è°ƒç”¨ closeï¼Œå°±å‘é€ RST æŠ¥æ–‡çš„è¯ï¼Œå®¢æˆ·ç«¯å°±æ€»æ˜¯çœ‹åˆ° TCP è¿æ¥é”™è¯¯ â€œconnnection reset by peerâ€ã€‚</p>',87),Li={id:"è¢«åŠ¨æ–¹çš„ä¼˜åŒ–",tabindex:"-1"},Ri={class:"header-anchor",href:"#è¢«åŠ¨æ–¹çš„ä¼˜åŒ–"},Yi={href:"https://xiaolincoding.com/network/3_tcp/tcp_optimize.html#%E8%A2%AB%E5%8A%A8%E6%96%B9%E7%9A%84%E4%BC%98%E5%8C%96",target:"_blank",rel:"noopener noreferrer"},Ui=n('<p>å½“è¢«åŠ¨æ–¹æ”¶åˆ° FIN æŠ¥æ–‡æ—¶ï¼Œå†…æ ¸ä¼šè‡ªåŠ¨å›å¤ ACKï¼ŒåŒæ—¶è¿æ¥å¤„äº CLOSE_WAIT çŠ¶æ€ï¼Œé¡¾åæ€ä¹‰ï¼Œå®ƒè¡¨ç¤ºç­‰å¾…åº”ç”¨è¿›ç¨‹è°ƒç”¨ close å‡½æ•°å…³é—­è¿æ¥ã€‚</p><p>å†…æ ¸æ²¡æœ‰æƒåˆ©æ›¿ä»£è¿›ç¨‹å»å…³é—­è¿æ¥ï¼Œå› ä¸ºå¦‚æœä¸»åŠ¨æ–¹æ˜¯é€šè¿‡ shutdown å…³é—­è¿æ¥ï¼Œé‚£ä¹ˆå®ƒå°±æ˜¯æƒ³åœ¨åŠå…³é—­è¿æ¥ä¸Šæ¥æ”¶æ•°æ®æˆ–å‘é€æ•°æ®ã€‚å› æ­¤ï¼ŒLinux å¹¶æ²¡æœ‰é™åˆ¶ CLOSE_WAIT çŠ¶æ€çš„æŒç»­æ—¶é—´ã€‚</p><p>å½“ç„¶ï¼Œå¤§å¤šæ•°åº”ç”¨ç¨‹åºå¹¶ä¸ä½¿ç”¨ shutdown å‡½æ•°å…³é—­è¿æ¥ã€‚æ‰€ä»¥ï¼Œ<strong>å½“ä½ ç”¨ netstat å‘½ä»¤å‘ç°å¤§é‡ CLOSE_WAIT çŠ¶æ€ã€‚å°±éœ€è¦æ’æŸ¥ä½ çš„åº”ç”¨ç¨‹åºï¼Œå› ä¸ºå¯èƒ½å› ä¸ºåº”ç”¨ç¨‹åºå‡ºç°äº† Bugï¼Œread å‡½æ•°è¿”å› 0 æ—¶ï¼Œæ²¡æœ‰è°ƒç”¨ close å‡½æ•°ã€‚</strong></p><p>å¤„äº CLOSE_WAIT çŠ¶æ€æ—¶ï¼Œè°ƒç”¨äº† close å‡½æ•°ï¼Œå†…æ ¸å°±ä¼šå‘å‡º FIN æŠ¥æ–‡å…³é—­å‘é€é€šé“ï¼ŒåŒæ—¶è¿æ¥è¿›å…¥ LAST_ACK çŠ¶æ€ï¼Œç­‰å¾…ä¸»åŠ¨æ–¹è¿”å› ACK æ¥ç¡®è®¤è¿æ¥å…³é—­ã€‚</p><p>å¦‚æœè¿Ÿè¿Ÿæ”¶ä¸åˆ°è¿™ä¸ª ACKï¼Œå†…æ ¸å°±ä¼šé‡å‘ FIN æŠ¥æ–‡ï¼Œé‡å‘æ¬¡æ•°ä»ç„¶ç”± tcp_orphan_retries å‚æ•°æ§åˆ¶ï¼Œè¿™ä¸ä¸»åŠ¨æ–¹é‡å‘ FIN æŠ¥æ–‡çš„ä¼˜åŒ–ç­–ç•¥ä¸€è‡´ã€‚</p><p>è¿˜æœ‰ä¸€ç‚¹æˆ‘ä»¬éœ€è¦æ³¨æ„çš„ï¼Œ<strong>å¦‚æœè¢«åŠ¨æ–¹è¿…é€Ÿè°ƒç”¨ close å‡½æ•°ï¼Œé‚£ä¹ˆè¢«åŠ¨æ–¹çš„ ACK å’Œ FIN æœ‰å¯èƒ½åœ¨ä¸€ä¸ªæŠ¥æ–‡ä¸­å‘é€ï¼Œè¿™æ ·çœ‹èµ·æ¥ï¼Œå››æ¬¡æŒ¥æ‰‹ä¼šå˜æˆä¸‰æ¬¡æŒ¥æ‰‹ï¼Œè¿™åªæ˜¯ä¸€ç§ç‰¹æ®Šæƒ…å†µï¼Œä¸ç”¨åœ¨æ„ã€‚</strong></p><blockquote><p>å¦‚æœè¿æ¥åŒæ–¹åŒæ—¶å…³é—­è¿æ¥ï¼Œä¼šæ€ä¹ˆæ ·ï¼Ÿ</p></blockquote><p>ç”±äº TCP æ˜¯åŒå…¨å·¥çš„åè®®ï¼Œæ‰€ä»¥æ˜¯ä¼šå‡ºç°ä¸¤æ–¹åŒæ—¶å…³é—­è¿æ¥çš„ç°è±¡ï¼Œä¹Ÿå°±æ˜¯åŒæ—¶å‘é€äº† FIN æŠ¥æ–‡ã€‚</p><p>æ­¤æ—¶ï¼Œä¸Šé¢ä»‹ç»çš„ä¼˜åŒ–ç­–ç•¥ä»ç„¶é€‚ç”¨ã€‚ä¸¤æ–¹å‘é€ FIN æŠ¥æ–‡æ—¶ï¼Œéƒ½è®¤ä¸ºè‡ªå·±æ˜¯ä¸»åŠ¨æ–¹ï¼Œæ‰€ä»¥éƒ½è¿›å…¥äº† FIN_WAIT1 çŠ¶æ€ï¼ŒFIN æŠ¥æ–‡çš„é‡å‘æ¬¡æ•°ä»ç”± tcp_orphan_retries å‚æ•°æ§åˆ¶ã€‚</p><figure><img src="'+Xn+'" alt="åŒæ—¶å…³é—­" tabindex="0" loading="lazy"><figcaption>åŒæ—¶å…³é—­</figcaption></figure><p>æ¥ä¸‹æ¥ï¼Œ<strong>åŒæ–¹åœ¨ç­‰å¾… ACK æŠ¥æ–‡çš„è¿‡ç¨‹ä¸­ï¼Œéƒ½ç­‰æ¥äº† FIN æŠ¥æ–‡ã€‚è¿™æ˜¯ä¸€ç§æ–°æƒ…å†µï¼Œæ‰€ä»¥è¿æ¥ä¼šè¿›å…¥ä¸€ç§å«åš CLOSING çš„æ–°çŠ¶æ€ï¼Œå®ƒæ›¿ä»£äº† FIN_WAIT2 çŠ¶æ€</strong>ã€‚æ¥ç€ï¼ŒåŒæ–¹å†…æ ¸å›å¤ ACK ç¡®è®¤å¯¹æ–¹å‘é€é€šé“çš„å…³é—­åï¼Œè¿›å…¥ TIME_WAIT çŠ¶æ€ï¼Œç­‰å¾… 2MSL çš„æ—¶é—´åï¼Œè¿æ¥è‡ªåŠ¨å…³é—­ã€‚</p>',11),Fi={id:"å°ç»“-2",tabindex:"-1"},ji={class:"header-anchor",href:"#å°ç»“-2"},Wi={href:"https://xiaolincoding.com/network/3_tcp/tcp_optimize.html#%E5%B0%8F%E7%BB%93-2",target:"_blank",rel:"noopener noreferrer"},Bi=n('<p>é’ˆå¯¹ TCP å››æ¬¡æŒ¥æ‰‹çš„ä¼˜åŒ–ï¼Œæˆ‘ä»¬éœ€è¦æ ¹æ®ä¸»åŠ¨æ–¹å’Œè¢«åŠ¨æ–¹å››æ¬¡æŒ¥æ‰‹çŠ¶æ€å˜åŒ–æ¥è°ƒæ•´ç³»ç»Ÿ TCP å†…æ ¸å‚æ•°ã€‚</p><figure><img src="'+Zn+'" alt="å››æ¬¡æŒ¥æ‰‹çš„ä¼˜åŒ–ç­–ç•¥" tabindex="0" loading="lazy"><figcaption>å››æ¬¡æŒ¥æ‰‹çš„ä¼˜åŒ–ç­–ç•¥</figcaption></figure><blockquote><p>ä¸»åŠ¨æ–¹çš„ä¼˜åŒ–</p></blockquote><p>ä¸»åŠ¨å‘èµ· FIN æŠ¥æ–‡æ–­å¼€è¿æ¥çš„ä¸€æ–¹ï¼Œå¦‚æœè¿Ÿè¿Ÿæ²¡æ”¶åˆ°å¯¹æ–¹çš„ ACK å›å¤ï¼Œåˆ™ä¼šé‡ä¼  FIN æŠ¥æ–‡ï¼Œé‡ä¼ çš„æ¬¡æ•°ç”± <code>tcp_orphan_retries</code> å‚æ•°å†³å®šã€‚</p><p>å½“ä¸»åŠ¨æ–¹æ”¶åˆ° ACK æŠ¥æ–‡åï¼Œè¿æ¥å°±è¿›å…¥ FIN_WAIT2 çŠ¶æ€ï¼Œæ ¹æ®å…³é—­çš„æ–¹å¼ä¸åŒï¼Œä¼˜åŒ–çš„æ–¹å¼ä¹Ÿä¸åŒï¼š</p><ul><li>å¦‚æœè¿™æ˜¯ close å‡½æ•°å…³é—­çš„è¿æ¥ï¼Œé‚£ä¹ˆå®ƒå°±æ˜¯å­¤å„¿è¿æ¥ã€‚å¦‚æœ <code>tcp_fin_timeout</code> ç§’å†…æ²¡æœ‰æ”¶åˆ°å¯¹æ–¹çš„ FIN æŠ¥æ–‡ï¼Œè¿æ¥å°±ç›´æ¥å…³é—­ã€‚åŒæ—¶ï¼Œä¸ºäº†åº”å¯¹å­¤å„¿è¿æ¥å ç”¨å¤ªå¤šçš„èµ„æºï¼Œ<code>tcp_max_orphans</code> å®šä¹‰äº†æœ€å¤§å­¤å„¿è¿æ¥çš„æ•°é‡ï¼Œè¶…è¿‡æ—¶è¿æ¥å°±ä¼šç›´æ¥é‡Šæ”¾ã€‚</li><li>åä¹‹æ˜¯ shutdown å‡½æ•°å…³é—­çš„è¿æ¥ï¼Œåˆ™ä¸å—æ­¤å‚æ•°é™åˆ¶ï¼›</li></ul><p>å½“ä¸»åŠ¨æ–¹æ¥æ”¶åˆ° FIN æŠ¥æ–‡ï¼Œå¹¶è¿”å› ACK åï¼Œä¸»åŠ¨æ–¹çš„è¿æ¥è¿›å…¥ TIME_WAIT çŠ¶æ€ã€‚è¿™ä¸€çŠ¶æ€ä¼šæŒç»­ 1 åˆ†é’Ÿï¼Œä¸ºäº†é˜²æ­¢ TIME_WAIT çŠ¶æ€å ç”¨å¤ªå¤šçš„èµ„æºï¼Œ<code>tcp_max_tw_buckets</code> å®šä¹‰äº†æœ€å¤§æ•°é‡ï¼Œè¶…è¿‡æ—¶è¿æ¥ä¹Ÿä¼šç›´æ¥é‡Šæ”¾ã€‚</p><p>å½“ TIME_WAIT çŠ¶æ€è¿‡å¤šæ—¶ï¼Œè¿˜å¯ä»¥é€šè¿‡è®¾ç½® <code>tcp_tw_reuse</code> å’Œ <code>tcp_timestamps</code> ä¸º 1 ï¼Œå°† TIME_WAIT çŠ¶æ€çš„ç«¯å£å¤ç”¨äºä½œä¸ºå®¢æˆ·ç«¯çš„æ–°è¿æ¥ï¼Œæ³¨æ„è¯¥å‚æ•°åªé€‚ç”¨äºå®¢æˆ·ç«¯ã€‚</p><blockquote><p>è¢«åŠ¨æ–¹çš„ä¼˜åŒ–</p></blockquote><p>è¢«åŠ¨å…³é—­çš„è¿æ¥æ–¹åº”å¯¹éå¸¸ç®€å•ï¼Œå®ƒåœ¨å›å¤ ACK åå°±è¿›å…¥äº† CLOSE_WAIT çŠ¶æ€ï¼Œç­‰å¾…è¿›ç¨‹è°ƒç”¨ close å‡½æ•°å…³é—­è¿æ¥ã€‚å› æ­¤ï¼Œå‡ºç°å¤§é‡ CLOSE_WAIT çŠ¶æ€çš„è¿æ¥æ—¶ï¼Œåº”å½“ä»åº”ç”¨ç¨‹åºä¸­æ‰¾é—®é¢˜ã€‚</p><p>å½“è¢«åŠ¨æ–¹å‘é€ FIN æŠ¥æ–‡åï¼Œè¿æ¥å°±è¿›å…¥ LAST_ACK çŠ¶æ€ï¼Œåœ¨æœªç­‰åˆ° ACK æ—¶ï¼Œä¼šåœ¨ <code>tcp_orphan_retries</code> å‚æ•°çš„æ§åˆ¶ä¸‹é‡å‘ FIN æŠ¥æ–‡ã€‚</p><hr>',12),Oi={id:"tcp-ä¼ è¾“æ•°æ®çš„æ€§èƒ½æå‡",tabindex:"-1"},Qi={class:"header-anchor",href:"#tcp-ä¼ è¾“æ•°æ®çš„æ€§èƒ½æå‡"},Gi={href:"https://xiaolincoding.com/network/3_tcp/tcp_optimize.html#tcp-%E4%BC%A0%E8%BE%93%E6%95%B0%E6%8D%AE%E7%9A%84%E6%80%A7%E8%83%BD%E6%8F%90%E5%8D%87",target:"_blank",rel:"noopener noreferrer"},Vi=o("p",null,"åœ¨å‰é¢ä»‹ç»çš„æ˜¯ä¸‰æ¬¡æ¡æ‰‹å’Œå››æ¬¡æŒ¥æ‰‹çš„ä¼˜åŒ–ç­–ç•¥ï¼Œæ¥ä¸‹æ¥ä¸»è¦ä»‹ç»çš„æ˜¯ TCP ä¼ è¾“æ•°æ®æ—¶çš„ä¼˜åŒ–ç­–ç•¥ã€‚",-1),Xi=o("p",null,"TCP è¿æ¥æ˜¯ç”±å†…æ ¸ç»´æŠ¤çš„ï¼Œå†…æ ¸ä¼šä¸ºæ¯ä¸ªè¿æ¥å»ºç«‹å†…å­˜ç¼“å†²åŒºï¼š",-1),Zi=o("ul",null,[o("li",null,"å¦‚æœè¿æ¥çš„å†…å­˜é…ç½®è¿‡å°ï¼Œå°±æ— æ³•å……åˆ†ä½¿ç”¨ç½‘ç»œå¸¦å®½ï¼ŒTCP ä¼ è¾“æ•ˆç‡å°±ä¼šé™ä½ï¼›"),o("li",null,"å¦‚æœè¿æ¥çš„å†…å­˜é…ç½®è¿‡å¤§ï¼Œå¾ˆå®¹æ˜“æŠŠæœåŠ¡å™¨èµ„æºè€—å°½ï¼Œè¿™æ ·å°±ä¼šå¯¼è‡´æ–°è¿æ¥æ— æ³•å»ºç«‹ï¼›")],-1),Ji=o("p",null,"å› æ­¤ï¼Œæˆ‘ä»¬å¿…é¡»ç†è§£ Linux ä¸‹ TCP å†…å­˜çš„ç”¨é€”ï¼Œæ‰èƒ½æ­£ç¡®åœ°é…ç½®å†…å­˜å¤§å°ã€‚",-1),$i={id:"æ»‘åŠ¨çª—å£æ˜¯å¦‚ä½•å½±å“ä¼ è¾“é€Ÿåº¦çš„",tabindex:"-1"},og={class:"header-anchor",href:"#æ»‘åŠ¨çª—å£æ˜¯å¦‚ä½•å½±å“ä¼ è¾“é€Ÿåº¦çš„"},tg={href:"https://xiaolincoding.com/network/3_tcp/tcp_optimize.html#%E6%BB%91%E5%8A%A8%E7%AA%97%E5%8F%A3%E6%98%AF%E5%A6%82%E4%BD%95%E5%BD%B1%E5%93%8D%E4%BC%A0%E8%BE%93%E9%80%9F%E5%BA%A6%E7%9A%84",target:"_blank",rel:"noopener noreferrer"},sg=n('<p>TCP ä¼šä¿è¯æ¯ä¸€ä¸ªæŠ¥æ–‡éƒ½èƒ½å¤ŸæŠµè¾¾å¯¹æ–¹ï¼Œå®ƒçš„æœºåˆ¶æ˜¯è¿™æ ·ï¼šæŠ¥æ–‡å‘å‡ºå»åï¼Œå¿…é¡»æ¥æ”¶åˆ°å¯¹æ–¹è¿”å›çš„ç¡®è®¤æŠ¥æ–‡ ACKï¼Œå¦‚æœè¿Ÿè¿Ÿæœªæ”¶åˆ°ï¼Œå°±ä¼šè¶…æ—¶é‡å‘è¯¥æŠ¥æ–‡ï¼Œç›´åˆ°æ”¶åˆ°å¯¹æ–¹çš„ ACK ä¸ºæ­¢ã€‚</p><p><strong>æ‰€ä»¥ï¼ŒTCP æŠ¥æ–‡å‘å‡ºå»åï¼Œå¹¶ä¸ä¼šç«‹é©¬ä»å†…å­˜ä¸­åˆ é™¤ï¼Œå› ä¸ºé‡ä¼ æ—¶è¿˜éœ€è¦ç”¨åˆ°å®ƒã€‚</strong></p><p>ç”±äº TCP æ˜¯å†…æ ¸ç»´æŠ¤çš„ï¼Œæ‰€ä»¥æŠ¥æ–‡å­˜æ”¾åœ¨å†…æ ¸ç¼“å†²åŒºã€‚å¦‚æœè¿æ¥éå¸¸å¤šï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ free å‘½ä»¤è§‚å¯Ÿåˆ° <code>buff/cache</code> å†…å­˜æ˜¯ä¼šå¢å¤§ã€‚</p><p>å¦‚æœ TCP æ˜¯æ¯å‘é€ä¸€ä¸ªæ•°æ®ï¼Œéƒ½è¦è¿›è¡Œä¸€æ¬¡ç¡®è®¤åº”ç­”ã€‚å½“ä¸Šä¸€ä¸ªæ•°æ®åŒ…æ”¶åˆ°äº†åº”ç­”äº†ï¼Œ å†å‘é€ä¸‹ä¸€ä¸ªã€‚è¿™ä¸ªæ¨¡å¼å°±æœ‰ç‚¹åƒæˆ‘å’Œä½ é¢å¯¹é¢èŠå¤©ï¼Œä½ ä¸€å¥æˆ‘ä¸€å¥ï¼Œä½†è¿™ç§æ–¹å¼çš„ç¼ºç‚¹æ˜¯æ•ˆç‡æ¯”è¾ƒä½çš„ã€‚</p><figure><img src="'+Jn+'" alt="æŒ‰æ•°æ®åŒ…è¿›è¡Œç¡®è®¤åº”ç­”" tabindex="0" loading="lazy"><figcaption>æŒ‰æ•°æ®åŒ…è¿›è¡Œç¡®è®¤åº”ç­”</figcaption></figure><p>æ‰€ä»¥ï¼Œè¿™æ ·çš„ä¼ è¾“æ–¹å¼æœ‰ä¸€ä¸ªç¼ºç‚¹ï¼šæ•°æ®åŒ…çš„<strong>å¾€è¿”æ—¶é—´è¶Šé•¿ï¼Œé€šä¿¡çš„æ•ˆç‡å°±è¶Šä½</strong>ã€‚</p><p><strong>è¦è§£å†³è¿™ä¸€é—®é¢˜ä¸éš¾ï¼Œå¹¶è¡Œæ‰¹é‡å‘é€æŠ¥æ–‡ï¼Œå†æ‰¹é‡ç¡®è®¤æŠ¥æ–‡å³å¯ã€‚</strong></p><figure><img src="'+$n+'" alt="å¹¶è¡Œå¤„ç†" tabindex="0" loading="lazy"><figcaption>å¹¶è¡Œå¤„ç†</figcaption></figure><p>ç„¶è€Œï¼Œè¿™å¼•å‡ºäº†å¦ä¸€ä¸ªé—®é¢˜ï¼Œå‘é€æ–¹å¯ä»¥éšå¿ƒæ‰€æ¬²çš„å‘é€æŠ¥æ–‡å—ï¼Ÿ<strong>å½“ç„¶è¿™ä¸ç°å®ï¼Œæˆ‘ä»¬è¿˜å¾—è€ƒè™‘æ¥æ”¶æ–¹çš„å¤„ç†èƒ½åŠ›ã€‚</strong></p><p>å½“æ¥æ”¶æ–¹ç¡¬ä»¶ä¸å¦‚å‘é€æ–¹ï¼Œæˆ–è€…ç³»ç»Ÿç¹å¿™ã€èµ„æºç´§å¼ æ—¶ï¼Œæ˜¯æ— æ³•ç¬é—´å¤„ç†è¿™ä¹ˆå¤šæŠ¥æ–‡çš„ã€‚äºæ˜¯ï¼Œè¿™äº›æŠ¥æ–‡åªèƒ½è¢«ä¸¢æ‰ï¼Œä½¿å¾—ç½‘ç»œæ•ˆç‡éå¸¸ä½ã€‚</p><p><strong>ä¸ºäº†è§£å†³è¿™ç§ç°è±¡å‘ç”Ÿï¼ŒTCP æä¾›ä¸€ç§æœºåˆ¶å¯ä»¥è®©ã€Œå‘é€æ–¹ã€æ ¹æ®ã€Œæ¥æ”¶æ–¹ã€çš„å®é™…æ¥æ”¶èƒ½åŠ›æ§åˆ¶å‘é€çš„æ•°æ®é‡ï¼Œè¿™å°±æ˜¯æ»‘åŠ¨çª—å£çš„ç”±æ¥ã€‚</strong></p><p>æ¥æ”¶æ–¹æ ¹æ®å®ƒçš„ç¼“å†²åŒºï¼Œå¯ä»¥è®¡ç®—å‡ºåç»­èƒ½å¤Ÿæ¥æ”¶å¤šå°‘å­—èŠ‚çš„æŠ¥æ–‡ï¼Œè¿™ä¸ªæ•°å­—å«åšæ¥æ”¶çª—å£ã€‚å½“å†…æ ¸æ¥æ”¶åˆ°æŠ¥æ–‡æ—¶ï¼Œå¿…é¡»ç”¨ç¼“å†²åŒºå­˜æ”¾å®ƒä»¬ï¼Œè¿™æ ·å‰©ä½™ç¼“å†²åŒºç©ºé—´å˜å°ï¼Œæ¥æ”¶çª—å£ä¹Ÿå°±å˜å°äº†ï¼›å½“è¿›ç¨‹è°ƒç”¨ read å‡½æ•°åï¼Œæ•°æ®è¢«è¯»å…¥äº†ç”¨æˆ·ç©ºé—´ï¼Œå†…æ ¸ç¼“å†²åŒºå°±è¢«æ¸…ç©ºï¼Œè¿™æ„å‘³ç€ä¸»æœºå¯ä»¥æ¥æ”¶æ›´å¤šçš„æŠ¥æ–‡ï¼Œæ¥æ”¶çª—å£å°±ä¼šå˜å¤§ã€‚</p><p>å› æ­¤ï¼Œæ¥æ”¶çª—å£å¹¶ä¸æ˜¯æ’å®šä¸å˜çš„ï¼Œæ¥æ”¶æ–¹ä¼šæŠŠå½“å‰å¯æ¥æ”¶çš„å¤§å°æ”¾åœ¨ TCP æŠ¥æ–‡å¤´éƒ¨ä¸­çš„<strong>çª—å£å­—æ®µ</strong>ï¼Œè¿™æ ·å°±å¯ä»¥èµ·åˆ°çª—å£å¤§å°é€šçŸ¥çš„ä½œç”¨ã€‚</p><p>å‘é€æ–¹çš„çª—å£ç­‰ä»·äºæ¥æ”¶æ–¹çš„çª—å£å—ï¼Ÿå¦‚æœä¸è€ƒè™‘æ‹¥å¡æ§åˆ¶ï¼Œå‘é€æ–¹çš„çª—å£å¤§å°ã€Œçº¦ç­‰äºã€æ¥æ”¶æ–¹çš„çª—å£å¤§å°ï¼Œå› ä¸ºçª—å£é€šçŸ¥æŠ¥æ–‡åœ¨ç½‘ç»œä¼ è¾“æ˜¯å­˜åœ¨æ—¶å»¶çš„ï¼Œæ‰€ä»¥æ˜¯çº¦ç­‰äºçš„å…³ç³»ã€‚</p><figure><img src="'+op+'" alt="TCP å¤´éƒ¨" tabindex="0" loading="lazy"><figcaption>TCP å¤´éƒ¨</figcaption></figure><p>ä»ä¸Šå›¾ä¸­å¯ä»¥çœ‹åˆ°ï¼Œçª—å£å­—æ®µåªæœ‰ 2 ä¸ªå­—èŠ‚ï¼Œå› æ­¤å®ƒæœ€å¤šèƒ½è¡¨è¾¾ 65535 å­—èŠ‚å¤§å°çš„çª—å£ï¼Œä¹Ÿå°±æ˜¯ 64KB å¤§å°ã€‚</p><p>è¿™ä¸ªçª—å£å¤§å°æœ€å¤§å€¼ï¼Œåœ¨å½“ä»Šé«˜é€Ÿç½‘ç»œä¸‹ï¼Œå¾ˆæ˜æ˜¾æ˜¯ä¸å¤Ÿç”¨çš„ã€‚æ‰€ä»¥åç»­æœ‰äº†æ‰©å……çª—å£çš„æ–¹æ³•ï¼š<strong>åœ¨ TCP é€‰é¡¹å­—æ®µå®šä¹‰äº†çª—å£æ‰©å¤§å› å­ï¼Œç”¨äºæ‰©å¤§ TCP é€šå‘Šçª—å£ï¼Œå…¶å€¼å¤§å°æ˜¯ 2^14ï¼Œè¿™æ ·å°±ä½¿ TCP çš„çª—å£å¤§å°ä» 16 ä½æ‰©å¤§ä¸º 30 ä½ï¼ˆ2^16 * 2^ 14 = 2^30ï¼‰ï¼Œæ‰€ä»¥æ­¤æ—¶çª—å£çš„æœ€å¤§å€¼å¯ä»¥è¾¾åˆ° 1GBã€‚</strong></p><p>![TCP option é€‰é¡¹ - çª—å£æ‰©å±•](../../.vuepress/public/assets/mdimages/TCP optionå­—æ®µ-çª—å£.png)</p><p>Linux ä¸­æ‰“å¼€è¿™ä¸€åŠŸèƒ½ï¼Œéœ€è¦æŠŠ tcp_window_scaling é…ç½®è®¾ä¸º 1ï¼ˆé»˜è®¤æ‰“å¼€ï¼‰ï¼š</p><figure><img src="'+tp+'" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><p>è¦ä½¿ç”¨çª—å£æ‰©å¤§é€‰é¡¹ï¼Œé€šè®¯åŒæ–¹å¿…é¡»åœ¨å„è‡ªçš„ SYN æŠ¥æ–‡ä¸­å‘é€è¿™ä¸ªé€‰é¡¹ï¼š</p><ul><li>ä¸»åŠ¨å»ºç«‹è¿æ¥çš„ä¸€æ–¹åœ¨ SYN æŠ¥æ–‡ä¸­å‘é€è¿™ä¸ªé€‰é¡¹ï¼›</li><li>è€Œè¢«åŠ¨å»ºç«‹è¿æ¥çš„ä¸€æ–¹åªæœ‰åœ¨æ”¶åˆ°å¸¦çª—å£æ‰©å¤§é€‰é¡¹çš„ SYN æŠ¥æ–‡ä¹‹åæ‰èƒ½å‘é€è¿™ä¸ªé€‰é¡¹ã€‚</li></ul><p>è¿™æ ·çœ‹æ¥ï¼Œåªè¦è¿›ç¨‹èƒ½åŠæ—¶åœ°è°ƒç”¨ read å‡½æ•°è¯»å–æ•°æ®ï¼Œå¹¶ä¸”æ¥æ”¶ç¼“å†²åŒºé…ç½®å¾—è¶³å¤Ÿå¤§ï¼Œé‚£ä¹ˆæ¥æ”¶çª—å£å°±å¯ä»¥æ— é™åœ°æ”¾å¤§ï¼Œå‘é€æ–¹ä¹Ÿå°±æ— é™åœ°æå‡å‘é€é€Ÿåº¦ã€‚</p><p><strong>è¿™æ˜¯ä¸å¯èƒ½çš„ï¼Œå› ä¸ºç½‘ç»œçš„ä¼ è¾“èƒ½åŠ›æ˜¯æœ‰é™çš„ï¼Œå½“å‘é€æ–¹ä¾æ®å‘é€çª—å£ï¼Œå‘é€è¶…è¿‡ç½‘ç»œå¤„ç†èƒ½åŠ›çš„æŠ¥æ–‡æ—¶ï¼Œè·¯ç”±å™¨ä¼šç›´æ¥ä¸¢å¼ƒè¿™äº›æŠ¥æ–‡ã€‚å› æ­¤ï¼Œç¼“å†²åŒºçš„å†…å­˜å¹¶ä¸æ˜¯è¶Šå¤§è¶Šå¥½ã€‚</strong></p>',24),eg={id:"å¦‚ä½•ç¡®å®šæœ€å¤§ä¼ è¾“é€Ÿåº¦",tabindex:"-1"},ng={class:"header-anchor",href:"#å¦‚ä½•ç¡®å®šæœ€å¤§ä¼ è¾“é€Ÿåº¦"},pg={href:"https://xiaolincoding.com/network/3_tcp/tcp_optimize.html#%E5%A6%82%E4%BD%95%E7%A1%AE%E5%AE%9A%E6%9C%80%E5%A4%A7%E4%BC%A0%E8%BE%93%E9%80%9F%E5%BA%A6",target:"_blank",rel:"noopener noreferrer"},rg=n('<p>åœ¨å‰é¢æˆ‘ä»¬çŸ¥é“äº† TCP çš„ä¼ è¾“é€Ÿåº¦ï¼Œå—åˆ¶äºå‘é€çª—å£ä¸æ¥æ”¶çª—å£ï¼Œä»¥åŠç½‘ç»œè®¾å¤‡ä¼ è¾“èƒ½åŠ›ã€‚å…¶ä¸­ï¼Œçª—å£å¤§å°ç”±å†…æ ¸ç¼“å†²åŒºå¤§å°å†³å®šã€‚å¦‚æœç¼“å†²åŒºä¸ç½‘ç»œä¼ è¾“èƒ½åŠ›åŒ¹é…ï¼Œé‚£ä¹ˆç¼“å†²åŒºçš„åˆ©ç”¨ç‡å°±è¾¾åˆ°äº†æœ€å¤§åŒ–ã€‚</p><p>é—®é¢˜æ¥äº†ï¼Œå¦‚ä½•è®¡ç®—ç½‘ç»œçš„ä¼ è¾“èƒ½åŠ›å‘¢ï¼Ÿ</p><p>ç›¸ä¿¡å¤§å®¶éƒ½çŸ¥é“ç½‘ç»œæ˜¯æœ‰ã€Œå¸¦å®½ã€é™åˆ¶çš„ï¼Œå¸¦å®½æè¿°çš„æ˜¯ç½‘ç»œä¼ è¾“èƒ½åŠ›ï¼Œå®ƒä¸å†…æ ¸ç¼“å†²åŒºçš„è®¡é‡å•ä½ä¸åŒ:</p><ul><li>å¸¦å®½æ˜¯å•ä½æ—¶é—´å†…çš„æµé‡ï¼Œè¡¨è¾¾æ˜¯ã€Œé€Ÿåº¦ã€ï¼Œæ¯”å¦‚å¸¸è§çš„å¸¦å®½ 100 MB/sï¼›</li><li>ç¼“å†²åŒºå•ä½æ˜¯å­—èŠ‚ï¼Œå½“ç½‘ç»œé€Ÿåº¦ä¹˜ä»¥æ—¶é—´æ‰èƒ½å¾—åˆ°å­—èŠ‚æ•°ï¼›</li></ul><p>è¿™é‡Œéœ€è¦è¯´ä¸€ä¸ªæ¦‚å¿µï¼Œå°±æ˜¯å¸¦å®½æ—¶å»¶ç§¯ï¼Œå®ƒå†³å®šç½‘ç»œä¸­é£è¡ŒæŠ¥æ–‡çš„å¤§å°ï¼Œå®ƒçš„è®¡ç®—æ–¹å¼ï¼š</p><figure><img src="'+sp+'" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><p>æ¯”å¦‚æœ€å¤§å¸¦å®½æ˜¯ 100 MB/sï¼Œç½‘ç»œæ—¶å»¶ï¼ˆRTTï¼‰æ˜¯ 10ms æ—¶ï¼Œæ„å‘³ç€å®¢æˆ·ç«¯åˆ°æœåŠ¡ç«¯çš„ç½‘ç»œä¸€å…±å¯ä»¥å­˜æ”¾ 100MB/s * 0.01s = 1MB çš„å­—èŠ‚ã€‚</p><p>è¿™ä¸ª 1MB æ˜¯å¸¦å®½å’Œæ—¶å»¶çš„ä¹˜ç§¯ï¼Œæ‰€ä»¥å®ƒå°±å«ã€Œå¸¦å®½æ—¶å»¶ç§¯ã€ï¼ˆç¼©å†™ä¸º BDPï¼ŒBandwidth Delay Productï¼‰ã€‚åŒæ—¶ï¼Œè¿™ 1MB ä¹Ÿè¡¨ç¤ºã€Œé£è¡Œä¸­ã€çš„ TCP æŠ¥æ–‡å¤§å°ï¼Œå®ƒä»¬å°±åœ¨ç½‘ç»œçº¿è·¯ã€è·¯ç”±å™¨ç­‰ç½‘ç»œè®¾å¤‡ä¸Šã€‚å¦‚æœé£è¡ŒæŠ¥æ–‡è¶…è¿‡äº† 1 MBï¼Œå°±ä¼šå¯¼è‡´ç½‘ç»œè¿‡è½½ï¼Œå®¹æ˜“ä¸¢åŒ…ã€‚</p><p><strong>ç”±äºå‘é€ç¼“å†²åŒºå¤§å°å†³å®šäº†å‘é€çª—å£çš„ä¸Šé™ï¼Œè€Œå‘é€çª—å£åˆå†³å®šäº†ã€Œå·²å‘é€æœªç¡®è®¤ã€çš„é£è¡ŒæŠ¥æ–‡çš„ä¸Šé™ã€‚å› æ­¤ï¼Œå‘é€ç¼“å†²åŒºä¸èƒ½è¶…è¿‡ã€Œå¸¦å®½æ—¶å»¶ç§¯ã€ã€‚</strong></p><p>å‘é€ç¼“å†²åŒºä¸å¸¦å®½æ—¶å»¶ç§¯çš„å…³ç³»ï¼š</p><ul><li>å¦‚æœå‘é€ç¼“å†²åŒºã€Œè¶…è¿‡ã€å¸¦å®½æ—¶å»¶ç§¯ï¼Œè¶…å‡ºçš„éƒ¨åˆ†å°±æ²¡åŠæ³•æœ‰æ•ˆçš„ç½‘ç»œä¼ è¾“ï¼ŒåŒæ—¶å¯¼è‡´ç½‘ç»œè¿‡è½½ï¼Œå®¹æ˜“ä¸¢åŒ…ï¼›</li><li>å¦‚æœå‘é€ç¼“å†²åŒºã€Œå°äºã€å¸¦å®½æ—¶å»¶ç§¯ï¼Œå°±ä¸èƒ½å¾ˆå¥½çš„å‘æŒ¥å‡ºç½‘ç»œçš„ä¼ è¾“æ•ˆç‡ã€‚</li></ul><p>æ‰€ä»¥ï¼Œå‘é€ç¼“å†²åŒºçš„å¤§å°æœ€å¥½æ˜¯å¾€å¸¦å®½æ—¶å»¶ç§¯é è¿‘ã€‚</p>',12),ig={id:"æ€æ ·è°ƒæ•´ç¼“å†²åŒºå¤§å°",tabindex:"-1"},gg={class:"header-anchor",href:"#æ€æ ·è°ƒæ•´ç¼“å†²åŒºå¤§å°"},ag={href:"https://xiaolincoding.com/network/3_tcp/tcp_optimize.html#%E6%80%8E%E6%A0%B7%E8%B0%83%E6%95%B4%E7%BC%93%E5%86%B2%E5%8C%BA%E5%A4%A7%E5%B0%8F",target:"_blank",rel:"noopener noreferrer"},lg=n('<p>åœ¨ Linux ä¸­å‘é€ç¼“å†²åŒºå’Œæ¥æ”¶ç¼“å†²éƒ½æ˜¯å¯ä»¥ç”¨å‚æ•°è°ƒèŠ‚çš„ã€‚è®¾ç½®å®Œåï¼ŒLinux ä¼šæ ¹æ®ä½ è®¾ç½®çš„ç¼“å†²åŒºè¿›è¡Œ<strong>åŠ¨æ€è°ƒèŠ‚</strong>ã€‚</p><blockquote><p>è°ƒèŠ‚å‘é€ç¼“å†²åŒºèŒƒå›´</p></blockquote><p>å…ˆæ¥çœ‹çœ‹å‘é€ç¼“å†²åŒºï¼Œå®ƒçš„èŒƒå›´é€šè¿‡ tcp_wmem å‚æ•°é…ç½®ï¼›</p><figure><img src="'+ep+'" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><p>ä¸Šé¢ä¸‰ä¸ªæ•°å­—å•ä½éƒ½æ˜¯å­—èŠ‚ï¼Œå®ƒä»¬åˆ†åˆ«è¡¨ç¤ºï¼š</p><ul><li>ç¬¬ä¸€ä¸ªæ•°å€¼æ˜¯åŠ¨æ€èŒƒå›´çš„æœ€å°å€¼ï¼Œ4096 byte = 4Kï¼›</li><li>ç¬¬äºŒä¸ªæ•°å€¼æ˜¯åˆå§‹é»˜è®¤å€¼ï¼Œ16384 byte â‰ˆ 16Kï¼›</li><li>ç¬¬ä¸‰ä¸ªæ•°å€¼æ˜¯åŠ¨æ€èŒƒå›´çš„æœ€å¤§å€¼ï¼Œ4194304 byte = 4096Kï¼ˆ4Mï¼‰ï¼›</li></ul><p><strong>å‘é€ç¼“å†²åŒºæ˜¯è‡ªè¡Œè°ƒèŠ‚çš„</strong>ï¼Œå½“å‘é€æ–¹å‘é€çš„æ•°æ®è¢«ç¡®è®¤åï¼Œå¹¶ä¸”æ²¡æœ‰æ–°çš„æ•°æ®è¦å‘é€ï¼Œå°±ä¼šæŠŠå‘é€ç¼“å†²åŒºçš„å†…å­˜é‡Šæ”¾æ‰ã€‚</p><blockquote><p>è°ƒèŠ‚æ¥æ”¶ç¼“å†²åŒºèŒƒå›´</p></blockquote><p>è€Œæ¥æ”¶ç¼“å†²åŒºçš„è°ƒæ•´å°±æ¯”è¾ƒå¤æ‚ä¸€äº›ï¼Œå…ˆæ¥çœ‹çœ‹è®¾ç½®æ¥æ”¶ç¼“å†²åŒºèŒƒå›´çš„ tcp_rmem å‚æ•°ï¼š</p><figure><img src="'+np+'" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><p>ä¸Šé¢ä¸‰ä¸ªæ•°å­—å•ä½éƒ½æ˜¯å­—èŠ‚ï¼Œå®ƒä»¬åˆ†åˆ«è¡¨ç¤ºï¼š</p><ul><li>ç¬¬ä¸€ä¸ªæ•°å€¼æ˜¯åŠ¨æ€èŒƒå›´çš„æœ€å°å€¼ï¼Œè¡¨ç¤ºå³ä½¿åœ¨å†…å­˜å‹åŠ›ä¸‹ä¹Ÿå¯ä»¥ä¿è¯çš„æœ€å°æ¥æ”¶ç¼“å†²åŒºå¤§å°ï¼Œ4096 byte = 4Kï¼›</li><li>ç¬¬äºŒä¸ªæ•°å€¼æ˜¯åˆå§‹é»˜è®¤å€¼ï¼Œ87380 byte â‰ˆ 86Kï¼›</li><li>ç¬¬ä¸‰ä¸ªæ•°å€¼æ˜¯åŠ¨æ€èŒƒå›´çš„æœ€å¤§å€¼ï¼Œ6291456 byte = 6144Kï¼ˆ6Mï¼‰ï¼›</li></ul><p><strong>æ¥æ”¶ç¼“å†²åŒºå¯ä»¥æ ¹æ®ç³»ç»Ÿç©ºé—²å†…å­˜çš„å¤§å°æ¥è°ƒèŠ‚æ¥æ”¶çª—å£ï¼š</strong></p><ul><li>å¦‚æœç³»ç»Ÿçš„ç©ºé—²å†…å­˜å¾ˆå¤šï¼Œå°±å¯ä»¥è‡ªåŠ¨æŠŠç¼“å†²åŒºå¢å¤§ä¸€äº›ï¼Œè¿™æ ·ä¼ ç»™å¯¹æ–¹çš„æ¥æ”¶çª—å£ä¹Ÿä¼šå˜å¤§ï¼Œå› è€Œæå‡å‘é€æ–¹å‘é€çš„ä¼ è¾“æ•°æ®æ•°é‡ï¼›</li><li>åä¹‹ï¼Œå¦‚æœç³»ç»Ÿçš„å†…å­˜å¾ˆç´§å¼ ï¼Œå°±ä¼šå‡å°‘ç¼“å†²åŒºï¼Œè¿™è™½ç„¶ä¼šé™ä½ä¼ è¾“æ•ˆç‡ï¼Œå¯ä»¥ä¿è¯æ›´å¤šçš„å¹¶å‘è¿æ¥æ­£å¸¸å·¥ä½œï¼›</li></ul><p>å‘é€ç¼“å†²åŒºçš„è°ƒèŠ‚åŠŸèƒ½æ˜¯è‡ªåŠ¨å¼€å¯çš„ï¼Œ<strong>è€Œæ¥æ”¶ç¼“å†²åŒºåˆ™éœ€è¦é…ç½® tcp_moderate_rcvbuf ä¸º 1 æ¥å¼€å¯è°ƒèŠ‚åŠŸèƒ½</strong>ï¼š</p><figure><img src="'+pp+'" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><blockquote><p>è°ƒèŠ‚ TCP å†…å­˜èŒƒå›´</p></blockquote><p>æ¥æ”¶ç¼“å†²åŒºè°ƒèŠ‚æ—¶ï¼Œæ€ä¹ˆçŸ¥é“å½“å‰å†…å­˜æ˜¯å¦ç´§å¼ æˆ–å……åˆ†å‘¢ï¼Ÿè¿™æ˜¯é€šè¿‡ tcp_mem é…ç½®å®Œæˆçš„ï¼š</p><figure><img src="'+rp+'" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><p>ä¸Šé¢ä¸‰ä¸ªæ•°å­—å•ä½ä¸æ˜¯å­—èŠ‚ï¼Œè€Œæ˜¯ã€Œé¡µé¢å¤§å°ã€ï¼Œ1 é¡µè¡¨ç¤º 4KBï¼Œå®ƒä»¬åˆ†åˆ«è¡¨ç¤ºï¼š</p><ul><li>å½“ TCP å†…å­˜å°äºç¬¬ 1 ä¸ªå€¼æ—¶ï¼Œä¸éœ€è¦è¿›è¡Œè‡ªåŠ¨è°ƒèŠ‚ï¼›</li><li>åœ¨ç¬¬ 1 å’Œç¬¬ 2 ä¸ªå€¼ä¹‹é—´æ—¶ï¼Œå†…æ ¸å¼€å§‹è°ƒèŠ‚æ¥æ”¶ç¼“å†²åŒºçš„å¤§å°ï¼›</li><li>å¤§äºç¬¬ 3 ä¸ªå€¼æ—¶ï¼Œå†…æ ¸ä¸å†ä¸º TCP åˆ†é…æ–°å†…å­˜ï¼Œæ­¤æ—¶æ–°è¿æ¥æ˜¯æ— æ³•å»ºç«‹çš„ï¼›</li></ul><p>ä¸€èˆ¬æƒ…å†µä¸‹è¿™äº›å€¼æ˜¯åœ¨ç³»ç»Ÿå¯åŠ¨æ—¶æ ¹æ®ç³»ç»Ÿå†…å­˜æ•°é‡è®¡ç®—å¾—åˆ°çš„ã€‚æ ¹æ®å½“å‰ tcp_mem æœ€å¤§å†…å­˜é¡µé¢æ•°æ˜¯ 177120ï¼Œå½“å†…å­˜ä¸º (177120 * 4) / 1024K â‰ˆ 692M æ—¶ï¼Œç³»ç»Ÿå°†æ— æ³•ä¸ºæ–°çš„ TCP è¿æ¥åˆ†é…å†…å­˜ï¼Œå³ TCP è¿æ¥å°†è¢«æ‹’ç»ã€‚</p><blockquote><p>æ ¹æ®å®é™…åœºæ™¯è°ƒèŠ‚çš„ç­–ç•¥</p></blockquote><p>åœ¨é«˜å¹¶å‘æœåŠ¡å™¨ä¸­ï¼Œä¸ºäº†å…¼é¡¾ç½‘é€Ÿä¸å¤§é‡çš„å¹¶å‘è¿æ¥ï¼Œ<strong>æˆ‘ä»¬åº”å½“ä¿è¯ç¼“å†²åŒºçš„åŠ¨æ€è°ƒæ•´çš„æœ€å¤§å€¼è¾¾åˆ°å¸¦å®½æ—¶å»¶ç§¯ï¼Œè€Œæœ€å°å€¼ä¿æŒé»˜è®¤çš„ 4K ä¸å˜å³å¯ã€‚è€Œå¯¹äºå†…å­˜ç´§å¼ çš„æœåŠ¡è€Œè¨€ï¼Œè°ƒä½é»˜è®¤å€¼æ˜¯æé«˜å¹¶å‘çš„æœ‰æ•ˆæ‰‹æ®µã€‚</strong></p><p>åŒæ—¶ï¼Œå¦‚æœè¿™æ˜¯ç½‘ç»œ IO å‹æœåŠ¡å™¨ï¼Œé‚£ä¹ˆï¼Œ<strong>è°ƒå¤§ tcp_mem çš„ä¸Šé™å¯ä»¥è®© TCP è¿æ¥ä½¿ç”¨æ›´å¤šçš„ç³»ç»Ÿå†…å­˜ï¼Œè¿™æœ‰åˆ©äºæå‡å¹¶å‘èƒ½åŠ›</strong>ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œtcp_wmem å’Œ tcp_rmem çš„å•ä½æ˜¯å­—èŠ‚ï¼Œè€Œ tcp_mem çš„å•ä½æ˜¯é¡µé¢å¤§å°ã€‚è€Œä¸”ï¼Œ<strong>åƒä¸‡ä¸è¦åœ¨ socket ä¸Šç›´æ¥è®¾ç½® SO_SNDBUF æˆ–è€… SO_RCVBUFï¼Œè¿™æ ·ä¼šå…³é—­ç¼“å†²åŒºçš„åŠ¨æ€è°ƒæ•´åŠŸèƒ½ã€‚</strong></p>',25),cg={id:"å°ç»“-3",tabindex:"-1"},dg={class:"header-anchor",href:"#å°ç»“-3"},mg={href:"https://xiaolincoding.com/network/3_tcp/tcp_optimize.html#%E5%B0%8F%E7%BB%93-3",target:"_blank",rel:"noopener noreferrer"},Tg=n('<p>æœ¬èŠ‚é’ˆå¯¹ TCP ä¼˜åŒ–æ•°æ®ä¼ è¾“çš„æ–¹å¼ï¼Œåšäº†ä¸€äº›ä»‹ç»ã€‚</p><figure><img src="'+ip+'" alt="æ•°æ®ä¼ è¾“çš„ä¼˜åŒ–ç­–ç•¥" tabindex="0" loading="lazy"><figcaption>æ•°æ®ä¼ è¾“çš„ä¼˜åŒ–ç­–ç•¥</figcaption></figure><p>TCP å¯é æ€§æ˜¯é€šè¿‡ ACK ç¡®è®¤æŠ¥æ–‡å®ç°çš„ï¼Œåˆä¾èµ–æ»‘åŠ¨çª—å£æå‡äº†å‘é€é€Ÿåº¦ä¹Ÿå…¼é¡¾äº†æ¥æ”¶æ–¹çš„å¤„ç†èƒ½åŠ›ã€‚</p><p>å¯æ˜¯ï¼Œé»˜è®¤çš„æ»‘åŠ¨çª—å£æœ€å¤§å€¼åªæœ‰ 64 KBï¼Œä¸æ»¡è¶³å½“ä»Šçš„é«˜é€Ÿç½‘ç»œçš„è¦æ±‚ï¼Œè¦æƒ³æå‡å‘é€é€Ÿåº¦å¿…é¡»æå‡æ»‘åŠ¨çª—å£çš„ä¸Šé™ï¼Œåœ¨ Linux ä¸‹æ˜¯é€šè¿‡è®¾ç½® <code>tcp_window_scaling</code> ä¸º 1 åšåˆ°çš„ï¼Œæ­¤æ—¶æœ€å¤§å€¼å¯é«˜è¾¾ 1GBã€‚</p><p>æ»‘åŠ¨çª—å£å®šä¹‰äº†ç½‘ç»œä¸­é£è¡ŒæŠ¥æ–‡çš„æœ€å¤§å­—èŠ‚æ•°ï¼Œå½“å®ƒè¶…è¿‡å¸¦å®½æ—¶å»¶ç§¯æ—¶ï¼Œç½‘ç»œè¿‡è½½ï¼Œå°±ä¼šå‘ç”Ÿä¸¢åŒ…ã€‚è€Œå½“å®ƒå°äºå¸¦å®½æ—¶å»¶ç§¯æ—¶ï¼Œå°±æ— æ³•å……åˆ†åˆ©ç”¨ç½‘ç»œå¸¦å®½ã€‚å› æ­¤ï¼Œæ»‘åŠ¨çª—å£çš„è®¾ç½®ï¼Œå¿…é¡»å‚è€ƒå¸¦å®½æ—¶å»¶ç§¯ã€‚</p><p>å†…æ ¸ç¼“å†²åŒºå†³å®šäº†æ»‘åŠ¨çª—å£çš„ä¸Šé™ï¼Œç¼“å†²åŒºå¯åˆ†ä¸ºï¼šå‘é€ç¼“å†²åŒº tcp_wmem å’Œæ¥æ”¶ç¼“å†²åŒº tcp_rmemã€‚</p><p>Linux ä¼šå¯¹ç¼“å†²åŒºåŠ¨æ€è°ƒèŠ‚ï¼Œæˆ‘ä»¬åº”è¯¥æŠŠç¼“å†²åŒºçš„ä¸Šé™è®¾ç½®ä¸ºå¸¦å®½æ—¶å»¶ç§¯ã€‚å‘é€ç¼“å†²åŒºçš„è°ƒèŠ‚åŠŸèƒ½æ˜¯è‡ªåŠ¨æ‰“å¼€çš„ï¼Œè€Œæ¥æ”¶ç¼“å†²åŒºéœ€è¦æŠŠ tcp_moderate_rcvbuf è®¾ç½®ä¸º 1 æ¥å¼€å¯ã€‚å…¶ä¸­ï¼Œè°ƒèŠ‚çš„ä¾æ®æ˜¯ TCP å†…å­˜èŒƒå›´ tcp_memã€‚</p><p>ä½†éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœç¨‹åºä¸­çš„ socket è®¾ç½® SO_SNDBUF å’Œ SO_RCVBUFï¼Œåˆ™ä¼šå…³é—­ç¼“å†²åŒºçš„åŠ¨æ€æ•´åŠŸèƒ½ï¼Œæ‰€ä»¥ä¸å»ºè®®åœ¨ç¨‹åºè®¾ç½®å®ƒä¿©ï¼Œè€Œæ˜¯äº¤ç»™å†…æ ¸è‡ªåŠ¨è°ƒæ•´æ¯”è¾ƒå¥½ã€‚</p><p>æœ‰æ•ˆé…ç½®è¿™äº›å‚æ•°åï¼Œæ—¢èƒ½å¤Ÿæœ€å¤§ç¨‹åº¦åœ°ä¿æŒå¹¶å‘æ€§ï¼Œä¹Ÿèƒ½è®©èµ„æºå……è£•æ—¶è¿æ¥ä¼ è¾“é€Ÿåº¦è¾¾åˆ°æœ€å¤§å€¼ã€‚</p><h2 id="-8" tabindex="-1"><a class="header-anchor" href="#-8"><span>--------------</span></a></h2><h2 id="_4-6-å¦‚ä½•ç†è§£æ˜¯-tcp-é¢å‘å­—èŠ‚æµåè®®" tabindex="-1"><a class="header-anchor" href="#_4-6-å¦‚ä½•ç†è§£æ˜¯-tcp-é¢å‘å­—èŠ‚æµåè®®"><span>4.6 å¦‚ä½•ç†è§£æ˜¯ TCP é¢å‘å­—èŠ‚æµåè®®ï¼Ÿ</span></a></h2><p>TCP æ˜¯é¢å‘å­—èŠ‚æµçš„åè®®ï¼ŒUDP æ˜¯é¢å‘æŠ¥æ–‡çš„åè®®ï¼Ÿè¿™é‡Œçš„ã€Œé¢å‘å­—èŠ‚æµã€å’Œã€Œé¢å‘æŠ¥æ–‡ã€è¯¥å¦‚ä½•ç†è§£ã€‚</p><h3 id="å¦‚ä½•ç†è§£å­—èŠ‚æµ" tabindex="-1"><a class="header-anchor" href="#å¦‚ä½•ç†è§£å­—èŠ‚æµ"><span>- å¦‚ä½•ç†è§£å­—èŠ‚æµï¼Ÿ</span></a></h3><p>ä¹‹æ‰€ä»¥ä¼šè¯´ TCP æ˜¯é¢å‘å­—èŠ‚æµçš„åè®®ï¼ŒUDP æ˜¯é¢å‘æŠ¥æ–‡çš„åè®®ï¼Œæ˜¯å› ä¸ºæ“ä½œç³»ç»Ÿå¯¹ TCP å’Œ UDP åè®®çš„<strong>å‘é€æ–¹çš„æœºåˆ¶ä¸åŒ</strong>ï¼Œä¹Ÿå°±æ˜¯é—®é¢˜åŸå› åœ¨å‘é€æ–¹ã€‚</p><blockquote><p>å…ˆæ¥è¯´è¯´ä¸ºä»€ä¹ˆ UDP æ˜¯<strong>é¢å‘æŠ¥æ–‡</strong>çš„åè®®ï¼Ÿ</p></blockquote><p>å½“ç”¨æˆ·æ¶ˆæ¯é€šè¿‡ UDP åè®®ä¼ è¾“æ—¶ï¼Œ<strong>æ“ä½œç³»ç»Ÿä¸ä¼šå¯¹æ¶ˆæ¯è¿›è¡Œæ‹†åˆ†</strong>ï¼Œåœ¨ç»„è£…å¥½ <strong>UDP å¤´éƒ¨</strong>åå°±äº¤ç»™ç½‘ç»œå±‚æ¥å¤„ç†ï¼Œæ‰€ä»¥å‘å‡ºå»çš„ UDP æŠ¥æ–‡ä¸­çš„æ•°æ®éƒ¨åˆ†å°±æ˜¯å®Œæ•´çš„ç”¨æˆ·æ¶ˆæ¯ï¼Œä¹Ÿå°±æ˜¯<strong>æ¯ä¸ª UDP æŠ¥æ–‡å°±æ˜¯ä¸€ä¸ªç”¨æˆ·æ¶ˆæ¯çš„è¾¹ç•Œ</strong>ï¼Œè¿™æ ·æ¥æ”¶æ–¹åœ¨æ¥æ”¶åˆ° UDP æŠ¥æ–‡åï¼Œè¯»ä¸€ä¸ª UDP æŠ¥æ–‡å°±èƒ½è¯»å–åˆ°å®Œæ•´çš„ç”¨æˆ·æ¶ˆæ¯ã€‚</p><p>ä½ å¯èƒ½ä¼šé—®ï¼Œå¦‚æœæ”¶åˆ°äº†ä¸¤ä¸ª UDP æŠ¥æ–‡ï¼Œæ“ä½œç³»ç»Ÿæ˜¯<strong>æ€ä¹ˆåŒºåˆ†å¼€çš„</strong>ï¼Ÿ</p><p>æ“ä½œç³»ç»Ÿåœ¨æ”¶åˆ° UDP æŠ¥æ–‡åï¼Œä¼šå°†å…¶æ’å…¥åˆ°<strong>é˜Ÿåˆ—é‡Œ</strong>ï¼Œ<strong>é˜Ÿåˆ—é‡Œçš„æ¯ä¸€ä¸ªå…ƒç´ å°±æ˜¯ä¸€ä¸ª UDP æŠ¥æ–‡</strong>ï¼Œè¿™æ ·å½“ç”¨æˆ·è°ƒç”¨ recvfrom() ç³»ç»Ÿè°ƒç”¨è¯»æ•°æ®çš„æ—¶å€™ï¼Œå°±ä¼šä»é˜Ÿåˆ—é‡Œå–å‡ºä¸€ä¸ªæ•°æ®ï¼Œç„¶åä»å†…æ ¸é‡Œæ‹·è´ç»™ç”¨æˆ·ç¼“å†²åŒºã€‚</p><img src="'+gp+'" alt="å›¾ç‰‡" style="zoom:67%;"><blockquote><p>å†æ¥è¯´è¯´ä¸ºä»€ä¹ˆ TCP æ˜¯é¢å‘å­—èŠ‚æµçš„åè®®ï¼Ÿ</p></blockquote><p>å½“ç”¨æˆ·æ¶ˆæ¯é€šè¿‡ TCP åè®®ä¼ è¾“æ—¶ï¼Œ<strong>æ¶ˆæ¯å¯èƒ½ä¼šè¢«æ“ä½œç³»ç»Ÿåˆ†ç»„æˆå¤šä¸ªçš„ TCP æŠ¥æ–‡</strong>ï¼Œä¹Ÿå°±æ˜¯ä¸€ä¸ªå®Œæ•´çš„ç”¨æˆ·æ¶ˆæ¯è¢«æ‹†åˆ†æˆ<strong>å¤šä¸ª TCP æŠ¥æ–‡</strong>è¿›è¡Œä¼ è¾“ã€‚</p><p>è¿™æ—¶ï¼Œæ¥æ”¶æ–¹çš„ç¨‹åºå¦‚æœä¸çŸ¥é“å‘é€æ–¹å‘é€çš„æ¶ˆæ¯çš„é•¿åº¦ï¼Œä¹Ÿå°±æ˜¯ä¸çŸ¥é“æ¶ˆæ¯çš„è¾¹ç•Œæ—¶ï¼Œæ˜¯<strong>æ— æ³•è¯»å‡ºä¸€ä¸ªæœ‰æ•ˆçš„ç”¨æˆ·æ¶ˆæ¯çš„</strong>ï¼Œå› ä¸ºç”¨æˆ·æ¶ˆæ¯è¢«æ‹†åˆ†æˆå¤šä¸ª TCP æŠ¥æ–‡åï¼Œå¹¶ä¸èƒ½åƒ UDP é‚£æ ·ï¼Œä¸€ä¸ª UDP æŠ¥æ–‡å°±èƒ½ä»£è¡¨ä¸€ä¸ªå®Œæ•´çš„ç”¨æˆ·æ¶ˆæ¯ã€‚</p><p>ä¸¾ä¸ªå®é™…çš„ä¾‹å­æ¥è¯´æ˜ã€‚</p><p>å‘é€æ–¹å‡†å¤‡å‘é€ ã€ŒHi.ã€å’Œã€ŒI am Xiaolinã€è¿™ä¸¤ä¸ªæ¶ˆæ¯ã€‚</p><p>åœ¨å‘é€ç«¯ï¼Œå½“æˆ‘ä»¬è°ƒç”¨ send å‡½æ•°å®Œæˆæ•°æ®â€œå‘é€â€ä»¥åï¼Œæ•°æ®å¹¶æ²¡æœ‰è¢«çœŸæ­£ä»ç½‘ç»œä¸Šå‘é€å‡ºå»ï¼Œåªæ˜¯<strong>ä»åº”ç”¨ç¨‹åºæ‹·è´åˆ°äº†æ“ä½œç³»ç»Ÿå†…æ ¸åè®®æ ˆä¸­ã€‚</strong></p><p>è‡³äºä»€ä¹ˆæ—¶å€™çœŸæ­£è¢«å‘é€ï¼Œ<strong>å–å†³äºå‘é€çª—å£ã€æ‹¥å¡çª—å£ä»¥åŠå½“å‰å‘é€ç¼“å†²åŒºçš„å¤§å°ç­‰æ¡ä»¶</strong>ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬ä¸èƒ½è®¤ä¸ºæ¯æ¬¡ send è°ƒç”¨å‘é€çš„æ•°æ®ï¼Œéƒ½ä¼šä½œä¸ºä¸€ä¸ªæ•´ä½“å®Œæ•´åœ°æ¶ˆæ¯è¢«å‘é€å‡ºå»ã€‚</p><p>å¦‚æœæˆ‘ä»¬è€ƒè™‘å®é™…ç½‘ç»œä¼ è¾“è¿‡ç¨‹ä¸­çš„å„ç§å½±å“ï¼Œå‡è®¾å‘é€ç«¯é™†ç»­è°ƒç”¨ send å‡½æ•°å…ˆåå‘é€ ã€ŒHi.ã€å’Œã€ŒI am Xiaolinã€ æŠ¥æ–‡ï¼Œé‚£ä¹ˆå®é™…çš„å‘é€å¾ˆæœ‰å¯èƒ½æ˜¯è¿™å‡ ç§æƒ…å†µã€‚</p><p>ç¬¬ä¸€ç§æƒ…å†µï¼Œè¿™ä¸¤ä¸ªæ¶ˆæ¯è¢«åˆ†åˆ°åŒä¸€ä¸ª TCP æŠ¥æ–‡ï¼Œåƒè¿™æ ·ï¼š</p><img src="'+ap+'" alt="å›¾ç‰‡" style="zoom:67%;"><p>ç¬¬äºŒç§æƒ…å†µï¼Œã€ŒI am Xiaolinã€çš„éƒ¨åˆ†éš ã€ŒHiã€ åœ¨ä¸€ä¸ª TCP æŠ¥æ–‡ä¸­å‘é€å‡ºå»ï¼Œåƒè¿™æ ·ï¼š</p><img src="'+lp+'" alt="å›¾ç‰‡" style="zoom:67%;"><p>ç¬¬ä¸‰ç§æƒ…å†µï¼Œã€ŒHi.ã€ çš„ä¸€éƒ¨åˆ†éš TCP æŠ¥æ–‡è¢«å‘é€å‡ºå»ï¼Œå¦ä¸€éƒ¨åˆ†å’Œ ã€ŒI am Xiaolinã€ ä¸€èµ·éšå¦ä¸€ä¸ª TCP æŠ¥æ–‡å‘é€å‡ºå»ï¼Œåƒè¿™æ ·ã€‚</p><img src="'+cp+'" alt="å›¾ç‰‡" style="zoom:67%;"><p>ç±»ä¼¼çš„æƒ…å†µè¿˜èƒ½ä¸¾ä¾‹<strong>å¾ˆå¤šç§</strong>ï¼Œè¿™é‡Œä¸»è¦æ˜¯æƒ³è¯´æ˜ï¼Œæˆ‘ä»¬ä¸çŸ¥é“ ã€ŒHi.ã€å’Œ ã€ŒI am Xiaolinã€ è¿™ä¸¤ä¸ªç”¨æˆ·æ¶ˆæ¯æ˜¯<strong>å¦‚ä½•è¿›è¡Œ TCP åˆ†ç»„ä¼ è¾“çš„ã€‚</strong></p><blockquote><p>å› æ­¤ï¼Œ<strong>æˆ‘ä»¬ä¸èƒ½è®¤ä¸ºä¸€ä¸ªç”¨æˆ·æ¶ˆæ¯å¯¹åº”ä¸€ä¸ª TCP æŠ¥æ–‡ï¼Œæ­£å› ä¸ºè¿™æ ·ï¼Œæ‰€ä»¥ TCP æ˜¯é¢å‘å­—èŠ‚æµçš„åè®®</strong>ã€‚</p></blockquote><p><strong>å½“ä¸¤ä¸ªæ¶ˆæ¯çš„æŸä¸ªéƒ¨åˆ†å†…å®¹</strong>è¢«åˆ†åˆ°<strong>åŒä¸€ä¸ª TCP æŠ¥æ–‡</strong>æ—¶ï¼Œå°±æ˜¯æˆ‘ä»¬å¸¸è¯´çš„ <strong>TCP ç²˜åŒ…é—®é¢˜</strong>ï¼Œè¿™æ—¶<strong>æ¥æ”¶æ–¹ä¸çŸ¥é“æ¶ˆæ¯çš„è¾¹ç•Œçš„è¯ï¼Œæ˜¯æ— æ³•è¯»å‡ºæœ‰æ•ˆçš„æ¶ˆæ¯ã€‚</strong></p><p>è¦è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œè¦äº¤ç»™<strong>åº”ç”¨ç¨‹åº</strong>ã€‚</p><h3 id="å¦‚ä½•è§£å†³ç²˜åŒ…" tabindex="-1"><a class="header-anchor" href="#å¦‚ä½•è§£å†³ç²˜åŒ…"><span>- å¦‚ä½•è§£å†³ç²˜åŒ…ï¼Ÿ</span></a></h3><p>ç²˜åŒ…çš„é—®é¢˜å‡ºç°æ˜¯å› ä¸º<strong>ä¸çŸ¥é“ä¸€ä¸ªç”¨æˆ·æ¶ˆæ¯çš„è¾¹ç•Œåœ¨å“ª</strong>ï¼Œå¦‚æœçŸ¥é“äº†è¾¹ç•Œåœ¨å“ªï¼Œæ¥æ”¶æ–¹å°±å¯ä»¥é€šè¿‡<strong>è¾¹ç•Œæ¥åˆ’åˆ†</strong>å‡ºæœ‰æ•ˆçš„ç”¨æˆ·æ¶ˆæ¯ã€‚</p><blockquote><p>ä¸€èˆ¬æœ‰ä¸‰ç§æ–¹å¼<strong>åˆ†åŒ…çš„æ–¹å¼</strong>ï¼š</p><ul><li>å›ºå®šé•¿åº¦çš„æ¶ˆæ¯ï¼›</li><li>ç‰¹æ®Šå­—ç¬¦ä½œä¸ºè¾¹ç•Œï¼›</li><li>è‡ªå®šä¹‰æ¶ˆæ¯ç»“æ„ã€‚</li></ul></blockquote><h4 id="å›ºå®šé•¿åº¦çš„æ¶ˆæ¯" tabindex="-1"><a class="header-anchor" href="#å›ºå®šé•¿åº¦çš„æ¶ˆæ¯"><span>-- å›ºå®šé•¿åº¦çš„æ¶ˆæ¯</span></a></h4><p>è¿™ç§æ˜¯æœ€ç®€å•æ–¹æ³•ï¼Œå³æ¯ä¸ªç”¨æˆ·æ¶ˆæ¯éƒ½æ˜¯å›ºå®šé•¿åº¦çš„ï¼Œæ¯”å¦‚è§„å®šä¸€ä¸ªæ¶ˆæ¯çš„é•¿åº¦æ˜¯ 64 ä¸ªå­—èŠ‚ï¼Œå½“æ¥æ”¶æ–¹æ¥æ»¡ 64 ä¸ªå­—èŠ‚ï¼Œå°±è®¤ä¸ºè¿™ä¸ªå†…å®¹æ˜¯ä¸€ä¸ªå®Œæ•´ä¸”æœ‰æ•ˆçš„æ¶ˆæ¯ã€‚</p><p>ä½†æ˜¯è¿™ç§æ–¹å¼çµæ´»æ€§ä¸é«˜ï¼Œå®é™…ä¸­å¾ˆå°‘ç”¨ã€‚</p><h4 id="ç‰¹æ®Šå­—ç¬¦ä½œä¸ºè¾¹ç•Œ" tabindex="-1"><a class="header-anchor" href="#ç‰¹æ®Šå­—ç¬¦ä½œä¸ºè¾¹ç•Œ"><span>- ç‰¹æ®Šå­—ç¬¦ä½œä¸ºè¾¹ç•Œ</span></a></h4><p>æˆ‘ä»¬å¯ä»¥åœ¨ä¸¤ä¸ªç”¨æˆ·æ¶ˆæ¯ä¹‹é—´æ’å…¥ä¸€ä¸ªç‰¹æ®Šçš„å­—ç¬¦ä¸²ï¼Œè¿™æ ·æ¥æ”¶æ–¹åœ¨æ¥æ”¶æ•°æ®æ—¶ï¼Œ<strong>è¯»åˆ°äº†è¿™ä¸ªç‰¹æ®Šå­—ç¬¦</strong>ï¼Œå°±æŠŠè®¤ä¸ºå·²ç»è¯»å®Œä¸€ä¸ªå®Œæ•´çš„æ¶ˆæ¯ã€‚</p><p><strong>HTTP æ˜¯ä¸€ä¸ªéå¸¸å¥½çš„ä¾‹å­ã€‚</strong></p><figure><img src="'+dp+`" alt="å›¾ç‰‡" tabindex="0" loading="lazy"><figcaption>å›¾ç‰‡</figcaption></figure><p>HTTP é€šè¿‡è®¾ç½®<strong>å›è½¦ç¬¦</strong>ã€<strong>æ¢è¡Œç¬¦</strong>ä½œä¸º <strong>HTTP æŠ¥æ–‡åè®®çš„è¾¹ç•Œã€‚</strong></p><p>æœ‰ä¸€ç‚¹è¦æ³¨æ„ï¼Œè¿™ä¸ªä½œä¸ºè¾¹ç•Œç‚¹çš„ç‰¹æ®Šå­—ç¬¦ï¼Œå¦‚æœåˆšå¥½æ¶ˆæ¯å†…å®¹é‡Œæœ‰è¿™ä¸ªç‰¹æ®Šå­—ç¬¦ï¼Œæˆ‘ä»¬è¦å¯¹è¿™ä¸ªå­—ç¬¦<strong>è½¬ä¹‰</strong>ï¼Œé¿å…è¢«æ¥æ”¶æ–¹å½“ä½œæ¶ˆæ¯çš„è¾¹ç•Œç‚¹è€Œè§£æåˆ°æ— æ•ˆçš„æ•°æ®ã€‚</p><h4 id="è‡ªå®šä¹‰æ¶ˆæ¯ç»“æ„" tabindex="-1"><a class="header-anchor" href="#è‡ªå®šä¹‰æ¶ˆæ¯ç»“æ„"><span>- è‡ªå®šä¹‰æ¶ˆæ¯ç»“æ„</span></a></h4><p>æˆ‘ä»¬å¯ä»¥è‡ªå®šä¹‰ä¸€ä¸ªæ¶ˆæ¯ç»“æ„ï¼Œç”±åŒ…å¤´å’Œæ•°æ®ç»„æˆï¼Œå…¶ä¸­åŒ…å¤´åŒ…æ˜¯å›ºå®šå¤§å°çš„ï¼Œè€Œä¸”åŒ…å¤´é‡Œæœ‰ä¸€ä¸ªå­—æ®µæ¥è¯´æ˜ç´§éšå…¶åçš„æ•°æ®æœ‰å¤šå¤§ã€‚</p><p>æ¯”å¦‚è¿™ä¸ªæ¶ˆæ¯ç»“æ„ä½“ï¼Œé¦–å…ˆ 4 ä¸ªå­—èŠ‚å¤§å°çš„å˜é‡æ¥è¡¨ç¤ºæ•°æ®é•¿åº¦ï¼ŒçœŸæ­£çš„æ•°æ®åˆ™åœ¨åé¢ã€‚</p><div class="language-c line-numbers-mode" data-ext="c" data-title="c"><pre class="language-c"><code><span class="token keyword">struct</span> <span class="token punctuation">{</span> 
    <span class="token class-name">u_int32_t</span> message_length<span class="token punctuation">;</span> 
    <span class="token keyword">char</span> message_data<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> 
<span class="token punctuation">}</span> message<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å½“æ¥æ”¶æ–¹æ¥æ”¶åˆ°åŒ…å¤´çš„å¤§å°ï¼ˆæ¯”å¦‚ 4 ä¸ªå­—èŠ‚ï¼‰åï¼Œå°±è§£æåŒ…å¤´çš„å†…å®¹ï¼Œäºæ˜¯å°±å¯ä»¥çŸ¥é“æ•°æ®çš„é•¿åº¦ï¼Œç„¶åæ¥ä¸‹æ¥å°±ç»§ç»­è¯»å–æ•°æ®ï¼Œç›´åˆ°è¯»æ»¡æ•°æ®çš„é•¿åº¦ï¼Œå°±å¯ä»¥ç»„è£…æˆä¸€ä¸ªå®Œæ•´åˆ°ç”¨æˆ·æ¶ˆæ¯æ¥å¤„ç†äº†ã€‚</p><h2 id="-9" tabindex="-1"><a class="header-anchor" href="#-9"><span>---------------</span></a></h2><h2 id="ğŸ•ğŸ•ğŸ•4-16-tcp-åè®®æœ‰ä»€ä¹ˆç¼ºé™·" tabindex="-1"><a class="header-anchor" href="#ğŸ•ğŸ•ğŸ•4-16-tcp-åè®®æœ‰ä»€ä¹ˆç¼ºé™·"><span>ğŸ•ğŸ•ğŸ•4.16 TCP åè®®æœ‰ä»€ä¹ˆ<mark>ç¼ºé™·</mark>ï¼Ÿ</span></a></h2><p>TCP é€šè¿‡<strong>åºåˆ—å·ã€ç¡®è®¤åº”ç­”ã€è¶…æ—¶é‡ä¼ ã€æµé‡æ§åˆ¶ã€æ‹¥å¡æ§åˆ¶</strong>ç­‰æ–¹å¼å®ç°äº†<strong>å¯é ä¼ è¾“</strong>ï¼Œçœ‹èµ·æ¥å®ƒå¾ˆå®Œç¾ï¼Œäº‹å®çœŸçš„æ˜¯è¿™æ ·å—ï¼ŸTCP å°±æ²¡ä»€ä¹ˆç¼ºé™·å—ï¼Ÿ</p><blockquote><p>æ‰€ä»¥ï¼Œä»Šå¤©å°±è·Ÿå¤§å®¶èŠèŠï¼ŒTCP åè®®æœ‰å“ªäº›ç¼ºé™·ï¼Ÿä¸»è¦æœ‰å››ä¸ªæ–¹é¢ï¼š</p><ul><li>å‡çº§ TCP çš„å·¥ä½œå¾ˆå›°éš¾ï¼›</li><li>TCP å»ºç«‹è¿æ¥çš„<strong>å»¶è¿Ÿ</strong>ï¼›</li><li>TCP å­˜åœ¨<strong>é˜Ÿå¤´é˜»å¡</strong>é—®é¢˜ï¼›</li><li><strong>ç½‘ç»œè¿ç§»</strong>éœ€è¦é‡æ–°å»ºç«‹ TCP è¿æ¥ï¼›</li></ul></blockquote><p>æ¥ä¸‹æ¥ï¼Œé’ˆå¯¹è¿™å››ä¸ªæ–¹é¢è¯¦ç»†è¯´ä¸€ä¸‹ã€‚</p><h3 id="å‡çº§-tcp-çš„å·¥ä½œå¾ˆå›°éš¾" tabindex="-1"><a class="header-anchor" href="#å‡çº§-tcp-çš„å·¥ä½œå¾ˆå›°éš¾"><span>- å‡çº§ TCP çš„å·¥ä½œå¾ˆå›°éš¾</span></a></h3><p>TCP åè®®æ˜¯è¯ç”Ÿåœ¨ 1973 å¹´ï¼Œè‡³ä»Š TCP åè®®ä¾ç„¶è¿˜åœ¨å®ç°æ›´å¤šçš„æ–°ç‰¹æ€§ã€‚</p><p>ä½†æ˜¯ <strong>TCP åè®®æ˜¯åœ¨å†…æ ¸ä¸­å®ç°çš„</strong>ï¼Œ<strong>åº”ç”¨ç¨‹åºåªèƒ½ä½¿ç”¨ä¸èƒ½ä¿®æ”¹</strong>ï¼Œå¦‚æœè¦æƒ³<strong>å‡çº§ TCP åè®®</strong>ï¼Œé‚£ä¹ˆåªèƒ½å‡çº§å†…æ ¸ã€‚</p><p>è€Œ<strong>å‡çº§å†…æ ¸</strong>è¿™ä¸ª<strong>å·¥ä½œæ˜¯å¾ˆéº»çƒ¦çš„äº‹æƒ…</strong>ï¼Œéº»çƒ¦çš„äº‹æƒ…ä¸æ˜¯è¯´å‡çº§å†…æ ¸è¿™ä¸ªæ“ä½œå¾ˆéº»çƒ¦ï¼Œè€Œæ˜¯ç”±äºå†…æ ¸å‡çº§æ¶‰åŠåˆ°åº•å±‚è½¯ä»¶å’Œè¿è¡Œåº“çš„æ›´æ–°ï¼Œæˆ‘ä»¬çš„æœåŠ¡ç¨‹åºå°±éœ€è¦å›å½’æµ‹è¯•æ˜¯å¦å…¼å®¹æ–°çš„å†…æ ¸ç‰ˆæœ¬ï¼Œæ‰€ä»¥æœåŠ¡å™¨çš„å†…æ ¸å‡çº§ä¹Ÿæ¯”è¾ƒä¿å®ˆå’Œç¼“æ…¢ã€‚</p><p>å¾ˆå¤š <strong>TCP åè®®çš„æ–°ç‰¹æ€§</strong>ï¼Œéƒ½æ˜¯éœ€è¦<strong>å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯åŒæ—¶æ”¯æŒ</strong>æ‰èƒ½ç”Ÿæ•ˆçš„ï¼Œæ¯”å¦‚ TCP Fast Open è¿™ä¸ªç‰¹æ€§ï¼Œè™½ç„¶åœ¨2013 å¹´å°±è¢«æå‡ºäº†ï¼Œä½†æ˜¯ Windows å¾ˆå¤šç³»ç»Ÿç‰ˆæœ¬ä¾ç„¶ä¸æ”¯æŒå®ƒï¼Œè¿™æ˜¯å› ä¸º PC ç«¯çš„ç³»ç»Ÿå‡çº§æ»åå¾ˆä¸¥é‡ï¼ŒW indows Xp ç°åœ¨è¿˜æœ‰å¤§é‡ç”¨æˆ·åœ¨ä½¿ç”¨ï¼Œå°½ç®¡å®ƒå·²ç»å­˜åœ¨å¿« 20 å¹´ã€‚</p><p>æ‰€ä»¥ï¼Œ<strong>å³ä½¿ TCP æœ‰æ¯”è¾ƒå¥½çš„ç‰¹æ€§æ›´æ–°ï¼Œä¹Ÿå¾ˆéš¾å¿«é€Ÿæ¨å¹¿</strong>ï¼Œç”¨æˆ·å¾€å¾€è¦å‡ å¹´æˆ–è€…åå¹´æ‰èƒ½ä½“éªŒåˆ°ã€‚</p><h3 id="tcp-å»ºç«‹è¿æ¥çš„-å»¶è¿Ÿ" tabindex="-1"><a class="header-anchor" href="#tcp-å»ºç«‹è¿æ¥çš„-å»¶è¿Ÿ"><span>- TCP å»ºç«‹è¿æ¥çš„ å»¶è¿Ÿ</span></a></h3><p>åŸºäº TCP å®ç°çš„<strong>åº”ç”¨åè®®</strong>ï¼Œéƒ½æ˜¯<strong>éœ€è¦å…ˆå»ºç«‹ä¸‰æ¬¡æ¡æ‰‹</strong>æ‰èƒ½è¿›è¡Œæ•°æ®ä¼ è¾“ï¼Œæ¯”å¦‚ HTTP 1.0/1.1ã€HTTP/2ã€HTTPSã€‚</p><p>ç°åœ¨<strong>å¤§å¤šæ•°ç½‘ç«™</strong>éƒ½æ˜¯<strong>ä½¿ç”¨ HTTPS</strong> çš„ï¼Œè¿™æ„å‘³ç€åœ¨ <strong>TCP ä¸‰æ¬¡æ¡æ‰‹ä¹‹å</strong>ï¼Œè¿˜éœ€è¦ç»è¿‡ <strong>TLS å››æ¬¡æ¡æ‰‹å</strong>ï¼Œæ‰èƒ½<strong>è¿›è¡Œ HTTP æ•°æ®çš„ä¼ è¾“</strong>ï¼Œè¿™åœ¨ä¸€å®šç¨‹åºä¸Šå¢åŠ äº†<strong>æ•°æ®ä¼ è¾“çš„å»¶è¿Ÿ</strong>ã€‚</p><blockquote><p>TCP ä¸‰æ¬¡æ¡æ‰‹å’Œ TLS æ¡æ‰‹å»¶è¿Ÿï¼Œå¦‚å›¾ï¼š</p></blockquote><p>TCP ä¸‰æ¬¡æ¡æ‰‹çš„å»¶è¿Ÿè¢« <strong>TCP Fast Open ï¼ˆå¿«é€Ÿæ‰“å¼€ï¼‰<strong>è¿™ä¸ªç‰¹æ€§è§£å†³äº†ï¼Œè¿™ä¸ªç‰¹æ€§å¯ä»¥</strong>åœ¨ã€Œç¬¬äºŒæ¬¡å»ºç«‹è¿æ¥ã€æ—¶</strong>å‡å°‘ TCP è¿æ¥å»ºç«‹çš„æ—¶å»¶ã€‚</p><figure><img src="`+mp+'" alt="å¸¸è§„ HTTP è¯·æ±‚ ä¸ Fast  Open HTTP è¯·æ±‚" tabindex="0" loading="lazy"><figcaption>å¸¸è§„ HTTP è¯·æ±‚ ä¸ Fast Open HTTP è¯·æ±‚</figcaption></figure><p>è¿‡ç¨‹å¦‚ä¸‹ï¼š</p><ul><li>åœ¨ç¬¬ä¸€æ¬¡å»ºç«‹è¿æ¥çš„æ—¶å€™ï¼ŒæœåŠ¡ç«¯åœ¨ç¬¬äºŒæ¬¡æ¡æ‰‹äº§ç”Ÿä¸€ä¸ª <code>Cookie</code> ï¼ˆå·²åŠ å¯†ï¼‰å¹¶é€šè¿‡ SYNã€ACK åŒ…ä¸€èµ·å‘ç»™å®¢æˆ·ç«¯ï¼Œäºæ˜¯å®¢æˆ·ç«¯å°±ä¼šç¼“å­˜è¿™ä¸ª <code>Cookie</code>ï¼Œæ‰€ä»¥ç¬¬ä¸€æ¬¡å‘èµ· HTTP Get è¯·æ±‚çš„æ—¶å€™ï¼Œè¿˜æ˜¯éœ€è¦ 2 ä¸ª RTT çš„æ—¶å»¶ï¼›</li><li>åœ¨ä¸‹æ¬¡è¯·æ±‚çš„æ—¶å€™ï¼Œå®¢æˆ·ç«¯åœ¨ SYN åŒ…å¸¦ä¸Š <code>Cookie</code> å‘ç»™æœåŠ¡ç«¯ï¼Œå°±æå‰å¯ä»¥è·³è¿‡ä¸‰æ¬¡æ¡æ‰‹çš„è¿‡ç¨‹ï¼Œå› ä¸º <code>Cookie</code> ä¸­ç»´æŠ¤äº†ä¸€äº›ä¿¡æ¯ï¼ŒæœåŠ¡ç«¯å¯ä»¥ä» <code>Cookie</code> è·å– TCP ç›¸å…³çš„ä¿¡æ¯ï¼Œè¿™æ—¶å‘èµ·çš„ HTTP GET è¯·æ±‚å°±åªéœ€è¦ 1 ä¸ª RTT çš„æ—¶å»¶ï¼›</li></ul><p>TCP Fast Open è¿™ä¸ªç‰¹æ€§æ˜¯ä¸é”™ï¼Œä½†æ˜¯å®ƒéœ€è¦æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯çš„æ“ä½œç³»ç»ŸåŒæ—¶æ”¯æŒæ‰èƒ½ä½“éªŒåˆ°ï¼Œè€Œ TCP Fast Open æ˜¯åœ¨ 2013 å¹´æå‡ºçš„ï¼Œæ‰€ä»¥å¸‚é¢ä¸Šä¾ç„¶æœ‰å¾ˆå¤šè€å¼çš„æ“ä½œç³»ç»Ÿä¸æ”¯æŒï¼Œè€Œå‡çº§æ“ä½œç³»ç»Ÿæ˜¯å¾ˆéº»çƒ¦çš„äº‹æƒ…ï¼Œå› æ­¤ <strong>TCP Fast Open å¾ˆéš¾è¢«æ™®åŠå¼€æ¥</strong>ã€‚</p><p>è¿˜æœ‰ä¸€ç‚¹ï¼Œé’ˆå¯¹ HTTPS æ¥è¯´ï¼Œ<strong>TLS æ˜¯åœ¨åº”ç”¨å±‚å®ç°çš„æ¡æ‰‹</strong>ï¼Œè€Œ TCP æ˜¯åœ¨å†…æ ¸å®ç°çš„æ¡æ‰‹ï¼Œè¿™ä¸¤ä¸ªæ¡æ‰‹<strong>è¿‡ç¨‹æ˜¯æ— æ³•ç»“åˆåœ¨ä¸€èµ·</strong>çš„ï¼Œæ€»æ˜¯å¾—å…ˆå®Œæˆ TCP æ¡æ‰‹ï¼Œæ‰èƒ½è¿›è¡Œ TLS æ¡æ‰‹ã€‚</p><p>ä¹Ÿæ­£æ˜¯ TCP æ˜¯åœ¨å†…æ ¸å®ç°çš„ï¼Œæ‰€ä»¥ <strong>TLS æ˜¯æ— æ³•å¯¹ TCP å¤´éƒ¨åŠ å¯†çš„</strong>ï¼Œè¿™æ„å‘³ç€ <strong>TCP çš„åºåˆ—å·éƒ½æ˜¯æ˜æ–‡ä¼ è¾“</strong>ï¼Œæ‰€ä»¥å°±å­˜å®‰å…¨çš„é—®é¢˜ã€‚</p><p>ä¸€ä¸ªå…¸å‹çš„ä¾‹å­å°±æ˜¯æ”»å‡»è€…ä¼ªé€ ä¸€ä¸ªçš„ RST æŠ¥æ–‡å¼ºåˆ¶å…³é—­ä¸€æ¡ TCP è¿æ¥ï¼Œè€Œæ”»å‡»æˆåŠŸçš„å…³é”®åˆ™æ˜¯ <strong>TCP å­—æ®µé‡Œçš„åºåˆ—å·ä½äºæ¥æ”¶æ–¹çš„æ»‘åŠ¨çª—å£å†…</strong>ï¼Œè¯¥æŠ¥æ–‡å°±æ˜¯åˆæ³•çš„ã€‚</p><p>ä¸ºæ­¤ TCP ä¹Ÿä¸å¾—ä¸è¿›è¡Œä¸‰æ¬¡æ¡æ‰‹æ¥åŒæ­¥å„è‡ªçš„åºåˆ—å·ï¼Œè€Œä¸”åˆå§‹åŒ–åºåˆ—å·æ—¶æ˜¯é‡‡ç”¨éšæœºçš„æ–¹å¼ï¼ˆä¸å®Œå…¨éšæœºï¼Œè€Œæ˜¯éšç€æ—¶é—´æµé€è€Œçº¿æ€§å¢é•¿ï¼Œåˆ°äº† 2^32 å°½å¤´å†å›æ»šï¼‰æ¥æå‡æ”»å‡»è€…çŒœæµ‹åºåˆ—å·çš„éš¾åº¦ï¼Œä»¥å¢åŠ å®‰å…¨æ€§ã€‚</p><p>ä½†æ˜¯è¿™ç§æ–¹å¼åªèƒ½é¿å…æ”»å‡»è€…é¢„æµ‹å‡ºåˆæ³•çš„ RST æŠ¥æ–‡ï¼Œè€Œæ— æ³•é¿å…æ”»å‡»è€…æˆªè·å®¢æˆ·ç«¯çš„æŠ¥æ–‡ï¼Œç„¶åä¸­é€”ä¼ªé€ å‡ºåˆæ³• RST æŠ¥æ–‡çš„æ”»å‡»çš„æ–¹å¼ã€‚</p><img src="'+Tp+'" alt="img" style="zoom:50%;"><p>å¤§èƒ†æƒ³ä¸€ä¸‹ï¼Œå¦‚æœ TCP çš„åºåˆ—å·ä¹Ÿèƒ½è¢«åŠ å¯†ï¼Œæˆ–è®¸çœŸçš„ä¸éœ€è¦ä¸‰æ¬¡æ¡æ‰‹äº†ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯çš„åˆå§‹åºåˆ—å·éƒ½ä» 0 å¼€å§‹ï¼Œä¹Ÿå°±ä¸ç”¨åšåŒæ­¥åºåˆ—å·çš„å·¥ä½œäº†ï¼Œä½†æ˜¯è¦å®ç°è¿™ä¸ªè¦æ”¹é€ æ•´ä¸ªåè®®æ ˆï¼Œå¤ªè¿‡äºéº»çƒ¦ï¼Œå³ä½¿å®ç°å‡ºæ¥äº†ï¼Œå¾ˆå¤šè€çš„ç½‘ç»œè®¾å¤‡æœªå¿…èƒ½å…¼å®¹ã€‚</p><h3 id="tcp-å­˜åœ¨é˜Ÿå¤´é˜»å¡é—®é¢˜" tabindex="-1"><a class="header-anchor" href="#tcp-å­˜åœ¨é˜Ÿå¤´é˜»å¡é—®é¢˜"><span>- TCP å­˜åœ¨<mark>é˜Ÿå¤´é˜»å¡</mark>é—®é¢˜</span></a></h3><p>TCP æ˜¯<strong>å­—èŠ‚æµåè®®</strong>ï¼Œ<strong>TCP å±‚å¿…é¡»ä¿è¯<code>æ”¶åˆ°çš„å­—èŠ‚æ•°æ®æ˜¯å®Œæ•´ä¸”æœ‰åºçš„</code></strong>ï¼Œå¦‚æœ<strong>åºåˆ—å·è¾ƒä½çš„</strong> TCP æ®µåœ¨ç½‘ç»œä¼ è¾“ä¸­ä¸¢å¤±äº†ï¼Œ<strong>å³ä½¿åºåˆ—å·è¾ƒé«˜çš„ TCP æ®µå·²ç»è¢«æ¥æ”¶äº†</strong>ï¼Œåº”ç”¨å±‚ä¹Ÿæ— <strong>æ³•ä»å†…æ ¸ä¸­è¯»å–åˆ°è¿™éƒ¨åˆ†æ•°æ®</strong>ã€‚å¦‚ä¸‹å›¾ï¼š</p><figure><img src="'+hp+'" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><p>å›¾ä¸­å‘é€æ–¹å‘é€äº†å¾ˆ<strong>å¤šä¸ª packet</strong>ï¼Œæ¯ä¸ª packet éƒ½æœ‰è‡ªå·±çš„åºå·ï¼Œä½ å¯ä»¥è®¤ä¸ºæ˜¯ TCP çš„åºåˆ—å·ï¼Œå…¶ä¸­ <code>packet #3</code> åœ¨ç½‘ç»œä¸­ä¸¢å¤±äº†ï¼Œå³ä½¿ <code>packet #4-6</code> è¢«æ¥æ”¶æ–¹æ”¶åˆ°åï¼Œ<strong>ç”±äºå†…æ ¸ä¸­çš„ TCP æ•°æ®ä¸æ˜¯è¿ç»­çš„</strong>ï¼Œäºæ˜¯æ¥æ”¶æ–¹çš„åº”ç”¨å±‚å°±æ— æ³•ä»å†…æ ¸ä¸­è¯»å–åˆ°ï¼Œåªæœ‰ç­‰åˆ° <code>packet #3</code> <strong>é‡ä¼ åï¼Œæ¥æ”¶æ–¹çš„åº”ç”¨å±‚æ‰å¯ä»¥ä»å†…æ ¸ä¸­è¯»å–åˆ°æ•°æ®ã€‚</strong></p><blockquote><p>è¿™å°±æ˜¯ <strong><code>TCP é˜Ÿå¤´é˜»å¡é—®é¢˜</code></strong>ï¼Œä½†è¿™ä¹Ÿä¸èƒ½æ€ª TCP ï¼Œå› ä¸º**<code>åªæœ‰è¿™æ ·åšæ‰èƒ½ä¿è¯æ•°æ®çš„æœ‰åºæ€§</code>**ã€‚</p></blockquote><p>HTTP/2 å¤šä¸ªè¯·æ±‚æ˜¯è·‘åœ¨<strong>ä¸€ä¸ª TCP è¿æ¥</strong>ä¸­çš„ï¼Œé‚£ä¹ˆ<strong>å½“ TCP <code>ä¸¢åŒ…</code>æ—¶ï¼Œ<code>æ•´ä¸ª TCP éƒ½è¦ç­‰å¾…é‡ä¼ </code></strong>ï¼Œé‚£ä¹ˆå°±ä¼š<strong>é˜»å¡è¯¥ TCP è¿æ¥ä¸­çš„æ‰€æœ‰è¯·æ±‚</strong>ï¼Œæ‰€ä»¥ HTTP/2 <strong>é˜Ÿå¤´é˜»å¡</strong>é—®é¢˜å°±æ˜¯<strong>å› ä¸º TCP åè®®å¯¼è‡´çš„ã€‚</strong></p><img src="'+up+'" alt="img" style="zoom:67%;"><h3 id="ç½‘ç»œè¿ç§»éœ€è¦é‡æ–°å»ºç«‹-tcp-è¿æ¥" tabindex="-1"><a class="header-anchor" href="#ç½‘ç»œè¿ç§»éœ€è¦é‡æ–°å»ºç«‹-tcp-è¿æ¥"><span>- ç½‘ç»œè¿ç§»éœ€è¦é‡æ–°å»ºç«‹ TCP è¿æ¥</span></a></h3><p>åŸºäº TCP ä¼ è¾“åè®®çš„ HTTP åè®®ï¼Œç”±äºæ˜¯é€šè¿‡**å››å…ƒç»„ï¼ˆæº IPã€æºç«¯å£ã€ç›®çš„ IPã€ç›®çš„ç«¯å£ï¼‰**ç¡®å®šä¸€æ¡ TCP è¿æ¥ã€‚</p><img src="'+_p+'" alt="TCP å››å…ƒç»„" style="zoom:67%;"><p>é‚£ä¹ˆ<strong>å½“ç§»åŠ¨è®¾å¤‡çš„ç½‘ç»œä» 4G åˆ‡æ¢åˆ° WIFI æ—¶ï¼Œæ„å‘³ç€ IP åœ°å€å˜åŒ–äº†ï¼Œé‚£ä¹ˆå°±å¿…é¡»è¦æ–­å¼€è¿æ¥ï¼Œç„¶åé‡æ–°å»ºç«‹ TCP è¿æ¥</strong>ã€‚</p><p>è€Œå»ºç«‹è¿æ¥çš„è¿‡ç¨‹åŒ…å« TCP ä¸‰æ¬¡æ¡æ‰‹å’Œ TLS å››æ¬¡æ¡æ‰‹çš„æ—¶å»¶ï¼Œä»¥åŠ TCP æ…¢å¯åŠ¨çš„å‡é€Ÿè¿‡ç¨‹ï¼Œç»™ç”¨æˆ·çš„æ„Ÿè§‰å°±æ˜¯<strong>ç½‘ç»œçªç„¶å¡é¡¿äº†ä¸€ä¸‹</strong>ï¼Œå› æ­¤è¿æ¥çš„è¿ç§»æˆæœ¬æ˜¯å¾ˆé«˜çš„ã€‚</p><h3 id="ç»“å°¾" tabindex="-1"><a class="header-anchor" href="#ç»“å°¾"><span>- ç»“å°¾</span></a></h3><p>æˆ‘è®°å¾—ä¹‹å‰åœ¨ç¾¤é‡Œçœ‹åˆ°ï¼Œæœ‰ä½è¯»è€…<strong>å­—èŠ‚ä¸€é¢</strong>çš„æ—¶å€™è¢«é—®åˆ°ï¼šã€Œ<strong>å¦‚ä½•åŸºäº UDP åè®®å®ç°å¯é ä¼ è¾“ï¼Ÿ</strong>ã€</p><p>å¾ˆå¤šåŒå­¦ç¬¬ä¸€ååº”å°±ä¼šè¯´æŠŠ TCP å¯é ä¼ è¾“çš„ç‰¹æ€§ï¼ˆåºåˆ—å·ã€ç¡®è®¤åº”ç­”ã€è¶…æ—¶é‡ä¼ ã€æµé‡æ§åˆ¶ã€æ‹¥å¡æ§åˆ¶ï¼‰åœ¨åº”ç”¨å±‚å®ç°ä¸€éã€‚</p><p>å®ç°çš„æ€è·¯ç¡®å®è¿™æ ·æ²¡é”™ï¼Œä½†æ˜¯æœ‰æ²¡æœ‰æƒ³è¿‡ï¼Œ<strong>æ—¢ç„¶ TCP å¤©ç„¶æ”¯æŒå¯é ä¼ è¾“ï¼Œä¸ºä»€ä¹ˆè¿˜éœ€è¦åŸºäº UDP å®ç°å¯é ä¼ è¾“å‘¢ï¼Ÿè¿™ä¸æ˜¯é‡å¤é€ è½®å­å—ï¼Ÿ</strong></p><blockquote><p>æ‰€ä»¥ï¼Œæˆ‘ä»¬è¦å…ˆå¼„æ¸…æ¥š <strong>TCP åè®®æœ‰å“ªäº›ç—›ç‚¹</strong>ï¼Ÿè€Œè¿™äº›ç—›ç‚¹æ˜¯å¦å¯ä»¥åœ¨åŸºäº UDP åè®®å®ç°çš„å¯é ä¼ è¾“åè®®ä¸­å¾—åˆ°æ”¹è¿›ï¼Ÿ</p></blockquote><p>ç°åœ¨å¸‚é¢ä¸Šå·²ç»æœ‰åŸºäº UDP åè®®å®ç°çš„å¯é ä¼ è¾“åè®®çš„æˆç†Ÿæ–¹æ¡ˆäº†ï¼Œé‚£å°±æ˜¯ QUIC åè®®ï¼Œ<strong>QUIC åè®®æŠŠæˆ‘æœ¬æ–‡è¯´çš„ TCP çš„ç¼ºç‚¹éƒ½ç»™è§£å†³äº†</strong>ï¼Œè€Œä¸”å·²ç»åº”ç”¨åœ¨äº† <strong>HTTP/3</strong>ã€‚</p><figure><img src="'+Pp+'" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><h2 id="-10" tabindex="-1"><a class="header-anchor" href="#-10"><span>--------------</span></a></h2><h2 id="ğŸƒğŸƒğŸƒ4-17-å¦‚ä½•åŸºäº-udp-åè®®å®ç°å¯é ä¼ è¾“" tabindex="-1"><a class="header-anchor" href="#ğŸƒğŸƒğŸƒ4-17-å¦‚ä½•åŸºäº-udp-åè®®å®ç°å¯é ä¼ è¾“"><span>ğŸƒğŸƒğŸƒ4.17 <mark>å¦‚ä½•åŸºäº UDP åè®®å®ç°å¯é ä¼ è¾“ï¼Ÿ</mark></span></a></h2><blockquote><p>æˆ‘è®°å¾—ä¹‹å‰åœ¨ç¾¤é‡Œçœ‹åˆ°ï¼Œæœ‰ä½è¯»è€…å­—èŠ‚ä¸€é¢çš„æ—¶å€™è¢«é—®åˆ°ï¼šã€Œ<strong>å¦‚ä½•åŸºäº UDP åè®®å®ç°å¯é ä¼ è¾“ï¼Ÿ</strong>ã€</p></blockquote><p>å¾ˆå¤šåŒå­¦ç¬¬ä¸€ååº”å°±ä¼šè¯´æŠŠ **TCP å¯é ä¼ è¾“çš„ç‰¹æ€§ï¼ˆåºåˆ—å·ã€ç¡®è®¤åº”ç­”ã€è¶…æ—¶é‡ä¼ ã€æµé‡æ§åˆ¶ã€æ‹¥å¡æ§åˆ¶ï¼‰**åœ¨åº”ç”¨å±‚å®ç°ä¸€éã€‚</p><p>å®ç°çš„æ€è·¯ç¡®å®è¿™æ ·æ²¡é”™ï¼Œä½†æ˜¯æœ‰æ²¡æœ‰æƒ³è¿‡ï¼Œ<strong>æ—¢ç„¶ TCP å¤©ç„¶æ”¯æŒå¯é ä¼ è¾“ï¼Œä¸ºä»€ä¹ˆè¿˜éœ€è¦åŸºäº UDP å®ç°å¯é ä¼ è¾“å‘¢ï¼Ÿè¿™ä¸æ˜¯é‡å¤é€ è½®å­å—ï¼Ÿ</strong></p><p>æ‰€ä»¥ï¼Œæˆ‘ä»¬è¦<strong>å…ˆå¼„æ¸…æ¥š TCP åè®®æœ‰å“ªäº›ç—›ç‚¹ï¼Ÿ<strong>è€Œè¿™äº›ç—›ç‚¹</strong>æ˜¯å¦å¯ä»¥åœ¨åŸºäº UDP åè®®å®ç°çš„å¯é ä¼ è¾“åè®®ä¸­å¾—åˆ°æ”¹è¿›ï¼Ÿ</strong></p>',106),hg={href:"https://mp.weixin.qq.com/s/9kHoRk6QIYOFUR_PCmHY6g",target:"_blank",rel:"noopener noreferrer"},ug=o("ul",null,[o("li",null,"å‡çº§ TCP çš„å·¥ä½œå¾ˆå›°éš¾ï¼›"),o("li",null,[t("TCP å»ºç«‹è¿æ¥çš„"),o("strong",null,"å»¶è¿Ÿ"),t("ï¼›")]),o("li",null,[t("TCP å­˜åœ¨"),o("strong",null,"é˜Ÿå¤´é˜»å¡"),t("é—®é¢˜ï¼›")]),o("li",null,[o("strong",null,"ç½‘ç»œè¿ç§»"),t("éœ€è¦é‡æ–°å»ºç«‹ TCP è¿æ¥ï¼›")])],-1),_g=n('<p>ç°åœ¨å¸‚é¢ä¸Šå·²ç»æœ‰åŸºäº UDP åè®®å®ç°çš„å¯é ä¼ è¾“åè®®çš„æˆç†Ÿæ–¹æ¡ˆäº†ï¼Œé‚£å°±æ˜¯ <code>QUIC </code>åè®®ï¼Œå·²ç»åº”ç”¨åœ¨äº† <code>HTTP/3</code>ã€‚</p><p>è¿™æ¬¡ï¼Œ<strong>èŠèŠ QUIC æ˜¯å¦‚ä½•å®ç°<code>å¯é ä¼ è¾“çš„</code>ï¼Ÿåˆæ˜¯å¦‚ä½•è§£å†³ä¸Šé¢ TCP åè®®å››ä¸ªæ–¹é¢çš„ç¼ºé™·</strong>ï¼Ÿ</p><img src="'+Cp+'" alt="img" style="zoom:50%;"><h3 id="ğŸ”®-quic-æ˜¯å¦‚ä½•å®ç°å¯é ä¼ è¾“çš„" tabindex="-1"><a class="header-anchor" href="#ğŸ”®-quic-æ˜¯å¦‚ä½•å®ç°å¯é ä¼ è¾“çš„"><span>ğŸ”® QUIC æ˜¯å¦‚ä½•å®ç°<mark>å¯é ä¼ è¾“</mark>çš„ï¼Ÿ</span></a></h3><blockquote><p>è¦åŸºäº UDP å®ç°çš„å¯é ä¼ è¾“åè®®ï¼Œé‚£ä¹ˆå°±è¦åœ¨**<code>åº”ç”¨å±‚</code><strong>ä¸‹åŠŸå¤«ï¼Œä¹Ÿå°±æ˜¯è¦</strong>è®¾è®¡å¥½<code>åè®®çš„å¤´éƒ¨å­—æ®µ</code>ã€‚**</p></blockquote><p>æ‹¿ HTTP/3 ä¸¾ä¾‹å­ï¼Œåœ¨ <strong>UDP æŠ¥æ–‡å¤´éƒ¨</strong>ä¸ <strong>HTTP æ¶ˆæ¯</strong>ä¹‹é—´ï¼Œå…±æœ‰ <strong>3 å±‚å¤´éƒ¨</strong>ï¼š</p><img src="'+bp+'" alt="img" style="zoom:67%;"><p>æ•´ä½“çœ‹çš„è§†è§’æ˜¯è¿™æ ·çš„ï¼š</p><figure><img src="'+kp+'" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><p>æ¥ä¸‹æ¥ï¼Œåˆ†åˆ«å¯¹æ¯ä¸€ä¸ª <strong>Header</strong> åšä¸ªä»‹ç»ã€‚</p><h4 id="packet-header" tabindex="-1"><a class="header-anchor" href="#packet-header"><span>- Packet Header</span></a></h4><p>Packet Header <strong>é¦–æ¬¡å»ºç«‹è¿æ¥æ—¶</strong>å’Œ<strong>æ—¥å¸¸ä¼ è¾“æ•°æ®æ—¶</strong>ä½¿ç”¨çš„ Header æ˜¯ä¸åŒçš„ã€‚å¦‚ä¸‹å›¾ï¼ˆ<em>æ³¨æ„æˆ‘æ²¡æœ‰æŠŠ Header æ‰€æœ‰å­—æ®µéƒ½ç”»å‡ºæ¥ï¼Œåªæ˜¯ç”»å‡ºäº†é‡è¦çš„å­—æ®µ</em>ï¼‰ï¼š</p><img src="'+fp+'" alt="Packet Header" style="zoom:67%;"><p>Packet Header ç»†åˆ†è¿™ä¸¤ç§ï¼š</p><ul><li>Long Packet Header ç”¨äºé¦–æ¬¡å»ºç«‹è¿æ¥ã€‚</li><li>Short Packet Header ç”¨äºæ—¥å¸¸ä¼ è¾“æ•°æ®ã€‚</li></ul><p>QUIC ä¹Ÿæ˜¯éœ€è¦**<code>ä¸‰æ¬¡æ¡æ‰‹æ¥</code><strong>å»ºç«‹è¿æ¥çš„ï¼Œä¸»è¦ç›®çš„æ˜¯ä¸ºäº†</strong>åå•†è¿æ¥ ID**ã€‚åå•†å‡ºè¿æ¥ ID åï¼Œåç»­ä¼ è¾“æ—¶ï¼ŒåŒæ–¹<strong>åªéœ€è¦<code>å›ºå®šä½è¿æ¥ ID</code></strong>ï¼Œä»è€Œå®ç°<strong>è¿æ¥è¿ç§»åŠŸèƒ½</strong>ã€‚æ‰€ä»¥ï¼Œä½ å¯ä»¥çœ‹åˆ°æ—¥å¸¸ä¼ è¾“æ•°æ®çš„ Short Packet Header ä¸éœ€è¦åœ¨ä¼ è¾“ Source Connection ID å­—æ®µäº†ï¼Œåªéœ€è¦ä¼ è¾“ Destination Connection IDã€‚</p><p>Short Packet Header ä¸­çš„ <code>Packet Number</code> æ˜¯**<code>æ¯ä¸ªæŠ¥æ–‡ç‹¬ä¸€æ— äºŒçš„ç¼–å·</code><strong>ï¼Œå®ƒæ˜¯</strong><code>ä¸¥æ ¼é€’å¢</code><strong>çš„ï¼Œä¹Ÿå°±æ˜¯è¯´å°±ç®— Packet N ä¸¢å¤±äº†ï¼Œ<strong>é‡ä¼ çš„</strong> Packet N çš„ Packet Number å·²ç»ä¸æ˜¯ Nï¼Œè€Œ</strong>æ˜¯ä¸€ä¸ªæ¯” N å¤§çš„å€¼**ã€‚</p><img src="'+Sp+'" alt="img" style="zoom:67%;"><blockquote><p>ä¸ºä»€ä¹ˆè¦è¿™ä¹ˆè®¾è®¡å‘¢ï¼Ÿ</p></blockquote><p>æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹ TCP çš„é—®é¢˜ï¼ŒTCP åœ¨<strong>é‡ä¼ æŠ¥æ–‡æ—¶</strong>çš„<strong>åºåˆ—å·å’ŒåŸå§‹æŠ¥æ–‡çš„åºåˆ—å·</strong>æ˜¯<strong>ä¸€æ ·çš„</strong>ï¼Œä¹Ÿæ­£æ˜¯ç”±äºè¿™ä¸ª<strong>ç‰¹æ€§</strong>ï¼Œå¼•å…¥äº† <strong><code>TCP é‡ä¼ çš„æ­§ä¹‰é—®é¢˜</code>ã€‚</strong></p><figure><img src="'+Ap+'" alt="TCP é‡ä¼ çš„æ­§ä¹‰é—®é¢˜" tabindex="0" loading="lazy"><figcaption>TCP é‡ä¼ çš„æ­§ä¹‰é—®é¢˜</figcaption></figure><p>æ¯”å¦‚ä¸Šå›¾ï¼Œå½“ TCP å‘ç”Ÿ<strong>è¶…æ—¶é‡ä¼ </strong>åï¼Œå®¢æˆ·ç«¯å‘èµ·é‡ä¼ ï¼Œç„¶åæ¥æ”¶åˆ°äº†æœåŠ¡ç«¯ç¡®è®¤ ACK ã€‚ç”±äºå®¢æˆ·ç«¯åŸå§‹æŠ¥æ–‡å’Œé‡ä¼ æŠ¥æ–‡åºåˆ—å·éƒ½æ˜¯ä¸€æ ·çš„ï¼Œé‚£ä¹ˆ<strong>æœåŠ¡ç«¯</strong>é’ˆå¯¹<strong>è¿™ä¸¤ä¸ªæŠ¥æ–‡å›å¤çš„éƒ½æ˜¯ç›¸åŒçš„ ACK</strong>ã€‚</p><p>è¿™æ ·çš„è¯ï¼Œ<strong>å®¢æˆ·ç«¯å°±æ— æ³•åˆ¤æ–­å‡ºæ˜¯ã€ŒåŸå§‹æŠ¥æ–‡çš„å“åº”ã€è¿˜æ˜¯ã€Œé‡ä¼ æŠ¥æ–‡çš„å“åº”ã€</strong>ï¼Œè¿™æ ·åœ¨<strong>è®¡ç®— RTTï¼ˆå¾€è¿”æ—¶é—´ï¼‰</strong> æ—¶åº”è¯¥é€‰æ‹©ä»å‘é€åŸå§‹æŠ¥æ–‡å¼€å§‹è®¡ç®—ï¼Œè¿˜æ˜¯é‡ä¼ åŸå§‹æŠ¥æ–‡å¼€å§‹è®¡ç®—å‘¢ï¼Ÿ</p><ul><li>å¦‚æœç®—æˆåŸå§‹è¯·æ±‚çš„å“åº”ï¼Œä½†å®é™…ä¸Šæ˜¯é‡ä¼ è¯·æ±‚çš„å“åº”ï¼ˆä¸Šå›¾å·¦ï¼‰ï¼Œä¼šå¯¼è‡´é‡‡æ · <strong>RTT å˜å¤§</strong>ã€‚</li><li>å¦‚æœç®—æˆé‡ä¼ è¯·æ±‚çš„å“åº”ï¼Œä½†å®é™…ä¸Šæ˜¯åŸå§‹è¯·æ±‚çš„å“åº”ï¼ˆä¸Šå›¾å³ï¼‰ï¼Œåˆå¾ˆå®¹æ˜“å¯¼è‡´é‡‡æ · <strong>RTT è¿‡å°</strong>ã€‚</li></ul><blockquote><p><strong>RTO ï¼ˆè¶…æ—¶æ—¶é—´ï¼‰<strong>æ˜¯åŸºäº RTT æ¥è®¡ç®—çš„ï¼Œé‚£ä¹ˆå¦‚æœ <strong>RTT è®¡ç®—ä¸ç²¾å‡†ï¼Œé‚£ä¹ˆ RTO ï¼ˆè¶…æ—¶æ—¶é—´ï¼‰ä¹Ÿä¼šä¸ç²¾ç¡®</strong>ï¼Œè¿™æ ·</strong>å¯èƒ½å¯¼è‡´é‡ä¼ çš„æ¦‚ç‡äº‹ä»¶å¢å¤§</strong>ã€‚</p></blockquote><p>QUIC æŠ¥æ–‡ä¸­çš„ Pakcet Number æ˜¯ä¸¥æ ¼é€’å¢çš„ï¼Œ å³ä½¿æ˜¯<strong>é‡ä¼ æŠ¥æ–‡</strong>ï¼Œ<strong>å®ƒçš„ Pakcet Number ä¹Ÿæ˜¯é€’å¢çš„</strong>ï¼Œè¿™æ ·å°±èƒ½<strong>æ›´åŠ <code>ç²¾ç¡®</code>è®¡ç®—å‡º<code>æŠ¥æ–‡çš„ RTT</code></strong>ã€‚</p><figure><img src="'+Ip+'" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><p>å¦‚æœ ACK çš„ Packet Number æ˜¯ N+Mï¼Œå°±æ ¹æ®<strong>é‡ä¼ æŠ¥æ–‡è®¡ç®—é‡‡æ · RTT</strong>ã€‚å¦‚æœ ACK çš„ Pakcet Number æ˜¯ Nï¼Œå°±æ ¹æ®åŸå§‹æŠ¥æ–‡çš„æ—¶é—´è®¡ç®—é‡‡æ · RTTï¼Œ<strong>æ²¡æœ‰æ­§ä¹‰æ€§çš„é—®é¢˜</strong>ã€‚</p><p>å¦å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ªå¥½å¤„ï¼Œ<strong>QUIC ä½¿ç”¨çš„ Packet Number å•è°ƒé€’å¢çš„è®¾è®¡ï¼Œå¯ä»¥è®©æ•°æ®åŒ…<code>ä¸å†åƒ TCP é‚£æ ·</code>å¿…é¡»<code>æœ‰åºç¡®è®¤</code>ï¼Œ<code>QUIC æ”¯æŒä¹±åºç¡®è®¤</code>ï¼Œå½“æ•°æ®åŒ…Packet N ä¸¢å¤±åï¼Œåªè¦æœ‰<code>æ–°çš„å·²æ¥æ”¶æ•°æ®åŒ…</code>ç¡®è®¤ï¼Œå½“å‰çª—å£å°±ä¼š<code>ç»§ç»­å‘å³æ»‘åŠ¨</code></strong>ï¼ˆåé¢è®²æµé‡æ§åˆ¶çš„æ—¶å€™ï¼Œä¼šä¸¾ä¾‹å­ï¼‰ã€‚</p><p>å¾…å‘é€ç«¯<strong>è·çŸ¥</strong>æ•°æ®åŒ…Packet N <strong>ä¸¢å¤±</strong>åï¼Œä¼š**<code>å°†éœ€è¦é‡ä¼ çš„æ•°æ®åŒ…æ”¾åˆ°å¾…å‘é€é˜Ÿåˆ—</code><strong>ï¼Œ<strong>é‡æ–°ç¼–å·</strong>æ¯”å¦‚æ•°æ®åŒ…Packet N+M å</strong>é‡æ–°å‘é€<strong>ç»™æ¥æ”¶ç«¯ï¼Œå¯¹é‡ä¼ æ•°æ®åŒ…çš„å¤„ç† è·Ÿ <strong>å‘é€æ–°çš„æ•°æ®åŒ…ç±»ä¼¼</strong>ï¼Œè¿™</strong>æ ·å°±<code>ä¸ä¼šå› ä¸ºä¸¢åŒ…é‡ä¼ å°†å½“å‰çª—å£é˜»å¡åœ¨åŸåœ°</code><strong>ï¼Œä»è€Œ</strong><code>è§£å†³äº†é˜Ÿå¤´é˜»å¡</code>**é—®é¢˜ã€‚</p><blockquote><p>æ‰€ä»¥ï¼Œ<strong>Packet Number å•è°ƒé€’å¢</strong>çš„ä¸¤ä¸ªå¥½å¤„ï¼š</p><ul><li>å¯ä»¥<strong>æ›´åŠ ç²¾ç¡®è®¡ç®—</strong> RTTï¼Œæ²¡æœ‰ TCP é‡ä¼ çš„æ­§ä¹‰æ€§é—®é¢˜ï¼›</li><li>å¯ä»¥<strong>æ”¯æŒä¹±åºç¡®è®¤</strong>ï¼Œå› ä¸ºä¸¢åŒ…é‡ä¼ å°†å½“å‰çª—å£é˜»å¡åœ¨åŸåœ°ï¼Œè€Œ TCP å¿…é¡»æ˜¯é¡ºåºç¡®è®¤çš„ï¼Œä¸¢åŒ…æ—¶ä¼šå¯¼è‡´çª—å£ä¸æ»‘åŠ¨ï¼›</li></ul></blockquote><h4 id="quic-frame-header" tabindex="-1"><a class="header-anchor" href="#quic-frame-header"><span>- QUIC Frame Header</span></a></h4><p><strong>ä¸€ä¸ª Packet æŠ¥æ–‡</strong>ä¸­å¯ä»¥<strong>å­˜æ”¾å¤šä¸ª QUIC Frame</strong>ã€‚</p><img src="'+xp+'" alt="img" style="zoom:67%;"><p>æ¯ä¸€ä¸ª Frame éƒ½æœ‰<strong>æ˜ç¡®çš„ç±»å‹</strong>ï¼Œé’ˆå¯¹ç±»å‹çš„ä¸åŒï¼ŒåŠŸèƒ½ä¹Ÿä¸åŒï¼Œè‡ªç„¶æ ¼å¼ä¹Ÿä¸åŒã€‚</p><p>æˆ‘è¿™é‡Œåªä¸¾ä¾‹ <strong>Stream ç±»å‹çš„ Frame æ ¼å¼</strong>ï¼ŒStream å¯ä»¥è®¤ä¸ºå°±æ˜¯<strong>ä¸€æ¡ HTTP è¯·æ±‚</strong>ï¼Œå®ƒé•¿è¿™æ ·ï¼š</p><img src="'+Np+'" alt="img" style="zoom:67%;"><ul><li><p>Stream ID ä½œç”¨ï¼š<strong>å¤šä¸ªå¹¶å‘ä¼ è¾“çš„ HTTP æ¶ˆæ¯</strong>ï¼Œé€šè¿‡ä¸åŒçš„ Stream ID åŠ ä»¥åŒºåˆ«ï¼Œç±»ä¼¼äº HTTP2 çš„ Stream IDï¼›</p></li><li><blockquote><p>Offset ä½œç”¨ï¼šç±»ä¼¼äº <strong>TCP åè®®ä¸­çš„ Seq åºå·</strong>ï¼Œ<strong>ä¿è¯æ•°æ®çš„é¡ºåºæ€§å’Œå¯é æ€§</strong>ï¼›</p></blockquote></li><li><p>Length ä½œç”¨ï¼šæŒ‡æ˜äº† Frame æ•°æ®çš„é•¿åº¦ã€‚</p></li></ul><p>åœ¨å‰é¢ä»‹ç» Packet Header æ—¶ï¼Œè¯´åˆ° <strong>Packet Number æ˜¯ä¸¥æ ¼é€’å¢</strong>ï¼Œå³ä½¿é‡ä¼ æŠ¥æ–‡çš„ Packet Number ä¹Ÿæ˜¯é€’å¢çš„ï¼Œæ—¢ç„¶é‡ä¼ æ•°æ®åŒ…çš„ Packet N+M ä¸ä¸¢å¤±æ•°æ®åŒ…çš„ Packet N ç¼–å·å¹¶ä¸ä¸€è‡´ï¼Œæˆ‘ä»¬**<code>æ€ä¹ˆç¡®å®šè¿™ä¸¤ä¸ªæ•°æ®åŒ…çš„å†…å®¹ä¸€æ ·å‘¢</code>ï¼Ÿ**</p><blockquote><p>æ‰€ä»¥å¼•å…¥ <strong>Frame Header è¿™ä¸€å±‚</strong>ï¼Œ<strong><code>é€šè¿‡ Stream ID + Offset å­—æ®µä¿¡æ¯å®ç°æ•°æ®çš„æœ‰åºæ€§</code></strong>ï¼Œé€šè¿‡<strong>æ¯”è¾ƒ</strong>ä¸¤ä¸ªæ•°æ®åŒ…çš„ Stream ID ä¸ Stream Offset ï¼Œ<strong>å¦‚æœéƒ½æ˜¯ä¸€è‡´</strong>ï¼Œå°±è¯´æ˜è¿™ä¸¤ä¸ª<strong>æ•°æ®åŒ…çš„å†…å®¹ä¸€è‡´</strong>ã€‚</p></blockquote><p>ä¸¾ä¸ªä¾‹å­ï¼Œä¸‹å›¾ä¸­ï¼Œæ•°æ®åŒ… Packet N ä¸¢å¤±äº†ï¼Œåé¢é‡ä¼ è¯¥æ•°æ®åŒ…çš„ç¼–å·ä¸º Packet N+2ï¼Œ<strong>ä¸¢å¤±çš„æ•°æ®åŒ…å’Œé‡ä¼ çš„æ•°æ®åŒ… Stream ID ä¸ Offset éƒ½ä¸€è‡´ï¼Œè¯´æ˜è¿™ä¸¤ä¸ªæ•°æ®åŒ…çš„å†…å®¹ä¸€è‡´</strong>ã€‚</p><p>è¿™äº›æ•°æ®åŒ…ä¼ è¾“åˆ°æ¥æ”¶ç«¯åï¼Œæ¥æ”¶ç«¯èƒ½æ ¹æ® Stream ID ä¸ Offset å­—æ®µä¿¡æ¯å°† Stream x å’Œ Stream x+y <strong>æŒ‰ç…§é¡ºåºç»„ç»‡èµ·æ¥</strong>ï¼Œç„¶åäº¤ç»™åº”ç”¨ç¨‹åºå¤„ç†ã€‚</p><img src="'+qp+'" alt="img" style="zoom:67%;"><p>æ€»çš„æ¥è¯´ï¼Œ<strong>QUIC é€šè¿‡å•å‘é€’å¢çš„ Packet Numberï¼Œ<code>é…åˆ Stream ID ä¸ Offset å­—æ®µä¿¡æ¯</code>ï¼Œå¯ä»¥<code>æ”¯æŒä¹±åºç¡®è®¤</code>è€Œ<code>ä¸å½±å“æ•°æ®åŒ…çš„æ­£ç¡®ç»„è£…</code></strong>ï¼Œæ‘†è„±äº†TCP <strong>å¿…é¡»æŒ‰é¡ºåºç¡®è®¤åº”ç­” ACK çš„é™åˆ¶</strong>ï¼Œè§£å†³äº† TCP <strong>å› æŸä¸ªæ•°æ®åŒ…é‡ä¼ </strong>è€Œ<strong>é˜»å¡åç»­æ‰€æœ‰å¾…å‘é€æ•°æ®åŒ…</strong>çš„é—®é¢˜ã€‚</p><h3 id="ğŸ”®-quic-æ˜¯å¦‚ä½•è§£å†³-tcp-é˜Ÿå¤´é˜»å¡é—®é¢˜çš„" tabindex="-1"><a class="header-anchor" href="#ğŸ”®-quic-æ˜¯å¦‚ä½•è§£å†³-tcp-é˜Ÿå¤´é˜»å¡é—®é¢˜çš„"><span>ğŸ”® QUIC æ˜¯å¦‚ä½•è§£å†³ TCP é˜Ÿå¤´é˜»å¡é—®é¢˜çš„ï¼Ÿ</span></a></h3><h4 id="ä»€ä¹ˆæ˜¯-tcp-é˜Ÿå¤´é˜»å¡é—®é¢˜" tabindex="-1"><a class="header-anchor" href="#ä»€ä¹ˆæ˜¯-tcp-é˜Ÿå¤´é˜»å¡é—®é¢˜"><span>- ä»€ä¹ˆæ˜¯ TCP é˜Ÿå¤´é˜»å¡é—®é¢˜ï¼Ÿ</span></a></h4><p>TCP é˜Ÿå¤´é˜»å¡çš„é—®é¢˜ï¼Œå…¶å®å°±æ˜¯**<code>æ¥æ”¶çª—å£çš„é˜Ÿå¤´é˜»å¡é—®é¢˜</code>**ã€‚</p><p>æ¥æ”¶æ–¹æ”¶åˆ°çš„æ•°æ®èŒƒå›´å¿…é¡»åœ¨<strong>æ¥æ”¶çª—å£èŒƒå›´å†…</strong>ï¼Œå¦‚æœæ”¶åˆ°<strong>è¶…è¿‡æ¥æ”¶çª—å£èŒƒå›´çš„æ•°æ®</strong>ï¼Œå°±ä¼š<strong>ä¸¢å¼ƒè¯¥æ•°æ®</strong>ï¼Œæ¯”å¦‚ä¸‹å›¾æ¥æ”¶çª—å£çš„èŒƒå›´æ˜¯ 32 ï½ 51 å­—èŠ‚ï¼Œå¦‚æœæ”¶åˆ°ç¬¬ 52 å­—èŠ‚ä»¥ä¸Šæ•°æ®éƒ½ä¼šè¢«ä¸¢å¼ƒã€‚</p><img src="'+yp+'" alt="æ¥æ”¶çª—å£" style="zoom:67%;"><p>æ¥æ”¶çª—å£ä»€ä¹ˆæ—¶å€™æ‰èƒ½æ»‘åŠ¨ï¼Ÿå½“æ¥æ”¶çª—å£æ”¶åˆ°æœ‰åºæ•°æ®æ—¶ï¼Œæ¥æ”¶çª—å£æ‰èƒ½å¾€å‰æ»‘åŠ¨ï¼Œç„¶åé‚£äº›<strong>å·²ç»æ¥æ”¶å¹¶ä¸”è¢«ç¡®è®¤çš„ã€Œæœ‰åºã€æ•°æ®</strong>å°±å¯ä»¥<strong>è¢«åº”ç”¨å±‚è¯»å–</strong>ã€‚</p><p>ä½†æ˜¯ï¼Œ<strong>å½“æ¥æ”¶çª—å£æ”¶åˆ°çš„æ•°æ®ä¸æ˜¯æœ‰åºçš„ï¼Œæ¯”å¦‚æ”¶åˆ°ç¬¬ 33ï½40 å­—èŠ‚çš„æ•°æ®ï¼Œç”±äºç¬¬ 32 å­—èŠ‚æ•°æ®æ²¡æœ‰æ”¶åˆ°ï¼Œ æ¥æ”¶çª—å£æ— æ³•å‘å‰æ»‘åŠ¨ï¼Œé‚£ä¹ˆå³ä½¿å…ˆæ”¶åˆ°ç¬¬ 33ï½40 å­—èŠ‚çš„æ•°æ®ï¼Œè¿™äº›æ•°æ®ä¹Ÿæ— æ³•è¢«åº”ç”¨å±‚è¯»å–çš„</strong>ã€‚åªæœ‰å½“å‘é€æ–¹é‡ä¼ äº†ç¬¬ 32 å­—èŠ‚æ•°æ®å¹¶ä¸”è¢«æ¥æ”¶æ–¹æ”¶åˆ°åï¼Œæ¥æ”¶çª—å£æ‰ä¼šå¾€å‰æ»‘åŠ¨ï¼Œç„¶ååº”ç”¨å±‚æ‰èƒ½ä»å†…æ ¸è¯»å–ç¬¬ 32ï½40 å­—èŠ‚çš„æ•°æ®ã€‚</p><blockquote><p>å¯¼è‡´æ¥æ”¶çª—å£çš„<strong>é˜Ÿå¤´é˜»å¡</strong>é—®é¢˜ï¼Œæ˜¯å› ä¸º <strong><code>TCP å¿…é¡»æŒ‰åºå¤„ç†æ•°æ®</code>ï¼Œä¹Ÿå°±æ˜¯ TCP å±‚ä¸ºäº†<code>ä¿è¯æ•°æ®çš„æœ‰åºæ€§</code>ï¼Œåªæœ‰åœ¨<code>å¤„ç†å®Œæœ‰åºçš„æ•°æ®</code>åï¼Œæ»‘åŠ¨çª—å£æ‰èƒ½<code>å¾€å‰æ»‘åŠ¨ï¼Œå¦åˆ™å°±åœç•™</code></strong>ï¼Œåœç•™ã€Œæ¥æ”¶çª—å£ã€ä¼š<strong>ä½¿å¾—åº”ç”¨å±‚æ— æ³•è¯»å–æ–°çš„æ•°æ®</strong>ã€‚</p></blockquote><p>å…¶å®ä¹Ÿä¸èƒ½æ€ª TCP åè®®ï¼Œå®ƒæœ¬æ¥è®¾è®¡ç›®çš„<strong>å°±æ˜¯ä¸ºäº†ä¿è¯æ•°æ®çš„æœ‰åºæ€§</strong>ã€‚</p><h4 id="http-2-çš„é˜Ÿå¤´é˜»å¡" tabindex="-1"><a class="header-anchor" href="#http-2-çš„é˜Ÿå¤´é˜»å¡"><span>- HTTP/2 çš„é˜Ÿå¤´é˜»å¡</span></a></h4><p>HTTP/2 é€šè¿‡æŠ½è±¡å‡º Stream çš„æ¦‚å¿µï¼Œå®ç°äº† HTTP å¹¶å‘ä¼ è¾“ï¼Œä¸€ä¸ª Stream å°±ä»£è¡¨ HTTP/1.1 é‡Œçš„è¯·æ±‚å’Œå“åº”ã€‚</p><img src="'+Hp+'" alt="HTTP/2" style="zoom:67%;"><p>åœ¨ HTTP/2 è¿æ¥ä¸Šï¼Œä¸åŒ Stream çš„å¸§æ˜¯å¯ä»¥ä¹±åºå‘é€çš„ï¼ˆå› æ­¤å¯ä»¥å¹¶å‘ä¸åŒçš„ Stream ï¼‰ï¼Œå› ä¸ºæ¯ä¸ªå¸§çš„å¤´éƒ¨ä¼šæºå¸¦ Stream ID ä¿¡æ¯ï¼Œæ‰€ä»¥æ¥æ”¶ç«¯å¯ä»¥é€šè¿‡ Stream ID æœ‰åºç»„è£…æˆ HTTP æ¶ˆæ¯ï¼Œè€ŒåŒä¸€ Stream å†…éƒ¨çš„å¸§å¿…é¡»æ˜¯ä¸¥æ ¼æœ‰åºçš„ã€‚</p><p><strong>ä½†æ˜¯ HTTP/2 å¤šä¸ª Stream è¯·æ±‚éƒ½æ˜¯åœ¨<code>ä¸€æ¡ TCP è¿æ¥ä¸Šä¼ è¾“</code>ï¼Œè¿™æ„å‘³ç€å¤šä¸ª Stream å…±ç”¨åŒä¸€ä¸ª TCP æ»‘åŠ¨çª—å£ï¼Œé‚£ä¹ˆå½“å‘ç”Ÿæ•°æ®ä¸¢å¤±ï¼Œæ»‘åŠ¨çª—å£æ˜¯æ— æ³•å¾€å‰ç§»åŠ¨çš„ï¼Œæ­¤æ—¶å°±ä¼šé˜»å¡ä½æ‰€æœ‰çš„ HTTP è¯·æ±‚ï¼Œè¿™å±äº TCP å±‚é˜Ÿå¤´é˜»å¡</strong>ã€‚</p><img src="'+vp+'" alt="img" style="zoom:67%;"><h4 id="æ²¡æœ‰é˜Ÿå¤´é˜»å¡çš„-quic" tabindex="-1"><a class="header-anchor" href="#æ²¡æœ‰é˜Ÿå¤´é˜»å¡çš„-quic"><span>- <mark>æ²¡æœ‰é˜Ÿå¤´é˜»å¡</mark>çš„ QUIC</span></a></h4><p>QUIC ä¹Ÿå€Ÿé‰´ HTTP/2 é‡Œçš„ Stream çš„æ¦‚å¿µï¼Œåœ¨ä¸€æ¡ QUIC è¿æ¥ä¸Šå¯ä»¥<strong>å¹¶å‘å‘é€å¤šä¸ª HTTP è¯·æ±‚ (Stream)ã€‚</strong></p><p>ä½†æ˜¯ <strong>QUIC ç»™æ¯ä¸€ä¸ª Stream éƒ½åˆ†é…äº†ä¸€ä¸ª<code>ç‹¬ç«‹çš„æ»‘åŠ¨çª—å£</code>ï¼Œè¿™æ ·ä½¿å¾—ä¸€ä¸ªè¿æ¥ä¸Šçš„å¤šä¸ª Stream ä¹‹é—´<code>æ²¡æœ‰ä¾èµ–å…³ç³»</code>ï¼Œéƒ½æ˜¯<code>ç›¸äº’ç‹¬ç«‹çš„</code>ï¼Œ<code>å„è‡ªæ§åˆ¶çš„æ»‘åŠ¨çª—å£</code></strong>ã€‚</p><blockquote><p>å‡å¦‚ Stream 2 ä¸¢äº†ä¸€ä¸ª UDP åŒ…ï¼Œä¹Ÿåªä¼šå½±å“ Stream 2 çš„å¤„ç†ï¼Œ<strong>ä¸ä¼šå½±å“å…¶ä»– Stream</strong>ï¼Œä¸ HTTP/2 ä¸åŒï¼Œ<strong>HTTP/2 åªè¦æŸä¸ªæµä¸­çš„æ•°æ®åŒ…ä¸¢å¤±äº†ï¼Œå…¶ä»–æµä¹Ÿä¼šå› æ­¤å—å½±å“ã€‚</strong></p></blockquote><img src="'+zp+'" alt="img" style="zoom:67%;"><h3 id="ğŸ”®-quic-æ˜¯å¦‚ä½•åšæµé‡æ§åˆ¶çš„" tabindex="-1"><a class="header-anchor" href="#ğŸ”®-quic-æ˜¯å¦‚ä½•åšæµé‡æ§åˆ¶çš„"><span>ğŸ”® QUIC æ˜¯å¦‚ä½•åšæµé‡æ§åˆ¶çš„ï¼Ÿ</span></a></h3><p>TCP æµé‡æ§åˆ¶æ˜¯é€šè¿‡è®©**ã€Œæ¥æ”¶æ–¹ã€å‘Šè¯‰ã€Œå‘é€æ–¹ã€<strong>ï¼Œå®ƒï¼ˆæ¥æ”¶æ–¹ï¼‰çš„</strong>æ¥æ”¶çª—å£æœ‰å¤šå¤§**ï¼Œä»è€Œ<strong>è®©ã€Œå‘é€æ–¹ã€æ ¹æ®ã€Œæ¥æ”¶æ–¹ã€çš„å®é™…æ¥æ”¶èƒ½åŠ›</strong> <strong>æ§åˆ¶å‘é€çš„æ•°æ®é‡</strong>ã€‚</p><blockquote><p><strong>QUIC å®ç°æµé‡æ§åˆ¶çš„æ–¹å¼ï¼š</strong></p></blockquote><ul><li>é€šè¿‡ window_update å¸§å‘Šè¯‰å¯¹ç«¯è‡ªå·±å¯ä»¥æ¥æ”¶çš„å­—èŠ‚æ•°ï¼Œè¿™æ ·å‘é€æ–¹å°±ä¸ä¼šå‘é€è¶…è¿‡è¿™ä¸ªæ•°é‡çš„æ•°æ®ã€‚</li><li>é€šè¿‡ BlockFrame å‘Šè¯‰å¯¹ç«¯ç”±äºæµé‡æ§åˆ¶è¢«é˜»å¡äº†ï¼Œæ— æ³•å‘é€æ•°æ®ã€‚</li></ul><p>åœ¨å‰é¢è¯´åˆ°ï¼ŒTCP çš„æ¥æ”¶çª—å£åœ¨æ”¶åˆ°æœ‰åºçš„æ•°æ®åï¼Œæ¥æ”¶çª—å£æ‰èƒ½å¾€å‰æ»‘åŠ¨ï¼Œå¦åˆ™åœæ­¢æ»‘åŠ¨ã€‚</p><p>QUIC æ˜¯åŸºäº UDP ä¼ è¾“çš„ï¼Œè€Œ <strong>UDP æ²¡æœ‰æµé‡æ§åˆ¶</strong>ï¼Œå› æ­¤ <strong><code>QUIC å®ç°äº†è‡ªå·±çš„æµé‡æ§åˆ¶æœºåˆ¶</code></strong>ï¼ŒQUIC çš„æ»‘åŠ¨çª—å£æ»‘åŠ¨çš„æ¡ä»¶è·Ÿ TCP æœ‰ä¸€ç‚¹å·®åˆ«ï¼Œä½†æ˜¯<strong>åŒä¸€ä¸ª Stream çš„æ•°æ®</strong>ä¹Ÿæ˜¯è¦ä¿è¯é¡ºåºçš„ï¼Œä¸ç„¶æ— æ³•å®ç°å¯é ä¼ è¾“ï¼Œå› æ­¤åŒä¸€ä¸ª Stream çš„æ•°æ®åŒ…ä¸¢å¤±äº†ï¼Œä¹Ÿä¼šé€ æˆçª—å£æ— æ³•æ»‘åŠ¨ã€‚</p><p><strong>QUIC çš„ æ¯ä¸ª Stream éƒ½æœ‰å„è‡ªçš„æ»‘åŠ¨çª—å£ï¼Œä¸åŒ Stream äº’ç›¸ç‹¬ç«‹ï¼Œé˜Ÿå¤´çš„ Stream A è¢«é˜»å¡åï¼Œä¸å¦¨ç¢ StreamBã€Cçš„è¯»å–</strong>ã€‚è€Œå¯¹äº HTTP/2 è€Œè¨€ï¼Œæ‰€æœ‰çš„ Stream éƒ½è·‘åœ¨ä¸€æ¡ TCP è¿æ¥ä¸Šï¼Œè€Œè¿™äº› Stream å…±äº«ä¸€ä¸ªæ»‘åŠ¨çª—å£ï¼Œå› æ­¤åŒä¸€ä¸ªConnectionå†…ï¼ŒStream A è¢«é˜»å¡åï¼ŒStreamBã€C å¿…é¡»ç­‰å¾…ã€‚</p><blockquote><p>QUIC å®ç°äº†<strong>ä¸¤ç§çº§åˆ«çš„æµé‡æ§åˆ¶</strong>ï¼Œåˆ†åˆ«ä¸º Stream å’Œ Connection ä¸¤ç§çº§åˆ«ï¼š</p></blockquote><ul><li><strong>Stream çº§åˆ«çš„æµé‡æ§åˆ¶</strong>ï¼šStream å¯ä»¥è®¤ä¸ºå°±æ˜¯ä¸€æ¡ HTTP è¯·æ±‚ï¼Œæ¯ä¸ª Stream éƒ½æœ‰ç‹¬ç«‹çš„æ»‘åŠ¨çª—å£ï¼Œæ‰€ä»¥æ¯ä¸ª Stream éƒ½å¯ä»¥åšæµé‡æ§åˆ¶ï¼Œ<strong>é˜²æ­¢å•ä¸ª Stream æ¶ˆè€—è¿æ¥ï¼ˆConnectionï¼‰çš„å…¨éƒ¨æ¥æ”¶ç¼“å†²</strong>ã€‚</li><li><strong>Connection æµé‡æ§åˆ¶</strong>ï¼šé™åˆ¶è¿æ¥ä¸­æ‰€æœ‰ Stream <strong>ç›¸åŠ èµ·æ¥çš„æ€»å­—èŠ‚æ•°</strong>ï¼Œ<strong>é˜²æ­¢å‘é€æ–¹è¶…è¿‡è¿æ¥çš„ç¼“å†²å®¹é‡</strong>ã€‚</li></ul><h4 id="stream-çº§åˆ«çš„æµé‡æ§åˆ¶" tabindex="-1"><a class="header-anchor" href="#stream-çº§åˆ«çš„æµé‡æ§åˆ¶"><span>- Stream çº§åˆ«çš„æµé‡æ§åˆ¶</span></a></h4>',74),Pg=o("strong",null,"æ¥æ”¶æ–¹çš„æ¥æ”¶çª—å£",-1),Cg={href:"https://docs.google.com/document/d/1F2YfdDXKpy20WVKJueEf4abn_LVZHhMUMS5gX6Pgjl4/mobilebasic",target:"_blank",rel:"noopener noreferrer"},bg=n('<figure><img src="'+Ep+'" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><p>æ¥ç€ï¼Œæ¥æ”¶æ–¹æ”¶åˆ°äº†å‘é€æ–¹å‘é€è¿‡æ¥çš„æ•°æ®ï¼Œæœ‰çš„æ•°æ®è¢«ä¸Šå±‚è¯»å–äº†ï¼Œæœ‰çš„æ•°æ®ä¸¢åŒ…äº†ï¼Œæ­¤æ—¶çš„æ¥æ”¶çª—å£çŠ¶å†µå¦‚ä¸‹ï¼š</p><figure><img src="'+wp+'" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œ<strong><code>æ¥æ”¶çª—å£çš„å·¦è¾¹ç•Œ</code> å–å†³äº <code>æ¥æ”¶åˆ°çš„æœ€å¤§åç§»å­—èŠ‚æ•°</code></strong>ï¼Œæ­¤æ—¶çš„<code>æ¥æ”¶çª—å£ = æœ€å¤§çª—å£æ•° - æ¥æ”¶åˆ°çš„æœ€å¤§åç§»æ•°</code>ã€‚</p><p>è¿™é‡Œå°±å¯ä»¥çœ‹å‡º QUIC çš„æµé‡æ§åˆ¶å’Œ TCP æœ‰ç‚¹<strong>åŒºåˆ«</strong>äº†ï¼š</p><ul><li>TCP çš„æ¥æ”¶çª—å£åªæœ‰åœ¨å‰é¢<strong>æ‰€æœ‰çš„ Segment éƒ½æ¥æ”¶çš„</strong>æƒ…å†µä¸‹æ‰ä¼š<strong>ç§»åŠ¨å·¦è¾¹ç•Œ</strong>ï¼Œå½“åœ¨<strong>å‰é¢è¿˜æœ‰å­—èŠ‚æœªæ¥æ”¶</strong> <strong>ä½†æ”¶åˆ°åé¢å­—èŠ‚çš„æƒ…å†µä¸‹ï¼Œçª—å£ä¹Ÿä¸ä¼šç§»åŠ¨</strong>ã€‚</li><li>QUIC çš„æ¥æ”¶çª—å£çš„å·¦è¾¹ç•Œæ»‘åŠ¨æ¡ä»¶å–å†³äº<strong>æ¥æ”¶åˆ°çš„æœ€å¤§åç§»å­—èŠ‚æ•°</strong>ã€‚</li></ul><p><em>PSï¼šä½†æ˜¯ä½ è¦é—®æˆ‘è¿™ä¹ˆè®¾è®¡æœ‰ä»€ä¹ˆå¥½å¤„ï¼Ÿæˆ‘ä¹Ÿæš‚æ—¶æ²¡æƒ³åˆ°ï¼Œå› ä¸ºèµ„æ–™å¤ªå°‘äº†ï¼Œè‡³ä»Šæ²¡æ‰¾åˆ°ä¸€ä¸ªåˆç†çš„è¯´æ˜ï¼Œå¦‚æœä½ çŸ¥é“ï¼Œæ¬¢è¿å‘Šè¯‰æˆ‘å•Šï¼</em></p><p>é‚£**<code>æ¥æ”¶çª—å£å³è¾¹ç•Œ</code>è§¦å‘çš„<code>æ»‘åŠ¨æ¡ä»¶</code>**æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿçœ‹ä¸‹å›¾ï¼š</p><figure><img src="'+Kp+'" alt="æ¥æ”¶çª—å£è§¦å‘çš„æ»‘åŠ¨" tabindex="0" loading="lazy"><figcaption>æ¥æ”¶çª—å£è§¦å‘çš„æ»‘åŠ¨</figcaption></figure><p>å½“å›¾ä¸­çš„<strong>ç»¿è‰²éƒ¨åˆ†</strong>æ•°æ®**<code>è¶…è¿‡æœ€å¤§æ¥æ”¶çª—å£çš„ä¸€åŠå</code><strong>ï¼Œæœ€å¤§æ¥æ”¶çª—å£</strong><code>å‘å³ç§»åŠ¨</code>**ï¼Œæ¥æ”¶çª—å£çš„å³è¾¹ç•Œä¹Ÿå‘å³æ‰©å±•ï¼ŒåŒæ—¶ç»™å¯¹ç«¯å‘é€ã€Œçª—å£æ›´æ–°å¸§ã€ï¼Œå½“å‘é€æ–¹æ”¶åˆ°æ¥æ”¶æ–¹çš„çª—å£æ›´æ–°å¸§åï¼Œå‘é€çª—å£çš„å³è¾¹ç•Œä¹Ÿä¼šå¾€å³æ‰©å±•ï¼Œä»¥æ­¤è¾¾åˆ°çª—å£æ»‘åŠ¨çš„æ•ˆæœã€‚</p><p>ç»¿è‰²éƒ¨åˆ†çš„æ•°æ®æ˜¯å·²æ”¶åˆ°çš„é¡ºåºçš„æ•°æ®ï¼Œ<strong>å¦‚æœä¸­é€”ä¸¢å¤±äº†æ•°æ®åŒ…ï¼Œå¯¼è‡´ç»¿è‰²éƒ¨åˆ†çš„æ•°æ®æ²¡æœ‰è¶…è¿‡æœ€å¤§æ¥æ”¶çª—å£çš„ä¸€åŠï¼Œé‚£æ¥æ”¶çª—å£å°±æ— æ³•æ»‘åŠ¨äº†</strong>ï¼Œè¿™ä¸ªåªå½±å“åŒä¸€ä¸ª Streamï¼Œå…¶ä»– Stream æ˜¯ä¸ä¼šå½±å“çš„ï¼Œå› ä¸ºæ¯ä¸ª Stream éƒ½æœ‰å„è‡ªçš„æ»‘åŠ¨çª—å£ã€‚</p><blockquote><p>åœ¨å‰é¢æˆ‘ä»¬è¯´è¿‡ QUIC æ”¯æŒ<strong>ä¹±åºç¡®è®¤</strong>ï¼Œå…·ä½“æ˜¯æ€ä¹ˆåšåˆ°çš„å‘¢ï¼Ÿ</p></blockquote>',12),kg={href:"https://juejin.cn/post/7066993430102016037",target:"_blank",rel:"noopener noreferrer"},fg=n('<p>å¦‚å›¾æ‰€ç¤ºï¼Œå½“å‰<strong>å‘é€æ–¹çš„ç¼“å†²åŒºå¤§å°ä¸º8</strong>ï¼Œ<strong>å‘é€æ–¹</strong> <strong>QUIC æŒ‰åºï¼ˆoffseté¡ºåºï¼‰å‘é€</strong> 29-36 çš„æ•°æ®åŒ…ï¼š</p><img src="'+Dp+'" alt="img" style="zoom:50%;"><p><strong>31ã€32ã€34æ•°æ®åŒ…</strong>å…ˆåˆ°è¾¾ï¼ŒåŸºäº offset è¢«<strong>ä¼˜å…ˆä¹±åºç¡®è®¤</strong>ï¼Œä½† <strong>30 æ•°æ®åŒ…æ²¡æœ‰ç¡®è®¤</strong>ï¼Œæ‰€ä»¥**<code>å½“å‰å·²æäº¤çš„å­—èŠ‚åç§»é‡</code>ä¸å˜**ï¼Œ<strong>å‘é€æ–¹çš„ç¼“å­˜åŒºä¸å˜</strong>ã€‚</p><img src="'+Mp+'" alt="img" style="zoom:50%;"><p>30 åˆ°è¾¾å¹¶ç¡®è®¤ï¼Œ<strong>å‘é€æ–¹çš„ç¼“å­˜åŒºæ”¶ç¼©åˆ°é˜ˆå€¼</strong>ï¼Œæ¥æ”¶æ–¹å‘é€ MAX_STREAM_DATA Frameï¼ˆåå•†ç¼“å­˜å¤§å°çš„ç‰¹å®šå¸§ï¼‰ç»™å‘é€æ–¹ï¼Œ<strong>è¯·æ±‚å¢é•¿</strong>æœ€å¤§ç»å¯¹å­—èŠ‚åç§»é‡ã€‚</p><img src="'+Lp+'" alt="img" style="zoom:50%;"><p>åå•†å®Œæ¯•åæœ€å¤§ç»å¯¹å­—èŠ‚åç§»é‡å³ç§»ï¼Œå‘é€æ–¹çš„ç¼“å­˜åŒºå˜å¤§ï¼ŒåŒæ—¶å‘é€æ–¹å‘ç°æ•°æ®åŒ…33è¶…æ—¶</p><img src="'+Rp+'" alt="img" style="zoom:50%;"><p>å‘é€æ–¹å°†è¶…æ—¶æ•°æ®åŒ…<strong>é‡æ–°ç¼–å·ä¸º 42 ç»§ç»­å‘é€</strong></p><img src="'+Yp+'" alt="img" style="zoom:50%;"><p>ä»¥ä¸Šå°±æ˜¯æœ€åŸºæœ¬çš„<strong>æ•°æ®åŒ…å‘é€-æ¥æ”¶è¿‡ç¨‹</strong>ï¼Œæ§åˆ¶æ•°æ®å‘é€çš„<strong>å”¯ä¸€é™åˆ¶</strong>å°±æ˜¯<strong>æœ€å¤§ç»å¯¹å­—èŠ‚åç§»é‡</strong>ï¼Œè¯¥å€¼æ˜¯<strong>æ¥æ”¶æ–¹åŸºäºå½“å‰å·²ç»æäº¤çš„åç§»é‡</strong>ï¼ˆè¿ç»­å·²ç¡®è®¤å¹¶å‘ä¸Šå±‚åº”ç”¨æäº¤çš„æ•°æ®åŒ…offsetï¼‰å’Œ<strong>å‘é€æ–¹åå•†</strong>å¾—å‡ºã€‚</p><h4 id="connection-æµé‡æ§åˆ¶" tabindex="-1"><a class="header-anchor" href="#connection-æµé‡æ§åˆ¶"><span>- Connection æµé‡æ§åˆ¶</span></a></h4><p>è€Œå¯¹äº Connection çº§åˆ«çš„æµé‡çª—å£ï¼Œå…¶æ¥æ”¶çª—å£å¤§å°å°±æ˜¯<strong>å„ä¸ª Stream æ¥æ”¶çª—å£å¤§å°ä¹‹å’Œ</strong>ã€‚</p><figure><img src="'+Up+`" alt="Connection æµé‡æ§åˆ¶" tabindex="0" loading="lazy"><figcaption>Connection æµé‡æ§åˆ¶</figcaption></figure><p>ä¸Šå›¾æ‰€ç¤ºçš„ä¾‹å­ï¼Œæ‰€æœ‰ Streams çš„æœ€å¤§çª—å£æ•°ä¸º 120ï¼Œå…¶ä¸­ï¼š</p><ul><li>Stream 1 çš„æœ€å¤§æ¥æ”¶åç§»ä¸º 100ï¼Œå¯ç”¨çª—å£ = 120 - 100 = 20</li><li>Stream 2 çš„æœ€å¤§æ¥æ”¶åç§»ä¸º 90ï¼Œå¯ç”¨çª—å£ = 120 - 90 = 30</li><li>Stream 3 çš„æœ€å¤§æ¥æ”¶åç§»ä¸º 110ï¼Œå¯ç”¨çª—å£ = 120 - 110 = 10</li></ul><p>é‚£ä¹ˆ<strong>æ•´ä¸ª Connection çš„å¯ç”¨çª—å£</strong> = 20 + 30 + 10 = 60</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>å¯ç”¨çª—å£ = Stream 1 å¯ç”¨çª—å£ + Stream 2 å¯ç”¨çª—å£ + Stream 3 å¯ç”¨çª—å£
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="ğŸ”®-quic-å¯¹æ‹¥å¡æ§åˆ¶æ”¹è¿›" tabindex="-1"><a class="header-anchor" href="#ğŸ”®-quic-å¯¹æ‹¥å¡æ§åˆ¶æ”¹è¿›"><span>ğŸ”® QUIC å¯¹æ‹¥å¡æ§åˆ¶æ”¹è¿›</span></a></h3><p>QUIC åè®®å½“å‰<strong>é»˜è®¤ä½¿ç”¨äº† TCP çš„ Cubic æ‹¥å¡æ§åˆ¶ç®—æ³•</strong>ï¼ˆæˆ‘ä»¬ç†ŸçŸ¥çš„æ…¢å¼€å§‹ã€æ‹¥å¡é¿å…ã€å¿«é‡ä¼ ã€å¿«æ¢å¤ç­–ç•¥ï¼‰ï¼ŒåŒæ—¶ä¹Ÿæ”¯æŒ CubicBytesã€Renoã€RenoBytesã€BBRã€PCC ç­‰æ‹¥å¡æ§åˆ¶ç®—æ³•ï¼Œç›¸å½“äº<strong>å°† TCP çš„æ‹¥å¡æ§åˆ¶ç®—æ³•</strong>ç…§æ¬è¿‡æ¥äº†ã€‚</p><p>QUIC æ˜¯å¦‚ä½•<strong>æ”¹è¿› TCP çš„æ‹¥å¡æ§åˆ¶ç®—æ³•çš„</strong>å‘¢ï¼Ÿ</p><blockquote><p><strong>QUIC</strong> æ˜¯å¤„äº**<code>åº”ç”¨å±‚</code>**çš„ï¼Œ<strong>åº”ç”¨ç¨‹åºå±‚é¢å°±èƒ½å®ç°ä¸åŒçš„æ‹¥å¡æ§åˆ¶ç®—æ³•</strong>ï¼Œä¸éœ€è¦æ“ä½œç³»ç»Ÿï¼Œä¸éœ€è¦å†…æ ¸æ”¯æŒã€‚</p><p>è¿™æ˜¯ä¸€ä¸ªé£è·ƒï¼Œå› ä¸ºä¼ ç»Ÿçš„ TCP æ‹¥å¡æ§åˆ¶ï¼Œå¿…é¡»è¦<strong>ç«¯åˆ°ç«¯çš„ç½‘ç»œåè®®æ ˆæ”¯æŒ</strong>ï¼Œæ‰èƒ½å®ç°æ§åˆ¶æ•ˆæœã€‚è€Œå†…æ ¸å’Œæ“ä½œç³»ç»Ÿçš„éƒ¨ç½²æˆæœ¬éå¸¸é«˜ï¼Œå‡çº§å‘¨æœŸå¾ˆé•¿ï¼Œæ‰€ä»¥ TCP æ‹¥å¡æ§åˆ¶ç®—æ³•è¿­ä»£é€Ÿåº¦æ˜¯å¾ˆ<strong>æ…¢</strong>çš„ã€‚</p><p>è€Œ <strong>QUIC å¯ä»¥éšæµè§ˆå™¨æ›´æ–°ï¼ŒQUIC çš„æ‹¥å¡æ§åˆ¶ç®—æ³•å°±å¯ä»¥æœ‰<code>è¾ƒå¿«çš„è¿­ä»£é€Ÿåº¦</code></strong>ã€‚</p></blockquote><p>TCP æ›´æ”¹æ‹¥å¡æ§åˆ¶ç®—æ³•æ˜¯å¯¹ç³»ç»Ÿä¸­æ‰€æœ‰åº”ç”¨éƒ½ç”Ÿæ•ˆï¼Œæ— æ³•æ ¹æ®ä¸åŒåº”ç”¨è®¾å®šä¸åŒçš„æ‹¥å¡æ§åˆ¶ç­–ç•¥ã€‚ä½†æ˜¯å› ä¸º QUIC å¤„äºåº”ç”¨å±‚ï¼Œæ‰€ä»¥å°±<strong>å¯ä»¥é’ˆå¯¹ä¸åŒçš„åº”ç”¨è®¾ç½®ä¸åŒçš„æ‹¥å¡æ§åˆ¶ç®—æ³•</strong>ï¼Œè¿™æ ·çµæ´»æ€§å°±å¾ˆé«˜äº†ã€‚</p><h3 id="ğŸ”®-quic-æ›´å¿«çš„è¿æ¥å»ºç«‹" tabindex="-1"><a class="header-anchor" href="#ğŸ”®-quic-æ›´å¿«çš„è¿æ¥å»ºç«‹"><span>ğŸ”® QUIC æ›´å¿«çš„è¿æ¥å»ºç«‹</span></a></h3><p>å¯¹äº HTTP/1 å’Œ HTTP/2 åè®®ï¼Œ<strong><code>TCP å’Œ TLS æ˜¯åˆ†å±‚çš„</code></strong>ï¼Œåˆ†åˆ«å±äºå†…æ ¸å®ç°çš„ä¼ è¾“å±‚ã€openssl åº“å®ç°çš„è¡¨ç¤ºå±‚ï¼Œå› æ­¤å®ƒä»¬éš¾ä»¥åˆå¹¶åœ¨ä¸€èµ·ï¼Œéœ€è¦**<code>åˆ†æ‰¹æ¬¡æ¥æ¡æ‰‹</code>**ï¼Œå…ˆ <strong>TCP æ¡æ‰‹ï¼ˆ1 RTTï¼‰</strong>ï¼Œå† <strong>TLS æ¡æ‰‹ï¼ˆ2 RTTï¼‰</strong>ï¼Œæ‰€ä»¥éœ€è¦ 3 RTT çš„å»¶è¿Ÿæ‰èƒ½ä¼ è¾“æ•°æ®ï¼Œå°±ç®— Session ä¼šè¯æœç”¨ï¼Œä¹Ÿéœ€è¦è‡³å°‘ 2 ä¸ª RTTã€‚</p><p><strong><code>HTTP/3</code></strong> åœ¨<strong>ä¼ è¾“æ•°æ®å‰</strong>è™½ç„¶éœ€è¦ <strong><code>QUIC åè®®æ¡æ‰‹</code></strong>ï¼Œè¿™ä¸ªæ¡æ‰‹è¿‡ç¨‹åªéœ€è¦ <strong><code>1 RTT</code>ï¼Œ<strong>æ¡æ‰‹çš„ç›®çš„æ˜¯ä¸º</strong>ç¡®è®¤åŒæ–¹çš„ã€Œè¿æ¥ IDã€</strong>ï¼Œè¿æ¥è¿ç§»å°±æ˜¯<strong>åŸºäºè¿æ¥ ID å®ç°çš„</strong>ã€‚</p><blockquote><p>ä½†æ˜¯ HTTP/3 çš„ QUIC åè®®<strong>å¹¶ä¸æ˜¯ä¸ TLS åˆ†å±‚</strong>ï¼Œè€Œæ˜¯**<code>QUIC å†…éƒ¨åŒ…å«äº† TLS</code>ï¼Œå®ƒåœ¨è‡ªå·±çš„å¸§ä¼šæºå¸¦ TLS é‡Œçš„â€œè®°å½•â€ï¼Œå†åŠ ä¸Š QUIC ä½¿ç”¨çš„æ˜¯ TLS 1.3ï¼Œå› æ­¤ä»…éœ€ <code>1 ä¸ª RTT</code> å°±å¯ä»¥ã€ŒåŒæ—¶ã€å®Œæˆå»ºç«‹è¿æ¥ä¸å¯†é’¥åå•†ï¼Œ**</p><p><strong>ç”šè‡³åœ¨ ç¬¬äºŒæ¬¡è¿æ¥çš„æ—¶å€™ï¼Œåº”ç”¨æ•°æ®åŒ…å¯ä»¥å’Œ QUIC æ¡æ‰‹ä¿¡æ¯ï¼ˆè¿æ¥ä¿¡æ¯ + TLS ä¿¡æ¯ï¼‰ä¸€èµ·å‘é€ï¼Œè¾¾åˆ° <code>0-RTT</code> çš„æ•ˆæœ</strong>ã€‚</p></blockquote><p>å¦‚ä¸‹å›¾å³è¾¹éƒ¨åˆ†ï¼ŒHTTP/3 å½“ä¼šè¯æ¢å¤æ—¶ï¼Œæœ‰æ•ˆè´Ÿè½½æ•°æ®ä¸ç¬¬ä¸€ä¸ªæ•°æ®åŒ…ä¸€èµ·å‘é€ï¼Œå¯ä»¥åšåˆ° 0-RTTï¼ˆä¸‹å›¾çš„å³ä¸‹è§’ï¼‰ï¼š</p><figure><img src="`+Fp+'" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><h3 id="ğŸ”®-quic-æ˜¯å¦‚ä½•è¿ç§»è¿æ¥çš„" tabindex="-1"><a class="header-anchor" href="#ğŸ”®-quic-æ˜¯å¦‚ä½•è¿ç§»è¿æ¥çš„"><span>ğŸ”® QUIC æ˜¯å¦‚ä½•è¿ç§»è¿æ¥çš„ï¼Ÿ</span></a></h3><p>åŸºäº TCP ä¼ è¾“åè®®çš„ HTTP åè®®ï¼Œç”±äºæ˜¯é€šè¿‡<strong>å››å…ƒç»„</strong>ï¼ˆæº IPã€æºç«¯å£ã€ç›®çš„ IPã€ç›®çš„ç«¯å£ï¼‰ç¡®å®šä¸€æ¡ TCP è¿æ¥ã€‚</p><img src="'+jp+'" alt="TCP å››å…ƒç»„" style="zoom:67%;"><p>é‚£ä¹ˆ<strong>å½“ç§»åŠ¨è®¾å¤‡çš„ç½‘ç»œä» 4G åˆ‡æ¢åˆ° WIFI æ—¶ï¼Œæ„å‘³ç€ <code>IP åœ°å€å˜åŒ–</code>äº†ï¼Œé‚£ä¹ˆå°±å¿…é¡»è¦<code>æ–­å¼€è¿æ¥ï¼Œç„¶åé‡æ–°å»ºç«‹ TCP è¿æ¥</code></strong>ã€‚</p><p>è€Œå»ºç«‹è¿æ¥çš„è¿‡ç¨‹åŒ…å« <strong>TCP ä¸‰æ¬¡æ¡æ‰‹å’Œ TLS å››æ¬¡æ¡æ‰‹</strong>çš„æ—¶å»¶ï¼Œä»¥åŠ <strong>TCP æ…¢å¯åŠ¨</strong>çš„å‡é€Ÿè¿‡ç¨‹ï¼Œ<strong>ç»™ç”¨æˆ·çš„æ„Ÿè§‰å°±æ˜¯ç½‘ç»œçªç„¶å¡é¡¿äº†ä¸€ä¸‹</strong>ï¼Œå› æ­¤<strong>è¿æ¥çš„è¿ç§»æˆæœ¬æ˜¯å¾ˆé«˜çš„</strong>ã€‚</p><blockquote><p><strong>QUIC åè®®</strong>æ²¡æœ‰ç”¨å››å…ƒç»„çš„æ–¹å¼æ¥â€œç»‘å®šâ€è¿æ¥ï¼Œè€Œæ˜¯é€šè¿‡**<code>è¿æ¥ ID</code><strong>æ¥æ ‡è®°</strong><code>é€šä¿¡çš„ä¸¤ä¸ªç«¯ç‚¹</code><strong>ï¼Œ<strong>å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨</strong>å¯ä»¥</strong>å„è‡ªé€‰æ‹©ä¸€ç»„ ID** æ¥<strong>æ ‡è®°è‡ªå·±</strong>ï¼Œå› æ­¤å³ä½¿ç§»åŠ¨è®¾å¤‡çš„ç½‘ç»œå˜åŒ–åï¼Œå¯¼è‡´ IP åœ°å€å˜åŒ–äº†ï¼Œ<strong>åªè¦ä»ä¿æœ‰<code>ä¸Šä¸‹æ–‡ä¿¡æ¯</code></strong>ï¼ˆæ¯”å¦‚è¿æ¥ IDã€TLS å¯†é’¥ç­‰ï¼‰ï¼Œ<strong>å°±å¯ä»¥<code>â€œæ— ç¼â€åœ°å¤ç”¨åŸè¿æ¥</code>ï¼Œæ¶ˆé™¤é‡è¿çš„æˆæœ¬ï¼Œ<code>æ²¡æœ‰ä¸æ¯«å¡é¡¿æ„Ÿ</code></strong>ï¼Œè¾¾åˆ°äº†**<code>è¿æ¥è¿ç§»</code>**çš„åŠŸèƒ½ã€‚</p></blockquote><h1 id="-11" tabindex="-1"><a class="header-anchor" href="#-11"><span>----------------</span></a></h1>',36);function Sg(Ag,Ig){const s=r("ExternalLinkIcon");return i(),g("div",null,[Bp,o("ul",null,[o("li",null,[t("ç½‘ç»œåŸºç¡€ç¯‡ "),o("ul",null,[o("li",null,[o("a",Op,[t("TCP/IP ç½‘ç»œæ¨¡å‹æœ‰å“ªå‡ å±‚ï¼Ÿ"),e(s)])]),o("li",null,[o("a",Qp,[t("é”®å…¥ç½‘å€åˆ°ç½‘é¡µæ˜¾ç¤ºï¼ŒæœŸé—´å‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ"),e(s)])]),o("li",null,[o("a",Gp,[t("Linux ç³»ç»Ÿæ˜¯å¦‚ä½•æ”¶å‘ç½‘ç»œåŒ…çš„ï¼Ÿ"),e(s)])])])]),o("li",null,[t("HTTP ç¯‡ "),o("ul",null,[o("li",null,[o("a",Vp,[t("HTTP å¸¸è§é¢è¯•é¢˜"),e(s)])]),o("li",null,[o("a",Xp,[t("HTTP/1.1å¦‚ä½•ä¼˜åŒ–ï¼Ÿ"),e(s)])]),o("li",null,[o("a",Zp,[t("HTTPS RSA æ¡æ‰‹è§£æ"),e(s)])]),o("li",null,[o("a",Jp,[t("HTTPS ECDHE æ¡æ‰‹è§£æ"),e(s)])]),o("li",null,[o("a",$p,[t("HTTPS å¦‚ä½•ä¼˜åŒ–ï¼Ÿ"),e(s)])]),o("li",null,[o("a",or,[t("HTTP/2 ç‰›é€¼åœ¨å“ªï¼Ÿ"),e(s)])]),o("li",null,[o("a",tr,[t("HTTP/3 å¼ºåŠ¿æ¥è¢­"),e(s)])]),o("li",null,[o("a",sr,[t("æ—¢ç„¶æœ‰ HTTP åè®®ï¼Œä¸ºä»€ä¹ˆè¿˜è¦æœ‰ RPCï¼Ÿ"),e(s)])]),o("li",null,[o("a",er,[t("æ—¢ç„¶æœ‰ HTTP åè®®ï¼Œä¸ºä»€ä¹ˆè¿˜è¦æœ‰ WebSocketï¼Ÿ"),e(s)])])])]),o("li",null,[t("TCP ç¯‡ "),o("ul",null,[o("li",null,[o("a",nr,[t("TCP ä¸‰æ¬¡æ¡æ‰‹ä¸å››æ¬¡æŒ¥æ‰‹é¢è¯•é¢˜"),e(s)])]),o("li",null,[o("a",pr,[t("TCP é‡ä¼ ã€æ»‘åŠ¨çª—å£ã€æµé‡æ§åˆ¶ã€æ‹¥å¡æ§åˆ¶"),e(s)])]),o("li",null,[o("a",rr,[t("TCP å®æˆ˜æŠ“åŒ…åˆ†æ"),e(s)])]),o("li",null,[o("a",ir,[t("TCP åŠè¿æ¥é˜Ÿåˆ—å’Œå…¨è¿æ¥é˜Ÿåˆ—"),e(s)])]),o("li",null,[o("a",gr,[t("å¦‚ä½•ä¼˜åŒ– TCP?"),e(s)])]),o("li",null,[o("a",ar,[t("å¦‚ä½•ç†è§£æ˜¯ TCP é¢å‘å­—èŠ‚æµåè®®ï¼Ÿ"),e(s)])]),o("li",null,[o("a",lr,[t("ä¸ºä»€ä¹ˆ TCP æ¯æ¬¡å»ºç«‹è¿æ¥æ—¶ï¼Œåˆå§‹åŒ–åºåˆ—å·éƒ½è¦ä¸ä¸€æ ·å‘¢ï¼Ÿ"),e(s)])]),o("li",null,[o("a",cr,[t("SYN æŠ¥æ–‡ä»€ä¹ˆæ—¶å€™æƒ…å†µä¸‹ä¼šè¢«ä¸¢å¼ƒï¼Ÿ"),e(s)])]),o("li",null,[o("a",dr,[t("å››æ¬¡æŒ¥æ‰‹ä¸­æ”¶åˆ°ä¹±åºçš„ FIN åŒ…ä¼šå¦‚ä½•å¤„ç†ï¼Ÿ"),e(s)])]),o("li",null,[o("a",mr,[t("åœ¨ TIME_WAIT çŠ¶æ€çš„ TCP è¿æ¥ï¼Œæ”¶åˆ° SYN åä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ"),e(s)])]),o("li",null,[o("a",Tr,[t("TCP è¿æ¥ï¼Œä¸€ç«¯æ–­ç”µå’Œè¿›ç¨‹å´©æºƒæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"),e(s)])]),o("li",null,[o("a",hr,[t("æ‹”æ‰ç½‘çº¿åï¼Œ åŸæœ¬çš„ TCP è¿æ¥è¿˜å­˜åœ¨å—ï¼Ÿ"),e(s)])]),o("li",null,[o("a",ur,[t("tcp_tw_reuse ä¸ºä»€ä¹ˆé»˜è®¤æ˜¯å…³é—­çš„ï¼Ÿ"),e(s)])]),o("li",null,[o("a",_r,[t("HTTPS ä¸­ TLS å’Œ TCP èƒ½åŒæ—¶æ¡æ‰‹å—ï¼Ÿ"),e(s)])]),o("li",null,[o("a",Pr,[t("TCP Keepalive å’Œ HTTP Keep-Alive æ˜¯ä¸€ä¸ªä¸œè¥¿å—ï¼Ÿ"),e(s)])]),o("li",null,[o("a",Cr,[t("TCP æœ‰ä»€ä¹ˆç¼ºé™·ï¼Ÿ"),e(s)])]),o("li",null,[o("a",br,[t("å¦‚ä½•åŸºäº UDP åè®®å®ç°å¯é ä¼ è¾“ï¼Ÿ"),e(s)])]),o("li",null,[o("a",kr,[t("TCP å’Œ UDP å¯ä»¥ä½¿ç”¨åŒä¸€ä¸ªç«¯å£å—ï¼Ÿ"),e(s)])]),o("li",null,[o("a",fr,[t("æœåŠ¡ç«¯æ²¡æœ‰ listenï¼Œå®¢æˆ·ç«¯å‘èµ·è¿æ¥å»ºç«‹ï¼Œä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ"),e(s)])]),o("li",null,[o("a",Sr,[t("æ²¡æœ‰ accpetï¼Œå¯ä»¥å»ºç«‹ TCP è¿æ¥å—ï¼Ÿ"),e(s)])]),o("li",null,[o("a",Ar,[t("ç”¨äº† TCP åè®®ï¼Œæ•°æ®ä¸€å®šä¸ä¼šä¸¢å—ï¼Ÿ"),e(s)])]),o("li",null,[o("a",Ir,[t("TCP å››æ¬¡æŒ¥æ‰‹ï¼Œå¯ä»¥å˜æˆä¸‰æ¬¡å—ï¼Ÿ"),e(s)])]),o("li",null,[o("a",xr,[t("TCP åºåˆ—å·å’Œç¡®è®¤å·æ˜¯å¦‚ä½•å˜åŒ–çš„ï¼Ÿ"),e(s)])])])]),o("li",null,[t("IP ç¯‡ "),o("ul",null,[o("li",null,[o("a",Nr,[t("IP åŸºç¡€çŸ¥è¯†å…¨å®¶æ¡¶"),e(s)])]),o("li",null,[o("a",qr,[t("ping çš„å·¥ä½œåŸç†"),e(s)])]),o("li",null,[o("a",yr,[t("æ–­ç½‘äº†ï¼Œè¿˜èƒ½ ping é€š 127.0.0.1 å—ï¼Ÿ"),e(s)])])])]),o("li",null,[t("å­¦ä¹ å¿ƒå¾— "),o("ul",null,[o("li",null,[o("a",Hr,[t("è®¡ç®—æœºç½‘ç»œæ€ä¹ˆå­¦ï¼Ÿ"),e(s)])]),o("li",null,[o("a",vr,[t("ç”»å›¾ç»éªŒåˆ†äº«"),e(s)])])])])]),zr,o("p",null,[t("å…·ä½“ä»€ä¹ˆæ˜¯ TCP ç²˜åŒ…ï¼Œå¯ä»¥çœ‹è¿™ç¯‡æ–‡ç« ï¼š"),o("a",Er,[t("å¦‚ä½•ç†è§£æ˜¯ TCP é¢å‘å­—èŠ‚æµåè®®ï¼Ÿ(opens new window)"),e(s)])]),wr,o("blockquote",null,[o("p",null,[t("PSï¼šå¤§å®¶ä¸è¦æŠŠ HTTP Keep-Alive å’Œ TCP Keepalive ææ··äº†ï¼Œè¿™ä¸¤ä¸ªè™½ç„¶é•¿çš„åƒï¼Œä½†æ˜¯ä¸æ˜¯ä¸€ä¸ªä¸œè¥¿ï¼Œå…·ä½“å¯ä»¥çœ‹æˆ‘è¿™ç¯‡æ–‡ç« ï¼š"),o("a",Kr,[t("TCP Keepalive å’Œ HTTP Keep-Alive æ˜¯ä¸€ä¸ªä¸œè¥¿å—ï¼Ÿ(opens new window)"),e(s)])])]),Dr,o("p",null,[t("TLS çš„ã€Œæ¡æ‰‹é˜¶æ®µã€æ¶‰åŠ"),Mr,t("é€šä¿¡ï¼Œä½¿ç”¨ä¸åŒçš„å¯†é’¥äº¤æ¢ç®—æ³•ï¼ŒTLS æ¡æ‰‹æµç¨‹ä¹Ÿä¼šä¸ä¸€æ ·çš„ï¼Œç°åœ¨å¸¸ç”¨çš„å¯†é’¥äº¤æ¢ç®—æ³•æœ‰ä¸¤ç§ï¼š"),o("a",Lr,[t("RSA ç®—æ³• (opens new window)"),e(s)]),t("å’Œ "),o("a",Rr,[t("ECDHE ç®—æ³• (opens new window)"),e(s)]),t("ã€‚")]),Yr,o("p",null,[t("å¦‚æœæƒ³æ·±å…¥å­¦ä¹ åŸºäº RSA ç®—æ³•çš„ HTTPS æ¡æ‰‹è¿‡ç¨‹ï¼Œå¯ä»¥çœ‹è¿™ç¯‡ï¼Œæˆ‘é€šè¿‡æŠ“åŒ…çš„æ–¹å¼ï¼Œé€æ­¥åˆ†ææ¯ä¸€ä¸ªè¿‡ç¨‹ï¼š"),o("a",Ur,[t("HTTPS RSA æ¡æ‰‹è§£æ(opens new window)"),e(s)])]),Fr,o("p",null,[t("ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œåé¢å°±å‡ºç°äº† ECDHE å¯†é’¥åå•†ç®—æ³•ï¼Œæˆ‘ä»¬ç°åœ¨å¤§å¤šæ•°ç½‘ç«™ä½¿ç”¨çš„æ­£æ˜¯ ECDHE å¯†é’¥åå•†ç®—æ³•ï¼Œå…³äº ECDHE æ¡æ‰‹çš„è¿‡ç¨‹å¯ä»¥çœ‹è¿™ç¯‡æ–‡ç« ï¼š"),o("a",jr,[t("HTTPS ECDHE æ¡æ‰‹è§£æ(opens new window)"),e(s)])]),Wr,o("p",null,[t("å¦‚æœä½ æƒ³è¯¦ç»†äº†è§£è®°å½•åè®®æ˜¯å¦‚ä½•åˆ†ç‰‡ã€å‹ç¼©ã€è®¡ç®— MAC å€¼ã€åˆ†ç»„åŠ å¯†ï¼Œå¯ä»¥çœ‹è¿™ç¯‡ï¼š"),o("a",Br,[t("ç†è§£SSL/TLSç³»åˆ— (å››) è®°å½•åè®®(opens new window)"),e(s)])]),Or,o("ol",null,[o("li",null,[t("æœ€å‰é¢çš„ 1 æ ‡è¯†è¯¥ Header æ˜¯é™æ€è¡¨ä¸­å·²ç»å­˜åœ¨çš„ KVã€‚ï¼ˆè‡³äºä»€ä¹ˆæ˜¯é™æ€è¡¨ï¼Œå¯ä»¥çœ‹è¿™ç¯‡ï¼š"),o("a",Qr,[t("HTTP/2 ç‰›é€¼åœ¨å“ªï¼Ÿ (opens new window)"),e(s)]),t("ï¼‰")]),Gr]),Vr,o("blockquote",null,[Xr,o("p",null,[t("å¦‚æœæƒ³æ›´è¿›ä¸€æ­¥äº†è§£ HTTP/2 åè®®ï¼Œå¯ä»¥çœ‹æˆ‘è¿™ç¯‡æ–‡ç« ï¼š"),o("a",Zr,[t("HTTP/2 ç‰›é€¼åœ¨å“ªï¼Ÿ(opens new window)"),e(s)])])]),Jr,o("ul",null,[o("li",null,[o("a",$r,[t("HTTP/3 å¼ºåŠ¿æ¥è¢­(opens new window)"),e(s)])]),o("li",null,[o("a",oi,[t("å¦‚ä½•åŸºäº UDP åè®®å®ç°å¯é ä¼ è¾“ï¼Ÿ(opens new window)"),e(s)])])]),ti,o("ul",null,[si,o("li",null,[t("UDP æ˜¯"),ei,t("ã€‚ä½†æ˜¯æˆ‘ä»¬å¯ä»¥åŸºäº UDP ä¼ è¾“åè®®å®ç°ä¸€ä¸ªå¯é çš„ä¼ è¾“åè®®ï¼Œæ¯”å¦‚ QUIC åè®®ï¼Œå…·ä½“å¯ä»¥å‚è§è¿™ç¯‡æ–‡ç« ï¼š"),o("a",ni,[t("å¦‚ä½•åŸºäº UDP åè®®å®ç°å¯é ä¼ è¾“ï¼Ÿ(opens new window)"),e(s)])])]),pi,o("p",null,[t("ä¸Šé¢è¿™äº›é—®é¢˜ï¼Œå¯ä»¥çœ‹è¿™ç¯‡æ–‡ç« ï¼š"),o("a",ri,[t("TCP å’Œ UDP å¯ä»¥ä½¿ç”¨åŒä¸€ä¸ªç«¯å£å—ï¼Ÿ"),e(s)])]),ii,o("blockquote",null,[gi,ai,li,o("p",null,[t("ç„¶åè¿™æ—¶å†æ”¶åˆ°ã€Œæ–° SYN æŠ¥æ–‡ã€æ—¶ï¼Œå°±ä¼šå› "),o("a",ci,[t("Challenge "),di,t(" (opens new window)"),e(s)]),t("æŠ¥æ–‡ç»™å®¢æˆ·ç«¯ï¼Œ"),mi,t("ï¼Œä¹Ÿå°±æ˜¯91ï¼ˆ90+1ï¼‰ã€‚æ‰€ä»¥å®¢æˆ·ç«¯æ”¶åˆ°æ­¤ ACK æŠ¥æ–‡æ—¶ï¼Œå‘ç°è‡ªå·±æœŸæœ›æ”¶åˆ°çš„ç¡®è®¤å·åº”è¯¥æ˜¯ 101ï¼Œè€Œä¸æ˜¯ 91ï¼Œäºæ˜¯å°±ä¼š"),Ti])]),hi,o("p",null,[t("æ‰€ä»¥ï¼Œæ¯æ¬¡åˆå§‹åŒ–åºåˆ—å·ä¸ä¸€æ ·å¾ˆå¤§ç¨‹åº¦ä¸Šèƒ½å¤Ÿé¿å…å†å²æŠ¥æ–‡è¢«ä¸‹ä¸€ä¸ªç›¸åŒå››å…ƒç»„çš„è¿æ¥æ¥æ”¶ï¼Œæ³¨æ„æ˜¯å¾ˆå¤§ç¨‹åº¦ä¸Šï¼Œå¹¶ä¸æ˜¯å®Œå…¨é¿å…äº†ï¼ˆå› ä¸ºåºåˆ—å·ä¼šæœ‰å›ç»•çš„é—®é¢˜ï¼Œæ‰€ä»¥éœ€è¦ç”¨æ—¶é—´æˆ³çš„æœºåˆ¶æ¥åˆ¤æ–­å†å²æŠ¥æ–‡ï¼Œè¯¦ç»†çœ‹ç¯‡ï¼š"),o("a",ui,[t("TCP æ˜¯å¦‚ä½•é¿å…å†å²æŠ¥æ–‡çš„ï¼Ÿ (opens new window)"),e(s)]),t("ï¼‰ã€‚")]),_i,o("p",null,[t("å…·ä½“ä¸ºä»€ä¹ˆæ˜¯ä¸‰ä¸ªå‚æ•°å†³å®š TCP åŠè¿æ¥é˜Ÿåˆ—çš„å¤§å°ï¼Œå¯ä»¥çœ‹è¿™ç¯‡ï¼šå¯ä»¥çœ‹è¿™ç¯‡ï¼š"),o("a",Pi,[t("TCP åŠè¿æ¥é˜Ÿåˆ—å’Œå…¨è¿æ¥é˜Ÿåˆ—æ»¡äº†ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿåˆè¯¥å¦‚ä½•åº”å¯¹ï¼Ÿ(opens new window)"),e(s)])]),Ci,o("p",null,[t("ä½†æ˜¯"),bi,t("ï¼Œå…·ä½“æƒ…å†µå¯ä»¥çœ‹è¿™ç¯‡ï¼š"),o("a",ki,[t("TCP å››æ¬¡æŒ¥æ‰‹ï¼Œå¯ä»¥å˜æˆä¸‰æ¬¡å—ï¼Ÿ(opens new window)"),e(s)])]),fi,o("p",null,[Si,t("ï¼Œå æ»¡äº†æ‰€æœ‰ç«¯å£èµ„æºï¼Œé‚£ä¹ˆå°±æ— æ³•å¯¹ã€Œç›®çš„ IP+ ç›®çš„ PORTã€éƒ½ä¸€æ ·çš„æœåŠ¡ç«¯å‘èµ·è¿æ¥äº†ï¼Œä½†æ˜¯è¢«ä½¿ç”¨çš„ç«¯å£ï¼Œè¿˜æ˜¯å¯ä»¥ç»§ç»­å¯¹å¦å¤–ä¸€ä¸ªæœåŠ¡ç«¯å‘èµ·è¿æ¥çš„ã€‚å…·ä½“å¯ä»¥çœ‹æˆ‘è¿™ç¯‡æ–‡ç« ï¼š"),o("a",Ai,[t("å®¢æˆ·ç«¯çš„ç«¯å£å¯ä»¥é‡å¤ä½¿ç”¨å—ï¼Ÿ(opens new window)"),e(s)])]),Ii,o("p",null,[t("å‘ç”Ÿè¿™ç§æƒ…å†µå¯èƒ½æ˜¯å› ä¸ºæœåŠ¡ç«¯åœ¨å°†å·²è¿æ¥çš„ socket æ³¨å†Œåˆ° epoll ä¹‹å‰ï¼Œä»£ç å¡åœ¨æŸä¸€ä¸ªé€»è¾‘æˆ–è€…æå‰æŠ›å‡ºäº†å¼‚å¸¸ã€‚ä¹‹å‰çœ‹åˆ°è¿‡åˆ«äººè§£å†³ close_wait é—®é¢˜çš„å®è·µæ–‡ç« ï¼Œæ„Ÿå…´è¶£çš„å¯ä»¥çœ‹çœ‹ï¼š"),o("a",xi,[t("ä¸€æ¬¡ Netty ä»£ç ä¸å¥å£®å¯¼è‡´çš„å¤§é‡ CLOSE_WAIT è¿æ¥åŸå› åˆ†æ(opens new window)"),e(s)])]),Ni,o("blockquote",null,[qi,o("p",null,[t("å…³äºè¿›ç¨‹å´©æºƒå’Œä¸»æœºå®•æœºçš„åŒºåˆ«ï¼Œå¯ä»¥å‚è€ƒè¿™ç¯‡ï¼š"),o("a",yi,[t("TCP è¿æ¥ï¼Œä¸€ç«¯æ–­ç”µå’Œè¿›ç¨‹å´©æºƒæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ(opens new window)"),e(s)])]),o("p",null,[t("è¿˜æœ‰ä¸€ä¸ªç±»ä¼¼çš„é—®é¢˜ï¼šã€Œæ‹”æ‰ç½‘çº¿åï¼Œ åŸæœ¬çš„ TCP è¿æ¥è¿˜å­˜åœ¨å—ï¼Ÿã€ï¼Œå…·ä½“å¯ä»¥çœ‹è¿™ç¯‡ï¼š"),o("a",Hi,[t("æ‹”æ‰ç½‘çº¿åï¼Œ åŸæœ¬çš„ TCP è¿æ¥è¿˜å­˜åœ¨å—ï¼Ÿ"),e(s)])])]),vi,o("p",null,[t("æˆ‘åœ¨è¯„è®ºåŒºçœ‹åˆ°@"),o("a",zi,[t("muum641651 (opens new window)"),e(s)]),t("å›ç­”çš„ä¸é”™ï¼Œè¿™é‡Œè´´å‡ºæ¥ç»™å¤§å®¶ã€‚")]),Ei,o("h3",wi,[o("a",Ki,[o("span",null,[o("a",Di,[t("#"),e(s)]),t("ä¸»åŠ¨æ–¹çš„ä¼˜åŒ–")])])]),Mi,o("h3",Li,[o("a",Ri,[o("span",null,[o("a",Yi,[t("#"),e(s)]),t("è¢«åŠ¨æ–¹çš„ä¼˜åŒ–")])])]),Ui,o("h3",Fi,[o("a",ji,[o("span",null,[o("a",Wi,[t("#"),e(s)]),t("å°ç»“")])])]),Bi,o("h2",Oi,[o("a",Qi,[o("span",null,[o("a",Gi,[t("#"),e(s)]),t("TCP ä¼ è¾“æ•°æ®çš„æ€§èƒ½æå‡")])])]),Vi,Xi,Zi,Ji,o("h3",$i,[o("a",og,[o("span",null,[o("a",tg,[t("#"),e(s)]),t("æ»‘åŠ¨çª—å£æ˜¯å¦‚ä½•å½±å“ä¼ è¾“é€Ÿåº¦çš„ï¼Ÿ")])])]),sg,o("h3",eg,[o("a",ng,[o("span",null,[o("a",pg,[t("#"),e(s)]),t("å¦‚ä½•ç¡®å®šæœ€å¤§ä¼ è¾“é€Ÿåº¦ï¼Ÿ")])])]),rg,o("h3",ig,[o("a",gg,[o("span",null,[o("a",ag,[t("#"),e(s)]),t("æ€æ ·è°ƒæ•´ç¼“å†²åŒºå¤§å°ï¼Ÿ")])])]),lg,o("h3",cg,[o("a",dg,[o("span",null,[o("a",mg,[t("#"),e(s)]),t("å°ç»“")])])]),Tg,o("blockquote",null,[o("p",null,[t("åœ¨ä¹‹å‰è¿™ç¯‡æ–‡ç« ï¼š"),o("a",hg,[t("TCP å°±æ²¡ä»€ä¹ˆç¼ºé™·å—ï¼Ÿ (opens new window)"),e(s)]),t("ï¼Œæˆ‘å·²ç»è¯´äº† TCP åè®®å››ä¸ªæ–¹é¢çš„ç¼ºé™·ï¼š")]),ug]),_g,o("p",null,[t("æœ€å¼€å§‹ï¼Œ"),Pg,t("åˆå§‹çŠ¶æ€å¦‚ä¸‹: ï¼ˆç½‘ä¸Šçš„è®² QUIC æµé‡æ§åˆ¶çš„èµ„æ–™å¤ªå°‘äº†ï¼Œä¸‹é¢çš„ä¾‹å­æˆ‘æ˜¯å‚è€ƒ google æ–‡æ¡£çš„ï¼š"),o("a",Cg,[t("Flow control in QUIC (opens new window)"),e(s)]),t("ï¼‰")]),bg,o("p",null,[t("æ¥ä¸‹æ¥ï¼Œä¸¾ä¸ªä¾‹å­ï¼ˆä¸‹é¢çš„ä¾‹å­æ¥æºäºï¼š"),o("a",kg,[t("QUICâ€”â€”å¿«é€ŸUDPç½‘ç»œè¿æ¥åè®® (opens new window)"),e(s)]),t("ï¼‰ï¼š")]),fg])}const qg=p(Wp,[["render",Sg],["__file","å›¾è§£è®¡ç®—æœºç½‘ç»œ.html.vue"]]),yg=JSON.parse('{"path":"/posts/Cpp/%E5%9B%BE%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C.html","title":"è®¡ç®—æœºç½‘ç»œ","lang":"zh-CN","frontmatter":{"icon":"pen-to-square","date":"2023-01-09T00:00:00.000Z","category":["å­¦ä¹ ç¬”è®°"],"tag":["è®¡ç®—æœºç½‘ç»œ"],"description":"è®¡ç®—æœºç½‘ç»œ å›¾è§£ç½‘ç»œ ----------------- ç®€å•ä»‹ç»ä¸‹ã€Šå›¾è§£ç½‘ç»œã€‹ï¼Œæ•´ä¸ªå†…å®¹å…±æœ‰ 20W å­— + 500 å¼ å›¾ï¼Œæ¯ä¸€ç¯‡éƒ½è‡ªå·±æ‰‹ç»˜äº†å¾ˆå¤šå›¾ï¼Œç›®çš„ä¹Ÿå¾ˆç®€å•ï¼Œæƒ³é€šè¿‡ã€Œè¯´äººè¯+å›¾è§£ã€çš„æ–¹å¼ï¼Œå‡»ç ´å¤§å®¶å¯¹äºã€Œå…«è‚¡æ–‡ã€çš„ææƒ§ ä¸€ã€ç®€ä»‹ 1.1 é€‚åˆä»€ä¹ˆç¾¤ä½“ï¼Ÿ ã€Šå›¾è§£ç½‘ç»œã€‹å†™çš„ç½‘ç»œçŸ¥è¯†ä¸»è¦æ˜¯é¢å‘ç¨‹åºå‘˜çš„ï¼Œå› ä¸ºå°æ—æœ¬èº«ä¹Ÿæ˜¯ä¸ªç¨‹åºå‘˜ï¼Œæ‰€ä»¥æ¶‰åŠåˆ°çš„çŸ¥è¯†ä¸»è¦æ˜¯å…³...","head":[["meta",{"property":"og:url","content":"https://mister-hope.github.io/homepage/posts/Cpp/%E5%9B%BE%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C.html"}],["meta",{"property":"og:site_name","content":"ä¸ªäººä¸»é¡µ"}],["meta",{"property":"og:title","content":"è®¡ç®—æœºç½‘ç»œ"}],["meta",{"property":"og:description","content":"è®¡ç®—æœºç½‘ç»œ å›¾è§£ç½‘ç»œ ----------------- ç®€å•ä»‹ç»ä¸‹ã€Šå›¾è§£ç½‘ç»œã€‹ï¼Œæ•´ä¸ªå†…å®¹å…±æœ‰ 20W å­— + 500 å¼ å›¾ï¼Œæ¯ä¸€ç¯‡éƒ½è‡ªå·±æ‰‹ç»˜äº†å¾ˆå¤šå›¾ï¼Œç›®çš„ä¹Ÿå¾ˆç®€å•ï¼Œæƒ³é€šè¿‡ã€Œè¯´äººè¯+å›¾è§£ã€çš„æ–¹å¼ï¼Œå‡»ç ´å¤§å®¶å¯¹äºã€Œå…«è‚¡æ–‡ã€çš„ææƒ§ ä¸€ã€ç®€ä»‹ 1.1 é€‚åˆä»€ä¹ˆç¾¤ä½“ï¼Ÿ ã€Šå›¾è§£ç½‘ç»œã€‹å†™çš„ç½‘ç»œçŸ¥è¯†ä¸»è¦æ˜¯é¢å‘ç¨‹åºå‘˜çš„ï¼Œå› ä¸ºå°æ—æœ¬èº«ä¹Ÿæ˜¯ä¸ªç¨‹åºå‘˜ï¼Œæ‰€ä»¥æ¶‰åŠåˆ°çš„çŸ¥è¯†ä¸»è¦æ˜¯å…³..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2024-03-25T09:14:07.000Z"}],["meta",{"property":"article:author","content":"JoeyYang"}],["meta",{"property":"article:tag","content":"è®¡ç®—æœºç½‘ç»œ"}],["meta",{"property":"article:published_time","content":"2023-01-09T00:00:00.000Z"}],["meta",{"property":"article:modified_time","content":"2024-03-25T09:14:07.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"è®¡ç®—æœºç½‘ç»œ\\",\\"image\\":[\\"\\"],\\"datePublished\\":\\"2023-01-09T00:00:00.000Z\\",\\"dateModified\\":\\"2024-03-25T09:14:07.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"JoeyYang\\",\\"url\\":\\"https://mister-hope.com\\"}]}"]]},"headers":[{"level":2,"title":"1.1 é€‚åˆä»€ä¹ˆç¾¤ä½“ï¼Ÿ","slug":"_1-1-é€‚åˆä»€ä¹ˆç¾¤ä½“","link":"#_1-1-é€‚åˆä»€ä¹ˆç¾¤ä½“","children":[]},{"level":2,"title":"1.2 è¦æ€ä¹ˆé˜…è¯»ï¼Ÿ","slug":"_1-2-è¦æ€ä¹ˆé˜…è¯»","link":"#_1-2-è¦æ€ä¹ˆé˜…è¯»","children":[]},{"level":2,"title":"2.1 TCP/IP ç½‘ç»œæ¨¡å‹æœ‰å“ªå‡ å±‚ï¼Ÿ","slug":"_2-1-tcp-ip-ç½‘ç»œæ¨¡å‹æœ‰å“ªå‡ å±‚","link":"#_2-1-tcp-ip-ç½‘ç»œæ¨¡å‹æœ‰å“ªå‡ å±‚","children":[]},{"level":2,"title":"2.2 é”®å…¥ç½‘å€åˆ°ç½‘é¡µæ˜¾ç¤ºï¼ŒæœŸé—´å‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ","slug":"_2-2-é”®å…¥ç½‘å€åˆ°ç½‘é¡µæ˜¾ç¤º-æœŸé—´å‘ç”Ÿäº†ä»€ä¹ˆ","link":"#_2-2-é”®å…¥ç½‘å€åˆ°ç½‘é¡µæ˜¾ç¤º-æœŸé—´å‘ç”Ÿäº†ä»€ä¹ˆ","children":[]},{"level":2,"title":"2.3 Linux ç³»ç»Ÿæ˜¯å¦‚ä½•æ”¶å‘ç½‘ç»œåŒ…çš„ï¼Ÿ","slug":"_2-3-linux-ç³»ç»Ÿæ˜¯å¦‚ä½•æ”¶å‘ç½‘ç»œåŒ…çš„","link":"#_2-3-linux-ç³»ç»Ÿæ˜¯å¦‚ä½•æ”¶å‘ç½‘ç»œåŒ…çš„","children":[]},{"level":2,"title":"3.1 HTTP å¸¸è§é¢è¯•é¢˜","slug":"_3-1-http-å¸¸è§é¢è¯•é¢˜","link":"#_3-1-http-å¸¸è§é¢è¯•é¢˜","children":[{"level":3,"title":"3.1.1 HTTP åŸºæœ¬æ¦‚å¿µ","slug":"_3-1-1-http-åŸºæœ¬æ¦‚å¿µ","link":"#_3-1-1-http-åŸºæœ¬æ¦‚å¿µ","children":[]},{"level":3,"title":"3.1.2 GET ä¸ POST","slug":"_3-1-2-get-ä¸-post","link":"#_3-1-2-get-ä¸-post","children":[]},{"level":3,"title":"3.1.3 HTTP ç¼“å­˜æŠ€æœ¯","slug":"_3-1-3-http-ç¼“å­˜æŠ€æœ¯","link":"#_3-1-3-http-ç¼“å­˜æŠ€æœ¯","children":[]},{"level":3,"title":"3.1.4 HTTP ç‰¹æ€§","slug":"_3-1-4-http-ç‰¹æ€§","link":"#_3-1-4-http-ç‰¹æ€§","children":[]},{"level":3,"title":"3.1.5 HTTP ä¸ HTTPS","slug":"_3-1-5-http-ä¸-https","link":"#_3-1-5-http-ä¸-https","children":[]}]},{"level":2,"title":"3.1.6 HTTP/1.1ã€HTTP/2ã€HTTP/3 æ¼”å˜","slug":"_3-1-6-http-1-1ã€http-2ã€http-3-æ¼”å˜","link":"#_3-1-6-http-1-1ã€http-2ã€http-3-æ¼”å˜","children":[]},{"level":2,"title":"--------------","slug":"-3","link":"#-3","children":[]},{"level":2,"title":"ğŸğŸğŸ4.1 TCP ä¸‰æ¬¡æ¡æ‰‹ä¸å››æ¬¡æŒ¥æ‰‹é¢è¯•é¢˜","slug":"ğŸğŸğŸ4-1-tcp-ä¸‰æ¬¡æ¡æ‰‹ä¸å››æ¬¡æŒ¥æ‰‹é¢è¯•é¢˜","link":"#ğŸğŸğŸ4-1-tcp-ä¸‰æ¬¡æ¡æ‰‹ä¸å››æ¬¡æŒ¥æ‰‹é¢è¯•é¢˜","children":[{"level":3,"title":"4.1.1 TCP åŸºæœ¬è®¤è¯†","slug":"_4-1-1-tcp-åŸºæœ¬è®¤è¯†","link":"#_4-1-1-tcp-åŸºæœ¬è®¤è¯†","children":[]},{"level":3,"title":"4.1.2 TCP è¿æ¥å»ºç«‹","slug":"_4-1-2-tcp-è¿æ¥å»ºç«‹","link":"#_4-1-2-tcp-è¿æ¥å»ºç«‹","children":[]},{"level":3,"title":"4.1.3 TCP è¿æ¥æ–­å¼€","slug":"_4-1-3-tcp-è¿æ¥æ–­å¼€","link":"#_4-1-3-tcp-è¿æ¥æ–­å¼€","children":[]}]},{"level":2,"title":"--------------","slug":"-4","link":"#-4","children":[]},{"level":2,"title":"4.2 TCP é‡ä¼ ã€æ»‘åŠ¨çª—å£ã€æµé‡æ§åˆ¶ã€æ‹¥å¡æ§åˆ¶","slug":"_4-2-tcp-é‡ä¼ ã€æ»‘åŠ¨çª—å£ã€æµé‡æ§åˆ¶ã€æ‹¥å¡æ§åˆ¶","link":"#_4-2-tcp-é‡ä¼ ã€æ»‘åŠ¨çª—å£ã€æµé‡æ§åˆ¶ã€æ‹¥å¡æ§åˆ¶","children":[{"level":3,"title":"4.2.1 é‡ä¼ æœºåˆ¶","slug":"_4-2-1-é‡ä¼ æœºåˆ¶","link":"#_4-2-1-é‡ä¼ æœºåˆ¶","children":[]},{"level":3,"title":"4.2.2 æ»‘åŠ¨çª—å£","slug":"_4-2-2-æ»‘åŠ¨çª—å£","link":"#_4-2-2-æ»‘åŠ¨çª—å£","children":[]},{"level":3,"title":"4.2.3 æµé‡æ§åˆ¶","slug":"_4-2-3-æµé‡æ§åˆ¶","link":"#_4-2-3-æµé‡æ§åˆ¶","children":[]},{"level":3,"title":"4.2.4 æ‹¥å¡æ§åˆ¶","slug":"_4-2-4-æ‹¥å¡æ§åˆ¶","link":"#_4-2-4-æ‹¥å¡æ§åˆ¶","children":[]}]},{"level":2,"title":"--------------","slug":"-5","link":"#-5","children":[]},{"level":2,"title":"4.3 TCP å®æˆ˜æŠ“åŒ…åˆ†æ","slug":"_4-3-tcp-å®æˆ˜æŠ“åŒ…åˆ†æ","link":"#_4-3-tcp-å®æˆ˜æŠ“åŒ…åˆ†æ","children":[]},{"level":2,"title":"--------------","slug":"-6","link":"#-6","children":[]},{"level":2,"title":"4.4 TCP åŠè¿æ¥é˜Ÿåˆ—å’Œå…¨è¿æ¥é˜Ÿåˆ—","slug":"_4-4-tcp-åŠè¿æ¥é˜Ÿåˆ—å’Œå…¨è¿æ¥é˜Ÿåˆ—","link":"#_4-4-tcp-åŠè¿æ¥é˜Ÿåˆ—å’Œå…¨è¿æ¥é˜Ÿåˆ—","children":[{"level":3,"title":"- ä»€ä¹ˆæ˜¯ TCP åŠè¿æ¥é˜Ÿåˆ—å’Œå…¨è¿æ¥é˜Ÿåˆ—ï¼Ÿ","slug":"ä»€ä¹ˆæ˜¯-tcp-åŠè¿æ¥é˜Ÿåˆ—å’Œå…¨è¿æ¥é˜Ÿåˆ—","link":"#ä»€ä¹ˆæ˜¯-tcp-åŠè¿æ¥é˜Ÿåˆ—å’Œå…¨è¿æ¥é˜Ÿåˆ—","children":[]},{"level":3,"title":"- å®æˆ˜ - TCP å…¨è¿æ¥é˜Ÿåˆ—æº¢å‡º","slug":"å®æˆ˜-tcp-å…¨è¿æ¥é˜Ÿåˆ—æº¢å‡º","link":"#å®æˆ˜-tcp-å…¨è¿æ¥é˜Ÿåˆ—æº¢å‡º","children":[]},{"level":3,"title":"- å®æˆ˜ - TCP åŠè¿æ¥é˜Ÿåˆ—æº¢å‡º","slug":"å®æˆ˜-tcp-åŠè¿æ¥é˜Ÿåˆ—æº¢å‡º","link":"#å®æˆ˜-tcp-åŠè¿æ¥é˜Ÿåˆ—æº¢å‡º","children":[]}]},{"level":2,"title":"--------------","slug":"-7","link":"#-7","children":[]},{"level":2,"title":"4.5 å¦‚ä½•ä¼˜åŒ– TCP?","slug":"_4-5-å¦‚ä½•ä¼˜åŒ–-tcp","link":"#_4-5-å¦‚ä½•ä¼˜åŒ–-tcp","children":[{"level":3,"title":"- TCP ä¸‰æ¬¡æ¡æ‰‹çš„æ€§èƒ½æå‡","slug":"tcp-ä¸‰æ¬¡æ¡æ‰‹çš„æ€§èƒ½æå‡","link":"#tcp-ä¸‰æ¬¡æ¡æ‰‹çš„æ€§èƒ½æå‡","children":[]},{"level":3,"title":"- TCP å››æ¬¡æŒ¥æ‰‹çš„æ€§èƒ½æå‡","slug":"tcp-å››æ¬¡æŒ¥æ‰‹çš„æ€§èƒ½æå‡","link":"#tcp-å››æ¬¡æŒ¥æ‰‹çš„æ€§èƒ½æå‡","children":[]},{"level":3,"title":"#ä¸»åŠ¨æ–¹çš„ä¼˜åŒ–","slug":"ä¸»åŠ¨æ–¹çš„ä¼˜åŒ–","link":"#ä¸»åŠ¨æ–¹çš„ä¼˜åŒ–","children":[]},{"level":3,"title":"#è¢«åŠ¨æ–¹çš„ä¼˜åŒ–","slug":"è¢«åŠ¨æ–¹çš„ä¼˜åŒ–","link":"#è¢«åŠ¨æ–¹çš„ä¼˜åŒ–","children":[]},{"level":3,"title":"#å°ç»“","slug":"å°ç»“-2","link":"#å°ç»“-2","children":[]}]},{"level":2,"title":"#TCP ä¼ è¾“æ•°æ®çš„æ€§èƒ½æå‡","slug":"tcp-ä¼ è¾“æ•°æ®çš„æ€§èƒ½æå‡","link":"#tcp-ä¼ è¾“æ•°æ®çš„æ€§èƒ½æå‡","children":[{"level":3,"title":"#æ»‘åŠ¨çª—å£æ˜¯å¦‚ä½•å½±å“ä¼ è¾“é€Ÿåº¦çš„ï¼Ÿ","slug":"æ»‘åŠ¨çª—å£æ˜¯å¦‚ä½•å½±å“ä¼ è¾“é€Ÿåº¦çš„","link":"#æ»‘åŠ¨çª—å£æ˜¯å¦‚ä½•å½±å“ä¼ è¾“é€Ÿåº¦çš„","children":[]},{"level":3,"title":"#å¦‚ä½•ç¡®å®šæœ€å¤§ä¼ è¾“é€Ÿåº¦ï¼Ÿ","slug":"å¦‚ä½•ç¡®å®šæœ€å¤§ä¼ è¾“é€Ÿåº¦","link":"#å¦‚ä½•ç¡®å®šæœ€å¤§ä¼ è¾“é€Ÿåº¦","children":[]},{"level":3,"title":"#æ€æ ·è°ƒæ•´ç¼“å†²åŒºå¤§å°ï¼Ÿ","slug":"æ€æ ·è°ƒæ•´ç¼“å†²åŒºå¤§å°","link":"#æ€æ ·è°ƒæ•´ç¼“å†²åŒºå¤§å°","children":[]},{"level":3,"title":"#å°ç»“","slug":"å°ç»“-3","link":"#å°ç»“-3","children":[]}]},{"level":2,"title":"--------------","slug":"-8","link":"#-8","children":[]},{"level":2,"title":"4.6 å¦‚ä½•ç†è§£æ˜¯ TCP é¢å‘å­—èŠ‚æµåè®®ï¼Ÿ","slug":"_4-6-å¦‚ä½•ç†è§£æ˜¯-tcp-é¢å‘å­—èŠ‚æµåè®®","link":"#_4-6-å¦‚ä½•ç†è§£æ˜¯-tcp-é¢å‘å­—èŠ‚æµåè®®","children":[{"level":3,"title":"- å¦‚ä½•ç†è§£å­—èŠ‚æµï¼Ÿ","slug":"å¦‚ä½•ç†è§£å­—èŠ‚æµ","link":"#å¦‚ä½•ç†è§£å­—èŠ‚æµ","children":[]},{"level":3,"title":"- å¦‚ä½•è§£å†³ç²˜åŒ…ï¼Ÿ","slug":"å¦‚ä½•è§£å†³ç²˜åŒ…","link":"#å¦‚ä½•è§£å†³ç²˜åŒ…","children":[]}]},{"level":2,"title":"---------------","slug":"-9","link":"#-9","children":[]},{"level":2,"title":"ğŸ•ğŸ•ğŸ•4.16 TCP åè®®æœ‰ä»€ä¹ˆç¼ºé™·ï¼Ÿ","slug":"ğŸ•ğŸ•ğŸ•4-16-tcp-åè®®æœ‰ä»€ä¹ˆç¼ºé™·","link":"#ğŸ•ğŸ•ğŸ•4-16-tcp-åè®®æœ‰ä»€ä¹ˆç¼ºé™·","children":[{"level":3,"title":"- å‡çº§ TCP çš„å·¥ä½œå¾ˆå›°éš¾","slug":"å‡çº§-tcp-çš„å·¥ä½œå¾ˆå›°éš¾","link":"#å‡çº§-tcp-çš„å·¥ä½œå¾ˆå›°éš¾","children":[]},{"level":3,"title":"- TCP å»ºç«‹è¿æ¥çš„ å»¶è¿Ÿ","slug":"tcp-å»ºç«‹è¿æ¥çš„-å»¶è¿Ÿ","link":"#tcp-å»ºç«‹è¿æ¥çš„-å»¶è¿Ÿ","children":[]},{"level":3,"title":"- TCP å­˜åœ¨é˜Ÿå¤´é˜»å¡é—®é¢˜","slug":"tcp-å­˜åœ¨é˜Ÿå¤´é˜»å¡é—®é¢˜","link":"#tcp-å­˜åœ¨é˜Ÿå¤´é˜»å¡é—®é¢˜","children":[]},{"level":3,"title":"- ç½‘ç»œè¿ç§»éœ€è¦é‡æ–°å»ºç«‹ TCP è¿æ¥","slug":"ç½‘ç»œè¿ç§»éœ€è¦é‡æ–°å»ºç«‹-tcp-è¿æ¥","link":"#ç½‘ç»œè¿ç§»éœ€è¦é‡æ–°å»ºç«‹-tcp-è¿æ¥","children":[]},{"level":3,"title":"- ç»“å°¾","slug":"ç»“å°¾","link":"#ç»“å°¾","children":[]}]},{"level":2,"title":"--------------","slug":"-10","link":"#-10","children":[]},{"level":2,"title":"ğŸƒğŸƒğŸƒ4.17 å¦‚ä½•åŸºäº UDP åè®®å®ç°å¯é ä¼ è¾“ï¼Ÿ","slug":"ğŸƒğŸƒğŸƒ4-17-å¦‚ä½•åŸºäº-udp-åè®®å®ç°å¯é ä¼ è¾“","link":"#ğŸƒğŸƒğŸƒ4-17-å¦‚ä½•åŸºäº-udp-åè®®å®ç°å¯é ä¼ è¾“","children":[{"level":3,"title":"ğŸ”® QUIC æ˜¯å¦‚ä½•å®ç°å¯é ä¼ è¾“çš„ï¼Ÿ","slug":"ğŸ”®-quic-æ˜¯å¦‚ä½•å®ç°å¯é ä¼ è¾“çš„","link":"#ğŸ”®-quic-æ˜¯å¦‚ä½•å®ç°å¯é ä¼ è¾“çš„","children":[]},{"level":3,"title":"ğŸ”® QUIC æ˜¯å¦‚ä½•è§£å†³ TCP é˜Ÿå¤´é˜»å¡é—®é¢˜çš„ï¼Ÿ","slug":"ğŸ”®-quic-æ˜¯å¦‚ä½•è§£å†³-tcp-é˜Ÿå¤´é˜»å¡é—®é¢˜çš„","link":"#ğŸ”®-quic-æ˜¯å¦‚ä½•è§£å†³-tcp-é˜Ÿå¤´é˜»å¡é—®é¢˜çš„","children":[]},{"level":3,"title":"ğŸ”® QUIC æ˜¯å¦‚ä½•åšæµé‡æ§åˆ¶çš„ï¼Ÿ","slug":"ğŸ”®-quic-æ˜¯å¦‚ä½•åšæµé‡æ§åˆ¶çš„","link":"#ğŸ”®-quic-æ˜¯å¦‚ä½•åšæµé‡æ§åˆ¶çš„","children":[]},{"level":3,"title":"ğŸ”® QUIC å¯¹æ‹¥å¡æ§åˆ¶æ”¹è¿›","slug":"ğŸ”®-quic-å¯¹æ‹¥å¡æ§åˆ¶æ”¹è¿›","link":"#ğŸ”®-quic-å¯¹æ‹¥å¡æ§åˆ¶æ”¹è¿›","children":[]},{"level":3,"title":"ğŸ”® QUIC æ›´å¿«çš„è¿æ¥å»ºç«‹","slug":"ğŸ”®-quic-æ›´å¿«çš„è¿æ¥å»ºç«‹","link":"#ğŸ”®-quic-æ›´å¿«çš„è¿æ¥å»ºç«‹","children":[]},{"level":3,"title":"ğŸ”® QUIC æ˜¯å¦‚ä½•è¿ç§»è¿æ¥çš„ï¼Ÿ","slug":"ğŸ”®-quic-æ˜¯å¦‚ä½•è¿ç§»è¿æ¥çš„","link":"#ğŸ”®-quic-æ˜¯å¦‚ä½•è¿ç§»è¿æ¥çš„","children":[]}]}],"git":{"createdTime":1711358047000,"updatedTime":1711358047000,"contributors":[{"name":"joey_yang_yx","email":"joey_yang_yx@163.com","commits":1}]},"readingTime":{"minutes":332.98,"words":99895},"filePathRelative":"posts/Cpp/å›¾è§£è®¡ç®—æœºç½‘ç»œ.md","localizedDate":"2023å¹´1æœˆ9æ—¥","excerpt":"\\n<h1>å›¾è§£ç½‘ç»œ</h1>\\n<h1>-----------------</h1>\\n<p>ç®€å•ä»‹ç»ä¸‹ã€Šå›¾è§£ç½‘ç»œã€‹ï¼Œæ•´ä¸ªå†…å®¹å…±æœ‰ <strong><code>20W</code> å­— + <code>500</code> å¼ å›¾</strong>ï¼Œæ¯ä¸€ç¯‡éƒ½è‡ªå·±æ‰‹ç»˜äº†å¾ˆå¤šå›¾ï¼Œç›®çš„ä¹Ÿå¾ˆç®€å•ï¼Œæƒ³é€šè¿‡ã€Œè¯´äººè¯+å›¾è§£ã€çš„æ–¹å¼ï¼Œå‡»ç ´å¤§å®¶å¯¹äºã€Œå…«è‚¡æ–‡ã€çš„ææƒ§</p>\\n<h1>ä¸€ã€ç®€ä»‹</h1>\\n<h2>1.1 é€‚åˆä»€ä¹ˆç¾¤ä½“ï¼Ÿ</h2>\\n<p>ã€Šå›¾è§£ç½‘ç»œã€‹å†™çš„ç½‘ç»œçŸ¥è¯†ä¸»è¦æ˜¯<strong>é¢å‘ç¨‹åºå‘˜</strong>çš„ï¼Œå› ä¸ºå°æ—æœ¬èº«ä¹Ÿæ˜¯ä¸ªç¨‹åºå‘˜ï¼Œæ‰€ä»¥æ¶‰åŠåˆ°çš„çŸ¥è¯†ä¸»è¦æ˜¯å…³äºç¨‹åºå‘˜æ—¥å¸¸å·¥ä½œæˆ–è€…é¢è¯•çš„ç½‘ç»œçŸ¥è¯†ã€‚</p>","autoDesc":true}');export{qg as comp,yg as data};
